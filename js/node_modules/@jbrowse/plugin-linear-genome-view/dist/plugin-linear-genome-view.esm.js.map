{"version":3,"file":"plugin-linear-genome-view.esm.js","sources":["../src/BaseLinearDisplay/models/baseLinearDisplayConfigSchema.ts","../../../node_modules/regenerator-runtime/runtime.js","../src/BaseLinearDisplay/components/Block.tsx","../src/BaseLinearDisplay/components/LinearBlocks.tsx","../src/BaseLinearDisplay/components/BaseLinearDisplay.tsx","../src/BaseLinearDisplay/components/ServerSideRenderedBlockContent.tsx","../src/BaseLinearDisplay/models/serverSideRenderedBlock.ts","../src/BaseLinearDisplay/models/BaseLinearDisplayModel.tsx","../src/LinearBareDisplay/configSchema.ts","../src/LinearBareDisplay/model.ts","../src/LinearGenomeView/components/RefNameAutocomplete.tsx","../src/LinearGenomeView/util.ts","../src/LinearGenomeView/components/OverviewRubberBand.tsx","../src/LinearGenomeView/components/OverviewScaleBar.tsx","../src/LinearGenomeView/components/ZoomControls.tsx","../src/LinearGenomeView/components/Header.tsx","../src/LinearGenomeView/components/TrackLabel.tsx","../src/LinearGenomeView/components/TrackContainer.tsx","../src/LinearGenomeView/components/RubberBand.tsx","../src/LinearGenomeView/components/ScaleBar.tsx","../src/LinearGenomeView/components/VerticalGuides.tsx","../src/LinearGenomeView/components/CenterLine.tsx","../src/LinearGenomeView/components/TracksContainer.tsx","../src/LinearGenomeView/components/SearchResultsDialog.tsx","../src/LinearGenomeView/components/ImportForm.tsx","../src/LinearGenomeView/components/MiniControls.tsx","../src/LinearGenomeView/components/SequenceDialog.tsx","../src/LinearGenomeView/components/Ruler.tsx","../src/LinearGenomeView/components/LinearGenomeView.tsx","../src/LinearGenomeView/components/ExportSvgDialog.tsx","../src/LinearGenomeView/components/ReturnToImportFormDialog.tsx","../src/LinearGenomeView/index.tsx","../src/LinearBasicDisplay/model.ts","../src/LinearBasicDisplay/configSchema.ts","../src/index.ts","../src/LinearBasicDisplay/components/SetMaxHeight.tsx"],"sourcesContent":["import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport const baseLinearDisplayConfigSchema = ConfigurationSchema(\n  'BaseLinearDisplay',\n  {\n    maxDisplayedBpPerPx: {\n      type: 'number',\n      description: 'maximum bpPerPx that is displayed in the view',\n      defaultValue: Number.MAX_VALUE,\n    },\n  },\n  { explicitIdentifier: 'displayId' },\n)\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n    return obj[key];\n  }\n  try {\n    // IE 8 has a broken Object.defineProperty that only works on DOM objects.\n    define({}, \"\");\n  } catch (err) {\n    define = function(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunction.displayName = define(\n    GeneratorFunctionPrototype,\n    toStringTagSymbol,\n    \"GeneratorFunction\"\n  );\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      define(prototype, method, function(arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      define(genFun, toStringTagSymbol, \"GeneratorFunction\");\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return PromiseImpl.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return PromiseImpl.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    if (PromiseImpl === void 0) PromiseImpl = Promise;\n\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList),\n      PromiseImpl\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  define(Gp, toStringTagSymbol, \"Generator\");\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  typeof module === \"object\" ? module.exports : {}\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n}\n","import { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport React from 'react'\n\nconst useStyles = makeStyles(theme => ({\n  contentBlock: {\n    position: 'relative',\n    minHeight: '100%',\n    boxSizing: 'border-box',\n    whiteSpace: 'nowrap',\n    overflow: 'hidden',\n  },\n  elidedBlock: {\n    minHeight: '100%',\n    boxSizing: 'border-box',\n    backgroundColor: '#999',\n    backgroundImage:\n      'repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)',\n  },\n  interRegionPaddingBlock: {\n    minHeight: '100%',\n    backgroundColor: theme.palette.text.primary,\n  },\n  boundaryPaddingBlock: {\n    minHeight: '100%',\n    backgroundColor: theme.palette.action.disabledBackground,\n  },\n}))\n\ninterface ContentBlockProps {\n  block: BaseBlock\n  children: React.ReactNode\n}\n\ninterface ElidedBlockProps {\n  width: number\n}\n\ninterface InterRegionPaddingBlockProps {\n  boundary: boolean\n  width: number\n  style?: React.CSSProperties\n}\n\nconst ContentBlock = observer(({ block, children }: ContentBlockProps) => {\n  const classes = useStyles()\n  return (\n    <div\n      style={{\n        width: `${block.widthPx}px`,\n      }}\n      className={classes.contentBlock}\n    >\n      {children}\n    </div>\n  )\n})\n\nfunction ElidedBlock({ width }: ElidedBlockProps) {\n  const classes = useStyles()\n  return <div className={classes.elidedBlock} style={{ width: `${width}px` }} />\n}\n\nfunction InterRegionPaddingBlock({\n  boundary,\n  width,\n  style = {},\n}: InterRegionPaddingBlockProps) {\n  const classes = useStyles()\n  return (\n    <div\n      style={{\n        ...style,\n        width: `${width}px`,\n      }}\n      className={\n        boundary\n          ? classes.boundaryPaddingBlock\n          : classes.interRegionPaddingBlock\n      }\n    />\n  )\n}\n\nexport { ContentBlock, ElidedBlock, InterRegionPaddingBlock }\n","import { makeStyles } from '@material-ui/core/styles'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { observer, PropTypes } from 'mobx-react'\nimport React from 'react'\nimport {\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from '@jbrowse/core/util/blockTypes'\nimport { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from './Block'\n\nconst useStyles = makeStyles({\n  linearBlocks: {\n    whiteSpace: 'nowrap',\n    textAlign: 'left',\n    position: 'absolute',\n    minHeight: '100%',\n    display: 'flex',\n  },\n  heightOverflowed: {\n    position: 'absolute',\n    color: 'rgb(77,77,77)',\n    borderBottom: '2px solid rgb(77,77,77)',\n    textShadow: 'white 0px 0px 1px',\n    whiteSpace: 'nowrap',\n    width: '100%',\n    fontWeight: 'bold',\n    textAlign: 'center',\n    zIndex: 2000,\n    boxSizing: 'border-box',\n  },\n})\nconst RenderedBlocks = observer(\n  ({ model }: { model: BaseLinearDisplayModel }) => {\n    const classes = useStyles()\n    const { blockDefinitions, blockState } = model\n    return (\n      <>\n        {blockDefinitions.map(block => {\n          if (block instanceof ContentBlock) {\n            const state = blockState.get(block.key)\n\n            return (\n              <ContentBlockComponent\n                block={block}\n                key={`${model.id}-${block.key}`}\n              >\n                {state && state.ReactComponent ? (\n                  <state.ReactComponent model={state} />\n                ) : null}\n                {state && state.maxHeightReached ? (\n                  <div\n                    className={classes.heightOverflowed}\n                    style={{\n                      top: state.layout.getTotalHeight() - 16,\n                      pointerEvents: 'none',\n                      height: 16,\n                    }}\n                  >\n                    Max height reached\n                  </div>\n                ) : null}\n              </ContentBlockComponent>\n            )\n          }\n          if (block instanceof ElidedBlock) {\n            return (\n              <ElidedBlockComponent\n                key={`${model.id}-${block.key}`}\n                width={block.widthPx}\n              />\n            )\n          }\n          if (block instanceof InterRegionPaddingBlock) {\n            return (\n              <InterRegionPaddingBlockComponent\n                key={block.key}\n                width={block.widthPx}\n                style={{ background: 'none' }}\n                boundary={block.variant === 'boundary'}\n              />\n            )\n          }\n          throw new Error(`invalid block type ${typeof block}`)\n        })}\n      </>\n    )\n  },\n)\nfunction LinearBlocks({ model }: { model: BaseLinearDisplayModel }) {\n  const classes = useStyles()\n  const { blockDefinitions } = model\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const viewModel = getContainingView(model) as any\n  return (\n    <div\n      data-testid=\"Blockset\"\n      className={classes.linearBlocks}\n      style={{\n        left: blockDefinitions.offsetPx - viewModel.offsetPx,\n      }}\n    >\n      <RenderedBlocks model={model} />\n    </div>\n  )\n}\n\nLinearBlocks.propTypes = {\n  model: PropTypes.observableObject.isRequired,\n}\n\nexport { RenderedBlocks, useStyles }\nexport default observer(LinearBlocks)\n","import { getConf } from '@jbrowse/core/configuration'\nimport { Menu } from '@jbrowse/core/ui'\nimport { useTheme, makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport React, { useState, useRef } from 'react'\nimport MUITooltip from '@material-ui/core/Tooltip'\nimport LinearBlocks from './LinearBlocks'\nimport { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\nconst useStyles = makeStyles({\n  display: {\n    position: 'relative',\n    whiteSpace: 'nowrap',\n    textAlign: 'left',\n    width: '100%',\n    minHeight: '100%',\n  },\n})\nconst Tooltip = observer(\n  (props: { model: BaseLinearDisplayModel; mouseCoord: [number, number] }) => {\n    const { model, mouseCoord } = props\n    const { featureUnderMouse } = model\n    const mouseover = featureUnderMouse\n      ? getConf(model, 'mouseover', { feature: featureUnderMouse })\n      : undefined\n    return mouseover ? (\n      <MUITooltip title={mouseover} open placement=\"right\">\n        <div\n          style={{\n            position: 'absolute',\n            left: mouseCoord[0],\n            top: mouseCoord[1],\n          }}\n        >\n          {' '}\n        </div>\n      </MUITooltip>\n    ) : null\n  },\n)\n\ntype Coord = [number, number]\nconst BaseLinearDisplay = observer(\n  (props: { model: BaseLinearDisplayModel; children?: React.ReactNode }) => {\n    const classes = useStyles()\n    const theme = useTheme()\n\n    const [mouseCoord, setMouseCoord] = useState<Coord>([0, 0])\n    const [contextCoord, setContextCoord] = useState<Coord>()\n    const ref = useRef<HTMLDivElement>(null)\n    const { model, children } = props\n    const {\n      TooltipComponent,\n      DisplayMessageComponent,\n      contextMenuItems,\n      height,\n      setContextMenuFeature,\n    } = model\n\n    return (\n      <div\n        ref={ref}\n        data-testid={`display-${getConf(model, 'displayId')}`}\n        className={classes.display}\n        onContextMenu={event => {\n          event.preventDefault()\n          if (contextCoord) {\n            // There's already a context menu open, so close it\n            setContextCoord(undefined)\n          } else if (ref.current) {\n            setContextCoord([event.clientX, event.clientY])\n          }\n        }}\n        onMouseMove={event => {\n          if (ref.current) {\n            const rect = ref.current.getBoundingClientRect()\n            setMouseCoord([event.clientX - rect.left, event.clientY - rect.top])\n          }\n        }}\n        role=\"presentation\"\n      >\n        {DisplayMessageComponent ? (\n          <DisplayMessageComponent model={model} />\n        ) : (\n          <LinearBlocks {...props} />\n        )}\n        {children}\n        <TooltipComponent\n          model={model}\n          height={height}\n          mouseCoord={mouseCoord}\n        />\n\n        <Menu\n          open={Boolean(contextCoord) && Boolean(contextMenuItems.length)}\n          onMenuItemClick={(_, callback) => {\n            callback()\n            setContextCoord(undefined)\n          }}\n          onClose={() => {\n            setContextCoord(undefined)\n            setContextMenuFeature(undefined)\n          }}\n          onExit={() => {\n            setContextCoord(undefined)\n            setContextMenuFeature(undefined)\n          }}\n          anchorReference=\"anchorPosition\"\n          anchorPosition={\n            contextCoord\n              ? { top: contextCoord[1], left: contextCoord[0] }\n              : undefined\n          }\n          style={{ zIndex: theme.zIndex.tooltip }}\n          menuItems={contextMenuItems}\n          data-testid=\"base_linear_display_context_menu\"\n        />\n      </div>\n    )\n  },\n)\n\nexport default BaseLinearDisplay\nexport { Tooltip }\n","import React, { useEffect, useState } from 'react'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport { getParent } from 'mobx-state-tree'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport Button from '@material-ui/core/Button'\nimport RefreshIcon from '@material-ui/icons/Refresh'\n\nconst useStyles = makeStyles(theme => ({\n  loading: {\n    paddingLeft: '0.6em',\n    backgroundColor: theme.palette.action.disabledBackground,\n    backgroundImage:\n      'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n    height: '100%',\n    width: '100%',\n    pointerEvents: 'none',\n    textAlign: 'center',\n  },\n  blockMessage: {\n    width: '100%',\n    background: theme.palette.action.disabledBackground,\n    padding: theme.spacing(2),\n    pointerEvents: 'none',\n    textAlign: 'center',\n  },\n  blockError: {\n    padding: theme.spacing(2),\n    width: '100%',\n    whiteSpace: 'normal',\n    color: theme.palette.error.main,\n    overflowY: 'auto',\n  },\n  blockReactNodeMessage: {\n    width: '100%',\n    background: theme.palette.action.disabledBackground,\n    padding: theme.spacing(2),\n    textAlign: 'center',\n  },\n  dots: {\n    '&::after': {\n      display: 'inline-block',\n      animation: '$ellipsis 1.5s infinite',\n      content: '\".\"',\n      width: '1em',\n      textAlign: 'left',\n    },\n  },\n  '@keyframes ellipsis': {\n    '0%': {\n      content: '\".\"',\n    },\n    '33%': {\n      content: '\"..\"',\n    },\n    '66%': {\n      content: '\"...\"',\n    },\n  },\n}))\n\nfunction Repeater({ children }: { children: React.ReactNode }) {\n  return (\n    <div style={{ display: 'flex' }}>\n      {children}\n      {children}\n    </div>\n  )\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst LoadingMessage = observer(({ model }: { model: any }) => {\n  // only show the loading message after 300ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  const classes = useStyles()\n  useEffect(() => {\n    let killed = false\n    const timeout = setTimeout(() => {\n      if (!killed) {\n        setShown(true)\n      }\n    }, 300)\n    return () => {\n      clearTimeout(timeout)\n      killed = true\n    }\n  }, [])\n\n  const { status: blockStatus } = model\n  const { message: displayStatus } = getParent(model, 2)\n  const status = displayStatus || blockStatus\n  return (\n    <>\n      {shown ? (\n        <div className={classes.loading}>\n          <Typography className={classes.dots} variant=\"body2\">\n            {status ? `${status}` : 'Loading'}\n          </Typography>\n        </div>\n      ) : null}\n    </>\n  )\n})\n\nfunction BlockMessage({\n  messageContent,\n}: {\n  messageContent: string | React.ReactNode\n}) {\n  const classes = useStyles()\n\n  return React.isValidElement(messageContent) ? (\n    <div className={classes.blockReactNodeMessage}>{messageContent}</div>\n  ) : (\n    <Typography variant=\"body2\" className={classes.blockMessage}>\n      {messageContent}\n    </Typography>\n  )\n}\n\nfunction BlockError({\n  error,\n  reload,\n  displayHeight,\n}: {\n  error: Error\n  reload: () => void\n  displayHeight: number\n}) {\n  const classes = useStyles()\n  return (\n    <div className={classes.blockError} style={{ height: displayHeight }}>\n      {reload ? (\n        <Button\n          data-testid=\"reload_button\"\n          onClick={reload}\n          startIcon={<RefreshIcon />}\n        >\n          Reload\n        </Button>\n      ) : null}\n      <Typography color=\"error\" variant=\"body2\" display=\"inline\">\n        {`${error}`}\n      </Typography>\n    </div>\n  )\n}\n\nconst ServerSideRenderedBlockContent = observer(\n  ({\n    model,\n  }: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    model: any\n  }) => {\n    if (model.error) {\n      return (\n        <Repeater>\n          <BlockError\n            error={model.error}\n            reload={model.reload}\n            displayHeight={getParentRenderProps(model).displayModel.height}\n          />\n        </Repeater>\n      )\n    }\n    if (model.message) {\n      return (\n        <Repeater>\n          <BlockMessage messageContent={model.message} />\n        </Repeater>\n      )\n    }\n    if (!model.filled) {\n      return (\n        <Repeater>\n          <LoadingMessage model={model} />\n        </Repeater>\n      )\n    }\n    return model.reactElement\n  },\n)\n\nexport default ServerSideRenderedBlockContent\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types, getParent, isAlive, cast, Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { Region } from '@jbrowse/core/util/types/mst'\nimport { AbstractDisplayModel } from '@jbrowse/core/util/types'\nimport React from 'react'\n\nimport {\n  assembleLocString,\n  makeAbortableReaction,\n  getSession,\n  getContainingDisplay,\n} from '@jbrowse/core/util'\nimport {\n  getTrackAssemblyNames,\n  getRpcSessionId,\n} from '@jbrowse/core/util/tracks'\n\nimport ServerSideRenderedBlockContent from '../components/ServerSideRenderedBlockContent'\n\n// the MST state of a single server-side-rendered block in a display\nconst blockState = types\n  .model('BlockState', {\n    key: types.string,\n    region: Region,\n    isLeftEndOfDisplayedRegion: false,\n    isRightEndOfDisplayedRegion: false,\n  })\n  // NOTE: all this volatile stuff has to be filled in at once, so that it stays consistent\n  .volatile(() => ({\n    renderInProgress: undefined as AbortController | undefined,\n    filled: false,\n    reactElement: undefined as React.ReactElement | undefined,\n    features: undefined as Map<string, Feature> | undefined,\n    layout: undefined as any,\n    status: '',\n    error: undefined as Error | undefined,\n    message: undefined as string | undefined,\n    maxHeightReached: false,\n    ReactComponent: ServerSideRenderedBlockContent,\n    renderProps: undefined as any,\n  }))\n  .actions(self => {\n    let renderInProgress: undefined | AbortController\n    return {\n      afterAttach() {\n        const display = getContainingDisplay(self)\n        makeAbortableReaction(\n          self as any,\n          renderBlockData,\n          renderBlockEffect as any, // reaction doesn't expect async here\n          {\n            name: `${display.id}/${assembleLocString(self.region)} rendering`,\n            delay: display.renderDelay,\n            fireImmediately: true,\n          },\n          this.setLoading,\n          this.setRendered,\n          this.setError,\n        )\n      },\n      setStatus(message: string) {\n        self.status = message\n      },\n      setLoading(abortController: AbortController) {\n        if (renderInProgress !== undefined) {\n          if (!renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n        }\n        self.filled = false\n        self.message = undefined\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.error = undefined\n        self.maxHeightReached = false\n        self.renderProps = undefined\n        renderInProgress = abortController\n      },\n      setMessage(messageText: string) {\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        self.filled = false\n        self.message = messageText\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.error = undefined\n        self.maxHeightReached = false\n        self.renderProps = undefined\n        renderInProgress = undefined\n      },\n      setRendered(\n        props:\n          | {\n              reactElement: React.ReactElement\n              features: Map<string, Feature>\n              layout: any\n              maxHeightReached: boolean\n              renderProps: any\n            }\n          | undefined,\n      ) {\n        if (!props) {\n          return\n        }\n        const {\n          reactElement,\n          features,\n          layout,\n          maxHeightReached,\n          renderProps,\n        } = props\n        self.filled = true\n        self.message = undefined\n        self.reactElement = reactElement\n        self.features = features\n        self.layout = layout\n        self.error = undefined\n        self.maxHeightReached = maxHeightReached\n        self.renderProps = renderProps\n        renderInProgress = undefined\n      },\n      setError(error: Error) {\n        console.error(error)\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        // the rendering failed for some reason\n        self.filled = false\n        self.message = undefined\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.maxHeightReached = false\n        self.error = error\n        self.renderProps = undefined\n        renderInProgress = undefined\n      },\n      reload() {\n        self.renderInProgress = undefined\n        self.filled = false\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.error = undefined\n        self.message = undefined\n        self.maxHeightReached = false\n        self.ReactComponent = ServerSideRenderedBlockContent\n        self.renderProps = undefined\n        getParent(self, 2).reload()\n      },\n      beforeDestroy() {\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        const display = getContainingDisplay(self)\n        const { rpcManager } = getSession(self)\n        const { rendererType } = display\n        const { renderArgs } = renderBlockData(cast(self))\n        // renderArgs can be undefined if an error occured in this block\n        if (renderArgs) {\n          rendererType\n            .freeResourcesInClient(\n              rpcManager,\n              JSON.parse(JSON.stringify(renderArgs)),\n            )\n            .catch((e: Error) => {\n              // just console.error if it's something while it's being destroyed\n              console.warn('Error while destroying block', e)\n            })\n        }\n      },\n    }\n  })\n\nexport default blockState\nexport type BlockStateModel = typeof blockState\nexport type BlockModel = Instance<BlockStateModel>\n\n// calls the render worker to render the block content not using a flow for\n// this, because the flow doesn't work with autorun\nexport function renderBlockData(\n  self: Instance<BlockStateModel>,\n  optDisplay?: AbstractDisplayModel,\n) {\n  try {\n    const display = optDisplay || (getContainingDisplay(self) as any)\n    const { assemblyManager, rpcManager } = getSession(display)\n    const {\n      adapterConfig,\n      renderProps,\n      rendererType,\n      error: displayError,\n      parentTrack,\n    } = display\n    const assemblyNames = getTrackAssemblyNames(parentTrack)\n    const regionAsm = self.region.assemblyName\n    if (\n      !assemblyNames.includes(regionAsm) &&\n      !assemblyNames.find(name => assemblyManager.get(name)?.hasName(regionAsm))\n    ) {\n      throw new Error(\n        `region assembly (${regionAsm}) does not match track assemblies (${assemblyNames})`,\n      )\n    }\n\n    const { config } = renderProps\n    // This line is to trigger the mobx reaction when the config changes\n    // It won't trigger the reaction if it doesn't think we're accessing it\n    readConfObject(config)\n\n    const sessionId = getRpcSessionId(display)\n    const cannotBeRenderedReason = display.regionCannotBeRendered(self.region)\n\n    return {\n      rendererType,\n      rpcManager,\n      renderProps,\n      cannotBeRenderedReason,\n      displayError,\n      renderArgs: {\n        statusCallback: (message: string) => {\n          if (isAlive(self)) {\n            self.setStatus(message)\n          }\n        },\n        assemblyName: self.region.assemblyName,\n        regions: [self.region],\n        adapterConfig,\n        rendererType: rendererType.name,\n        sessionId,\n        blockKey: self.key,\n        timeout: 1000000, // 10000,\n      },\n    }\n  } catch (e) {\n    return { displayError: e }\n  }\n}\n\ninterface RenderProps {\n  displayError: Error\n  rendererType: any\n  renderProps: { [key: string]: any }\n  rpcManager: { call: Function }\n  cannotBeRenderedReason: string\n  renderArgs: { [key: string]: any }\n}\n\ninterface ErrorProps {\n  displayError: string\n}\n\nasync function renderBlockEffect(\n  props: RenderProps | ErrorProps,\n  signal: AbortSignal,\n  self: Instance<BlockStateModel>,\n) {\n  const {\n    rendererType,\n    renderProps,\n    rpcManager,\n    renderArgs,\n    cannotBeRenderedReason,\n    displayError,\n  } = props as RenderProps\n  if (!isAlive(self)) {\n    return undefined\n  }\n\n  if (displayError) {\n    self.setError(displayError)\n    return undefined\n  }\n  if (cannotBeRenderedReason) {\n    self.setMessage(cannotBeRenderedReason)\n    return undefined\n  }\n\n  if (renderProps.notReady) {\n    return undefined\n  }\n\n  const {\n    reactElement,\n    features,\n    layout,\n    maxHeightReached,\n  } = await rendererType.renderInClient(rpcManager, {\n    ...renderArgs,\n    ...renderProps,\n    signal,\n  })\n  return {\n    reactElement,\n    features,\n    layout,\n    maxHeightReached,\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any,react/no-danger */\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport {\n  getContainingView,\n  getSession,\n  isSelectionContainer,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport { Region } from '@jbrowse/core/util/types'\nimport CompositeMap from '@jbrowse/core/util/compositeMap'\nimport { Feature, isFeature } from '@jbrowse/core/util/simpleFeature'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport Button from '@material-ui/core/Button'\nimport Typography from '@material-ui/core/Typography'\nimport MenuOpenIcon from '@material-ui/icons/MenuOpen'\nimport { autorun } from 'mobx'\nimport { addDisposer, Instance, isAlive, types, getEnv } from 'mobx-state-tree'\nimport React from 'react'\nimport { Tooltip } from '../components/BaseLinearDisplay'\nimport BlockState, { renderBlockData } from './serverSideRenderedBlock'\n\nimport { LinearGenomeViewModel, ExportSvgOptions } from '../../LinearGenomeView'\n\nexport interface Layout {\n  minX: number\n  minY: number\n  maxX: number\n  maxY: number\n  name: string\n}\ntype LayoutRecord = [number, number, number, number]\n\nconst minDisplayHeight = 20\nconst defaultDisplayHeight = 100\nexport const BaseLinearDisplay = types\n  .compose(\n    'BaseLinearDisplay',\n    BaseDisplay,\n    types.model({\n      height: types.optional(\n        types.refinement(\n          'displayHeight',\n          types.number,\n          n => n >= minDisplayHeight,\n        ),\n        defaultDisplayHeight,\n      ),\n      blockState: types.map(BlockState),\n      userBpPerPxLimit: types.maybe(types.number),\n    }),\n  )\n  .volatile(() => ({\n    message: '',\n    featureIdUnderMouse: undefined as undefined | string,\n    contextMenuFeature: undefined as undefined | Feature,\n    additionalContextMenuItemCallbacks: [] as Function[],\n    scrollTop: 0,\n  }))\n  .views(self => ({\n    get blockType(): 'staticBlocks' | 'dynamicBlocks' {\n      return 'staticBlocks'\n    },\n    get blockDefinitions() {\n      const { blockType } = this\n      const view = getContainingView(self) as LinearGenomeViewModel\n      if (!view.initialized) {\n        throw new Error('view not initialized yet')\n      }\n      return view[blockType]\n    },\n  }))\n  .views(self => ({\n    /**\n     * set limit to config amount, or user amount if they force load,\n     */\n    get maxViewBpPerPx() {\n      return self.userBpPerPxLimit || getConf(self, 'maxDisplayedBpPerPx')\n    },\n\n    /**\n     * how many milliseconds to wait for the display to\n     * \"settle\" before re-rendering a block\n     */\n    get renderDelay() {\n      return 50\n    },\n\n    get TooltipComponent(): React.FC<any> {\n      return (Tooltip as unknown) as React.FC\n    },\n\n    /**\n     * returns a string feature ID if the globally-selected object\n     * is probably a feature\n     */\n    get selectedFeatureId() {\n      if (isAlive(self)) {\n        const session = getSession(self)\n        const { selection } = session\n        // does it quack like a feature?\n        if (isFeature(selection)) {\n          return selection.id()\n        }\n      }\n      return undefined\n    },\n    /**\n     * if a display-level message should be displayed instead of the blocks,\n     * make this return a react component\n     */\n    get DisplayMessageComponent() {\n      return undefined as undefined | React.FC<any>\n    },\n  }))\n  .views(self => {\n    return {\n      /**\n       * a CompositeMap of `featureId -> feature obj` that\n       * just looks in all the block data for that feature\n       */\n      get features() {\n        const featureMaps = []\n        for (const block of self.blockState.values()) {\n          if (block && block.features) {\n            featureMaps.push(block.features)\n          }\n        }\n        return new CompositeMap<string, Feature>(featureMaps)\n      },\n\n      get featureUnderMouse() {\n        return self.featureIdUnderMouse\n          ? this.features.get(self.featureIdUnderMouse)\n          : undefined\n      },\n\n      /**\n       * returns per-base block layouts as the data structure\n       * `Map<blockKey, Map<featureId, LayoutRecord>>`\n       *\n       * this per-block is needed to avoid cross-contamination of\n       * layouts across blocks especially when building the rtree\n       */\n      get blockLayoutFeatures() {\n        const layoutMaps = new Map<string, Map<string, LayoutRecord>>()\n        for (const block of self.blockState.values()) {\n          if (block && block.layout && block.layout.rectangles) {\n            layoutMaps.set(block.key, block.layout.getRectangles())\n          }\n        }\n        return layoutMaps\n      },\n\n      getFeatureOverlapping(blockKey: string, x: number, y: number) {\n        return self.blockState.get(blockKey)?.layout?.getByCoord(x, y)\n      },\n\n      getFeatureByID(id: string) {\n        let ret\n        self.blockState.forEach(block => {\n          const val = block?.layout?.getByID(id)\n          if (val) {\n            ret = val\n          }\n        })\n        return ret\n      },\n    }\n  })\n  .actions(self => ({\n    afterAttach() {\n      // watch the parent's blocks to update our block state when they change\n      const blockWatchDisposer = autorun(() => {\n        // create any blocks that we need to create\n        const blocksPresent: { [key: string]: boolean } = {}\n        const view = getContainingView(self) as LinearGenomeViewModel\n        if (view.initialized) {\n          self.blockDefinitions.contentBlocks.forEach(block => {\n            blocksPresent[block.key] = true\n            if (!self.blockState.has(block.key)) {\n              this.addBlock(block.key, block)\n            }\n          })\n          // delete any blocks we need go delete\n          self.blockState.forEach((_, key) => {\n            if (!blocksPresent[key]) {\n              this.deleteBlock(key)\n            }\n          })\n        }\n      })\n\n      addDisposer(self, blockWatchDisposer)\n    },\n    setHeight(displayHeight: number) {\n      if (displayHeight > minDisplayHeight) {\n        self.height = displayHeight\n      } else {\n        self.height = minDisplayHeight\n      }\n      return self.height\n    },\n    resizeHeight(distance: number) {\n      const oldHeight = self.height\n      const newHeight = this.setHeight(self.height + distance)\n      return newHeight - oldHeight\n    },\n    setScrollTop(scrollTop: number) {\n      self.scrollTop = scrollTop\n    },\n    // sets the new bpPerPxLimit if user chooses to force load\n    setUserBpPerPxLimit(limit: number) {\n      self.userBpPerPxLimit = limit\n    },\n    // base display reload does nothing, see specialized displays for details\n    setMessage(message: string) {\n      self.message = message\n    },\n    addBlock(key: string, block: BaseBlock) {\n      self.blockState.set(\n        key,\n        BlockState.create({\n          key,\n          region: block.toRegion(),\n        }),\n      )\n    },\n    deleteBlock(key: string) {\n      self.blockState.delete(key)\n    },\n    selectFeature(feature: Feature) {\n      const session = getSession(self)\n      if (isSessionModelWithWidgets(session)) {\n        const featureWidget = session.addWidget(\n          'BaseFeatureWidget',\n          'baseFeature',\n          { featureData: feature.toJSON(), view: getContainingView(self) },\n        )\n        session.showWidget(featureWidget)\n      }\n      if (isSelectionContainer(session)) {\n        session.setSelection(feature)\n      }\n    },\n    clearFeatureSelection() {\n      const session = getSession(self)\n      session.clearSelection()\n    },\n    setFeatureIdUnderMouse(feature: string | undefined) {\n      self.featureIdUnderMouse = feature\n    },\n    reload() {\n      const temp = JSON.parse(JSON.stringify(self.blockState))\n      Object.keys(temp).forEach(blockState => {\n        temp[blockState].key += '-reload'\n      })\n      self.blockState = temp\n    },\n    addAdditionalContextMenuItemCallback(callback: Function) {\n      self.additionalContextMenuItemCallbacks.push(callback)\n    },\n    setContextMenuFeature(feature?: Feature) {\n      self.contextMenuFeature = feature\n    },\n  }))\n  .views(self => ({\n    regionCannotBeRenderedText(_region: Region) {\n      const view = getContainingView(self) as LinearGenomeViewModel\n      if (view && view.bpPerPx > self.maxViewBpPerPx) {\n        return 'Zoom in to see features'\n      }\n      return ''\n    },\n\n    /**\n     * @param region -\n     * @returns falsy if the region is fine to try rendering. Otherwise,\n     *  return a react node + string of text.\n     *  string of text describes why it cannot be rendered\n     *  react node allows user to force load at current setting\n     */\n    regionCannotBeRendered(_region: Region) {\n      const view = getContainingView(self) as LinearGenomeViewModel\n      if (view && view.bpPerPx > self.maxViewBpPerPx) {\n        return (\n          <>\n            <Typography component=\"span\" variant=\"body2\">\n              Zoom in to see features or{' '}\n            </Typography>\n            <Button\n              data-testid=\"reload_button\"\n              onClick={() => {\n                self.setUserBpPerPxLimit(view.bpPerPx)\n                self.reload()\n              }}\n              variant=\"outlined\"\n            >\n              Force Load\n            </Button>\n            <Typography component=\"span\" variant=\"body2\">\n              (force load may be slow)\n            </Typography>\n          </>\n        )\n      }\n      return undefined\n    },\n\n    get trackMenuItems(): MenuItem[] {\n      return []\n    },\n    // distinct set of display items that are particular to this display type.\n    // for base, there are none\n    //\n    // note: this attribute is helpful when composing together multiple\n    // subdisplays so that you don't repeat the \"about this track\" from each\n    // child display\n    get composedTrackMenuItems(): MenuItem[] {\n      return []\n    },\n    get contextMenuItems() {\n      const { pluginManager } = getEnv(self)\n      const contextMenuItems = self.contextMenuFeature\n        ? [\n            {\n              label: 'Open feature details',\n              icon: MenuOpenIcon,\n              onClick: () => {\n                if (self.contextMenuFeature) {\n                  self.selectFeature(self.contextMenuFeature)\n                }\n              },\n            },\n          ]\n        : []\n\n      self.additionalContextMenuItemCallbacks.forEach(callback => {\n        const menuItems = callback(self.contextMenuFeature, self, pluginManager)\n        contextMenuItems.push(...menuItems)\n      })\n      return contextMenuItems\n    },\n    get composedRenderProps() {\n      return {\n        ...getParentRenderProps(self),\n        rpcDriverName: self.rpcDriverName,\n        displayModel: self,\n        onFeatureClick(_: unknown, featureId: string | undefined) {\n          const f = featureId || self.featureIdUnderMouse\n          if (!f) {\n            self.clearFeatureSelection()\n          } else {\n            const feature = self.features.get(f)\n            self.selectFeature(feature as Feature)\n          }\n        },\n        onClick() {\n          self.clearFeatureSelection()\n        },\n        // similar to click but opens a menu with further options\n        onFeatureContextMenu(_: unknown, featureId: string | undefined) {\n          const f = featureId || self.featureIdUnderMouse\n          if (!f) {\n            self.clearFeatureSelection()\n          } else {\n            // feature id under mouse passed to context menu\n            self.setContextMenuFeature(self.features.get(f))\n          }\n        },\n\n        onMouseMove(_: unknown, featureId: string | undefined) {\n          self.setFeatureIdUnderMouse(featureId)\n        },\n\n        onMouseLeave(_: unknown) {\n          self.setFeatureIdUnderMouse(undefined)\n        },\n\n        onContextMenu() {\n          self.setContextMenuFeature(undefined)\n          self.clearFeatureSelection()\n        },\n      }\n    },\n    get renderProps() {\n      return this.composedRenderProps\n    },\n  }))\n  .actions(self => ({\n    async renderSvg(opts: ExportSvgOptions & { overrideHeight: number }) {\n      const { height, id } = self\n      const { overrideHeight } = opts\n      const view = getContainingView(self) as LinearGenomeViewModel\n      const {\n        offsetPx: viewOffsetPx,\n        roundedDynamicBlocks: dynamicBlocks,\n        width,\n      } = view\n\n      const renderings = await Promise.all(\n        dynamicBlocks.map(block => {\n          const blockState = BlockState.create({\n            key: block.key,\n            region: block,\n          })\n\n          // regionCannotBeRendered can return jsx so look for plaintext\n          // version, or just get the default if none available\n          const cannotBeRenderedReason =\n            self.regionCannotBeRenderedText(block) ||\n            self.regionCannotBeRendered(block)\n\n          if (cannotBeRenderedReason) {\n            return {\n              reactElement: (\n                <>\n                  <rect x={0} y={0} width={width} height={20} fill=\"#aaa\" />\n                  <text x={0} y={15}>\n                    {cannotBeRenderedReason}\n                  </text>\n                </>\n              ),\n            }\n          }\n\n          const {\n            rpcManager,\n            renderArgs,\n            renderProps,\n            rendererType,\n          } = renderBlockData(blockState, self)\n\n          return rendererType.renderInClient(rpcManager, {\n            ...renderArgs,\n            ...renderProps,\n            exportSVG: opts,\n          })\n        }),\n      )\n\n      return (\n        <>\n          {renderings.map((rendering, index) => {\n            const { offsetPx } = dynamicBlocks[index]\n            const offset = offsetPx - viewOffsetPx\n            // stabalize clipid under test for snapshot\n            const clipid = `clip-${\n              typeof jest === 'undefined' ? id : 'jest'\n            }-${index}`\n            return (\n              <React.Fragment key={`frag-${index}`}>\n                <defs>\n                  <clipPath id={clipid}>\n                    <rect\n                      x={0}\n                      y={0}\n                      width={width}\n                      height={overrideHeight || height}\n                    />\n                  </clipPath>\n                </defs>\n                <g transform={`translate(${offset} 0)`}>\n                  <g clipPath={`url(#${clipid})`}>\n                    {React.isValidElement(rendering.reactElement) ? (\n                      rendering.reactElement\n                    ) : (\n                      <g dangerouslySetInnerHTML={{ __html: rendering.html }} />\n                    )}\n                  </g>\n                </g>\n              </React.Fragment>\n            )\n          })}\n        </>\n      )\n    },\n  }))\n  .postProcessSnapshot(self => {\n    const { blockState, ...rest } = self\n    return rest\n  })\n\nexport type BaseLinearDisplayStateModel = typeof BaseLinearDisplay\nexport type BaseLinearDisplayModel = Instance<BaseLinearDisplayStateModel>\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '../BaseLinearDisplay'\n\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearBareDisplay',\n    { renderer: pluginManager.pluggableConfigSchemaType('renderer') },\n    {\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration/configurationSchema'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { types } from 'mobx-state-tree'\nimport { BaseLinearDisplay } from '../BaseLinearDisplay'\n\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearBareDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearBareDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => ({\n      get renderProps() {\n        return {\n          ...self.composedRenderProps,\n          ...getParentRenderProps(self),\n          rpcDriverName: self.rpcDriverName,\n          config: self.configuration.renderer,\n        }\n      },\n\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n    }))\n}\n","/**\n * Based on:\n *  https://material-ui.com/components/autocomplete/#Virtualize.tsx\n * Asynchronous Requests for autocomplete:\n *  https://material-ui.com/components/autocomplete/\n */\nimport React, { useMemo, useEffect, useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { getEnv } from 'mobx-state-tree'\n\n// jbrowse core\nimport { Region } from '@jbrowse/core/util/types'\nimport { getSession, useDebounce } from '@jbrowse/core/util' // useDebounce\nimport BaseResult, {\n  RefSequenceResult,\n} from '@jbrowse/core/TextSearch/BaseResults'\n// material ui\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport TextField, { TextFieldProps as TFP } from '@material-ui/core/TextField'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport Typography from '@material-ui/core/Typography'\nimport SearchIcon from '@material-ui/icons/Search'\nimport { InputAdornment } from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Autocomplete, {\n  createFilterOptions,\n} from '@material-ui/lab/Autocomplete'\n// other\nimport { LinearGenomeViewModel } from '..'\n\n/**\n *  Option interface used to format results to display in dropdown\n *  of the materila ui interface\n */\nexport interface Option {\n  group: string\n  result: BaseResult\n}\n\n// filters for options to display in dropdown\nconst filter = createFilterOptions<Option>({\n  trim: true,\n  matchFrom: 'start',\n  ignoreCase: true,\n  limit: 101,\n})\nconst helperSearchText = `Search for features or navigate to a location using syntax \"chr1:1-100\" or \"chr1:1..100\"`\nconst useStyles = makeStyles(() => ({\n  customWidth: {\n    maxWidth: 150,\n  },\n}))\n\nasync function fetchResults(\n  self: LinearGenomeViewModel,\n  query: string,\n  assemblyName: string,\n) {\n  const session = getSession(self)\n  const { pluginManager } = getEnv(session)\n  const { rankSearchResults } = self\n  const { textSearchManager } = pluginManager.rootModel\n  const searchScope = self.searchScope(assemblyName)\n  const args = {\n    queryString: query,\n    searchType: 'prefix',\n  }\n  const searchResults =\n    (await textSearchManager?.search(args, searchScope, rankSearchResults)) ||\n    []\n  return searchResults\n}\nfunction RefNameAutocomplete({\n  model,\n  onSelect,\n  assemblyName,\n  style,\n  value,\n  TextFieldProps = {},\n}: {\n  model: LinearGenomeViewModel\n  onSelect: (region: BaseResult) => void\n  assemblyName?: string\n  value?: string\n  style?: React.CSSProperties\n  TextFieldProps?: TFP\n}) {\n  const classes = useStyles()\n  const session = getSession(model)\n  const [open, setOpen] = useState(false)\n  const [, setError] = useState<Error>()\n  const [currentSearch, setCurrentSearch] = useState('')\n  const debouncedSearch = useDebounce(currentSearch, 350)\n  const [searchOptions, setSearchOptions] = useState<Option[]>([])\n  const { assemblyManager } = session\n  const { coarseVisibleLocStrings } = model\n  const assembly = assemblyName && assemblyManager.get(assemblyName)\n  const regions: Region[] = useMemo(() => {\n    return (assembly && assembly.regions) || []\n  }, [assembly])\n  // default options for dropdown\n  const limitOption: Array<Option> = [\n    {\n      group: 'reference sequence',\n      result: new BaseResult({\n        refName: '',\n        label: '',\n        renderingComponent: (\n          <Tooltip\n            title={'Displaying first 100 refNames. Search for more results'}\n          >\n            <Typography noWrap>{'more results...'}</Typography>\n          </Tooltip>\n        ),\n      }),\n    },\n  ]\n  let options: Array<Option> = useMemo(() => {\n    const defaultOptions = regions.map(option => {\n      const defaultOption: Option = {\n        group: 'reference sequence',\n        result: new RefSequenceResult({\n          refName: option.refName,\n          label: option.refName,\n          matchedAttribute: 'refName',\n        }),\n      }\n      return defaultOption\n    })\n    return defaultOptions\n  }, [regions])\n\n  options =\n    options.length > 100 ? options.slice(0, 100).concat(limitOption) : options\n  useEffect(() => {\n    let active = true\n\n    ;(async () => {\n      try {\n        let results: BaseResult[] = []\n        if (debouncedSearch && debouncedSearch !== '' && assemblyName) {\n          const searchResults = await fetchResults(\n            model,\n            debouncedSearch,\n            assemblyName,\n          )\n          results = results.concat(searchResults)\n        }\n        if (results.length > 0 && active) {\n          const adapterResults: Option[] = results.map(result => {\n            const newOption: Option = {\n              group: 'text search results',\n              result,\n            }\n            return newOption\n          })\n          setSearchOptions(adapterResults)\n        }\n      } catch (e) {\n        console.error(e)\n        if (active) {\n          setError(e)\n        }\n      }\n    })()\n\n    return () => {\n      active = false\n    }\n  }, [assemblyName, debouncedSearch, model])\n\n  function onChange(selectedOption: Option | string) {\n    if (selectedOption && assemblyName) {\n      if (typeof selectedOption === 'string') {\n        // handles string inputs on keyPress enter\n        const newResult = new BaseResult({\n          label: selectedOption,\n        })\n        onSelect(newResult)\n      } else {\n        const { result } = selectedOption\n        onSelect(result)\n      }\n    }\n  }\n\n  return (\n    <Autocomplete\n      id={`refNameAutocomplete-${model.id}`}\n      data-testid=\"autocomplete\"\n      freeSolo\n      disableListWrap\n      disableClearable\n      includeInputInList\n      clearOnBlur\n      selectOnFocus\n      disabled={!assemblyName}\n      style={style}\n      value={coarseVisibleLocStrings || value || ''}\n      open={open}\n      onOpen={() => setOpen(true)}\n      onClose={() => {\n        setOpen(false)\n        setCurrentSearch('')\n        setSearchOptions([])\n      }}\n      options={searchOptions.length === 0 ? options : searchOptions}\n      groupBy={option => String(option.group)}\n      filterOptions={(possibleOptions, params) => {\n        return filter(possibleOptions, params)\n      }}\n      ListboxProps={{ style: { maxHeight: 250 } }}\n      onChange={(_, selectedOption) => onChange(selectedOption)}\n      renderInput={params => {\n        const { helperText, InputProps = {} } = TextFieldProps\n        const TextFieldInputProps = {\n          ...params.InputProps,\n          ...InputProps,\n          endAdornment: (\n            <>\n              {regions.length === 0 && searchOptions.length === 0 ? (\n                <CircularProgress color=\"inherit\" size={20} />\n              ) : (\n                <Tooltip\n                  title={helperSearchText}\n                  leaveDelay={300}\n                  placement=\"top\"\n                  classes={{ tooltip: classes.customWidth }}\n                >\n                  <InputAdornment position=\"end\" style={{ marginRight: 7 }}>\n                    <SearchIcon />\n                  </InputAdornment>\n                </Tooltip>\n              )}\n              {params.InputProps.endAdornment}\n            </>\n          ),\n        }\n        return (\n          <TextField\n            {...params}\n            {...TextFieldProps}\n            helperText={helperText}\n            value={coarseVisibleLocStrings || value || ''}\n            InputProps={TextFieldInputProps}\n            placeholder=\"Search for location\"\n            onChange={e => {\n              setCurrentSearch(e.target.value)\n            }}\n          />\n        )\n      }}\n      renderOption={(option, { inputValue }) => {\n        const { result } = option\n        const rendering = result.getLabel()\n        // if renderingComponent is provided render that\n        const component = result.getRenderingComponent()\n        if (component) {\n          if (React.isValidElement(component)) {\n            return component\n          }\n        }\n        if (currentSearch !== '' && inputValue.length <= rendering.length) {\n          return (\n            <Typography noWrap>\n              <b>{rendering.slice(0, inputValue.length)}</b>\n              {rendering.slice(inputValue.length)}\n            </Typography>\n          )\n        }\n        return <Typography noWrap>{rendering}</Typography>\n      }}\n      getOptionLabel={option => {\n        // needed for filtering options and value\n        return (\n          (typeof option === 'string' ? option : option.result.getLabel()) || ''\n        )\n      }}\n    />\n  )\n}\n\nexport default observer(RefNameAutocomplete)\n","/**\n * Given a scale ( bp/px ) and minimum distances (px) between major and minor\n * gridlines, return an object like `{ majorPitch: bp, minorPitch: bp }` giving\n * the gridline pitches to use.\n */\nexport function chooseGridPitch(\n  scale: number,\n  minMajorPitchPx: number,\n  minMinorPitchPx: number,\n) {\n  scale = Math.abs(scale)\n  const minMajorPitchBp = minMajorPitchPx * scale\n  const majorMagnitude = parseInt(\n    Number(minMajorPitchBp).toExponential().split(/e/i)[1],\n    10,\n  )\n\n  let majorPitch = 10 ** majorMagnitude\n  while (majorPitch < minMajorPitchBp) {\n    majorPitch *= 2\n    if (majorPitch >= minMajorPitchBp) {\n      break\n    }\n    majorPitch *= 2.5\n  }\n\n  majorPitch = Math.max(majorPitch, 5)\n\n  const majorPitchPx = majorPitch / scale\n\n  let minorPitch = 0\n  if (!(majorPitch % 10) && majorPitchPx / 10 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 10\n  } else if (!(majorPitch % 5) && majorPitchPx / 5 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 5\n  } else if (!(majorPitch % 2) && majorPitchPx / 2 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 2\n  }\n\n  return { majorPitch, minorPitch }\n}\n\nexport function makeTicks(\n  start: number,\n  end: number,\n  bpPerPx: number,\n  emitMajor = true,\n  emitMinor = true,\n) {\n  const gridPitch = chooseGridPitch(bpPerPx, 60, 15)\n\n  let minBase = start\n  let maxBase = end\n  if (minBase === null || maxBase === null) {\n    return []\n  }\n\n  if (bpPerPx < 0) {\n    ;[minBase, maxBase] = [maxBase, minBase]\n  }\n\n  // add 20px additional on the right and left to allow us to draw the ends\n  // of labels that lie a little outside our region\n  minBase -= Math.abs(20 * bpPerPx) - 1\n  maxBase += Math.abs(20 * bpPerPx) + 1\n\n  const iterPitch = gridPitch.minorPitch || gridPitch.majorPitch\n  let index = 0\n  const ticks = []\n  for (\n    let base = Math.ceil(minBase / iterPitch) * iterPitch;\n    base < maxBase;\n    base += iterPitch\n  ) {\n    if (emitMinor && base % (gridPitch.majorPitch * 2)) {\n      ticks.push({ type: 'minor', base: base - 1, index })\n      index += 1\n    } else if (emitMajor && !(base % (gridPitch.majorPitch * 2))) {\n      ticks.push({ type: 'major', base: base - 1, index })\n      index += 1\n    }\n  }\n  return ticks\n}\n","import Popover from '@material-ui/core/Popover'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport Typography from '@material-ui/core/Typography'\nimport { stringify } from '@jbrowse/core/util'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport ReactPropTypes from 'prop-types'\nimport React, { useRef, useEffect, useState } from 'react'\nimport { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport { LinearGenomeViewStateModel, HEADER_OVERVIEW_HEIGHT } from '..'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(theme => {\n  const background = theme.palette.tertiary\n    ? fade(theme.palette.tertiary.main, 0.7)\n    : fade(theme.palette.primary.main, 0.7)\n  return {\n    rubberBand: {\n      height: '100%',\n      background,\n      position: 'absolute',\n      zIndex: 10,\n      textAlign: 'center',\n      overflow: 'hidden',\n    },\n    rubberBandControl: {\n      cursor: 'crosshair',\n      width: '100%',\n      minHeight: 8,\n    },\n    rubberBandText: {\n      color: theme.palette.tertiary\n        ? theme.palette.tertiary.contrastText\n        : theme.palette.primary.contrastText,\n    },\n    popover: {\n      mouseEvents: 'none',\n      cursor: 'crosshair',\n    },\n    paper: {\n      paddingLeft: theme.spacing(1),\n      paddingRight: theme.spacing(1),\n    },\n    guide: {\n      pointerEvents: 'none',\n      height: '100%',\n      width: 1,\n      position: 'absolute',\n      zIndex: 10,\n    },\n  }\n})\n\nfunction OverviewRubberBand({\n  model,\n  overview,\n  ControlComponent = <div />,\n}: {\n  model: LGV\n  overview: Base1DViewModel\n  ControlComponent?: React.ReactElement\n}) {\n  const [startX, setStartX] = useState<number>()\n  const [currentX, setCurrentX] = useState<number>()\n  const [guideX, setGuideX] = useState<number | undefined>()\n  const controlsRef = useRef<HTMLDivElement>(null)\n  const rubberBandRef = useRef(null)\n  const classes = useStyles()\n  const mouseDragging = startX !== undefined\n\n  useEffect(() => {\n    function globalMouseMove(event: MouseEvent) {\n      if (controlsRef.current && mouseDragging) {\n        const relativeX =\n          event.clientX - controlsRef.current.getBoundingClientRect().left\n        setCurrentX(relativeX)\n      }\n    }\n\n    function globalMouseUp() {\n      if (\n        controlsRef.current &&\n        startX !== undefined &&\n        currentX !== undefined\n      ) {\n        if (Math.abs(currentX - startX) > 3) {\n          model.zoomToDisplayedRegions(\n            overview.pxToBp(startX),\n            overview.pxToBp(currentX),\n          )\n        }\n      }\n      /* handling clicking and centering at a specific Bp */\n      if (\n        controlsRef.current &&\n        startX !== undefined &&\n        currentX === undefined\n      ) {\n        const clickedAt = overview.pxToBp(startX)\n        model.centerAt(\n          Math.round(clickedAt.coord),\n          clickedAt.refName,\n          clickedAt.index,\n        )\n      }\n      setStartX(undefined)\n      setCurrentX(undefined)\n\n      if (startX !== undefined) {\n        setGuideX(undefined)\n      }\n    }\n\n    function globalKeyDown(event: KeyboardEvent) {\n      if (event.key === 'Escape') {\n        setStartX(undefined)\n        setCurrentX(undefined)\n      }\n    }\n\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove, true)\n      window.addEventListener('mouseup', globalMouseUp, true)\n      window.addEventListener('keydown', globalKeyDown, true)\n      return () => {\n        window.removeEventListener('mousemove', globalMouseMove, true)\n        window.removeEventListener('mouseup', globalMouseUp, true)\n        window.removeEventListener('keydown', globalKeyDown, true)\n      }\n    }\n    return () => {}\n  }, [mouseDragging, currentX, startX, model, overview])\n\n  function mouseDown(event: React.MouseEvent<HTMLDivElement>) {\n    event.preventDefault()\n    event.stopPropagation()\n    if (controlsRef.current) {\n      setStartX(\n        event.clientX - controlsRef.current.getBoundingClientRect().left,\n      )\n    }\n  }\n\n  function mouseMove(event: React.MouseEvent<HTMLDivElement>) {\n    if (controlsRef.current) {\n      setGuideX(\n        event.clientX - controlsRef.current.getBoundingClientRect().left,\n      )\n    }\n  }\n\n  function mouseOut() {\n    setGuideX(undefined)\n  }\n\n  if (startX === undefined) {\n    return (\n      <div style={{ position: 'relative' }}>\n        {guideX !== undefined ? (\n          <Tooltip\n            open={!mouseDragging}\n            placement=\"top\"\n            title={stringify(overview.pxToBp(guideX))}\n            arrow\n          >\n            <div\n              className={classes.guide}\n              style={{\n                left: guideX,\n              }}\n            />\n          </Tooltip>\n        ) : null}\n        <div\n          className={classes.rubberBandControl}\n          role=\"presentation\"\n          ref={controlsRef}\n          onMouseDown={mouseDown}\n          onMouseOut={mouseOut}\n          onMouseMove={mouseMove}\n        >\n          {ControlComponent}\n        </div>\n      </div>\n    )\n  }\n\n  let left = startX || 0\n  let width = 0\n  if (startX !== undefined && currentX !== undefined) {\n    left = currentX < startX ? currentX : startX\n    width = currentX - startX\n  }\n  // calculate the start and end bp of drag\n  let leftBpOffset\n  let rightBpOffset\n  if (startX) {\n    leftBpOffset = overview.pxToBp(startX)\n    rightBpOffset = overview.pxToBp(startX + width)\n    if (currentX && currentX < startX) {\n      ;[leftBpOffset, rightBpOffset] = [rightBpOffset, leftBpOffset]\n    }\n  }\n\n  return (\n    <div style={{ position: 'relative' }}>\n      {rubberBandRef.current ? (\n        <>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'left',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'right',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>\n              {leftBpOffset ? stringify(leftBpOffset) : ''}\n            </Typography>\n          </Popover>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'right',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'left',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>\n              {rightBpOffset ? stringify(rightBpOffset) : ''}\n            </Typography>\n          </Popover>\n        </>\n      ) : null}\n      <div\n        ref={rubberBandRef}\n        className={classes.rubberBand}\n        style={{\n          left,\n          width: Math.abs(width),\n          height: HEADER_OVERVIEW_HEIGHT,\n        }}\n      />\n      <div\n        data-testid=\"rubberBand_controls\"\n        className={classes.rubberBandControl}\n        role=\"presentation\"\n        ref={controlsRef}\n        onMouseDown={mouseDown}\n        onMouseOut={mouseOut}\n        onMouseMove={mouseMove}\n      >\n        {ControlComponent}\n      </div>\n    </div>\n  )\n}\n\nOverviewRubberBand.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n  overview: MobxPropTypes.objectOrObservableObject.isRequired,\n  ControlComponent: ReactPropTypes.node,\n}\n\nOverviewRubberBand.defaultProps = {\n  ControlComponent: <div />,\n}\n\nexport default observer(OverviewRubberBand)\n","// import { Region } from '@jbrowse/core/util/types'\n// import { Region as MSTRegion } from '@jbrowse/core/util/types/mst'\nimport Base1DView, { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport { getSession } from '@jbrowse/core/util'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport { ContentBlock } from '@jbrowse/core/util/blockTypes'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React from 'react'\nimport clsx from 'clsx'\nimport { Typography } from '@material-ui/core'\nimport {\n  LinearGenomeViewStateModel,\n  HEADER_BAR_HEIGHT,\n  HEADER_OVERVIEW_HEIGHT,\n} from '..'\nimport { chooseGridPitch } from '../util'\nimport OverviewRubberBand from './OverviewRubberBand'\n\nconst useStyles = makeStyles(theme => {\n  const scaleBarColor = theme.palette.tertiary\n    ? theme.palette.tertiary.light\n    : theme.palette.primary.light\n  return {\n    scaleBar: {\n      width: '100%',\n      height: HEADER_OVERVIEW_HEIGHT,\n      overflow: 'hidden',\n    },\n    scaleBarContig: {\n      backgroundColor: theme.palette.background.default,\n      position: 'absolute',\n      top: 0,\n      height: HEADER_OVERVIEW_HEIGHT,\n      border: '1px solid',\n      borderBottomColor: 'black',\n    },\n    scaleBarContigForward: {\n      backgroundImage: `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")`,\n      backgroundRepeat: 'repeat',\n    },\n    scaleBarContigReverse: {\n      backgroundImage: `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")`,\n      backgroundRepeat: 'repeat',\n    },\n    scaleBarRegionIncompleteLeft: {\n      width: 10,\n      height: 17.5,\n      background: `linear-gradient(-225deg,black 3px, transparent 1px),\n      linear-gradient(45deg, black 3px, transparent 1px)`,\n      backgroundRepeat: 'repeat-y',\n      backgroundSize: '10px 8px',\n      borderTopLeftRadius: '2px',\n      borderBottomLeftRadius: '2px',\n      float: 'left',\n    },\n    scaleBarRegionIncompleteRight: {\n      width: 10,\n      height: 17.5,\n      background: `linear-gradient(225deg, black 3px, transparent 1px),\n      linear-gradient(-45deg, black 3px, transparent 1px)`,\n      backgroundRepeat: 'repeat-y',\n      backgroundSize: '10px 8px',\n      borderTopRightRadius: '2px',\n      borderBottomRightRadius: '2px',\n      float: 'right',\n    },\n    scaleBarRefName: {\n      position: 'absolute',\n      fontWeight: 'bold',\n      lineHeight: 'normal',\n      pointerEvents: 'none',\n      left: 5,\n    },\n    scaleBarLabel: {\n      height: HEADER_OVERVIEW_HEIGHT,\n      width: 1,\n      position: 'absolute',\n      display: 'flex',\n      justifyContent: 'center',\n      pointerEvents: 'none',\n    },\n    scaleBarVisibleRegion: {\n      background: fade(scaleBarColor, 0.3),\n      position: 'absolute',\n      height: HEADER_OVERVIEW_HEIGHT,\n      pointerEvents: 'none',\n      top: -1,\n      zIndex: 100,\n      borderWidth: 1,\n      borderStyle: 'solid',\n      borderColor: fade(scaleBarColor, 0.8),\n      boxSizing: 'content-box',\n    },\n    overview: {\n      height: HEADER_BAR_HEIGHT,\n      position: 'relative',\n    },\n    overviewSvg: { position: 'absolute' },\n  }\n})\n\nconst wholeSeqSpacer = 2\nconst Polygon = observer(\n  ({\n    model,\n    overview,\n  }: {\n    model: LGV\n    overview: Instance<Base1DViewModel>\n  }) => {\n    const theme = useTheme()\n    const classes = useStyles()\n    const {\n      offsetPx,\n      dynamicBlocks: { contentBlocks, totalWidthPxWithoutBorders },\n    } = model\n\n    const polygonColor = theme.palette.tertiary\n      ? theme.palette.tertiary.light\n      : theme.palette.primary.light\n\n    if (!contentBlocks.length) {\n      return null\n    }\n    const firstBlock = contentBlocks[0]\n    const lastBlock = contentBlocks[contentBlocks.length - 1]\n    const topLeft = overview.bpToPx({\n      refName: firstBlock.refName,\n      coord: firstBlock.reversed ? firstBlock.end : firstBlock.start,\n      regionNumber: firstBlock.regionNumber,\n    })\n    const topRight = overview.bpToPx({\n      refName: lastBlock.refName,\n      coord: lastBlock.reversed ? lastBlock.start : lastBlock.end,\n      regionNumber: lastBlock.regionNumber,\n    })\n\n    const startPx = Math.max(0, -offsetPx)\n    const endPx =\n      startPx +\n      totalWidthPxWithoutBorders +\n      (contentBlocks.length * model.interRegionPaddingWidth) / 2\n\n    const points = [\n      [startPx, HEADER_BAR_HEIGHT],\n      [endPx, HEADER_BAR_HEIGHT],\n      [topRight, 0],\n      [topLeft, 0],\n    ]\n\n    return (\n      <svg\n        height={HEADER_BAR_HEIGHT}\n        width=\"100%\"\n        className={classes.overviewSvg}\n      >\n        {points && (\n          <polygon\n            points={points.toString()}\n            fill={fade(polygonColor, 0.3)}\n            stroke={fade(polygonColor, 0.8)}\n          />\n        )}\n      </svg>\n    )\n  },\n)\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst ScaleBar = observer(\n  ({\n    model,\n    scale,\n    overview,\n  }: {\n    model: LGV\n    overview: Base1DViewModel\n    scale: number\n  }) => {\n    const classes = useStyles()\n    const { dynamicBlocks: visibleRegions } = model\n    const { assemblyManager } = getSession(model)\n    const gridPitch = chooseGridPitch(scale, 120, 15)\n    const { dynamicBlocks: overviewVisibleRegions } = overview\n\n    if (!visibleRegions.contentBlocks.length) {\n      return null\n    }\n    const firstBlock = visibleRegions.contentBlocks[0]\n    const firstOverviewPx =\n      overview.bpToPx({\n        refName: firstBlock.refName,\n        regionNumber: firstBlock.regionNumber,\n        coord: firstBlock.reversed ? firstBlock.end : firstBlock.start,\n      }) || 0\n\n    const lastBlock =\n      visibleRegions.contentBlocks[visibleRegions.contentBlocks.length - 1]\n    const lastOverviewPx =\n      overview.bpToPx({\n        refName: lastBlock.refName,\n        coord: lastBlock.reversed ? lastBlock.start : lastBlock.end,\n        regionNumber: lastBlock.regionNumber,\n      }) || 0\n\n    return (\n      <div className={classes.scaleBar}>\n        <div\n          className={classes.scaleBarVisibleRegion}\n          style={{\n            width: lastOverviewPx - firstOverviewPx,\n            left: firstOverviewPx,\n          }}\n        />\n        {/* this is the entire scale bar */}\n        {overviewVisibleRegions.map((seq, idx) => {\n          const assembly = assemblyManager.get(seq.assemblyName)\n          let refNameColor: string | undefined\n          if (assembly) {\n            refNameColor = assembly.getRefNameColor(seq.refName)\n          }\n          const regionLength = seq.end - seq.start\n          const tickLabels = []\n          for (\n            let index = 0;\n            index < Math.floor(regionLength / gridPitch.majorPitch);\n            index++\n          ) {\n            const offsetLabel = (index + 1) * gridPitch.majorPitch\n            tickLabels.push(\n              seq.reversed ? seq.end - offsetLabel : seq.start + offsetLabel,\n            )\n          }\n\n          return !(seq instanceof ContentBlock) ? (\n            <div\n              key={`${JSON.stringify(seq)}-${idx}`}\n              className={classes.scaleBarContig}\n              style={{\n                width: seq.widthPx,\n                left: seq.offsetPx,\n                backgroundColor: '#999',\n                backgroundImage:\n                  'repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)',\n              }}\n            />\n          ) : (\n            <div\n              key={`${JSON.stringify(seq)}-${idx}`}\n              className={clsx(\n                classes.scaleBarContig,\n                seq.reversed\n                  ? classes.scaleBarContigReverse\n                  : classes.scaleBarContigForward,\n              )}\n              style={{\n                left: seq.offsetPx,\n                width: seq.widthPx,\n                borderColor: refNameColor,\n              }}\n            >\n              {/* name of sequence */}\n              <Typography\n                style={{ color: refNameColor }}\n                className={classes.scaleBarRefName}\n              >\n                {seq.refName}\n              </Typography>\n\n              {/* the number labels drawn in overview scale bar*/}\n              {tickLabels.map((tickLabel, labelIdx) => (\n                <Typography\n                  key={`${JSON.stringify(seq)}-${tickLabel}-${labelIdx}`}\n                  className={classes.scaleBarLabel}\n                  variant=\"body2\"\n                  style={{\n                    left: ((labelIdx + 1) * gridPitch.majorPitch) / scale,\n                    pointerEvents: 'none',\n                    color: refNameColor,\n                  }}\n                >\n                  {tickLabel.toLocaleString('en-US')}\n                </Typography>\n              ))}\n            </div>\n          )\n        })}\n      </div>\n    )\n  },\n)\n\nfunction OverviewScaleBar({\n  model,\n  children,\n}: {\n  model: LGV\n  children: React.ReactNode\n}) {\n  const classes = useStyles()\n  const { width, displayedRegions } = model\n\n  const overview = Base1DView.create({\n    displayedRegions: JSON.parse(JSON.stringify(displayedRegions)),\n    interRegionPaddingWidth: 0,\n    minimumBlockWidth: model.minimumBlockWidth,\n  })\n  overview.setVolatileWidth(width)\n  overview.showAllRegions()\n\n  const scale =\n    model.totalBp / (width - (displayedRegions.length - 1) * wholeSeqSpacer)\n\n  return !displayedRegions.length ? (\n    <>\n      <div className={classes.scaleBar}>\n        <LinearProgress\n          variant=\"indeterminate\"\n          style={{ marginTop: 4, width: '100%' }}\n        />\n      </div>\n      <div>{children}</div>\n    </>\n  ) : (\n    <div>\n      <OverviewRubberBand\n        model={model}\n        overview={overview}\n        ControlComponent={\n          <ScaleBar model={model} overview={overview} scale={scale} />\n        }\n      />\n      <div className={classes.overview}>\n        <Polygon model={model} overview={overview} />\n        {children}\n      </div>\n    </div>\n  )\n}\n\nexport default observer(OverviewScaleBar)\n","import React, { useState, useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport IconButton from '@material-ui/core/IconButton'\nimport Slider from '@material-ui/core/Slider'\nimport { makeStyles } from '@material-ui/core/styles'\nimport ZoomIn from '@material-ui/icons/ZoomIn'\nimport ZoomOut from '@material-ui/icons/ZoomOut'\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles({\n  container: {\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n  },\n  slider: {\n    width: 70,\n  },\n})\n\nfunction ZoomControls({ model }: { model: LinearGenomeViewModel }) {\n  const classes = useStyles()\n  const { maxBpPerPx, minBpPerPx, bpPerPx, scaleFactor } = model\n  const [value, setValue] = useState(-Math.log2(bpPerPx) * 100)\n  useEffect(() => {\n    setValue(-Math.log2(bpPerPx) * 100)\n  }, [setValue, bpPerPx])\n  return (\n    <div className={classes.container}>\n      <IconButton\n        data-testid=\"zoom_out\"\n        onClick={() => {\n          model.zoom(bpPerPx * 2)\n        }}\n        disabled={bpPerPx >= maxBpPerPx - 0.0001 || scaleFactor !== 1}\n        color=\"secondary\"\n      >\n        <ZoomOut />\n      </IconButton>\n\n      <Slider\n        className={classes.slider}\n        value={value}\n        min={-Math.log2(maxBpPerPx) * 100}\n        max={-Math.log2(minBpPerPx) * 100}\n        onChange={(_, val) => setValue(val as number)}\n        onChangeCommitted={() => model.zoomTo(2 ** (-value / 100))}\n        disabled={scaleFactor !== 1}\n      />\n      <IconButton\n        data-testid=\"zoom_in\"\n        onClick={() => {\n          model.zoom(model.bpPerPx / 2)\n        }}\n        disabled={bpPerPx <= minBpPerPx + 0.0001 || scaleFactor !== 1}\n        color=\"secondary\"\n      >\n        <ZoomIn />\n      </IconButton>\n    </div>\n  )\n}\n\nexport default observer(ZoomControls)\n","import { getSession } from '@jbrowse/core/util'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport Button from '@material-ui/core/Button'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport FormGroup from '@material-ui/core/FormGroup'\nimport Typography from '@material-ui/core/Typography'\nimport { observer } from 'mobx-react'\nimport { Instance, getEnv } from 'mobx-state-tree'\nimport React from 'react'\n\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport ArrowForwardIcon from '@material-ui/icons/ArrowForward'\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack'\nimport { LinearGenomeViewStateModel, HEADER_BAR_HEIGHT } from '..'\nimport RefNameAutocomplete from './RefNameAutocomplete'\nimport OverviewScaleBar from './OverviewScaleBar'\nimport ZoomControls from './ZoomControls'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst WIDGET_HEIGHT = 32\nconst SPACING = 7\n\nconst useStyles = makeStyles(theme => ({\n  headerBar: {\n    height: HEADER_BAR_HEIGHT,\n    display: 'flex',\n  },\n  headerForm: {\n    flexWrap: 'nowrap',\n    marginRight: 7,\n  },\n  spacer: {\n    flexGrow: 1,\n  },\n  input: {},\n  headerRefName: {\n    minWidth: 100,\n  },\n  panButton: {\n    background: fade(theme.palette.background.paper, 0.8),\n    height: WIDGET_HEIGHT,\n    margin: SPACING,\n  },\n  bp: {\n    display: 'flex',\n    alignItems: 'center',\n    marginLeft: 5,\n  },\n  toggleButton: {\n    height: 44,\n    border: 'none',\n    margin: theme.spacing(0.5),\n  },\n  buttonSpacer: {\n    marginRight: theme.spacing(2),\n  },\n}))\n\nconst Controls = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  return (\n    <Button\n      onClick={model.activateTrackSelector}\n      className={classes.toggleButton}\n      title=\"Open track selector\"\n      value=\"track_select\"\n      color=\"secondary\"\n    >\n      <TrackSelectorIcon className={classes.buttonSpacer} />\n    </Button>\n  )\n})\n\nfunction PanControls({ model }: { model: LGV }) {\n  const classes = useStyles()\n  return (\n    <>\n      <Button\n        variant=\"outlined\"\n        className={classes.panButton}\n        onClick={() => model.slide(-0.9)}\n      >\n        <ArrowBackIcon />\n      </Button>\n      <Button\n        variant=\"outlined\"\n        className={classes.panButton}\n        onClick={() => model.slide(0.9)}\n      >\n        <ArrowForwardIcon />\n      </Button>\n    </>\n  )\n}\n\nconst RegionWidth = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  const { coarseTotalBp } = model\n  return (\n    <Typography variant=\"body2\" color=\"textSecondary\" className={classes.bp}>\n      {`${Math.round(coarseTotalBp).toLocaleString('en-US')} bp`}\n    </Typography>\n  )\n})\n\nconst LinearGenomeViewHeader = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  const theme = useTheme()\n  const session = getSession(model)\n  const { assemblyManager } = session\n  const { pluginManager } = getEnv(session)\n  const { textSearchManager } = pluginManager.rootModel\n  const {\n    coarseDynamicBlocks: contentBlocks,\n    displayedRegions,\n    rankSearchResults,\n  } = model\n  const { assemblyName, refName } = contentBlocks[0] || { refName: '' }\n  const assembly = assemblyName && assemblyManager.get(assemblyName)\n  const regions = (assembly && assembly.regions) || []\n  const searchScope = model.searchScope(assemblyName)\n  async function setDisplayedRegion(result: BaseResult) {\n    if (result) {\n      const newRegionValue = result.getLocation()\n      // need to fix finding region\n      const newRegion = regions.find(\n        region => newRegionValue === region.refName,\n      )\n      if (newRegion) {\n        model.setDisplayedRegions([newRegion])\n        // we use showAllRegions after setDisplayedRegions to make the entire\n        // region visible, xref #1703\n        model.showAllRegions()\n      } else {\n        const results =\n          (await textSearchManager?.search(\n            {\n              queryString: newRegionValue.toLocaleLowerCase(),\n              searchType: 'exact',\n            },\n            searchScope,\n            rankSearchResults,\n          )) || []\n        // distinguishes between locstrings and search strings\n        if (results.length > 0) {\n          model.setSearchResults(results, newRegionValue.toLocaleLowerCase())\n        } else {\n          try {\n            newRegionValue !== '' && model.navToLocString(newRegionValue)\n          } catch (e) {\n            if (\n              `${e}` === `Error: Unknown reference sequence \"${newRegionValue}\"`\n            ) {\n              model.setSearchResults(\n                results,\n                newRegionValue.toLocaleLowerCase(),\n              )\n            } else {\n              console.warn(e)\n              session.notify(`${e}`, 'warning')\n            }\n          }\n        }\n      }\n    }\n  }\n\n  const controls = (\n    <div className={classes.headerBar}>\n      <Controls model={model} />\n      <div className={classes.spacer} />\n      <FormGroup row className={classes.headerForm}>\n        <PanControls model={model} />\n        <RefNameAutocomplete\n          onSelect={setDisplayedRegion}\n          assemblyName={assemblyName}\n          value={displayedRegions.length > 1 ? '' : refName}\n          model={model}\n          TextFieldProps={{\n            variant: 'outlined',\n            className: classes.headerRefName,\n            style: { margin: SPACING, minWidth: '175px' },\n            InputProps: {\n              style: {\n                padding: 0,\n                height: WIDGET_HEIGHT,\n                background: fade(theme.palette.background.paper, 0.8),\n              },\n            },\n          }}\n        />\n      </FormGroup>\n      <RegionWidth model={model} />\n      <ZoomControls model={model} />\n      <div className={classes.spacer} />\n    </div>\n  )\n\n  if (model.hideHeaderOverview) {\n    return controls\n  }\n\n  return <OverviewScaleBar model={model}>{controls}</OverviewScaleBar>\n})\n\nexport default LinearGenomeViewHeader\n","import { getConf, readConfObject } from '@jbrowse/core/configuration'\nimport { Menu } from '@jbrowse/core/ui'\nimport { getSession, getContainingView } from '@jbrowse/core/util'\nimport { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport IconButton from '@material-ui/core/IconButton'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport Typography from '@material-ui/core/Typography'\nimport MoreVertIcon from '@material-ui/icons/MoreVert'\nimport DragIcon from '@material-ui/icons/DragIndicator'\nimport CloseIcon from '@material-ui/icons/Close'\n\nimport clsx from 'clsx'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React from 'react'\nimport { LinearGenomeViewStateModel } from '..'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    background: fade(theme.palette.background.paper, 0.8),\n    '&:hover': {\n      background: theme.palette.background.paper,\n    },\n    transition: theme.transitions.create(['background'], {\n      duration: theme.transitions.duration.shortest,\n    }),\n  },\n  trackName: {\n    margin: '0 auto',\n    width: '90%',\n    fontSize: '0.8rem',\n    pointerEvents: 'none',\n  },\n  dragHandle: {\n    cursor: 'grab',\n    color: '#135560',\n  },\n  dragHandleIcon: {\n    display: 'inline-block',\n    verticalAlign: 'middle',\n    pointerEvents: 'none',\n  },\n  iconButton: {\n    padding: theme.spacing(1),\n  },\n}))\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst TrackLabel = React.forwardRef(\n  (props: { track: BaseTrackModel; className?: string }, ref) => {\n    const classes = useStyles()\n    const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null)\n    const { track, className } = props\n    const view = getContainingView(track) as LGV\n    const session = getSession(track)\n    const trackConf = track.configuration\n    const trackId = getConf(track, 'trackId')\n\n    const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n      setAnchorEl(event.currentTarget)\n    }\n\n    const handleClose = () => {\n      setAnchorEl(null)\n    }\n\n    const onDragStart = (event: React.DragEvent<HTMLSpanElement>) => {\n      const target = event.target as HTMLElement\n      if (target.parentNode) {\n        event.dataTransfer.setDragImage(\n          target.parentNode as HTMLElement,\n          20,\n          20,\n        )\n        view.setDraggingTrackId(track.id)\n      }\n    }\n\n    const onDragEnd = () => {\n      view.setDraggingTrackId(undefined)\n    }\n\n    let trackName = getConf(track, 'name')\n    if (getConf(track, 'type') === 'ReferenceSequenceTrack') {\n      trackName = 'Reference Sequence'\n      session.assemblies.forEach(assembly => {\n        if (assembly.sequence === trackConf) {\n          trackName = `Reference Sequence (${readConfObject(assembly, 'name')})`\n        }\n      })\n    }\n\n    function handleMenuItemClick(_: unknown, callback: Function) {\n      callback()\n      handleClose()\n    }\n\n    return (\n      <>\n        <Paper ref={ref} className={clsx(className, classes.root)}>\n          <span\n            draggable\n            className={classes.dragHandle}\n            onDragStart={onDragStart}\n            onDragEnd={onDragEnd}\n            data-testid={`dragHandle-${view.id}-${trackId}`}\n          >\n            <DragIcon className={classes.dragHandleIcon} />\n          </span>\n          <IconButton\n            onClick={() => view.hideTrack(trackId)}\n            className={classes.iconButton}\n            title=\"close this track\"\n            color=\"secondary\"\n          >\n            <CloseIcon />\n          </IconButton>\n          <Typography\n            variant=\"body1\"\n            component=\"span\"\n            className={classes.trackName}\n          >\n            {trackName}\n          </Typography>\n          <IconButton\n            aria-controls=\"simple-menu\"\n            aria-haspopup=\"true\"\n            onClick={handleClick}\n            className={classes.iconButton}\n            color=\"secondary\"\n            data-testid=\"track_menu_icon\"\n            disabled={!track.trackMenuItems.length}\n          >\n            <MoreVertIcon />\n          </IconButton>\n        </Paper>\n        <Menu\n          anchorEl={anchorEl}\n          onMenuItemClick={handleMenuItemClick}\n          open={Boolean(anchorEl)}\n          onClose={handleClose}\n          menuItems={[\n            ...(session.getTrackActionMenuItems\n              ? session.getTrackActionMenuItems(trackConf)\n              : []),\n            ...track.trackMenuItems,\n          ].sort((a, b) => (b.priority || 0) - (a.priority || 0))}\n        />\n      </>\n    )\n  },\n)\n\nexport default observer(TrackLabel)\n","import React, { useEffect, useRef } from 'react'\nimport { observer } from 'mobx-react'\nimport { isAlive } from 'mobx-state-tree'\nimport { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { ResizeHandle } from '@jbrowse/core/ui'\nimport { useDebouncedCallback, getContainingView } from '@jbrowse/core/util'\nimport clsx from 'clsx'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport { LinearGenomeViewModel, RESIZE_HANDLE_HEIGHT } from '..'\nimport TrackLabel from './TrackLabel'\n\nconst useStyles = makeStyles(theme => ({\n  root: {},\n  resizeHandle: {\n    height: RESIZE_HANDLE_HEIGHT,\n    boxSizing: 'border-box',\n    position: 'relative',\n    zIndex: 2,\n  },\n  overlay: {\n    pointerEvents: 'none',\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    width: '100%',\n    zIndex: 3,\n    borderRadius: theme.shape.borderRadius,\n  },\n  renderingComponentContainer: {\n    position: 'absolute',\n    // -1 offset because of the 1px border of the Paper\n    left: -1,\n    height: '100%',\n    width: '100%',\n  },\n  trackLabel: {\n    zIndex: 3,\n    margin: theme.spacing(1),\n  },\n  trackLabelInline: {\n    position: 'relative',\n    display: 'inline-block',\n  },\n  trackLabelOverlap: {\n    position: 'absolute',\n  },\n  trackRenderingContainer: {\n    overflowY: 'auto',\n    overflowX: 'hidden',\n    whiteSpace: 'nowrap',\n    position: 'relative',\n    background: 'none',\n    zIndex: 2,\n    boxSizing: 'content-box',\n  },\n}))\n\ntype LGV = LinearGenomeViewModel\n\nfunction TrackContainer(props: {\n  model: LinearGenomeViewModel\n  track: BaseTrackModel\n}) {\n  const classes = useStyles()\n  const { model, track } = props\n  const display = track.displays[0]\n  const { horizontalScroll, draggingTrackId, moveTrack } = model\n  const { height } = display\n  const view = getContainingView(display) as LGV\n  const trackId = getConf(track, 'trackId')\n  const ref = useRef(null)\n\n  useEffect(() => {\n    if (ref.current) {\n      model.trackRefs[trackId] = ref.current\n    }\n    return () => {\n      delete model.trackRefs[trackId]\n    }\n  }, [model.trackRefs, trackId])\n  function onDragEnter() {\n    if (\n      draggingTrackId !== undefined &&\n      isAlive(display) &&\n      draggingTrackId !== display.id\n    ) {\n      moveTrack(draggingTrackId, track.id)\n    }\n  }\n  const debouncedOnDragEnter = useDebouncedCallback(onDragEnter, 100)\n  const { RenderingComponent, DisplayBlurb } = display\n  const dimmed = draggingTrackId !== undefined && draggingTrackId !== display.id\n\n  return (\n    <div className={classes.root}>\n      {view.trackLabels !== 'hidden' ? (\n        <TrackLabel\n          track={track}\n          className={clsx(\n            classes.trackLabel,\n            view.trackLabels === 'overlapping'\n              ? classes.trackLabelOverlap\n              : classes.trackLabelInline,\n          )}\n        />\n      ) : null}\n\n      <Paper\n        variant=\"outlined\"\n        className={classes.trackRenderingContainer}\n        style={{ height }}\n        onScroll={event => {\n          const target = event.target as HTMLDivElement\n          display.setScrollTop(target.scrollTop)\n        }}\n        onDragEnter={debouncedOnDragEnter}\n        data-testid={`trackRenderingContainer-${view.id}-${trackId}`}\n        role=\"presentation\"\n      >\n        <div\n          ref={ref}\n          className={classes.renderingComponentContainer}\n          style={{ transform: `scaleX(${model.scaleFactor})` }}\n        >\n          <RenderingComponent\n            model={display}\n            blockState={{}}\n            onHorizontalScroll={horizontalScroll}\n          />\n        </div>\n\n        {DisplayBlurb ? (\n          <div\n            style={{\n              position: 'absolute',\n              left: 0,\n              top: display.height - 20,\n            }}\n          >\n            {' '}\n            <DisplayBlurb model={display} />\n          </div>\n        ) : null}\n      </Paper>\n      <div\n        className={classes.overlay}\n        style={{\n          height: display.height,\n          background: dimmed ? 'rgba(0, 0, 0, 0.4)' : undefined,\n        }}\n        onDragEnter={debouncedOnDragEnter}\n      />\n      <ResizeHandle\n        onDrag={display.resizeHeight}\n        className={classes.resizeHandle}\n      />\n    </div>\n  )\n}\n\nexport default observer(TrackContainer)\n","import React, { useRef, useEffect, useState } from 'react'\nimport ReactPropTypes from 'prop-types'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\n// material ui\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport MenuOpenIcon from '@material-ui/icons/MenuOpen'\nimport { Menu } from '@jbrowse/core/ui'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Popover from '@material-ui/core/Popover'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport Typography from '@material-ui/core/Typography'\nimport ZoomInIcon from '@material-ui/icons/ZoomIn'\n\nimport { stringify } from '@jbrowse/core/util'\nimport { LinearGenomeViewStateModel } from '..'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(theme => {\n  const background = theme.palette.tertiary\n    ? fade(theme.palette.tertiary.main, 0.7)\n    : fade(theme.palette.primary.main, 0.7)\n  return {\n    rubberBand: {\n      height: '100%',\n      background,\n      position: 'absolute',\n      zIndex: 10,\n      textAlign: 'center',\n      overflow: 'hidden',\n    },\n    rubberBandControl: {\n      cursor: 'crosshair',\n      width: '100%',\n      minHeight: 8,\n    },\n    rubberBandText: {\n      color: theme.palette.tertiary\n        ? theme.palette.tertiary.contrastText\n        : theme.palette.primary.contrastText,\n    },\n    popover: {\n      mouseEvents: 'none',\n      cursor: 'crosshair',\n    },\n    paper: {\n      paddingLeft: theme.spacing(1),\n      paddingRight: theme.spacing(1),\n    },\n    guide: {\n      pointerEvents: 'none',\n      height: '100%',\n      width: 1,\n      position: 'absolute',\n      zIndex: 10,\n    },\n  }\n})\n\nconst VerticalGuide = observer(\n  ({ model, coordX }: { model: LGV; coordX: number }) => {\n    const classes = useStyles()\n    return (\n      <Tooltip\n        open\n        placement=\"top\"\n        title={stringify(model.pxToBp(coordX))}\n        arrow\n      >\n        <div\n          className={classes.guide}\n          style={{\n            left: coordX,\n            background: 'red',\n          }}\n        />\n      </Tooltip>\n    )\n  },\n)\n\nfunction RubberBand({\n  model,\n  ControlComponent = <div />,\n}: {\n  model: LGV\n  ControlComponent?: React.ReactElement\n}) {\n  const [startX, setStartX] = useState<number>()\n  const [currentX, setCurrentX] = useState<number>()\n\n  // clientX and clientY used for anchorPosition for menu\n  // offsetX used for calculations about width of selection\n  const [anchorPosition, setAnchorPosition] = useState<{\n    offsetX: number\n    clientX: number\n    clientY: number\n  }>()\n  const [guideX, setGuideX] = useState<number | undefined>()\n  const controlsRef = useRef<HTMLDivElement>(null)\n  const rubberBandRef = useRef(null)\n  const classes = useStyles()\n  const mouseDragging = startX !== undefined && anchorPosition === undefined\n\n  useEffect(() => {\n    function globalMouseMove(event: MouseEvent) {\n      if (controlsRef.current && mouseDragging) {\n        const relativeX =\n          event.clientX - controlsRef.current.getBoundingClientRect().left\n        setCurrentX(relativeX)\n      }\n    }\n\n    function globalMouseUp(event: MouseEvent) {\n      if (startX !== undefined && controlsRef.current) {\n        const { clientX, clientY } = event\n        const ref = controlsRef.current\n        const offsetX = clientX - ref.getBoundingClientRect().left\n        // as stated above, store both clientX/Y and offsetX for different\n        // purposes\n        setAnchorPosition({\n          offsetX,\n          clientX,\n          clientY,\n        })\n        setGuideX(undefined)\n      }\n    }\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove)\n      window.addEventListener('mouseup', globalMouseUp)\n      return () => {\n        window.removeEventListener('mousemove', globalMouseMove)\n        window.removeEventListener('mouseup', globalMouseUp)\n      }\n    }\n    return () => {}\n  }, [startX, mouseDragging, anchorPosition])\n\n  useEffect(() => {\n    if (\n      !mouseDragging &&\n      currentX !== undefined &&\n      startX !== undefined &&\n      Math.abs(currentX - startX) <= 3\n    ) {\n      handleClose()\n    }\n  }, [mouseDragging, currentX, startX, model.bpPerPx])\n\n  function mouseDown(event: React.MouseEvent<HTMLDivElement>) {\n    event.preventDefault()\n    event.stopPropagation()\n    const relativeX =\n      event.clientX -\n      (event.target as HTMLDivElement).getBoundingClientRect().left\n    setStartX(relativeX)\n    setCurrentX(relativeX)\n  }\n\n  function mouseMove(event: React.MouseEvent<HTMLDivElement>) {\n    const target = event.target as HTMLDivElement\n    setGuideX(event.clientX - target.getBoundingClientRect().left)\n  }\n\n  function mouseOut() {\n    setGuideX(undefined)\n    model.setOffsets(undefined, undefined)\n  }\n\n  function zoomToRegion() {\n    if (startX === undefined || anchorPosition === undefined) {\n      return\n    }\n    let leftPx = startX\n    let rightPx = anchorPosition.offsetX\n    if (rightPx < leftPx) {\n      ;[leftPx, rightPx] = [rightPx, leftPx]\n    }\n    const leftOffset = model.pxToBp(leftPx)\n    const rightOffset = model.pxToBp(rightPx)\n    model.moveTo(leftOffset, rightOffset)\n  }\n\n  function getSequence() {\n    if (startX === undefined || anchorPosition === undefined) {\n      return\n    }\n    let leftPx = startX\n    let rightPx = anchorPosition.offsetX\n    // handles clicking and draging to the left\n    if (rightPx < leftPx) {\n      ;[leftPx, rightPx] = [rightPx, leftPx]\n    }\n    const leftOffset = model.pxToBp(leftPx)\n    const rightOffset = model.pxToBp(rightPx)\n    model.setOffsets(leftOffset, rightOffset)\n  }\n\n  function handleClose() {\n    setAnchorPosition(undefined)\n    setStartX(undefined)\n    setCurrentX(undefined)\n  }\n\n  const open = Boolean(anchorPosition)\n\n  function handleMenuItemClick(_: unknown, callback: Function) {\n    callback()\n    handleClose()\n  }\n\n  const menuItems = [\n    {\n      label: 'Zoom to region',\n      icon: ZoomInIcon,\n      onClick: () => {\n        zoomToRegion()\n        handleClose()\n      },\n    },\n    {\n      label: 'Get sequence',\n      disabled:\n        currentX !== undefined &&\n        startX !== undefined &&\n        Math.abs(currentX - startX) * model.bpPerPx > 500_000_000,\n      icon: MenuOpenIcon,\n      onClick: () => {\n        getSequence()\n        handleClose()\n      },\n    },\n  ]\n\n  if (startX === undefined) {\n    return (\n      <>\n        {guideX !== undefined ? (\n          <VerticalGuide model={model} coordX={guideX} />\n        ) : null}\n        <div\n          data-testid=\"rubberBand_controls\"\n          className={classes.rubberBandControl}\n          role=\"presentation\"\n          ref={controlsRef}\n          onMouseDown={mouseDown}\n          onMouseOut={mouseOut}\n          onMouseMove={mouseMove}\n        >\n          {ControlComponent}\n        </div>\n      </>\n    )\n  }\n\n  /* Calculating Pixels for Mouse Dragging */\n  const right = anchorPosition ? anchorPosition.offsetX : currentX || 0\n  const left = right < startX ? right : startX\n  const width = Math.abs(right - startX)\n  const leftBpOffset = model.pxToBp(left)\n  const rightBpOffset = model.pxToBp(left + width)\n  const numOfBpSelected = Math.ceil(width * model.bpPerPx)\n  return (\n    <>\n      {rubberBandRef.current ? (\n        <>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'left',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'right',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>{stringify(leftBpOffset)}</Typography>\n          </Popover>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'right',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'left',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>{stringify(rightBpOffset)}</Typography>\n          </Popover>\n        </>\n      ) : null}\n      <div\n        ref={rubberBandRef}\n        className={classes.rubberBand}\n        style={{ left, width }}\n      >\n        <Typography variant=\"h6\" className={classes.rubberBandText}>\n          {numOfBpSelected.toLocaleString('en-US')} bp\n        </Typography>\n      </div>\n      <div\n        data-testid=\"rubberBand_controls\"\n        className={classes.rubberBandControl}\n        role=\"presentation\"\n        ref={controlsRef}\n        onMouseDown={mouseDown}\n        onMouseOut={mouseOut}\n        onMouseMove={mouseMove}\n      >\n        {ControlComponent}\n      </div>\n      {anchorPosition ? (\n        <Menu\n          anchorReference=\"anchorPosition\"\n          anchorPosition={{\n            left: anchorPosition.clientX,\n            top: anchorPosition.clientY,\n          }}\n          onMenuItemClick={handleMenuItemClick}\n          open={open}\n          onClose={handleClose}\n          menuItems={menuItems}\n        />\n      ) : null}\n    </>\n  )\n}\n\nRubberBand.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n  ControlComponent: ReactPropTypes.node,\n}\n\nRubberBand.defaultProps = {\n  ControlComponent: <div />,\n}\n\nexport default observer(RubberBand)\n","import {\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from '@jbrowse/core/util/blockTypes'\nimport Paper from '@material-ui/core/Paper'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\nimport clsx from 'clsx'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React from 'react'\nimport { LinearGenomeViewStateModel } from '..'\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from '../../BaseLinearDisplay/components/Block'\nimport { makeTicks } from '../util'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(theme => ({\n  scaleBarContainer: {\n    overflow: 'hidden',\n    position: 'relative',\n  },\n  scaleBarZoomContainer: {\n    position: 'relative',\n    zIndex: 1,\n  },\n  scaleBar: {\n    position: 'absolute',\n    display: 'flex',\n    pointerEvents: 'none',\n  },\n  majorTickLabel: {\n    fontSize: '11px',\n    zIndex: 1,\n    background: theme.palette.background.paper,\n    lineHeight: 'normal',\n    pointerEvents: 'none',\n  },\n  tick: {\n    position: 'absolute',\n    width: 0,\n    display: 'flex',\n    justifyContent: 'center',\n    pointerEvents: 'none',\n  },\n  refLabel: {\n    fontSize: '11px',\n    position: 'absolute',\n    left: '2px',\n    top: '-1px',\n    fontWeight: 'bold',\n    lineHeight: 'normal',\n    zIndex: 1,\n    pointerEvents: 'none',\n    background: theme.palette.background.paper,\n  },\n}))\n\nconst RenderedRefNameLabels = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n\n  // find the block that needs pinning to the left side for context\n  let lastLeftBlock = 0\n  model.staticBlocks.forEach((block, i) => {\n    if (block.offsetPx - model.offsetPx < 0) {\n      lastLeftBlock = i\n    }\n  })\n  return (\n    <>\n      {model.staticBlocks.map((block, index) => {\n        return block instanceof ContentBlock &&\n          (block.isLeftEndOfDisplayedRegion || index === lastLeftBlock) ? (\n          <Typography\n            key={`refLabel-${block.key}-${index}`}\n            style={{\n              left:\n                index === lastLeftBlock\n                  ? Math.max(0, -model.offsetPx)\n                  : block.offsetPx - model.offsetPx - 1,\n              paddingLeft: index === lastLeftBlock ? 0 : 1,\n            }}\n            className={classes.refLabel}\n            data-testid={`refLabel-${block.refName}`}\n          >\n            {block.refName}\n          </Typography>\n        ) : null\n      })}\n    </>\n  )\n})\n\nconst RenderedScaleBarLabels = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n\n  return (\n    <>\n      {model.staticBlocks.map((block, index) => {\n        if (block instanceof ContentBlock) {\n          const ticks = makeTicks(\n            block.start,\n            block.end,\n            model.bpPerPx,\n            true,\n            false,\n          )\n\n          return (\n            <ContentBlockComponent key={`${block.key}-${index}`} block={block}>\n              {ticks.map(tick => {\n                if (tick.type === 'major') {\n                  const x =\n                    (block.reversed\n                      ? block.end - tick.base\n                      : tick.base - block.start) / model.bpPerPx\n                  const baseNumber = (tick.base + 1).toLocaleString('en-US')\n                  return (\n                    <div\n                      key={tick.base}\n                      className={classes.tick}\n                      style={{ left: x }}\n                    >\n                      {baseNumber ? (\n                        <Typography className={classes.majorTickLabel}>\n                          {baseNumber}\n                        </Typography>\n                      ) : null}\n                    </div>\n                  )\n                }\n                return null\n              })}\n            </ContentBlockComponent>\n          )\n        }\n        if (block instanceof ElidedBlock) {\n          return <ElidedBlockComponent key={block.key} width={block.widthPx} />\n        }\n        if (block instanceof InterRegionPaddingBlock) {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={block.key}\n              width={block.widthPx}\n              style={{ background: 'none' }}\n              boundary={block.variant === 'boundary'}\n            />\n          )\n        }\n        return null\n      })}\n    </>\n  )\n})\n\nconst ScaleBar = React.forwardRef(\n  (\n    {\n      model,\n      style,\n      className,\n      ...other\n    }: { model: LGV; style?: React.CSSProperties; className?: string },\n    ref,\n  ) => {\n    const classes = useStyles()\n\n    const offsetLeft = model.staticBlocks.offsetPx - model.offsetPx\n    return (\n      <Paper\n        data-resizer=\"true\" // used to avoid click-and-drag scrolls on trackscontainer\n        className={clsx(classes.scaleBarContainer, className)}\n        variant=\"outlined\"\n        ref={ref}\n        style={style}\n        {...other}\n      >\n        <div\n          className={classes.scaleBarZoomContainer}\n          style={{\n            transform:\n              model.scaleFactor !== 1\n                ? `scaleX(${model.scaleFactor})`\n                : undefined,\n          }}\n        >\n          <div\n            className={classes.scaleBar}\n            style={{\n              left: offsetLeft - 1,\n              width: model.staticBlocks.totalWidthPx,\n              ...style,\n            }}\n          >\n            <RenderedScaleBarLabels model={model} />\n          </div>\n        </div>\n        <RenderedRefNameLabels model={model} />\n      </Paper>\n    )\n  },\n)\n\nexport default observer(ScaleBar)\n","import {\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from '@jbrowse/core/util/blockTypes'\nimport { makeStyles } from '@material-ui/core/styles'\nimport clsx from 'clsx'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React from 'react'\nimport { LinearGenomeViewStateModel } from '..'\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from '../../BaseLinearDisplay/components/Block'\n\nimport { makeTicks } from '../util'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(theme => ({\n  verticalGuidesZoomContainer: {\n    position: 'absolute',\n    height: '100%',\n    width: '100%',\n    zIndex: 1,\n    pointerEvents: 'none',\n  },\n  verticalGuidesContainer: {\n    position: 'absolute',\n    height: '100%',\n    zIndex: 1,\n    pointerEvents: 'none',\n    display: 'flex',\n  },\n  tick: {\n    position: 'absolute',\n    height: '100%',\n    width: 1,\n  },\n  majorTick: {\n    background: theme.palette.text.hint,\n  },\n  minorTick: {\n    background: theme.palette.divider,\n  },\n}))\nconst RenderedVerticalGuides = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  return (\n    <>\n      {model.staticBlocks.map((block, index) => {\n        if (block instanceof ContentBlock) {\n          const ticks = makeTicks(block.start, block.end, model.bpPerPx)\n          return (\n            <ContentBlockComponent key={`${block.key}-${index}`} block={block}>\n              {ticks.map(tick => {\n                const x =\n                  (block.reversed\n                    ? block.end - tick.base\n                    : tick.base - block.start) / model.bpPerPx\n                return (\n                  <div\n                    key={tick.base}\n                    className={clsx(\n                      classes.tick,\n                      tick.type === 'major' || tick.type === 'labeledMajor'\n                        ? classes.majorTick\n                        : classes.minorTick,\n                    )}\n                    style={{ left: x }}\n                  />\n                )\n              })}\n            </ContentBlockComponent>\n          )\n        }\n        if (block instanceof ElidedBlock) {\n          return <ElidedBlockComponent key={block.key} width={block.widthPx} />\n        }\n        if (block instanceof InterRegionPaddingBlock) {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={block.key}\n              width={block.widthPx}\n              boundary={block.variant === 'boundary'}\n            />\n          )\n        }\n        return null\n      })}\n    </>\n  )\n})\nfunction VerticalGuides({ model }: { model: LGV }) {\n  const classes = useStyles()\n  // find the block that needs pinning to the left side for context\n  const offsetLeft = model.staticBlocks.offsetPx - model.offsetPx\n  return (\n    <div\n      className={classes.verticalGuidesZoomContainer}\n      style={{\n        transform:\n          model.scaleFactor !== 1 ? `scaleX(${model.scaleFactor})` : undefined,\n      }}\n    >\n      <div\n        className={classes.verticalGuidesContainer}\n        style={{\n          left: offsetLeft,\n          width: model.staticBlocks.totalWidthPx,\n        }}\n      >\n        <RenderedVerticalGuides model={model} />\n      </div>\n    </div>\n  )\n}\n\nexport default observer(VerticalGuides)\n","import { makeStyles } from '@material-ui/core/styles'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport React, { useRef } from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport { LinearGenomeViewStateModel } from '..'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(() => ({\n  centerLineContainer: {\n    background: 'transparent',\n    height: '100%',\n    zIndex: 5, // above the track but under menu\n    position: 'absolute',\n    border: '1px black dashed',\n    borderTop: 'none',\n    borderBottom: 'none',\n    pointerEvents: 'none',\n  },\n  centerLineText: {\n    position: 'absolute',\n    pointerEvents: 'none',\n    whiteSpace: 'nowrap',\n    fontWeight: 'bold',\n  },\n}))\n\nfunction CenterLine({ model }: { model: LGV }) {\n  const { bpPerPx, centerLineInfo, trackHeights, tracks, width } = model\n  const ref = useRef<HTMLDivElement>(null)\n  const classes = useStyles()\n  const startingPosition = width / 2\n\n  return tracks.length ? (\n    <div\n      data-testid=\"centerline_container\"\n      className={classes.centerLineContainer}\n      role=\"presentation\"\n      ref={ref}\n      style={{\n        left: `${startingPosition}px`,\n        width: Math.max(1 / bpPerPx, 1),\n      }}\n    >\n      {centerLineInfo && (\n        <div\n          // text that indicates what bp is center, positioned\n          // at the bottom right of the center line\n          data-testid=\"centerline_text\"\n          className={classes.centerLineText}\n          role=\"presentation\"\n          style={{\n            left: Math.max(1 / bpPerPx, 1) + 5,\n            top: trackHeights,\n          }}\n        >\n          {/* change bp to refName */}\n          {centerLineInfo.refName}:{' '}\n          {Math.max(Math.round(centerLineInfo.offset) + 1, 0)}\n        </div>\n      )}\n    </div>\n  ) : null\n}\n\nCenterLine.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n\nexport default observer(CenterLine)\n","import { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React, { useEffect, useRef, useState } from 'react'\nimport normalizeWheel from 'normalize-wheel'\n\nimport {\n  LinearGenomeViewStateModel,\n  RESIZE_HANDLE_HEIGHT,\n  SCALE_BAR_HEIGHT,\n} from '..'\nimport RubberBand from './RubberBand'\nimport ScaleBar from './ScaleBar'\nimport VerticalGuides from './VerticalGuides'\nimport CenterLine from './CenterLine'\n\nconst useStyles = makeStyles(theme => ({\n  tracksContainer: {\n    position: 'relative',\n    borderRadius: theme.shape.borderRadius,\n    overflow: 'hidden',\n  },\n  spacer: {\n    position: 'relative',\n    height: RESIZE_HANDLE_HEIGHT,\n  },\n}))\n\ntype LGV = Instance<LinearGenomeViewStateModel>\ntype Timer = ReturnType<typeof setTimeout>\n\nfunction TracksContainer({\n  children,\n  model,\n}: {\n  children: React.ReactNode\n  model: LGV\n}) {\n  const classes = useStyles()\n  // refs are to store these variables to avoid repeated rerenders associated\n  // with useState/setState\n  const delta = useRef(0)\n  const scheduled = useRef(false)\n  const timeout = useRef<Timer>()\n  const ref = useRef<HTMLDivElement>(null)\n  const prevX = useRef<number>(0)\n\n  const [mouseDragging, setMouseDragging] = useState(false)\n\n  useEffect(() => {\n    let cleanup = () => {}\n\n    function globalMouseMove(event: MouseEvent) {\n      event.preventDefault()\n      const currX = event.clientX\n      const distance = currX - prevX.current\n      if (distance) {\n        // use rAF to make it so multiple event handlers aren't fired per-frame\n        // see https://calendar.perfplanet.com/2013/the-runtime-performance-checklist/\n        if (!scheduled.current) {\n          scheduled.current = true\n          window.requestAnimationFrame(() => {\n            model.horizontalScroll(-distance)\n            scheduled.current = false\n            prevX.current = event.clientX\n          })\n        }\n      }\n    }\n\n    function globalMouseUp() {\n      prevX.current = 0\n      if (mouseDragging) {\n        setMouseDragging(false)\n      }\n    }\n\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove, true)\n      window.addEventListener('mouseup', globalMouseUp, true)\n      cleanup = () => {\n        window.removeEventListener('mousemove', globalMouseMove, true)\n        window.removeEventListener('mouseup', globalMouseUp, true)\n      }\n    }\n    return cleanup\n  }, [model, mouseDragging, prevX])\n\n  function mouseDown(event: React.MouseEvent) {\n    // check if clicking a draggable element or a resize handle\n    const target = event.target as HTMLElement\n    if (target.draggable || target.dataset.resizer) {\n      return\n    }\n\n    // otherwise do click and drag scroll\n    if (event.button === 0) {\n      prevX.current = event.clientX\n      setMouseDragging(true)\n    }\n  }\n\n  // this local mouseup is used in addition to the global because sometimes\n  // the global add/remove are not called in time, resulting in issue #533\n  function mouseUp(event: React.MouseEvent) {\n    event.preventDefault()\n    setMouseDragging(false)\n  }\n\n  function mouseLeave(event: React.MouseEvent) {\n    event.preventDefault()\n  }\n\n  useEffect(() => {\n    const curr = ref.current\n    // if ctrl is held down, zoom in with y-scroll\n    // else scroll horizontally with x-scroll\n    function onWheel(origEvent: WheelEvent) {\n      const event = normalizeWheel(origEvent)\n      if (origEvent.ctrlKey === true) {\n        origEvent.preventDefault()\n        delta.current += event.pixelY / 500\n        model.setScaleFactor(\n          delta.current < 0 ? 1 - delta.current : 1 / (1 + delta.current),\n        )\n        if (timeout.current) {\n          clearTimeout(timeout.current)\n        }\n        timeout.current = setTimeout(() => {\n          model.setScaleFactor(1)\n          model.zoomTo(\n            delta.current > 0\n              ? model.bpPerPx * (1 + delta.current)\n              : model.bpPerPx / (1 - delta.current),\n          )\n          delta.current = 0\n        }, 300)\n      } else {\n        // this is needed to stop the event from triggering \"back button\n        // action\" on MacOSX etc.  but is a heuristic to avoid preventing the\n        // inner-track scroll behavior\n        if (Math.abs(event.pixelX) > Math.abs(2 * event.pixelY)) {\n          origEvent.preventDefault()\n        }\n        delta.current += event.pixelX\n        if (!scheduled.current) {\n          // use rAF to make it so multiple event handlers aren't fired per-frame\n          // see https://calendar.perfplanet.com/2013/the-runtime-performance-checklist/\n          scheduled.current = true\n          window.requestAnimationFrame(() => {\n            model.horizontalScroll(delta.current)\n            delta.current = 0\n            scheduled.current = false\n          })\n        }\n      }\n    }\n    if (curr) {\n      curr.addEventListener('wheel', onWheel)\n      return () => {\n        curr.removeEventListener('wheel', onWheel)\n      }\n    }\n    return () => {}\n  }, [model])\n\n  return (\n    <div\n      ref={ref}\n      role=\"presentation\"\n      className={classes.tracksContainer}\n      onMouseDown={mouseDown}\n      onMouseUp={mouseUp}\n      onMouseLeave={mouseLeave}\n    >\n      <VerticalGuides model={model} />\n      {model.showCenterLine ? <CenterLine model={model} /> : null}\n\n      <RubberBand\n        model={model}\n        ControlComponent={\n          <ScaleBar\n            model={model}\n            style={{ height: SCALE_BAR_HEIGHT, boxSizing: 'border-box' }}\n          />\n        }\n      />\n      <div className={classes.spacer} />\n      {children}\n    </div>\n  )\n}\n\nexport default observer(TracksContainer)\n","import React from 'react'\nimport { getEnv, resolveIdentifier, getRoot } from 'mobx-state-tree'\nimport { getSession } from '@jbrowse/core/util'\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogContentText,\n  DialogTitle,\n  Divider,\n  IconButton,\n  Table,\n  TableBody,\n  TableCell,\n  TableContainer,\n  TableHead,\n  TableRow,\n  Typography,\n  Paper,\n} from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\nimport { makeStyles } from '@material-ui/core/styles'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport { LinearGenomeViewModel } from '../..'\n\nexport const useStyles = makeStyles(theme => ({\n  dialogContent: {\n    width: '80em',\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nexport default function SearchResultsDialog({\n  model,\n  optAssemblyName,\n  handleClose,\n}: {\n  model: LinearGenomeViewModel\n  optAssemblyName?: string\n  handleClose: () => void\n}) {\n  const classes = useStyles()\n  const session = getSession(model)\n  const { pluginManager } = getEnv(session)\n  const { assemblyManager } = session\n  let assemblyName = optAssemblyName\n  if (model.displayedRegions.length > 0) {\n    assemblyName = model.displayedRegions[0]?.assemblyName\n  }\n  if (!assemblyName) {\n    throw new Error(`Assembly name not found`)\n  }\n  const assembly = assemblyManager.get(assemblyName)\n  if (!assembly) {\n    throw new Error(`assembly ${assemblyName} not found`)\n  }\n  if (!assembly.regions) {\n    throw new Error(`assembly ${assemblyName} regions not loaded`)\n  }\n  const assemblyRegions = assembly.regions\n\n  function handleClick(location: string) {\n    try {\n      const newRegion = assemblyRegions.find(\n        region => location === region.refName,\n      )\n      if (newRegion) {\n        model.setDisplayedRegions([newRegion])\n        // we use showAllRegions after setDisplayedRegions to make the entire\n        // region visible, xref #1703\n        model.showAllRegions()\n      } else {\n        model.navToLocString(location, assemblyName)\n      }\n    } catch (e) {\n      console.warn(e)\n      session.notify(`${e}`, 'warning')\n    }\n  }\n  function handleShowTrack(trackId: string) {\n    const trackConfigSchema = pluginManager.pluggableConfigSchemaType('track')\n    const configuration = resolveIdentifier(\n      trackConfigSchema,\n      getRoot(model),\n      trackId,\n    )\n    // check if we have any tracks with that configuration\n    const shownTracks = model.tracks.filter(\n      t => t.configuration === configuration,\n    )\n    if (shownTracks.length === 0) {\n      model.showTrack(trackId)\n    }\n  }\n\n  function getTrackName(trackId: string | undefined) {\n    if (trackId) {\n      const trackConfigSchema = pluginManager.pluggableConfigSchemaType('track')\n      const configuration = resolveIdentifier(\n        trackConfigSchema,\n        getRoot(model),\n        trackId,\n      )\n      if (configuration) {\n        return configuration.name?.value\n      }\n    }\n    return ''\n  }\n\n  return (\n    <Dialog open maxWidth=\"xl\" onClose={handleClose}>\n      <DialogTitle id=\"search-results-dialog\">\n        Search Results\n        {handleClose ? (\n          <IconButton\n            data-testid=\"close-resultsDialog\"\n            className={classes.closeButton}\n            onClick={() => {\n              handleClose()\n            }}\n          >\n            <CloseIcon />\n          </IconButton>\n        ) : null}\n      </DialogTitle>\n      <Divider />\n      <DialogContent>\n        {model.searchResults?.length === 0 ||\n        model.searchResults === undefined ? (\n          <Typography>\n            {`No results found for `}\n            <b>{model.searchQuery}</b>\n          </Typography>\n        ) : (\n          <>\n            <DialogContentText id=\"alert-dialog-slide-description\">\n              {`Showing results for `}\n              <b>{model.searchQuery}</b>\n            </DialogContentText>\n            <TableContainer component={Paper}>\n              <Table>\n                <TableHead>\n                  <TableRow>\n                    <TableCell>Name</TableCell>\n                    <TableCell align=\"right\">Location</TableCell>\n                    <TableCell align=\"right\">Track</TableCell>\n                    <TableCell align=\"right\" />\n                  </TableRow>\n                </TableHead>\n                <TableBody>\n                  {model.searchResults.map((result: BaseResult, index) => (\n                    <TableRow key={`${result.getLabel()}-${index}`}>\n                      <TableCell component=\"th\" scope=\"row\">\n                        {result.getLabel()}\n                      </TableCell>\n                      <TableCell align=\"right\">\n                        {result.getLocation()}\n                      </TableCell>\n                      <TableCell align=\"right\">\n                        {getTrackName(result.getTrackId()) || 'N/A'}\n                      </TableCell>\n                      <TableCell align=\"right\">\n                        <Button\n                          onClick={() => {\n                            handleClick(result.getLocation())\n                            handleClose()\n                          }}\n                          color=\"primary\"\n                          variant=\"contained\"\n                        >\n                          Go to location\n                        </Button>\n                      </TableCell>\n                      <TableCell align=\"right\">\n                        <Button\n                          onClick={() => {\n                            handleClick(result.getLocation())\n                            const resultTrackId = result.getTrackId()\n                            if (resultTrackId) {\n                              handleShowTrack(resultTrackId)\n                            }\n                            handleClose()\n                          }}\n                          disabled={!getTrackName(result.getTrackId())}\n                          color=\"primary\"\n                          variant=\"contained\"\n                        >\n                          Show Track\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </TableContainer>\n          </>\n        )}\n      </DialogContent>\n      <Divider />\n      <DialogActions>\n        <Button\n          onClick={() => {\n            handleClose()\n          }}\n          color=\"primary\"\n        >\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n","import React, { useState, useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport { getEnv } from 'mobx-state-tree'\nimport { getSession } from '@jbrowse/core/util'\nimport { Region } from '@jbrowse/core/util/types'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\n// material ui\nimport { makeStyles } from '@material-ui/core/styles'\nimport Button from '@material-ui/core/Button'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport TextField from '@material-ui/core/TextField'\nimport Container from '@material-ui/core/Container'\nimport Grid from '@material-ui/core/Grid'\nimport MenuItem from '@material-ui/core/MenuItem'\n// other\nimport RefNameAutocomplete from './RefNameAutocomplete'\nimport SearchResultsDialog from './SearchResultsDialog'\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles(theme => ({\n  importFormContainer: {\n    padding: theme.spacing(2),\n  },\n  importFormEntry: {\n    minWidth: 180,\n  },\n  button: {\n    margin: theme.spacing(2),\n  },\n}))\n\ntype LGV = LinearGenomeViewModel\n\nconst ImportForm = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  const session = getSession(model)\n  const { assemblyNames, assemblyManager } = session\n  const { pluginManager } = getEnv(session)\n  const { textSearchManager } = pluginManager.rootModel\n  const { rankSearchResults } = model\n  const [selectedAssemblyIdx, setSelectedAssemblyIdx] = useState(0)\n  const [selectedRegion, setSelectedRegion] = useState<string | undefined>(\n    undefined,\n  )\n  const [assemblyRegions, setAssemblyRegions] = useState<Region[]>([])\n  const error = !assemblyNames.length ? 'No configured assemblies' : ''\n  const hasError = Boolean(error)\n  const assemblyName = assemblyNames[selectedAssemblyIdx]\n  const displayName = assemblyName && !error ? selectedAssemblyIdx : ''\n  const searchScope = model.searchScope(assemblyName)\n  useEffect(() => {\n    let done = false\n    ;(async () => {\n      if (assemblyName) {\n        const assembly = await assemblyManager.waitForAssembly(assemblyName)\n        if (assembly && assembly.regions) {\n          const regions = assembly.regions\n          if (!done && regions) {\n            setSelectedRegion(regions[0].refName)\n            setAssemblyRegions(regions)\n          }\n        }\n      }\n    })()\n    return () => {\n      done = true\n    }\n  }, [assemblyManager, assemblyName])\n\n  function setSelectedValue(selectedOption: BaseResult) {\n    setSelectedRegion(selectedOption.getLocation())\n  }\n\n  async function handleSelectedRegion(input: string) {\n    const newRegion = assemblyRegions.find(r => selectedRegion === r.refName)\n    if (newRegion) {\n      model.setDisplayedRegions([newRegion])\n      // we use showAllRegions after setDisplayedRegions to make the entire\n      // region visible, xref #1703\n      model.showAllRegions()\n    } else {\n      const results =\n        (await textSearchManager?.search(\n          {\n            queryString: input.toLocaleLowerCase(),\n            searchType: 'exact',\n          },\n          searchScope,\n          rankSearchResults,\n        )) || []\n      if (results.length > 0) {\n        model.setSearchResults(results, input.toLocaleLowerCase())\n      } else {\n        try {\n          input && model.navToLocString(input, assemblyName)\n        } catch (e) {\n          if (`${e}` === `Error: Unknown reference sequence \"${input}\"`) {\n            model.setSearchResults(results, input.toLocaleLowerCase())\n          } else {\n            console.warn(e)\n            session.notify(`${e}`, 'warning')\n          }\n        }\n      }\n    }\n  }\n\n  return (\n    <div>\n      {model.isSearchDialogDisplayed ? (\n        <SearchResultsDialog\n          model={model}\n          optAssemblyName={assemblyName}\n          handleClose={() => {\n            model.setSearchResults(undefined, undefined)\n          }}\n        />\n      ) : null}\n      <Container className={classes.importFormContainer}>\n        <Grid container spacing={1} justify=\"center\" alignItems=\"center\">\n          <Grid item>\n            <TextField\n              select\n              variant=\"outlined\"\n              value={displayName}\n              onChange={event => {\n                setSelectedAssemblyIdx(Number(event.target.value))\n              }}\n              label=\"Assembly\"\n              helperText={error || 'Select assembly to view'}\n              error={hasError}\n              disabled={hasError}\n              margin=\"normal\"\n              className={classes.importFormEntry}\n            >\n              {assemblyNames.map((name, idx) => (\n                <MenuItem key={name} value={idx}>\n                  {name}\n                </MenuItem>\n              ))}\n            </TextField>\n          </Grid>\n          <Grid item>\n            {assemblyName ? (\n              selectedRegion !== undefined && model.volatileWidth ? (\n                <RefNameAutocomplete\n                  model={model}\n                  assemblyName={\n                    error ? undefined : assemblyNames[selectedAssemblyIdx]\n                  }\n                  value={selectedRegion}\n                  onSelect={option => {\n                    setSelectedValue(option)\n                  }}\n                  TextFieldProps={{\n                    margin: 'normal',\n                    variant: 'outlined',\n                    className: classes.importFormEntry,\n                    helperText: 'Enter a sequence or locstring',\n                    onBlur: event => {\n                      if ((event.target as HTMLInputElement).value !== '') {\n                        setSelectedRegion(\n                          (event.target as HTMLInputElement).value,\n                        )\n                      }\n                    },\n                    onKeyPress: event => {\n                      const inputValue = (event.target as HTMLInputElement)\n                        .value\n                      // maybe check regular expression here to see if it's a locstring\n                      // try defaulting exact matches to first exact match\n                      if (event.key === 'Enter') {\n                        handleSelectedRegion(inputValue)\n                      }\n                    },\n                  }}\n                />\n              ) : (\n                <CircularProgress\n                  role=\"progressbar\"\n                  color=\"inherit\"\n                  size={20}\n                  disableShrink\n                />\n              )\n            ) : null}\n          </Grid>\n          <Grid item>\n            <Button\n              disabled={!selectedRegion}\n              className={classes.button}\n              onClick={() => {\n                if (selectedRegion) {\n                  handleSelectedRegion(selectedRegion)\n                }\n              }}\n              variant=\"contained\"\n              color=\"primary\"\n            >\n              Open\n            </Button>\n            <Button\n              disabled={!selectedRegion}\n              className={classes.button}\n              onClick={() => {\n                model.showAllRegionsInAssembly(assemblyName)\n              }}\n              variant=\"contained\"\n              color=\"secondary\"\n            >\n              Show all regions in assembly\n            </Button>\n          </Grid>\n        </Grid>\n      </Container>\n    </div>\n  )\n})\n\nexport default ImportForm\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport IconButton from '@material-ui/core/IconButton'\nimport ZoomIn from '@material-ui/icons/ZoomIn'\nimport ZoomOut from '@material-ui/icons/ZoomOut'\nimport ArrowDown from '@material-ui/icons/KeyboardArrowDown'\nimport Paper from '@material-ui/core/Paper'\nimport Menu from '@jbrowse/core/ui/Menu'\nimport { LinearGenomeViewModel } from '..'\n\nconst MiniControls = observer((props: { model: LinearGenomeViewModel }) => {\n  const { model } = props\n  const { bpPerPx, maxBpPerPx, minBpPerPx, scaleFactor } = model\n  const [anchorEl, setAnchorEl] = useState<HTMLElement>()\n\n  return (\n    <>\n      <Paper style={{ background: '#aaa7' }}>\n        <IconButton\n          color=\"secondary\"\n          onClick={event => {\n            setAnchorEl(event.currentTarget)\n          }}\n        >\n          <ArrowDown />\n        </IconButton>\n\n        <IconButton\n          data-testid=\"zoom_out\"\n          onClick={() => {\n            model.zoom(bpPerPx * 2)\n          }}\n          disabled={bpPerPx >= maxBpPerPx - 0.0001 || scaleFactor !== 1}\n          color=\"secondary\"\n        >\n          <ZoomOut />\n        </IconButton>\n        <IconButton\n          data-testid=\"zoom_in\"\n          onClick={() => {\n            model.zoom(model.bpPerPx / 2)\n          }}\n          disabled={bpPerPx <= minBpPerPx + 0.0001 || scaleFactor !== 1}\n          color=\"secondary\"\n        >\n          <ZoomIn />\n        </IconButton>\n      </Paper>\n      <Menu\n        anchorEl={anchorEl}\n        open={Boolean(anchorEl)}\n        onMenuItemClick={(_, callback) => {\n          callback()\n          setAnchorEl(undefined)\n        }}\n        onClose={() => {\n          setAnchorEl(undefined)\n        }}\n        menuItems={model.menuItems}\n      />\n    </>\n  )\n})\n\nexport default MiniControls\n","import React, { useEffect, useMemo, useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { saveAs } from 'file-saver'\nimport { Region } from '@jbrowse/core/util/types'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport copy from 'copy-to-clipboard'\nimport { makeStyles } from '@material-ui/core/styles'\nimport {\n  Button,\n  CircularProgress,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  Container,\n  Typography,\n  Divider,\n  IconButton,\n  TextField,\n} from '@material-ui/core'\nimport { ContentCopy as ContentCopyIcon } from '@jbrowse/core/ui/Icons'\nimport CloseIcon from '@material-ui/icons/Close'\nimport GetAppIcon from '@material-ui/icons/GetApp'\nimport { getSession } from '@jbrowse/core/util'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { formatSeqFasta, SeqChunk } from '@jbrowse/core/util/formatFastaStrings'\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles(theme => ({\n  loadingMessage: {\n    padding: theme.spacing(5),\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n  dialogContent: {\n    width: '80em',\n  },\n  textAreaFont: {\n    fontFamily: 'Courier New',\n  },\n}))\n\n/**\n * Fetches and returns a list features for a given list of regions\n * @param selectedRegions - Region[]\n * @returns Features[]\n */\nasync function fetchSequence(\n  self: LinearGenomeViewModel,\n  selectedRegions: Region[],\n) {\n  const session = getSession(self)\n  const assemblyName =\n    self.leftOffset?.assemblyName || self.rightOffset?.assemblyName || ''\n  const { rpcManager, assemblyManager } = session\n  const assemblyConfig = assemblyManager.get(assemblyName)?.configuration\n\n  // assembly configuration\n  const adapterConfig = readConfObject(assemblyConfig, ['sequence', 'adapter'])\n\n  const sessionId = 'getSequence'\n  const chunks = (await Promise.all(\n    selectedRegions.map(region =>\n      rpcManager.call(sessionId, 'CoreGetFeatures', {\n        adapterConfig,\n        region,\n        sessionId,\n      }),\n    ),\n  )) as Feature[][]\n\n  // assumes that we get whole sequence in a single getFeatures call\n  return chunks.map(chunk => chunk[0])\n}\n\nfunction SequenceDialog({\n  model,\n  handleClose,\n}: {\n  model: LinearGenomeViewModel\n  handleClose: () => void\n}) {\n  const classes = useStyles()\n  const session = getSession(model)\n  const [error, setError] = useState<Error>()\n  const [sequence, setSequence] = useState('')\n  const loading = Boolean(!sequence) || Boolean(error)\n  const { leftOffset, rightOffset } = model\n\n  // avoid infinite looping of useEffect\n  // random note: the current selected region can't be a computed because it\n  // uses action on base1dview even though it's on the ephemeral base1dview\n  const regionsSelected = useMemo(\n    () => model.getSelectedRegions(leftOffset, rightOffset),\n    [model, leftOffset, rightOffset],\n  )\n\n  useEffect(() => {\n    let active = true\n\n    function formatSequence(seqChunks: Feature[]) {\n      const sequenceChunks: SeqChunk[] = []\n      const incompleteSeqErrs: string[] = []\n      seqChunks.forEach((chunk: Feature) => {\n        const chunkSeq = chunk.get('seq')\n        const chunkRefName = chunk.get('refName')\n        const chunkStart = chunk.get('start') + 1\n        const chunkEnd = chunk.get('end')\n        const chunkLocstring = `${chunkRefName}:${chunkStart}-${chunkEnd}`\n        if (chunkSeq) {\n          sequenceChunks.push({ header: chunkLocstring, seq: chunkSeq })\n          if (chunkSeq.length !== chunkEnd - chunkStart + 1) {\n            incompleteSeqErrs.push(\n              `${chunkLocstring} returned ${chunkSeq.length.toLocaleString()} bases, but should have returned ${(\n                chunkEnd - chunkStart\n              ).toLocaleString()}`,\n            )\n          }\n        }\n      })\n      if (incompleteSeqErrs.length > 0) {\n        session.notify(\n          `Unable to retrieve complete reference sequence from regions:${incompleteSeqErrs.join()}`,\n        )\n      }\n      setSequence(formatSeqFasta(sequenceChunks))\n    }\n\n    ;(async () => {\n      try {\n        if (regionsSelected.length > 0) {\n          const chunks = await fetchSequence(model, regionsSelected)\n          if (active) {\n            formatSequence(chunks)\n          }\n        } else {\n          throw new Error('Selected region is out of bounds')\n        }\n      } catch (e) {\n        console.error(e)\n        if (active) {\n          setError(e)\n        }\n      }\n    })()\n\n    return () => {\n      active = false\n    }\n  }, [model, session, regionsSelected, setSequence])\n\n  const sequenceTooLarge = sequence.length > 1_000_000\n\n  return (\n    <Dialog\n      data-testid=\"sequence-dialog\"\n      maxWidth=\"xl\"\n      open\n      onClose={handleClose}\n      aria-labelledby=\"alert-dialog-title\"\n      aria-describedby=\"alert-dialog-description\"\n    >\n      <DialogTitle id=\"alert-dialog-title\">\n        Reference sequence\n        {handleClose ? (\n          <IconButton\n            data-testid=\"close-seqDialog\"\n            className={classes.closeButton}\n            onClick={() => {\n              handleClose()\n              model.setOffsets(undefined, undefined)\n            }}\n          >\n            <CloseIcon />\n          </IconButton>\n        ) : null}\n      </DialogTitle>\n      <Divider />\n\n      <DialogContent>\n        {error ? <Typography color=\"error\">{`${error}`}</Typography> : null}\n        {loading && !error ? (\n          <Container>\n            Retrieving reference sequence...\n            <CircularProgress\n              style={{\n                marginLeft: 10,\n              }}\n              size={20}\n              disableShrink\n            />\n          </Container>\n        ) : null}\n        {sequence !== undefined ? (\n          <TextField\n            data-testid=\"rubberband-sequence\"\n            variant=\"outlined\"\n            multiline\n            rows={3}\n            rowsMax={5}\n            disabled={sequenceTooLarge}\n            className={classes.dialogContent}\n            fullWidth\n            value={\n              sequenceTooLarge\n                ? 'Reference sequence too large to display, use the download FASTA button'\n                : sequence\n            }\n            InputProps={{\n              readOnly: true,\n              classes: {\n                input: classes.textAreaFont,\n              },\n            }}\n          />\n        ) : null}\n      </DialogContent>\n      <DialogActions>\n        <Button\n          onClick={() => {\n            copy(sequence || '')\n            session.notify('Copied to clipboard', 'success')\n          }}\n          disabled={loading || sequenceTooLarge}\n          color=\"primary\"\n          startIcon={<ContentCopyIcon />}\n        >\n          Copy to clipboard\n        </Button>\n        <Button\n          onClick={() => {\n            const seqFastaFile = new Blob([sequence || ''], {\n              type: 'text/x-fasta;charset=utf-8',\n            })\n            saveAs(seqFastaFile, 'jbrowse_ref_seq.fa')\n          }}\n          disabled={loading}\n          color=\"primary\"\n          startIcon={<GetAppIcon />}\n        >\n          Download FASTA\n        </Button>\n        <Button\n          onClick={() => {\n            handleClose()\n            model.setOffsets(undefined, undefined)\n          }}\n          color=\"primary\"\n          autoFocus\n        >\n          Close\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nexport default observer(SequenceDialog)\n","import { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\nimport { makeTicks } from '../util'\n\nfunction mathPower(num: number): string {\n  if (num < 999) {\n    return String(num)\n  }\n  return `${mathPower(~~(num / 1000))},${`00${~~(num % 1000)}`.substr(-3, 3)}`\n}\n\nconst useStyles = makeStyles((/* theme */) => ({\n  majorTickLabel: {\n    fontSize: '11px',\n    // fill: theme.palette.text.primary,\n  },\n  majorTick: {\n    stroke: '#555',\n    // stroke: theme.palette.text.secondary,\n  },\n  minorTick: {\n    stroke: '#999',\n    // stroke: theme.palette.text.hint,\n  },\n}))\n\nfunction Ruler({\n  start,\n  end,\n  bpPerPx,\n  reversed,\n  major,\n  minor,\n}: {\n  start: number\n  end: number\n  bpPerPx: number\n  reversed?: boolean\n  major: boolean\n  minor: boolean\n}) {\n  const classes = useStyles()\n  const ticks = makeTicks(start, end, bpPerPx, major, minor)\n  return (\n    <>\n      {ticks.map(tick => {\n        const x = (reversed ? end - tick.base : tick.base - start) / bpPerPx\n        return (\n          <line\n            key={tick.base}\n            x1={x}\n            x2={x}\n            y1={0}\n            y2={tick.type === 'major' ? 6 : 4}\n            strokeWidth={1}\n            stroke={tick.type === 'major' ? '#555' : '#999'}\n            className={\n              tick.type === 'major' ? classes.majorTick : classes.minorTick\n            }\n            data-bp={tick.base}\n          />\n        )\n      })}\n      {ticks\n        .filter(tick => tick.type === 'major')\n        .map(tick => {\n          const x = (reversed ? end - tick.base : tick.base - start) / bpPerPx\n          return (\n            <text\n              x={x - 3}\n              y={7 + 11}\n              key={`label-${tick.base}`}\n              style={{ fontSize: '11px' }}\n              className={classes.majorTickLabel}\n            >\n              {mathPower(tick.base + 1)}\n            </text>\n          )\n        })}\n    </>\n  )\n}\n\nRuler.propTypes = {\n  start: ReactPropTypes.number.isRequired,\n  end: ReactPropTypes.number.isRequired,\n  bpPerPx: ReactPropTypes.number.isRequired,\n  reversed: ReactPropTypes.bool,\n  major: ReactPropTypes.bool,\n  minor: ReactPropTypes.bool,\n}\n\nRuler.defaultProps = {\n  reversed: false,\n  major: true,\n  minor: true,\n}\n\nexport default observer(Ruler)\n","import React from 'react'\nimport { renderToStaticMarkup } from 'react-dom/server'\n\n// material ui things\nimport { Button, Paper, Typography, makeStyles } from '@material-ui/core'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\n\n// misc\nimport { when } from 'mobx'\nimport { observer } from 'mobx-react'\nimport { getParent, Instance } from 'mobx-state-tree'\nimport { getConf, readConfObject } from '@jbrowse/core/configuration'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\n// locals\nimport { LinearGenomeViewStateModel, ExportSvgOptions } from '..'\nimport Header from './Header'\nimport TrackContainer from './TrackContainer'\nimport TracksContainer from './TracksContainer'\nimport ImportForm from './ImportForm'\nimport MiniControls from './MiniControls'\nimport SequenceDialog from './SequenceDialog'\nimport SearchResultsDialog from './SearchResultsDialog'\nimport Ruler from './Ruler'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(theme => ({\n  errorMessage: {\n    textAlign: 'center',\n    paddingTop: theme.spacing(1),\n    paddingBottom: theme.spacing(1),\n  },\n  spacer: {\n    marginRight: theme.spacing(2),\n  },\n}))\n\nconst LinearGenomeView = observer(({ model }: { model: LGV }) => {\n  const { tracks, error, hideHeader, initialized, hasDisplayedRegions } = model\n  const classes = useStyles()\n\n  if (!initialized) {\n    return null\n  }\n  if (!hasDisplayedRegions) {\n    return <ImportForm model={model} />\n  }\n  return (\n    <div style={{ position: 'relative' }}>\n      {model.isSeqDialogDisplayed ? (\n        <SequenceDialog\n          model={model}\n          handleClose={() => {\n            model.setOffsets(undefined, undefined)\n          }}\n        />\n      ) : null}\n      {model.isSearchDialogDisplayed ? (\n        <SearchResultsDialog\n          model={model}\n          handleClose={() => {\n            model.setSearchResults(undefined, undefined)\n          }}\n        />\n      ) : null}\n      {!hideHeader ? (\n        <Header model={model} />\n      ) : (\n        <div\n          style={{\n            position: 'absolute',\n            right: 0,\n            zIndex: 1001,\n          }}\n        >\n          <MiniControls model={model} />\n        </div>\n      )}\n      {error ? (\n        <Paper variant=\"outlined\" className={classes.errorMessage}>\n          <Typography color=\"error\">{error.message}</Typography>\n        </Paper>\n      ) : (\n        <>\n          <TracksContainer model={model}>\n            {!tracks.length ? (\n              <Paper variant=\"outlined\" className={classes.errorMessage}>\n                <Typography>No tracks active.</Typography>\n                <Button\n                  variant=\"contained\"\n                  color=\"primary\"\n                  onClick={model.activateTrackSelector}\n                  style={{ zIndex: 1000 }}\n                >\n                  <TrackSelectorIcon className={classes.spacer} />\n                  Open track selector\n                </Button>\n              </Paper>\n            ) : (\n              tracks.map(track => (\n                <TrackContainer key={track.id} model={model} track={track} />\n              ))\n            )}\n          </TracksContainer>\n        </>\n      )}\n    </div>\n  )\n})\n\nexport default LinearGenomeView\n\nfunction ScaleBar({ model, fontSize }: { model: LGV; fontSize: number }) {\n  const {\n    offsetPx,\n    dynamicBlocks: { totalWidthPxWithoutBorders: totalWidthPx, totalBp },\n  } = model\n  let displayBp\n  if (Math.floor(totalBp / 1000000) > 0) {\n    displayBp = `${parseFloat((totalBp / 1000000).toPrecision(3))}Mbp`\n  } else if (Math.floor(totalBp / 1000) > 0) {\n    displayBp = `${parseFloat((totalBp / 1000).toPrecision(3))}Kbp`\n  } else {\n    displayBp = `${Math.floor(totalBp)}bp`\n  }\n  const x0 = Math.max(-offsetPx, 0)\n  const x1 = x0 + totalWidthPx\n  return (\n    <>\n      <line x1={x0} x2={x1} y1={10} y2={10} stroke=\"black\" />\n      <line x1={x0} x2={x0} y1={5} y2={15} stroke=\"black\" />\n      <line x1={x1} x2={x1} y1={5} y2={15} stroke=\"black\" />\n      <text\n        x={x0 + (x1 - x0) / 2}\n        y={fontSize * 2}\n        textAnchor=\"middle\"\n        fontSize={fontSize}\n      >\n        {displayBp}\n      </text>\n    </>\n  )\n}\n\nfunction SVGRuler({\n  model,\n  fontSize,\n  width,\n}: {\n  model: LGV\n  fontSize: number\n  width: number\n}) {\n  const {\n    dynamicBlocks: { contentBlocks },\n    offsetPx: viewOffsetPx,\n    bpPerPx,\n  } = model\n  const renderRuler = contentBlocks.length < 5\n  return (\n    <>\n      <defs>\n        <clipPath id=\"clip-ruler\">\n          <rect x={0} y={0} width={width} height={20} />\n        </clipPath>\n      </defs>\n      {contentBlocks.map(block => {\n        const offsetLeft = block.offsetPx - viewOffsetPx\n        return (\n          <g key={`${block.key}`} transform={`translate(${offsetLeft} 0)`}>\n            <text x={offsetLeft / bpPerPx} y={fontSize} fontSize={fontSize}>\n              {block.refName}\n            </text>\n            {renderRuler ? (\n              <g transform=\"translate(0 20)\" clipPath=\"url(#clip-ruler)\">\n                <Ruler\n                  start={block.start}\n                  end={block.end}\n                  bpPerPx={bpPerPx}\n                  reversed={block.reversed}\n                />\n              </g>\n            ) : (\n              <line\n                strokeWidth={1}\n                stroke=\"black\"\n                x1={block.start / bpPerPx}\n                x2={block.end / bpPerPx}\n                y1={20}\n                y2={20}\n              />\n            )}\n          </g>\n        )\n      })}\n    </>\n  )\n}\n\nconst fontSize = 15\nconst rulerHeight = 50\nconst textHeight = fontSize + 5\nconst paddingHeight = 20\nconst headerHeight = textHeight + 20\n\nconst totalHeight = (tracks: { displays: { height: number }[] }[]) => {\n  return tracks.reduce((accum, track) => {\n    const display = track.displays[0]\n    return accum + display.height + paddingHeight + textHeight\n  }, 0)\n}\n\n// SVG component, ruler and assembly name\nconst SVGHeader = ({ model }: { model: LGV }) => {\n  const { width, assemblyNames } = model\n  const assemblyName = assemblyNames.length > 1 ? '' : assemblyNames[0]\n  return (\n    <g id=\"header\">\n      <text x={0} y={fontSize} fontSize={fontSize}>\n        {assemblyName}\n      </text>\n      <g transform={`translate(0 ${fontSize})`}>\n        <ScaleBar model={model} fontSize={fontSize} />\n      </g>\n      <g transform={`translate(0 ${rulerHeight})`}>\n        <SVGRuler model={model} fontSize={fontSize} width={width} />\n      </g>\n    </g>\n  )\n}\n\n// SVG component, region separator\nconst SVGRegionSeparators = ({ model }: { model: LGV }) => {\n  const { dynamicBlocks, tracks } = model\n  const initialOffset = headerHeight + rulerHeight + 20\n  const height = totalHeight(tracks)\n\n  return (\n    <>\n      {dynamicBlocks.contentBlocks.slice(1).map(block => (\n        <line\n          key={block.key}\n          x1={block.offsetPx - model.offsetPx}\n          x2={block.offsetPx - model.offsetPx}\n          y1={initialOffset}\n          y2={height}\n          stroke=\"black\"\n          strokeOpacity={0.3}\n        />\n      ))}\n    </>\n  )\n}\n\n// SVG component, tracks\nfunction SVGTracks({\n  displayResults,\n  model,\n  offset,\n}: {\n  displayResults: {\n    track: {\n      configuration: AnyConfigurationModel\n      displays: { height: number }[]\n    }\n    result: string\n  }[]\n  model: LGV\n  offset: number\n}) {\n  return (\n    <>\n      {displayResults.map(({ track, result }) => {\n        const current = offset\n        const trackName =\n          getConf(track, 'name') ||\n          `Reference sequence (${readConfObject(\n            getParent(track.configuration),\n            'name',\n          )})`\n        const display = track.displays[0]\n        offset += display.height + paddingHeight + textHeight\n        return (\n          <g\n            key={track.configuration.trackId}\n            transform={`translate(0 ${current})`}\n          >\n            <text fontSize={fontSize} x={Math.max(-model.offsetPx, 0)}>\n              {trackName}\n            </text>\n            <g transform={`translate(0 ${textHeight})`}>{result}</g>\n          </g>\n        )\n      })}\n    </>\n  )\n}\n\n// render LGV to SVG\nexport async function renderToSvg(model: LGV, opts: ExportSvgOptions) {\n  await when(() => model.initialized)\n  const { width, tracks } = model\n  const shift = 50\n  const offset = headerHeight + rulerHeight + 20\n  const height = totalHeight(tracks) + offset\n  const displayResults = await Promise.all(\n    tracks.map(async track => {\n      const display = track.displays[0]\n      await when(() => (display.ready !== undefined ? display.ready : true))\n      const result = await display.renderSvg(opts)\n      return { track, result }\n    }),\n  )\n\n  // the xlink namespace is used for rendering <image> tag\n  return renderToStaticMarkup(\n    <svg\n      width={width}\n      height={height}\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n      viewBox={[0, 0, width + shift * 2, height].toString()}\n    >\n      {/* background white */}\n      <rect width={width + shift * 2} height={height} fill=\"white\" />\n\n      <g stroke=\"none\" transform={`translate(${shift} ${fontSize})`}>\n        <SVGHeader model={model} />\n        <SVGTracks\n          model={model}\n          displayResults={displayResults}\n          offset={offset}\n        />\n        <SVGRegionSeparators model={model} />\n      </g>\n    </svg>,\n  )\n}\n","import React, { useState } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport {\n  Button,\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n  Checkbox,\n  FormControlLabel,\n  CircularProgress,\n  Typography,\n} from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\nimport { LinearGenomeViewModel as LGV } from '..'\n\nconst useStyles = makeStyles(theme => ({\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nexport default function ExportSvgDlg({\n  model,\n  handleClose,\n}: {\n  model: LGV\n  handleClose: () => void\n}) {\n  const [rasterizeLayers, setRasterizeLayers] = useState(\n    typeof OffscreenCanvas !== 'undefined',\n  )\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<Error>()\n  const classes = useStyles()\n  return (\n    <Dialog open onClose={handleClose}>\n      <DialogTitle>\n        Export SVG\n        <IconButton className={classes.closeButton} onClick={handleClose}>\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        {error ? (\n          <div style={{ color: 'red' }}>{`${error}`}</div>\n        ) : loading ? (\n          <div>\n            <CircularProgress size={20} style={{ marginRight: 20 }} />\n            <Typography display=\"inline\">Creating SVG</Typography>\n          </div>\n        ) : null}\n\n        {typeof OffscreenCanvas !== 'undefined' ? (\n          <FormControlLabel\n            control={\n              <Checkbox\n                checked={rasterizeLayers}\n                onChange={() => setRasterizeLayers(val => !val)}\n              />\n            }\n            label=\"Rasterize canvas based tracks? File may be much larger if this is turned off\"\n          />\n        ) : (\n          <Typography>\n            Note: rasterizing layers not yet supported in this browser, so SVG\n            size may be large\n          </Typography>\n        )}\n\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          type=\"submit\"\n          onClick={async () => {\n            setLoading(true)\n            setError(undefined)\n            try {\n              await model.exportSvg({ rasterizeLayers })\n              handleClose()\n            } catch (e) {\n              setError(e)\n            } finally {\n              setLoading(false)\n            }\n          }}\n        >\n          Submit\n        </Button>\n      </DialogContent>\n    </Dialog>\n  )\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  Divider,\n  IconButton,\n  Typography,\n} from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\n\nconst useStyles = makeStyles(theme => ({\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nfunction ReturnToImportFormDialog({\n  model,\n  handleClose,\n}: {\n  model: { clearView: Function }\n  handleClose: () => void\n}) {\n  const classes = useStyles()\n  return (\n    <Dialog maxWidth=\"xl\" open onClose={handleClose}>\n      <DialogTitle>\n        Reference sequence\n        {handleClose ? (\n          <IconButton\n            className={classes.closeButton}\n            onClick={() => {\n              handleClose()\n            }}\n          >\n            <CloseIcon />\n          </IconButton>\n        ) : null}\n      </DialogTitle>\n      <Divider />\n\n      <DialogContent>\n        <Typography>\n          Are you sure you want to return to the import form? This will lose\n          your current view\n        </Typography>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          onClick={() => {\n            model.clearView()\n            handleClose()\n          }}\n          variant=\"contained\"\n          color=\"primary\"\n          autoFocus\n        >\n          OK\n        </Button>\n        <Button\n          onClick={() => {\n            handleClose()\n          }}\n          color=\"secondary\"\n          variant=\"contained\"\n          autoFocus\n        >\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nexport default observer(ReturnToImportFormDialog)\n","import { getConf } from '@jbrowse/core/configuration'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { Region } from '@jbrowse/core/util/types'\nimport { ElementId, Region as MUIRegion } from '@jbrowse/core/util/types/mst'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport {\n  assembleLocString,\n  clamp,\n  findLastIndex,\n  getContainingView,\n  getSession,\n  isViewContainer,\n  parseLocString,\n  springAnimate,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport { BlockSet, BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport calculateDynamicBlocks from '@jbrowse/core/util/calculateDynamicBlocks'\nimport calculateStaticBlocks from '@jbrowse/core/util/calculateStaticBlocks'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\n// misc\nimport { transaction, autorun } from 'mobx'\nimport {\n  getSnapshot,\n  types,\n  cast,\n  Instance,\n  getRoot,\n  resolveIdentifier,\n  addDisposer,\n} from 'mobx-state-tree'\n\nimport Base1DView from '@jbrowse/core/util/Base1DViewModel'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport SyncAltIcon from '@material-ui/icons/SyncAlt'\nimport VisibilityIcon from '@material-ui/icons/Visibility'\nimport LabelIcon from '@material-ui/icons/Label'\nimport FolderOpenIcon from '@material-ui/icons/FolderOpen'\nimport clone from 'clone'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { saveAs } from 'file-saver'\nimport { renderToSvg } from './components/LinearGenomeView'\nimport ExportSvgDlg from './components/ExportSvgDialog'\nimport ReturnToImportFormDlg from './components/ReturnToImportFormDialog'\n\nexport { default as ReactComponent } from './components/LinearGenomeView'\n\nexport interface BpOffset {\n  refName?: string\n  index: number\n  offset: number\n  start?: number\n  end?: number\n  coord?: number\n  reversed?: boolean\n  assemblyName?: string\n  oob?: boolean\n}\n\nexport interface ExportSvgOptions {\n  rasterizeLayers?: boolean\n}\n\nfunction calculateVisibleLocStrings(contentBlocks: BaseBlock[]) {\n  if (!contentBlocks.length) {\n    return ''\n  }\n  const isSingleAssemblyName = contentBlocks.every(\n    block => block.assemblyName === contentBlocks[0].assemblyName,\n  )\n  const locs = contentBlocks.map(block =>\n    assembleLocString({\n      ...block,\n      start: Math.round(block.start),\n      end: Math.round(block.end),\n      assemblyName: isSingleAssemblyName ? undefined : block.assemblyName,\n    }),\n  )\n  return locs.join(';')\n}\n\nexport interface NavLocation {\n  refName: string\n  start?: number\n  end?: number\n  assemblyName?: string\n}\n\nexport const HEADER_BAR_HEIGHT = 48\nexport const HEADER_OVERVIEW_HEIGHT = 20\nexport const SCALE_BAR_HEIGHT = 17\nexport const RESIZE_HANDLE_HEIGHT = 3\nexport const INTER_REGION_PADDING_WIDTH = 2\n\nexport function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .compose(\n      BaseViewModel,\n      types.model('LinearGenomeView', {\n        id: ElementId,\n        type: types.literal('LinearGenomeView'),\n        offsetPx: 0,\n        bpPerPx: 1,\n        displayedRegions: types.array(MUIRegion),\n\n        // we use an array for the tracks because the tracks are displayed in a\n        // specific order that we need to keep.\n        tracks: types.array(\n          pluginManager.pluggableMstType('track', 'stateModel'),\n        ),\n        hideHeader: false,\n        hideHeaderOverview: false,\n        trackSelectorType: types.optional(\n          types.enumeration(['hierarchical']),\n          'hierarchical',\n        ),\n        trackLabels: 'overlapping' as 'overlapping' | 'hidden' | 'offset',\n        showCenterLine: false,\n      }),\n    )\n    .volatile(() => ({\n      volatileWidth: undefined as number | undefined,\n      minimumBlockWidth: 3,\n      draggingTrackId: undefined as undefined | string,\n      error: undefined as undefined | Error,\n\n      // array of callbacks to run after the next set of the displayedRegions,\n      // which is basically like an onLoad\n      afterDisplayedRegionsSetCallbacks: [] as Function[],\n      scaleFactor: 1,\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      trackRefs: {} as { [key: string]: any },\n      coarseDynamicBlocks: [] as BaseBlock[],\n      coarseTotalBp: 0,\n      leftOffset: undefined as undefined | BpOffset,\n      rightOffset: undefined as undefined | BpOffset,\n      searchResults: undefined as undefined | BaseResult[],\n      searchQuery: undefined as undefined | string,\n    }))\n    .views(self => ({\n      get width(): number {\n        if (self.volatileWidth === undefined) {\n          throw new Error(\n            'width undefined, make sure to check for model.initialized',\n          )\n        }\n        return self.volatileWidth\n      },\n    }))\n    .views(self => ({\n      get initialized() {\n        const { assemblyManager } = getSession(self)\n\n        // if the assemblyManager is tracking a given assembly name, wait for\n        // it to be loaded. this is done by looking in the assemblyManager's\n        // assembly list, and then waiting on it's initialized state which is\n        // updated later\n        const assembliesInitialized = this.assemblyNames.every(assemblyName => {\n          if (\n            assemblyManager.assemblyList\n              ?.map(asm => asm.name)\n              .includes(assemblyName)\n          ) {\n            return (assemblyManager.get(assemblyName) || {}).initialized\n          }\n          return true\n        })\n\n        return self.volatileWidth !== undefined && assembliesInitialized\n      },\n      get hasDisplayedRegions() {\n        return self.displayedRegions.length > 0\n      },\n      get isSeqDialogDisplayed() {\n        return self.leftOffset && self.rightOffset\n      },\n      get isSearchDialogDisplayed() {\n        return self.searchResults !== undefined\n      },\n      get scaleBarHeight() {\n        return SCALE_BAR_HEIGHT + RESIZE_HANDLE_HEIGHT\n      },\n      get headerHeight() {\n        if (self.hideHeader) {\n          return 0\n        }\n        if (self.hideHeaderOverview) {\n          return HEADER_BAR_HEIGHT\n        }\n        return HEADER_BAR_HEIGHT + HEADER_OVERVIEW_HEIGHT\n      },\n      get trackHeights() {\n        return self.tracks\n          .map(t => t.displays[0].height)\n          .reduce((a, b) => a + b, 0)\n      },\n\n      get trackHeightsWithResizeHandles() {\n        return this.trackHeights + self.tracks.length * RESIZE_HANDLE_HEIGHT\n      },\n      get height() {\n        return (\n          this.trackHeightsWithResizeHandles +\n          this.headerHeight +\n          this.scaleBarHeight\n        )\n      },\n      get interRegionPaddingWidth() {\n        return INTER_REGION_PADDING_WIDTH\n      },\n      get totalBp() {\n        let totalbp = 0\n        self.displayedRegions.forEach(region => {\n          totalbp += region.end - region.start\n        })\n        return totalbp\n      },\n\n      get maxBpPerPx() {\n        return this.totalBp / (self.width * 0.9)\n      },\n\n      get minBpPerPx() {\n        return 1 / 50\n      },\n\n      get maxOffset() {\n        // objectively determined to keep the linear genome on the main screen\n        const leftPadding = 10\n        return this.displayedRegionsTotalPx - leftPadding\n      },\n\n      get minOffset() {\n        // objectively determined to keep the linear genome on the main screen\n        const rightPadding = 30\n        return -self.width + rightPadding\n      },\n\n      get displayedRegionsTotalPx() {\n        return this.totalBp / self.bpPerPx\n      },\n\n      get renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          bpPerPx: self.bpPerPx,\n          highResolutionScaling: getConf(\n            getSession(self),\n            'highResolutionScaling',\n          ),\n        }\n      },\n      get assemblyNames() {\n        return [\n          ...new Set(self.displayedRegions.map(region => region.assemblyName)),\n        ]\n      },\n      searchScope(assemblyName: string) {\n        return {\n          assemblyName,\n          includeAggregateIndexes: true,\n          tracks: self.tracks,\n        }\n      },\n\n      /**\n       * @param refName - refName of the displayedRegion\n       * @param coord - coordinate at the displayed Region\n       * @param regionNumber - optional param used as identifier when\n       * there are multiple displayedRegions with the same refName\n       * @returns offsetPx of the displayed region that it lands in\n       */\n      bpToPx({\n        refName,\n        coord,\n        regionNumber,\n      }: {\n        refName: string\n        coord: number\n        regionNumber?: number\n      }) {\n        let offsetBp = 0\n\n        const interRegionPaddingBp = this.interRegionPaddingWidth * self.bpPerPx\n        const minimumBlockBp = self.minimumBlockWidth * self.bpPerPx\n        const index = self.displayedRegions.findIndex((region, idx) => {\n          const len = region.end - region.start\n          if (\n            refName === region.refName &&\n            coord >= region.start &&\n            coord <= region.end\n          ) {\n            if (regionNumber ? regionNumber === idx : true) {\n              offsetBp += region.reversed\n                ? region.end - coord\n                : coord - region.start\n              return true\n            }\n          }\n\n          // add the interRegionPaddingWidth if the boundary is in the screen\n          // e.g. offset>=0 && offset<width\n          if (\n            len > minimumBlockBp &&\n            offsetBp / self.bpPerPx >= 0 &&\n            offsetBp / self.bpPerPx < self.width\n          ) {\n            offsetBp += len + interRegionPaddingBp\n          } else {\n            offsetBp += len\n          }\n          return false\n        })\n        const foundRegion = self.displayedRegions[index]\n        if (foundRegion) {\n          return {\n            index,\n            offsetPx: Math.round(offsetBp / self.bpPerPx),\n          }\n        }\n\n        return undefined\n      },\n      /**\n       *\n       * @param px - px in the view area, return value is the displayed regions\n       * @returns BpOffset of the displayed region that it lands in\n       */\n      pxToBp(px: number) {\n        let bpSoFar = 0\n        const bp = (self.offsetPx + px) * self.bpPerPx\n        const n = self.displayedRegions.length\n        if (bp < 0) {\n          const region = self.displayedRegions[0]\n          const offset = bp\n          return {\n            ...getSnapshot(region),\n            oob: true,\n            coord: region.reversed\n              ? Math.floor(region.end - offset) + 1\n              : Math.floor(region.start + offset) + 1,\n            offset,\n            index: 0,\n          }\n        }\n\n        const interRegionPaddingBp = this.interRegionPaddingWidth * self.bpPerPx\n        const minimumBlockBp = self.minimumBlockWidth * self.bpPerPx\n\n        for (let index = 0; index < self.displayedRegions.length; index += 1) {\n          const region = self.displayedRegions[index]\n          const len = region.end - region.start\n          const offset = bp - bpSoFar\n          if (len + bpSoFar > bp && bpSoFar <= bp) {\n            return {\n              ...getSnapshot(region),\n              oob: false,\n              offset,\n              coord: region.reversed\n                ? Math.floor(region.end - offset) + 1\n                : Math.floor(region.start + offset) + 1,\n              index,\n            }\n          }\n\n          // add the interRegionPaddingWidth if the boundary is in the screen\n          // e.g. offset>0 && offset<width\n          if (\n            region.end - region.start > minimumBlockBp &&\n            offset / self.bpPerPx > 0 &&\n            offset / self.bpPerPx < self.width\n          ) {\n            bpSoFar += len + interRegionPaddingBp\n          } else {\n            bpSoFar += len\n          }\n        }\n\n        if (bp >= bpSoFar) {\n          const region = self.displayedRegions[n - 1]\n          const len = region.end - region.start\n          const offset = bp - bpSoFar + len\n          return {\n            ...getSnapshot(region),\n            oob: true,\n            offset,\n            coord: region.reversed\n              ? Math.floor(region.end - offset) + 1\n              : Math.floor(region.start + offset) + 1,\n            index: n - 1,\n          }\n        }\n        return {\n          coord: 0,\n          index: 0,\n          refName: '',\n          oob: true,\n          assemblyName: '',\n          offset: 0,\n          start: 0,\n          end: 0,\n          reversed: false,\n        }\n      },\n\n      getTrack(id: string) {\n        return self.tracks.find(t => t.configuration.trackId === id)\n      },\n\n      rankSearchResults(results: BaseResult[]) {\n        // order of rank\n        const openTrackIds = self.tracks.map(\n          track => track.configuration.trackId,\n        )\n        results.forEach(result => {\n          if (openTrackIds !== []) {\n            if (openTrackIds.includes(result.trackId)) {\n              result.updateScore(result.getScore() + 1)\n            }\n          }\n        })\n        return results\n      },\n\n      // modifies view menu action onClick to apply to all tracks of same type\n      rewriteOnClicks(trackType: string, viewMenuActions: MenuItem[]) {\n        viewMenuActions.forEach((action: MenuItem) => {\n          // go to lowest level menu\n          if ('subMenu' in action) {\n            this.rewriteOnClicks(trackType, action.subMenu)\n          }\n          if ('onClick' in action) {\n            const holdOnClick = action.onClick\n            action.onClick = (...args: unknown[]) => {\n              self.tracks.forEach(track => {\n                if (track.type === trackType) {\n                  holdOnClick.apply(track, [track, ...args])\n                }\n              })\n            }\n          }\n        })\n      },\n\n      get trackTypeActions() {\n        const allActions: Map<string, MenuItem[]> = new Map()\n        self.tracks.forEach(track => {\n          const trackInMap = allActions.get(track.type)\n          if (!trackInMap) {\n            const viewMenuActions = clone(track.viewMenuActions)\n            this.rewriteOnClicks(track.type, viewMenuActions)\n            allActions.set(track.type, viewMenuActions)\n          }\n        })\n\n        return allActions\n      },\n\n      get centerLineInfo() {\n        return self.displayedRegions.length\n          ? this.pxToBp(self.width / 2)\n          : undefined\n      },\n    }))\n    .actions(self => ({\n      setWidth(newWidth: number) {\n        self.volatileWidth = newWidth\n      },\n      setError(error: Error | undefined) {\n        self.error = error\n      },\n\n      toggleHeader() {\n        self.hideHeader = !self.hideHeader\n      },\n\n      toggleHeaderOverview() {\n        self.hideHeaderOverview = !self.hideHeaderOverview\n      },\n\n      scrollTo(offsetPx: number) {\n        const newOffsetPx = clamp(offsetPx, self.minOffset, self.maxOffset)\n        self.offsetPx = newOffsetPx\n        return newOffsetPx\n      },\n\n      zoomTo(bpPerPx: number) {\n        const newBpPerPx = clamp(bpPerPx, self.minBpPerPx, self.maxBpPerPx)\n        if (newBpPerPx === self.bpPerPx) {\n          return newBpPerPx\n        }\n        const oldBpPerPx = self.bpPerPx\n        self.bpPerPx = newBpPerPx\n\n        if (Math.abs(oldBpPerPx - newBpPerPx) < 0.000001) {\n          console.warn('zoomTo bpPerPx rounding error')\n          return oldBpPerPx\n        }\n\n        // tweak the offset so that the center of the view remains at the same coordinate\n        const viewWidth = self.width\n        this.scrollTo(\n          Math.round(\n            ((self.offsetPx + viewWidth / 2) * oldBpPerPx) / newBpPerPx -\n              viewWidth / 2,\n          ),\n        )\n        return newBpPerPx\n      },\n\n      setOffsets(left: undefined | BpOffset, right: undefined | BpOffset) {\n        // sets offsets used in the get sequence dialog\n        self.leftOffset = left\n        self.rightOffset = right\n      },\n\n      setSearchResults(\n        results: BaseResult[] | undefined,\n        query: string | undefined,\n      ) {\n        self.searchResults = results\n        self.searchQuery = query\n      },\n\n      setNewView(bpPerPx: number, offsetPx: number) {\n        this.zoomTo(bpPerPx)\n        this.scrollTo(offsetPx)\n      },\n\n      horizontallyFlip() {\n        self.displayedRegions = cast(\n          self.displayedRegions\n            .slice()\n            .reverse()\n            .map(region => ({ ...region, reversed: !region.reversed })),\n        )\n        this.scrollTo(self.totalBp / self.bpPerPx - self.offsetPx - self.width)\n      },\n\n      showTrack(\n        trackId: string,\n        initialSnapshot = {},\n        displayInitialSnapshot = {},\n      ) {\n        const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'track',\n        )\n        const configuration = resolveIdentifier(\n          trackConfigSchema,\n          getRoot(self),\n          trackId,\n        )\n        const trackType = pluginManager.getTrackType(configuration.type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${configuration.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)\n        const supportedDisplays = viewType.displayTypes.map(\n          displayType => displayType.name,\n        )\n        const displayConf = configuration.displays.find(\n          (d: AnyConfigurationModel) => supportedDisplays.includes(d.type),\n        )\n        if (!displayConf) {\n          throw new Error(\n            `could not find a compatible display for view type ${self.type}`,\n          )\n        }\n        const track = trackType.stateModel.create({\n          ...initialSnapshot,\n          type: configuration.type,\n          configuration,\n          displays: [\n            {\n              type: displayConf.type,\n              configuration: displayConf,\n              ...displayInitialSnapshot,\n            },\n          ],\n        })\n        self.tracks.push(track)\n        return track\n      },\n\n      hideTrack(trackId: string) {\n        const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'track',\n        )\n        const configuration = resolveIdentifier(\n          trackConfigSchema,\n          getRoot(self),\n          trackId,\n        )\n        // if we have any tracks with that configuration, turn them off\n        const shownTracks = self.tracks.filter(\n          t => t.configuration === configuration,\n        )\n        transaction(() => shownTracks.forEach(t => self.tracks.remove(t)))\n        return shownTracks.length\n      },\n    }))\n    .actions(self => ({\n      moveTrack(movingTrackId: string, targetTrackId: string) {\n        const oldIndex = self.tracks.findIndex(\n          track => track.id === movingTrackId,\n        )\n        if (oldIndex === -1) {\n          throw new Error(`Track ID ${movingTrackId} not found`)\n        }\n        const newIndex = self.tracks.findIndex(\n          track => track.id === targetTrackId,\n        )\n        if (newIndex === -1) {\n          throw new Error(`Track ID ${targetTrackId} not found`)\n        }\n        const track = getSnapshot(self.tracks[oldIndex])\n        self.tracks.splice(oldIndex, 1)\n        self.tracks.splice(newIndex, 0, track)\n      },\n\n      closeView() {\n        const parent = getContainingView(self)\n        if (parent) {\n          // I am embedded in a some other view\n          if (isViewContainer(parent)) {\n            parent.removeView(self)\n          }\n        } else {\n          // I am part of a session\n          getSession(self).removeView(self)\n        }\n      },\n\n      toggleTrack(trackId: string) {\n        // if we have any tracks with that configuration, turn them off\n        const hiddenCount = self.hideTrack(trackId)\n        // if none had that configuration, turn one on\n        if (!hiddenCount) {\n          self.showTrack(trackId)\n        }\n      },\n\n      setTrackLabels(setting: 'overlapping' | 'offset' | 'hidden') {\n        self.trackLabels = setting\n      },\n\n      toggleCenterLine() {\n        self.showCenterLine = !self.showCenterLine\n      },\n\n      setDisplayedRegions(regions: Region[]) {\n        self.displayedRegions = cast(regions)\n        self.zoomTo(self.bpPerPx)\n      },\n\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n      navToLocString(locString: string, optAssemblyName?: string) {\n        const { assemblyManager } = getSession(self)\n        const { isValidRefName } = assemblyManager\n        const locStrings = locString.split(';')\n        if (self.displayedRegions.length > 1) {\n          const locations = locStrings.map(ls =>\n            parseLocString(ls, isValidRefName),\n          )\n          this.navToMultiple(locations)\n          return\n        }\n        let assemblyName = optAssemblyName\n        let defaultRefName = ''\n        if (self.displayedRegions.length !== 0) {\n          // defaults\n          assemblyName = self.displayedRegions[0].assemblyName\n          defaultRefName = self.displayedRegions[0].refName\n        }\n        let assembly = assemblyName && assemblyManager.get(assemblyName)\n        if (!assembly) {\n          throw new Error(`Could not find assembly ${assemblyName}`)\n        }\n        let { regions } = assembly\n        if (!regions) {\n          throw new Error(`Regions for assembly ${assemblyName} not yet loaded`)\n        }\n        if (locStrings.length > 1) {\n          throw new Error(\n            'Navigating to multiple locations is not allowed when viewing a whole chromosome',\n          )\n        }\n        const parsedLocString = parseLocString(locStrings[0], refName =>\n          isValidRefName(refName, assemblyName),\n        )\n        let changedAssembly = false\n        if (\n          parsedLocString.assemblyName &&\n          parsedLocString.assemblyName !== assemblyName\n        ) {\n          const newAssembly = assemblyManager.get(parsedLocString.assemblyName)\n          if (!newAssembly) {\n            throw new Error(\n              `Could not find assembly ${parsedLocString.assemblyName}`,\n            )\n          }\n          assembly = newAssembly\n          changedAssembly = true\n          const newRegions = newAssembly.regions\n          if (!newRegions) {\n            throw new Error(\n              `Regions for assembly ${parsedLocString.assemblyName} not yet loaded`,\n            )\n          }\n          regions = newRegions\n        }\n        const canonicalRefName = assembly.getCanonicalRefName(\n          parsedLocString.refName,\n        )\n\n        if (!canonicalRefName) {\n          throw new Error(\n            `Could not find refName ${parsedLocString.refName} in ${assembly.name}`,\n          )\n        }\n        if (changedAssembly || canonicalRefName !== defaultRefName) {\n          const newDisplayedRegion = regions.find(\n            region => region.refName === canonicalRefName,\n          )\n          if (newDisplayedRegion) {\n            this.setDisplayedRegions([newDisplayedRegion])\n          } else {\n            throw new Error(\n              `Could not find refName ${parsedLocString.refName} in ${assembly.name}`,\n            )\n          }\n        }\n        const displayedRegion = regions.find(\n          region => region.refName === canonicalRefName,\n        )\n        if (displayedRegion) {\n          const start = clamp(\n            parsedLocString?.start ?? 0,\n            0,\n            displayedRegion.end,\n          )\n          const end = clamp(\n            parsedLocString?.end ?? displayedRegion.end,\n            0,\n            displayedRegion.end,\n          )\n\n          this.navTo({\n            ...parsedLocString,\n            start,\n            end,\n          })\n        }\n      },\n\n      /**\n       * Navigate to a location based on its refName and optionally start, end,\n       * and assemblyName. Can handle if there are multiple displayedRegions\n       * from same refName. Only navigates to a location if it is entirely\n       * within a displayedRegion. Navigates to the first matching location\n       * encountered.\n       *\n       * Throws an error if navigation was unsuccessful\n       *\n       * @param location - a proposed location to navigate to\n       */\n      navTo(query: NavLocation) {\n        this.navToMultiple([query])\n      },\n\n      navToMultiple(locations: NavLocation[]) {\n        const firstLocation = locations[0]\n        let { refName } = firstLocation\n        const {\n          start,\n          end,\n          assemblyName = self.assemblyNames[0],\n        } = firstLocation\n\n        if (start !== undefined && end !== undefined && start > end) {\n          throw new Error(`start \"${start + 1}\" is greater than end \"${end}\"`)\n        }\n        const session = getSession(self)\n        const { assemblyManager } = session\n        const assembly = assemblyManager.get(assemblyName)\n        if (assembly) {\n          const canonicalRefName = assembly.getCanonicalRefName(refName)\n          if (canonicalRefName) {\n            refName = canonicalRefName\n          }\n        }\n        let s = start\n        let e = end\n        let refNameMatched = false\n        const predicate = (r: Region) => {\n          if (refName === r.refName) {\n            refNameMatched = true\n            if (s === undefined) {\n              s = r.start\n            }\n            if (e === undefined) {\n              e = r.end\n            }\n            if (s >= r.start && s <= r.end && e <= r.end && e >= r.start) {\n              return true\n            }\n            s = start\n            e = end\n          }\n          return false\n        }\n\n        const lastIndex = findLastIndex(self.displayedRegions, predicate)\n        let index\n        while (index !== lastIndex) {\n          try {\n            const previousIndex: number | undefined = index\n            index = self.displayedRegions\n              .slice(previousIndex === undefined ? 0 : previousIndex + 1)\n              .findIndex(predicate)\n            if (previousIndex !== undefined) {\n              index += previousIndex + 1\n            }\n            if (!refNameMatched) {\n              throw new Error(\n                `could not find a region with refName \"${refName}\"`,\n              )\n            }\n            if (s === undefined) {\n              throw new Error(\n                `could not find a region with refName \"${refName}\" that contained an end position ${e}`,\n              )\n            }\n            if (e === undefined) {\n              throw new Error(\n                `could not find a region with refName \"${refName}\" that contained a start position ${\n                  s + 1\n                }`,\n              )\n            }\n            if (index === -1) {\n              throw new Error(\n                `could not find a region that completely contained \"${assembleLocString(\n                  firstLocation,\n                )}\"`,\n              )\n            }\n            if (locations.length === 1) {\n              const f = self.displayedRegions[index]\n              this.moveTo(\n                { index, offset: f.reversed ? f.end - e : s - f.start },\n                { index, offset: f.reversed ? f.end - s : e - f.start },\n              )\n              return\n            }\n            let locationIndex = 0\n            let locationStart = 0\n            let locationEnd = 0\n            for (\n              locationIndex;\n              locationIndex < locations.length;\n              locationIndex++\n            ) {\n              const location = locations[locationIndex]\n              const region = self.displayedRegions[index + locationIndex]\n              locationStart = location.start || region.start\n              locationEnd = location.end || region.end\n              if (location.refName !== region.refName) {\n                throw new Error(\n                  `Entered location ${assembleLocString(\n                    location,\n                  )} does not match with displayed regions`,\n                )\n              }\n              if (locationIndex > 0) {\n                // does it reach the left side?\n                const matchesLeft = region.reversed\n                  ? locationEnd === region.end\n                  : locationStart === region.start\n                if (!matchesLeft) {\n                  throw new Error(\n                    `${\n                      region.reversed ? 'End' : 'Start'\n                    } of region ${assembleLocString(\n                      location,\n                    )} should be ${(region.reversed\n                      ? region.end\n                      : region.start + 1\n                    ).toLocaleString('en-US')}, but it is not`,\n                  )\n                }\n              }\n              const isLast = locationIndex === locations.length - 1\n              if (!isLast) {\n                // does it reach the right side?\n                const matchesRight = region.reversed\n                  ? locationStart === region.start\n                  : locationEnd === region.end\n                if (!matchesRight) {\n                  throw new Error(\n                    `${\n                      region.reversed ? 'Start' : 'End'\n                    } of region ${assembleLocString(\n                      location,\n                    )} should be ${(region.reversed\n                      ? region.start + 1\n                      : region.end\n                    ).toLocaleString('en-US')}, but it is not`,\n                  )\n                }\n              }\n            }\n            locationIndex -= 1\n            const startDisplayedRegion = self.displayedRegions[index]\n            const endDisplayedRegion =\n              self.displayedRegions[index + locationIndex]\n            this.moveTo(\n              {\n                index,\n                offset: startDisplayedRegion.reversed\n                  ? startDisplayedRegion.end - e\n                  : s - startDisplayedRegion.start,\n              },\n              {\n                index: index + locationIndex,\n                offset: endDisplayedRegion.reversed\n                  ? endDisplayedRegion.end - locationStart\n                  : locationEnd - endDisplayedRegion.start,\n              },\n            )\n            return\n          } catch (error) {\n            if (index === lastIndex) {\n              throw error\n            }\n          }\n        }\n      },\n\n      /**\n       * Navigate to a location based on user clicking and dragging on the\n       * overview scale bar to select a region to zoom into.\n       * Can handle if there are multiple displayedRegions from same refName.\n       * Only navigates to a location if it is entirely within a displayedRegion.\n       *\n       * @param leftPx- `object as {start, end, index, offset}`, offset = start of user drag\n       * @param rightPx- `object as {start, end, index, offset}`, offset = end of user drag\n       */\n      zoomToDisplayedRegions(leftPx: BpOffset, rightPx: BpOffset) {\n        if (leftPx === undefined || rightPx === undefined) {\n          return\n        }\n\n        const singleRefSeq =\n          leftPx.refName === rightPx.refName && leftPx.index === rightPx.index\n        // zooming into one displayed Region\n        if (\n          (singleRefSeq && rightPx.offset < leftPx.offset) ||\n          leftPx.index > rightPx.index\n        ) {\n          ;[leftPx, rightPx] = [rightPx, leftPx]\n        }\n        const startOffset = {\n          start: leftPx.start,\n          end: leftPx.end,\n          index: leftPx.index,\n          offset: leftPx.offset,\n        }\n        const endOffset = {\n          start: rightPx.start,\n          end: rightPx.end,\n          index: rightPx.index,\n          offset: rightPx.offset,\n        }\n        if (startOffset && endOffset) {\n          this.moveTo(startOffset, endOffset)\n        } else {\n          const session = getSession(self)\n          session.notify('No regions found to navigate to', 'warning')\n        }\n      },\n      /**\n       * Helper method for the fetchSequence.\n       * Retrieves the corresponding regions that were selected by the rubberband\n       *\n       * @param leftOffset - `object as {start, end, index, offset}`, offset = start of user drag\n       * @param rightOffset - `object as {start, end, index, offset}`, offset = end of user drag\n       * @returns array of Region[]\n       */\n      getSelectedRegions(\n        leftOffset: BpOffset | undefined,\n        rightOffset: BpOffset | undefined,\n      ) {\n        const simView = Base1DView.create({\n          ...getSnapshot(self),\n          interRegionPaddingWidth: self.interRegionPaddingWidth,\n        })\n\n        simView.setVolatileWidth(self.width)\n        simView.zoomToDisplayedRegions(leftOffset, rightOffset)\n\n        return simView.dynamicBlocks.contentBlocks.map(region => {\n          return {\n            ...region,\n            start: Math.floor(region.start),\n            end: Math.ceil(region.end),\n          }\n        })\n      },\n\n      // schedule something to be run after the next time displayedRegions is set\n      afterDisplayedRegionsSet(cb: Function) {\n        self.afterDisplayedRegionsSetCallbacks.push(cb)\n      },\n      /**\n       * offset is the base-pair-offset in the displayed region, index is the index of the\n       * displayed region in the linear genome view\n       *\n       * @param start - object as `{start, end, offset, index}`\n       * @param end - object as `{start, end, offset, index}`\n       */\n      moveTo(start: BpOffset, end: BpOffset) {\n        // find locations in the modellist\n        let bpSoFar = 0\n\n        if (start.index === end.index) {\n          bpSoFar += end.offset - start.offset\n        } else {\n          const s = self.displayedRegions[start.index]\n          bpSoFar += s.end - s.start - start.offset\n          if (end.index - start.index >= 2) {\n            for (let i = start.index + 1; i < end.index; i += 1) {\n              bpSoFar +=\n                self.displayedRegions[i].end - self.displayedRegions[i].start\n            }\n          }\n          bpSoFar += end.offset\n        }\n        const targetBpPerPx =\n          bpSoFar /\n          (self.width -\n            self.interRegionPaddingWidth * (end.index - start.index))\n        const newBpPerPx = self.zoomTo(targetBpPerPx)\n        // If our target bpPerPx was smaller than the allowed minBpPerPx, adjust\n        // the scroll so the requested range is in the middle of the screen\n        let extraBp = 0\n        if (targetBpPerPx < newBpPerPx) {\n          extraBp = ((newBpPerPx - targetBpPerPx) * self.width) / 2\n        }\n\n        let bpToStart = -extraBp\n        for (let i = 0; i < self.displayedRegions.length; i += 1) {\n          const region = self.displayedRegions[i]\n          if (start.index === i) {\n            bpToStart += start.offset\n            break\n          } else {\n            bpToStart += region.end - region.start\n          }\n        }\n        self.scrollTo(\n          Math.round(bpToStart / self.bpPerPx) +\n            self.interRegionPaddingWidth * start.index,\n        )\n      },\n\n      horizontalScroll(distance: number) {\n        const oldOffsetPx = self.offsetPx\n        // newOffsetPx is the actual offset after the scroll is clamped\n        const newOffsetPx = self.scrollTo(self.offsetPx + distance)\n        return newOffsetPx - oldOffsetPx\n      },\n\n      /**\n       * scrolls the view to center on the given bp. if that is not in any\n       * of the displayed regions, does nothing\n       * @param bp - basepair at which you want to center the view\n       * @param refName - refName of the displayedRegion you are centering at\n       * @param regionIndex - index of the displayedRegion\n       */\n      centerAt(bp: number, refName: string, regionIndex: number) {\n        const centerPx = self.bpToPx({\n          refName,\n          coord: bp,\n          regionNumber: regionIndex,\n        })\n        if (centerPx) {\n          self.scrollTo(Math.round(centerPx.offsetPx - self.width / 2))\n        }\n      },\n\n      center() {\n        const centerBp = self.totalBp / 2\n        self.scrollTo(Math.round(centerBp / self.bpPerPx - self.width / 2))\n      },\n\n      showAllRegions() {\n        self.zoomTo(self.maxBpPerPx)\n        this.center()\n      },\n\n      showAllRegionsInAssembly(assemblyName?: string) {\n        const session = getSession(self)\n        const { assemblyManager } = session\n        if (!assemblyName) {\n          const assemblyNames = [\n            ...new Set(\n              self.displayedRegions.map(region => region.assemblyName),\n            ),\n          ]\n          if (assemblyNames.length > 1) {\n            session.notify(\n              `Can't perform this with multiple assemblies currently`,\n            )\n            return\n          }\n\n          ;[assemblyName] = assemblyNames\n        }\n        const assembly = assemblyManager.get(assemblyName)\n        if (assembly) {\n          const { regions } = assembly\n          if (regions) {\n            this.setDisplayedRegions(regions)\n            self.zoomTo(self.maxBpPerPx)\n            this.center()\n          }\n        }\n      },\n\n      setDraggingTrackId(idx?: string) {\n        self.draggingTrackId = idx\n      },\n\n      setScaleFactor(factor: number) {\n        self.scaleFactor = factor\n      },\n    }))\n    .actions(self => {\n      let cancelLastAnimation = () => {}\n\n      function slide(viewWidths: number) {\n        const [animate, cancelAnimation] = springAnimate(\n          self.offsetPx,\n          self.offsetPx + self.width * viewWidths,\n          self.scrollTo,\n        )\n        cancelLastAnimation()\n        cancelLastAnimation = cancelAnimation\n        animate()\n      }\n\n      return { slide }\n    })\n    .actions(self => {\n      let cancelLastAnimation = () => {}\n\n      function zoom(targetBpPerPx: number) {\n        self.zoomTo(self.bpPerPx)\n        if (\n          // already zoomed all the way in\n          (targetBpPerPx < self.bpPerPx && self.bpPerPx === self.minBpPerPx) ||\n          // already zoomed all the way out\n          (targetBpPerPx > self.bpPerPx && self.bpPerPx === self.maxBpPerPx)\n        ) {\n          return\n        }\n        const factor = self.bpPerPx / targetBpPerPx\n        const [animate, cancelAnimation] = springAnimate(\n          1,\n          factor,\n          self.setScaleFactor,\n          () => {\n            self.zoomTo(targetBpPerPx)\n            self.setScaleFactor(1)\n          },\n        )\n        cancelLastAnimation()\n        cancelLastAnimation = cancelAnimation\n        animate()\n      }\n\n      return { zoom }\n    })\n    .views(self => {\n      let currentlyCalculatedStaticBlocks: BlockSet | undefined\n      let stringifiedCurrentlyCalculatedStaticBlocks = ''\n      return {\n        get menuItems(): MenuItem[] {\n          const menuItems: MenuItem[] = [\n            {\n              label: 'Return to import form',\n              onClick: () => {\n                getSession(self).setDialogComponent(ReturnToImportFormDlg, {\n                  model: self,\n                })\n              },\n              icon: FolderOpenIcon,\n            },\n            {\n              label: 'Export SVG',\n              onClick: () => {\n                getSession(self).setDialogComponent(ExportSvgDlg, {\n                  model: self,\n                })\n              },\n            },\n            {\n              label: 'Open track selector',\n              onClick: self.activateTrackSelector,\n              icon: TrackSelectorIcon,\n            },\n            {\n              label: 'Horizontally flip',\n              icon: SyncAltIcon,\n              onClick: self.horizontallyFlip,\n            },\n            {\n              label: 'Show all regions in assembly',\n              icon: VisibilityIcon,\n              onClick: self.showAllRegionsInAssembly,\n            },\n            {\n              label: 'Show center line',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showCenterLine,\n              onClick: self.toggleCenterLine,\n            },\n            { type: 'divider' },\n            {\n              label: 'Show header',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: !self.hideHeader,\n              onClick: self.toggleHeader,\n            },\n            {\n              label: 'Show header overview',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: !self.hideHeaderOverview,\n              onClick: self.toggleHeaderOverview,\n              disabled: self.hideHeader,\n            },\n            {\n              label: 'Track labels',\n              icon: LabelIcon,\n              subMenu: [\n                {\n                  label: 'Overlapping',\n                  icon: VisibilityIcon,\n                  type: 'radio',\n                  checked: self.trackLabels === 'overlapping',\n                  onClick: () => self.setTrackLabels('overlapping'),\n                },\n                {\n                  label: 'Offset',\n                  icon: VisibilityIcon,\n                  type: 'radio',\n                  checked: self.trackLabels === 'offset',\n                  onClick: () => self.setTrackLabels('offset'),\n                },\n                {\n                  label: 'Hidden',\n                  icon: VisibilityIcon,\n                  type: 'radio',\n                  checked: self.trackLabels === 'hidden',\n                  onClick: () => self.setTrackLabels('hidden'),\n                },\n              ],\n            },\n          ]\n\n          // add track's view level menu options\n          for (const [key, value] of self.trackTypeActions.entries()) {\n            if (value.length) {\n              menuItems.push(\n                { type: 'divider' },\n                { type: 'subHeader', label: key },\n              )\n              value.forEach(action => {\n                menuItems.push(action)\n              })\n            }\n          }\n\n          return menuItems\n        },\n\n        get staticBlocks() {\n          const ret = calculateStaticBlocks(self)\n          const sret = JSON.stringify(ret)\n          if (stringifiedCurrentlyCalculatedStaticBlocks !== sret) {\n            currentlyCalculatedStaticBlocks = ret\n            stringifiedCurrentlyCalculatedStaticBlocks = sret\n          }\n          return currentlyCalculatedStaticBlocks as BlockSet\n        },\n\n        get dynamicBlocks() {\n          return calculateDynamicBlocks(self)\n        },\n\n        get roundedDynamicBlocks() {\n          return this.dynamicBlocks.contentBlocks.map(block => {\n            return {\n              ...block,\n              start: Math.floor(block.start),\n              end: Math.ceil(block.end),\n            }\n          })\n        },\n        get visibleLocStrings() {\n          return calculateVisibleLocStrings(this.dynamicBlocks.contentBlocks)\n        },\n        get coarseVisibleLocStrings() {\n          return calculateVisibleLocStrings(self.coarseDynamicBlocks)\n        },\n      }\n    })\n    .actions(self => ({\n      // this \"clears the view\" and makes the view return to the import form\n      clearView() {\n        self.setDisplayedRegions([])\n        self.tracks.clear()\n        // it is necessary to run these after setting displayed regions empty\n        // or else model.offsetPx gets set to Infinity and breaks\n        // mobx-state-tree snapshot\n        self.scrollTo(0)\n        self.zoomTo(10)\n      },\n      setCoarseDynamicBlocks(blocks: BlockSet) {\n        self.coarseDynamicBlocks = blocks.contentBlocks\n        self.coarseTotalBp = blocks.totalBp\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              if (self.initialized) {\n                this.setCoarseDynamicBlocks(self.dynamicBlocks)\n              }\n            },\n            { delay: 150 },\n          ),\n        )\n      },\n    }))\n    .actions(self => ({\n      async exportSvg(opts: ExportSvgOptions = {}) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const html = await renderToSvg(self as any, opts)\n        const blob = new Blob([html], { type: 'image/svg+xml' })\n        saveAs(blob, 'image.svg')\n      },\n    }))\n}\n\nexport { renderToSvg }\nexport type LinearGenomeViewStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearGenomeViewModel = Instance<LinearGenomeViewStateModel>\n","import { lazy } from 'react'\nimport { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { getSession } from '@jbrowse/core/util'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport VisibilityIcon from '@material-ui/icons/Visibility'\nimport { types, getEnv, Instance } from 'mobx-state-tree'\nimport { AnyConfigurationSchemaType } from '@jbrowse/core/configuration/configurationSchema'\nimport { BaseLinearDisplay } from '../BaseLinearDisplay'\n\nconst SetMaxHeightDlg = lazy(() => import('./components/SetMaxHeight'))\n\nconst stateModelFactory = (configSchema: AnyConfigurationSchemaType) =>\n  types\n    .compose(\n      'LinearBasicDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearBasicDisplay'),\n        trackShowLabels: types.maybe(types.boolean),\n        trackDisplayMode: types.maybe(types.string),\n        trackMaxHeight: types.maybe(types.number),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(self => ({\n      get rendererTypeName() {\n        return getConf(self, ['renderer', 'type'])\n      },\n\n      get showLabels() {\n        const showLabels = getConf(self, ['renderer', 'showLabels'])\n        return self.trackShowLabels !== undefined\n          ? self.trackShowLabels\n          : showLabels\n      },\n\n      get maxHeight() {\n        const maxHeight = getConf(self, ['renderer', 'maxHeight'])\n        return self.trackMaxHeight !== undefined\n          ? self.trackMaxHeight\n          : maxHeight\n      },\n\n      get displayMode() {\n        const displayMode = getConf(self, ['renderer', 'displayMode'])\n        return self.trackDisplayMode !== undefined\n          ? self.trackDisplayMode\n          : displayMode\n      },\n      get rendererConfig() {\n        const configBlob = getConf(self, ['renderer']) || {}\n\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            showLabels: this.showLabels,\n            displayMode: this.displayMode,\n            maxHeight: this.maxHeight,\n          },\n          getEnv(self),\n        )\n      },\n    }))\n\n    .actions(self => ({\n      toggleShowLabels() {\n        self.trackShowLabels = !self.showLabels\n      },\n      setDisplayMode(val: string) {\n        self.trackDisplayMode = val\n      },\n      setMaxHeight(val: number) {\n        self.trackMaxHeight = val\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems } = self\n      return {\n        get renderProps() {\n          const config = self.rendererConfig\n\n          return {\n            ...self.composedRenderProps,\n            ...getParentRenderProps(self),\n            config,\n          }\n        },\n        get trackMenuItems(): MenuItem[] {\n          const displayModes = [\n            'compact',\n            'reducedRepresentation',\n            'normal',\n            'collapse',\n          ]\n          return [\n            ...trackMenuItems,\n            {\n              label: 'Show labels',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showLabels,\n              onClick: () => {\n                self.toggleShowLabels()\n              },\n            },\n            {\n              label: 'Display mode',\n              icon: VisibilityIcon,\n              subMenu: displayModes.map(val => ({\n                label: val,\n                onClick: () => {\n                  self.setDisplayMode(val)\n                },\n              })),\n            },\n            {\n              label: 'Set max height',\n              onClick: () => {\n                getSession(self).setDialogComponent(SetMaxHeightDlg, {\n                  model: self,\n                })\n              },\n            },\n          ]\n        },\n      }\n    })\n\nexport type FeatureTrackStateModel = ReturnType<typeof stateModelFactory>\nexport type FeatureTrackModel = Instance<FeatureTrackStateModel>\n\nexport default stateModelFactory\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { baseLinearDisplayConfigSchema } from '../BaseLinearDisplay'\n\nexport default function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearBasicDisplay',\n    {\n      mouseover: {\n        type: 'string',\n        description: 'what to display in a given mouseover',\n        defaultValue: `jexl:get(feature,'name')`,\n\n        contextVariable: ['feature'],\n      },\n      renderer: pluginManager.pluggableConfigSchemaType('renderer'),\n      // overrides base\n      maxDisplayedBpPerPx: {\n        type: 'number',\n        description: 'maximum bpPerPx that is displayed in the view',\n        defaultValue: 1000,\n      },\n    },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n","import { lazy } from 'react'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\nimport LineStyleIcon from '@material-ui/icons/LineStyle'\nimport {\n  BaseLinearDisplay,\n  BaseLinearDisplayComponent,\n  baseLinearDisplayConfigSchema,\n  BlockModel,\n} from './BaseLinearDisplay'\nimport {\n  configSchemaFactory as linearBareDisplayConfigSchemaFactory,\n  stateModelFactory as LinearBareDisplayStateModelFactory,\n} from './LinearBareDisplay'\nimport {\n  LinearGenomeViewModel,\n  LinearGenomeViewStateModel,\n  stateModelFactory as linearGenomeViewStateModelFactory,\n  renderToSvg,\n} from './LinearGenomeView'\n\nimport {\n  configSchema as linearBasicDisplayConfigSchemaFactory,\n  modelFactory as linearBasicDisplayModelFactory,\n} from './LinearBasicDisplay'\n\nexport default class LinearGenomeViewPlugin extends Plugin {\n  name = 'LinearGenomeViewPlugin'\n\n  exports = {\n    BaseLinearDisplayComponent,\n    BaseLinearDisplay,\n    baseLinearDisplayConfigSchema,\n  }\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'FeatureTrack',\n        {},\n        {\n          baseConfiguration: createBaseTrackConfig(pluginManager),\n          explicitIdentifier: 'trackId',\n        },\n      )\n      return new TrackType({\n        name: 'FeatureTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'FeatureTrack',\n          configSchema,\n        ),\n      })\n    })\n\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'BasicTrack',\n        {},\n        {\n          baseConfiguration: createBaseTrackConfig(pluginManager),\n          explicitIdentifier: 'trackId',\n        },\n      )\n      return new TrackType({\n        name: 'BasicTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'BasicTrack',\n          configSchema,\n        ),\n      })\n    })\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearBareDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearBareDisplay',\n        configSchema,\n        stateModel: LinearBareDisplayStateModelFactory(configSchema),\n        trackType: 'BasicTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearBasicDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearBasicDisplay',\n        configSchema,\n        stateModel: linearBasicDisplayModelFactory(configSchema),\n        trackType: 'FeatureTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n\n    pluginManager.addViewType(\n      () =>\n        new ViewType({\n          name: 'LinearGenomeView',\n          stateModel: linearGenomeViewStateModelFactory(pluginManager),\n          ReactComponent: lazy(\n            () => import('./LinearGenomeView/components/LinearGenomeView'),\n          ),\n        }),\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['File', 'Add'], {\n        label: 'Linear genome view',\n        icon: LineStyleIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('LinearGenomeView', {})\n        },\n      })\n    }\n  }\n}\n\nexport {\n  BaseLinearDisplayComponent,\n  BaseLinearDisplay,\n  baseLinearDisplayConfigSchema,\n  linearBareDisplayConfigSchemaFactory,\n  linearBasicDisplayConfigSchemaFactory,\n  linearBasicDisplayModelFactory,\n  renderToSvg,\n}\n\nexport type { LinearGenomeViewModel, LinearGenomeViewStateModel, BlockModel }\n\nexport type { BaseLinearDisplayModel } from './BaseLinearDisplay'\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  Button,\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n  Typography,\n  TextField,\n  makeStyles,\n} from '@material-ui/core'\n\nimport CloseIcon from '@material-ui/icons/Close'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: 500,\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n  field: {\n    margin: theme.spacing(2),\n  },\n}))\n\nfunction SetMaxHeightDlg(props: {\n  model: {\n    maxHeight?: number\n    setMaxHeight: Function\n  }\n  handleClose: () => void\n}) {\n  const { model, handleClose } = props\n  const classes = useStyles()\n  const { maxHeight = '' } = model\n  const [max, setMax] = useState(`${maxHeight}`)\n\n  return (\n    <Dialog\n      open\n      onClose={handleClose}\n      aria-labelledby=\"alert-dialog-title\"\n      aria-describedby=\"alert-dialog-description\"\n    >\n      <DialogTitle id=\"alert-dialog-title\">\n        Filter options\n        <IconButton\n          aria-label=\"close\"\n          className={classes.closeButton}\n          onClick={handleClose}\n        >\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <div className={classes.root}>\n          <Typography>Set max height for the track</Typography>\n          <TextField\n            value={max}\n            onChange={event => {\n              setMax(event.target.value)\n            }}\n            placeholder=\"Enter max score\"\n          />\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            type=\"submit\"\n            style={{ marginLeft: 20 }}\n            onClick={() => {\n              model.setMaxHeight(\n                max !== '' && !Number.isNaN(+max) ? +max : undefined,\n              )\n              handleClose()\n            }}\n          >\n            Submit\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nexport default observer(SetMaxHeightDlg)\n"],"names":["baseLinearDisplayConfigSchema","ConfigurationSchema","maxDisplayedBpPerPx","type","description","defaultValue","Number","MAX_VALUE","explicitIdentifier","runtime","exports","Op","Object","prototype","hasOwn","hasOwnProperty","undefined","$Symbol","Symbol","iteratorSymbol","iterator","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","obj","key","value","defineProperty","enumerable","configurable","writable","err","wrap","innerFn","outerFn","self","tryLocsList","protoGenerator","Generator","generator","create","context","Context","_invoke","makeInvokeMethod","tryCatch","fn","arg","call","GenStateSuspendedStart","GenStateSuspendedYield","GenStateExecuting","GenStateCompleted","ContinueSentinel","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","getProto","getPrototypeOf","NativeIteratorPrototype","values","Gp","constructor","displayName","defineIteratorMethods","forEach","method","isGeneratorFunction","genFun","ctor","name","mark","setPrototypeOf","__proto__","awrap","__await","AsyncIterator","PromiseImpl","invoke","resolve","reject","record","result","then","unwrapped","error","previousPromise","enqueue","callInvokeWithMethodAndArg","async","Promise","iter","next","done","state","Error","doneResult","delegate","delegateResult","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","TypeError","info","resultName","nextLoc","toString","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","push","resetTryEntry","completion","reset","keys","object","reverse","length","pop","iterable","iteratorMethod","isNaN","i","skipTempReset","prev","charAt","slice","stop","rootEntry","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","module","regeneratorRuntime","accidentalStrictMode","Function","useStyles","makeStyles","theme","contentBlock","position","minHeight","boxSizing","whiteSpace","overflow","elidedBlock","backgroundColor","backgroundImage","interRegionPaddingBlock","palette","text","primary","boundaryPaddingBlock","action","disabledBackground","ContentBlock","observer","block","children","classes","React","style","width","widthPx","className","ElidedBlock","InterRegionPaddingBlock","boundary","linearBlocks","textAlign","display","heightOverflowed","color","borderBottom","textShadow","fontWeight","zIndex","RenderedBlocks","model","blockDefinitions","blockState","map","get","ContentBlockComponent","id","ReactComponent","maxHeightReached","top","layout","getTotalHeight","pointerEvents","height","ElidedBlockComponent","InterRegionPaddingBlockComponent","background","variant","LinearBlocks","viewModel","getContainingView","left","offsetPx","propTypes","PropTypes","observableObject","isRequired","Tooltip","props","mouseCoord","featureUnderMouse","mouseover","getConf","feature","MUITooltip","title","open","placement","BaseLinearDisplay","useTheme","useState","setMouseCoord","contextCoord","setContextCoord","ref","useRef","TooltipComponent","DisplayMessageComponent","contextMenuItems","setContextMenuFeature","onContextMenu","event","preventDefault","current","clientX","clientY","onMouseMove","rect","getBoundingClientRect","role","Menu","Boolean","onMenuItemClick","_","callback","onClose","onExit","anchorReference","anchorPosition","tooltip","menuItems","loading","paddingLeft","blockMessage","padding","spacing","blockError","main","overflowY","blockReactNodeMessage","dots","animation","content","Repeater","LoadingMessage","shown","setShown","useEffect","killed","timeout","setTimeout","clearTimeout","blockStatus","status","getParent","displayStatus","message","Typography","BlockMessage","messageContent","isValidElement","BlockError","reload","displayHeight","Button","onClick","startIcon","RefreshIcon","ServerSideRenderedBlockContent","getParentRenderProps","displayModel","filled","reactElement","types","string","region","Region","isLeftEndOfDisplayedRegion","isRightEndOfDisplayedRegion","renderInProgress","features","renderProps","actions","afterAttach","getContainingDisplay","makeAbortableReaction","renderBlockData","renderBlockEffect","assembleLocString","delay","renderDelay","fireImmediately","setLoading","setRendered","setError","setStatus","abortController","signal","aborted","abort","setMessage","messageText","console","beforeDestroy","getSession","rpcManager","rendererType","cast","renderArgs","freeResourcesInClient","JSON","parse","stringify","e","warn","optDisplay","assemblyManager","adapterConfig","displayError","parentTrack","assemblyNames","getTrackAssemblyNames","regionAsm","assemblyName","includes","find","hasName","config","readConfObject","sessionId","getRpcSessionId","cannotBeRenderedReason","regionCannotBeRendered","statusCallback","isAlive","regions","blockKey","notReady","renderInClient","minDisplayHeight","defaultDisplayHeight","compose","BaseDisplay","optional","refinement","number","n","BlockState","userBpPerPxLimit","maybe","featureIdUnderMouse","contextMenuFeature","additionalContextMenuItemCallbacks","scrollTop","views","blockType","view","initialized","maxViewBpPerPx","selectedFeatureId","session","selection","isFeature","featureMaps","CompositeMap","blockLayoutFeatures","layoutMaps","Map","rectangles","set","getRectangles","getFeatureOverlapping","x","y","getByCoord","getFeatureByID","ret","val","getByID","blockWatchDisposer","autorun","blocksPresent","contentBlocks","has","addBlock","deleteBlock","addDisposer","setHeight","resizeHeight","distance","oldHeight","newHeight","setScrollTop","setUserBpPerPxLimit","limit","toRegion","selectFeature","isSessionModelWithWidgets","featureWidget","addWidget","featureData","toJSON","showWidget","isSelectionContainer","setSelection","clearFeatureSelection","clearSelection","setFeatureIdUnderMouse","temp","addAdditionalContextMenuItemCallback","regionCannotBeRenderedText","_region","bpPerPx","component","trackMenuItems","composedTrackMenuItems","getEnv","pluginManager","label","icon","MenuOpenIcon","composedRenderProps","rpcDriverName","onFeatureClick","featureId","f","onFeatureContextMenu","onMouseLeave","renderSvg","opts","overrideHeight","viewOffsetPx","dynamicBlocks","roundedDynamicBlocks","all","fill","exportSVG","renderings","rendering","index","offset","clipid","jest","Fragment","transform","clipPath","dangerouslySetInnerHTML","__html","html","postProcessSnapshot","rest","configSchemaFactory","renderer","pluggableConfigSchemaType","baseConfiguration","explicitlyTyped","stateModelFactory","configSchema","literal","configuration","ConfigurationReference","rendererTypeName","filter","createFilterOptions","trim","matchFrom","ignoreCase","helperSearchText","customWidth","maxWidth","fetchResults","query","rankSearchResults","textSearchManager","rootModel","searchScope","args","queryString","searchType","search","searchResults","RefNameAutocomplete","onSelect","TextFieldProps","setOpen","currentSearch","setCurrentSearch","debouncedSearch","useDebounce","searchOptions","setSearchOptions","coarseVisibleLocStrings","assembly","useMemo","limitOption","group","BaseResult","refName","renderingComponent","noWrap","options","defaultOptions","option","defaultOption","RefSequenceResult","matchedAttribute","concat","active","results","adapterResults","newOption","onChange","selectedOption","newResult","Autocomplete","freeSolo","disableListWrap","disableClearable","includeInputInList","clearOnBlur","selectOnFocus","disabled","onOpen","groupBy","String","filterOptions","possibleOptions","params","ListboxProps","maxHeight","renderInput","helperText","InputProps","TextFieldInputProps","endAdornment","CircularProgress","size","leaveDelay","InputAdornment","marginRight","SearchIcon","TextField","placeholder","target","renderOption","inputValue","getLabel","getRenderingComponent","getOptionLabel","chooseGridPitch","scale","minMajorPitchPx","minMinorPitchPx","Math","abs","minMajorPitchBp","majorMagnitude","parseInt","toExponential","split","majorPitch","max","majorPitchPx","minorPitch","makeTicks","start","end","emitMajor","emitMinor","gridPitch","minBase","maxBase","iterPitch","ticks","base","ceil","tertiary","fade","rubberBand","rubberBandControl","cursor","rubberBandText","contrastText","popover","mouseEvents","paper","paddingRight","guide","OverviewRubberBand","overview","ControlComponent","startX","setStartX","currentX","setCurrentX","guideX","setGuideX","controlsRef","rubberBandRef","mouseDragging","globalMouseMove","relativeX","globalMouseUp","zoomToDisplayedRegions","pxToBp","clickedAt","centerAt","round","coord","globalKeyDown","window","addEventListener","removeEventListener","mouseDown","stopPropagation","mouseMove","mouseOut","arrow","onMouseDown","onMouseOut","leftBpOffset","rightBpOffset","Popover","anchorEl","anchorOrigin","vertical","horizontal","transformOrigin","keepMounted","disableRestoreFocus","HEADER_OVERVIEW_HEIGHT","MobxPropTypes","objectOrObservableObject","ReactPropTypes","node","defaultProps","scaleBarColor","light","scaleBar","scaleBarContig","border","borderBottomColor","scaleBarContigForward","backgroundRepeat","scaleBarContigReverse","scaleBarRegionIncompleteLeft","backgroundSize","borderTopLeftRadius","borderBottomLeftRadius","scaleBarRegionIncompleteRight","borderTopRightRadius","borderBottomRightRadius","scaleBarRefName","lineHeight","scaleBarLabel","justifyContent","scaleBarVisibleRegion","borderWidth","borderStyle","borderColor","HEADER_BAR_HEIGHT","overviewSvg","wholeSeqSpacer","Polygon","totalWidthPxWithoutBorders","polygonColor","firstBlock","lastBlock","topLeft","bpToPx","reversed","regionNumber","topRight","startPx","endPx","interRegionPaddingWidth","points","stroke","ScaleBar","visibleRegions","overviewVisibleRegions","firstOverviewPx","lastOverviewPx","seq","idx","refNameColor","getRefNameColor","regionLength","tickLabels","floor","offsetLabel","clsx","tickLabel","labelIdx","toLocaleString","OverviewScaleBar","displayedRegions","Base1DView","minimumBlockWidth","setVolatileWidth","showAllRegions","totalBp","LinearProgress","marginTop","container","flexDirection","alignItems","slider","ZoomControls","maxBpPerPx","minBpPerPx","scaleFactor","log2","setValue","IconButton","zoom","ZoomOut","Slider","min","onChangeCommitted","zoomTo","ZoomIn","WIDGET_HEIGHT","SPACING","headerBar","headerForm","flexWrap","spacer","flexGrow","input","headerRefName","minWidth","panButton","margin","bp","marginLeft","toggleButton","buttonSpacer","Controls","activateTrackSelector","TrackSelectorIcon","PanControls","slide","ArrowBackIcon","ArrowForwardIcon","RegionWidth","coarseTotalBp","LinearGenomeViewHeader","coarseDynamicBlocks","setDisplayedRegion","newRegionValue","getLocation","newRegion","setDisplayedRegions","toLocaleLowerCase","setSearchResults","navToLocString","notify","controls","FormGroup","row","hideHeaderOverview","root","transition","transitions","duration","shortest","trackName","fontSize","dragHandle","dragHandleIcon","verticalAlign","iconButton","TrackLabel","forwardRef","setAnchorEl","track","trackConf","trackId","handleClick","currentTarget","handleClose","onDragStart","parentNode","dataTransfer","setDragImage","setDraggingTrackId","onDragEnd","assemblies","sequence","handleMenuItemClick","Paper","draggable","DragIcon","hideTrack","CloseIcon","MoreVertIcon","getTrackActionMenuItems","sort","a","b","priority","resizeHandle","RESIZE_HANDLE_HEIGHT","overlay","borderRadius","shape","renderingComponentContainer","trackLabel","trackLabelInline","trackLabelOverlap","trackRenderingContainer","overflowX","TrackContainer","displays","horizontalScroll","draggingTrackId","moveTrack","trackRefs","onDragEnter","debouncedOnDragEnter","useDebouncedCallback","RenderingComponent","DisplayBlurb","dimmed","trackLabels","onScroll","onHorizontalScroll","ResizeHandle","onDrag","VerticalGuide","coordX","RubberBand","setAnchorPosition","offsetX","setOffsets","zoomToRegion","leftPx","rightPx","leftOffset","rightOffset","moveTo","getSequence","ZoomInIcon","right","numOfBpSelected","scaleBarContainer","scaleBarZoomContainer","majorTickLabel","tick","refLabel","RenderedRefNameLabels","lastLeftBlock","staticBlocks","RenderedScaleBarLabels","baseNumber","other","offsetLeft","totalWidthPx","verticalGuidesZoomContainer","verticalGuidesContainer","majorTick","hint","minorTick","divider","RenderedVerticalGuides","VerticalGuides","centerLineContainer","borderTop","centerLineText","CenterLine","centerLineInfo","trackHeights","tracks","startingPosition","tracksContainer","TracksContainer","delta","scheduled","prevX","setMouseDragging","cleanup","currX","requestAnimationFrame","dataset","resizer","button","mouseUp","mouseLeave","curr","onWheel","origEvent","normalizeWheel","ctrlKey","pixelY","setScaleFactor","pixelX","onMouseUp","showCenterLine","SCALE_BAR_HEIGHT","dialogContent","closeButton","grey","SearchResultsDialog","optAssemblyName","assemblyRegions","location","handleShowTrack","trackConfigSchema","resolveIdentifier","getRoot","shownTracks","t","showTrack","getTrackName","Dialog","DialogTitle","Divider","DialogContent","searchQuery","DialogContentText","TableContainer","Table","TableHead","TableRow","TableCell","align","TableBody","scope","getTrackId","resultTrackId","DialogActions","importFormContainer","importFormEntry","ImportForm","selectedAssemblyIdx","setSelectedAssemblyIdx","selectedRegion","setSelectedRegion","setAssemblyRegions","hasError","waitForAssembly","setSelectedValue","handleSelectedRegion","r","isSearchDialogDisplayed","Container","Grid","justify","item","select","MenuItem","volatileWidth","onBlur","onKeyPress","disableShrink","showAllRegionsInAssembly","MiniControls","ArrowDown","loadingMessage","textAreaFont","fontFamily","fetchSequence","selectedRegions","assemblyConfig","chunks","chunk","SequenceDialog","setSequence","regionsSelected","getSelectedRegions","formatSequence","seqChunks","sequenceChunks","incompleteSeqErrs","chunkSeq","chunkRefName","chunkStart","chunkEnd","chunkLocstring","header","join","formatSeqFasta","sequenceTooLarge","multiline","rows","rowsMax","fullWidth","readOnly","copy","ContentCopyIcon","seqFastaFile","Blob","saveAs","GetAppIcon","autoFocus","mathPower","num","substr","Ruler","major","minor","x1","x2","y1","y2","strokeWidth","bool","errorMessage","paddingTop","paddingBottom","LinearGenomeView","hideHeader","hasDisplayedRegions","isSeqDialogDisplayed","Header","displayBp","parseFloat","toPrecision","x0","textAnchor","SVGRuler","renderRuler","rulerHeight","textHeight","paddingHeight","headerHeight","totalHeight","reduce","accum","SVGHeader","SVGRegionSeparators","initialOffset","strokeOpacity","SVGTracks","displayResults","renderToSvg","when","shift","ready","renderToStaticMarkup","xmlns","xmlnsXlink","viewBox","ExportSvgDlg","OffscreenCanvas","rasterizeLayers","setRasterizeLayers","FormControlLabel","control","Checkbox","checked","exportSvg","ReturnToImportFormDialog","clearView","calculateVisibleLocStrings","isSingleAssemblyName","every","INTER_REGION_PADDING_WIDTH","BaseViewModel","ElementId","array","MUIRegion","pluggableMstType","trackSelectorType","enumeration","afterDisplayedRegionsSetCallbacks","assembliesInitialized","assemblyList","asm","scaleBarHeight","trackHeightsWithResizeHandles","totalbp","maxOffset","leftPadding","displayedRegionsTotalPx","minOffset","rightPadding","highResolutionScaling","Set","includeAggregateIndexes","offsetBp","interRegionPaddingBp","minimumBlockBp","findIndex","len","foundRegion","px","bpSoFar","getSnapshot","oob","getTrack","openTrackIds","updateScore","getScore","rewriteOnClicks","trackType","viewMenuActions","subMenu","holdOnClick","apply","trackTypeActions","allActions","trackInMap","clone","setWidth","newWidth","toggleHeader","toggleHeaderOverview","scrollTo","newOffsetPx","clamp","newBpPerPx","oldBpPerPx","viewWidth","setNewView","horizontallyFlip","initialSnapshot","displayInitialSnapshot","getTrackType","viewType","getViewType","supportedDisplays","displayTypes","displayType","displayConf","d","stateModel","transaction","remove","movingTrackId","targetTrackId","oldIndex","newIndex","splice","closeView","parent","isViewContainer","removeView","toggleTrack","hiddenCount","setTrackLabels","setting","toggleCenterLine","selector","locString","isValidRefName","locStrings","locations","ls","parseLocString","navToMultiple","defaultRefName","parsedLocString","changedAssembly","newAssembly","newRegions","canonicalRefName","getCanonicalRefName","newDisplayedRegion","displayedRegion","navTo","firstLocation","s","refNameMatched","predicate","lastIndex","findLastIndex","previousIndex","locationIndex","locationStart","locationEnd","matchesLeft","isLast","matchesRight","startDisplayedRegion","endDisplayedRegion","singleRefSeq","startOffset","endOffset","simView","afterDisplayedRegionsSet","cb","targetBpPerPx","extraBp","bpToStart","oldOffsetPx","regionIndex","centerPx","center","centerBp","factor","cancelLastAnimation","viewWidths","springAnimate","animate","cancelAnimation","currentlyCalculatedStaticBlocks","stringifiedCurrentlyCalculatedStaticBlocks","setDialogComponent","ReturnToImportFormDlg","FolderOpenIcon","SyncAltIcon","VisibilityIcon","LabelIcon","entries","calculateStaticBlocks","sret","calculateDynamicBlocks","visibleLocStrings","clear","setCoarseDynamicBlocks","blocks","blob","SetMaxHeightDlg","lazy","trackShowLabels","trackDisplayMode","trackMaxHeight","showLabels","displayMode","rendererConfig","configBlob","toggleShowLabels","setDisplayMode","setMaxHeight","displayModes","contextVariable","LinearGenomeViewPlugin","BaseLinearDisplayComponent","addTrackType","createBaseTrackConfig","TrackType","createBaseTrackModel","addDisplayType","linearBareDisplayConfigSchemaFactory","DisplayType","LinearBareDisplayStateModelFactory","linearBasicDisplayConfigSchemaFactory","linearBasicDisplayModelFactory","addViewType","ViewType","linearGenomeViewStateModelFactory","isAbstractMenuManager","appendToSubMenu","LineStyleIcon","addView","Plugin","field","setMax"],"mappings":"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"}