"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),r=e(t),n=require("@jbrowse/core/configuration"),o=require("@jbrowse/core/pluggableElementTypes/models"),a=e(require("@jbrowse/core/pluggableElementTypes/TrackType")),i=e(require("@jbrowse/core/pluggableElementTypes/DisplayType")),l=e(require("@jbrowse/core/pluggableElementTypes/ViewType")),c=e(require("@jbrowse/core/Plugin")),s=require("@jbrowse/core/util"),u=e(require("@material-ui/icons/LineStyle")),d=e(require("@jbrowse/core/util/compositeMap")),f=require("@jbrowse/core/util/simpleFeature"),m=require("@jbrowse/core/util/tracks"),p=e(require("@material-ui/core/Button")),g=e(require("@material-ui/core/Typography")),h=e(require("@material-ui/icons/MenuOpen")),v=require("mobx"),y=require("mobx-state-tree"),b=require("@jbrowse/core/ui"),k=require("@material-ui/core/styles"),x=require("mobx-react"),w=e(require("@material-ui/core/Tooltip")),E=require("@jbrowse/core/util/blockTypes"),S=require("@jbrowse/core/util/types/mst"),C=e(require("@material-ui/icons/Refresh")),P=require("@jbrowse/core/configuration/configurationSchema"),T=e(require("@jbrowse/core/util/calculateDynamicBlocks")),B=e(require("@jbrowse/core/util/calculateStaticBlocks")),R=e(require("@jbrowse/core/util/Base1DViewModel")),N=require("@jbrowse/core/ui/Icons"),M=e(require("@material-ui/icons/SyncAlt")),L=e(require("@material-ui/icons/Visibility")),I=e(require("@material-ui/icons/Label")),D=e(require("@material-ui/icons/FolderOpen")),O=e(require("clone")),F=require("file-saver"),j=require("react-dom/server"),z=require("@material-ui/core"),q=require("@material-ui/core/styles/colorManipulator"),A=e(require("@material-ui/core/FormGroup")),H=e(require("@material-ui/icons/ArrowForward")),W=e(require("@material-ui/icons/ArrowBack")),V=require("@jbrowse/core/TextSearch/BaseResults"),_=e(V),G=e(require("@material-ui/core/CircularProgress")),X=e(require("@material-ui/core/TextField")),U=e(require("@material-ui/icons/Search")),J=require("@material-ui/lab/Autocomplete"),Y=e(J),Z=e(require("@material-ui/core/LinearProgress")),K=e(require("clsx")),Q=e(require("@material-ui/core/Popover")),$=e(require("prop-types")),ee=e(require("@material-ui/core/IconButton")),te=e(require("@material-ui/core/Slider")),re=e(require("@material-ui/icons/ZoomIn")),ne=e(require("@material-ui/icons/ZoomOut")),oe=e(require("@material-ui/core/Paper")),ae=e(require("@material-ui/icons/MoreVert")),ie=e(require("@material-ui/icons/DragIndicator")),le=e(require("@material-ui/icons/Close")),ce=e(require("normalize-wheel")),se=e(require("@material-ui/core/Container")),ue=e(require("@material-ui/core/Grid")),de=e(require("@material-ui/core/MenuItem")),fe=e(require("@material-ui/icons/KeyboardArrowDown")),me=e(require("@jbrowse/core/ui/Menu")),pe=e(require("copy-to-clipboard")),ge=e(require("@material-ui/icons/GetApp")),he=require("@jbrowse/core/util/formatFastaStrings");function ve(e){return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ye(e,t,r,n,o,a,i){try{var l=e[a](i),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,o)}function be(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){ye(a,n,o,i,l,"next",e)}function l(e){ye(a,n,o,i,l,"throw",e)}i(void 0)}))}}function ke(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function we(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?we(Object(r),!0).forEach((function(t){xe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):we(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Se(e){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ce(e,t){return(Ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pe(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)t.indexOf(r=a[n])>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t.indexOf(r=a[n])>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function Te(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Se(e);if(t){var o=Se(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Te(this,r)}}function Re(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=r){var n,o,a=[],i=!0,l=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(l)throw o}}return a}}(e,t)||Me(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ne(e){return function(e){if(Array.isArray(e))return Le(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Me(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Me(e,t){if(e){if("string"==typeof e)return Le(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Le(e,t):void 0}}function Le(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ie(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Me(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw a}}}}var De=n.ConfigurationSchema("BaseLinearDisplay",{maxDisplayedBpPerPx:{type:"number",description:"maximum bpPerPx that is displayed in the view",defaultValue:Number.MAX_VALUE}},{explicitIdentifier:"displayId"});function Oe(e,t){return e(t={exports:{}},t.exports),t.exports}var Fe=Oe((function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=Object.create((t&&t.prototype instanceof d?t:d).prototype),a=new E(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return{value:void 0,done:!0}}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var l=k(i,r);if(l){if(l===u)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=s(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),o}function s(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function d(){}function f(){}function m(){}var p={};p[o]=function(){return this};var g=Object.getPrototypeOf,h=g&&g(g(S([])));h&&h!==t&&r.call(h,o)&&(p=h);var v=m.prototype=d.prototype=Object.create(p);function y(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var n;this._invoke=function(o,a){function i(){return new t((function(n,i){!function n(o,a,i,l){var c=s(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,i,l)}),(function(e){n("throw",e,i,l)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return n("throw",e,i,l)}))}l(c.arg)}(o,a,n,i)}))}return n=n?n.then(i,i):i()}}function k(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var n=s(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,u;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function S(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:C}}function C(){return{value:void 0,done:!0}}return f.prototype=v.constructor=m,m.constructor=f,f.displayName=l(m,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(b.prototype),b.prototype[a]=function(){return this},e.AsyncIterator=b,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new b(c(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},y(v),l(v,i,"Generator"),v[o]=function(){return this},v.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=S,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;w(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}})),je=k.makeStyles((function(e){return{contentBlock:{position:"relative",minHeight:"100%",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden"},elidedBlock:{minHeight:"100%",boxSizing:"border-box",backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"},interRegionPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.text.primary},boundaryPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.action.disabledBackground}}})),ze=x.observer((function(e){var t=e.block,n=e.children,o=je();return r.createElement("div",{style:{width:"".concat(t.widthPx,"px")},className:o.contentBlock},n)}));function qe(e){var t=e.width,n=je();return r.createElement("div",{className:n.elidedBlock,style:{width:"".concat(t,"px")}})}function Ae(e){var t=e.boundary,n=e.width,o=e.style,a=void 0===o?{}:o,i=je();return r.createElement("div",{style:Ee(Ee({},a),{},{width:"".concat(n,"px")}),className:t?i.boundaryPaddingBlock:i.interRegionPaddingBlock})}var He=k.makeStyles({linearBlocks:{whiteSpace:"nowrap",textAlign:"left",position:"absolute",minHeight:"100%",display:"flex"},heightOverflowed:{position:"absolute",color:"rgb(77,77,77)",borderBottom:"2px solid rgb(77,77,77)",textShadow:"white 0px 0px 1px",whiteSpace:"nowrap",width:"100%",fontWeight:"bold",textAlign:"center",zIndex:2e3,boxSizing:"border-box"}}),We=x.observer((function(e){var t=e.model,n=He(),o=t.blockState;return r.createElement(r.Fragment,null,t.blockDefinitions.map((function(e){if(e instanceof E.ContentBlock){var a=o.get(e.key);return r.createElement(ze,{block:e,key:"".concat(t.id,"-").concat(e.key)},a&&a.ReactComponent?r.createElement(a.ReactComponent,{model:a}):null,a&&a.maxHeightReached?r.createElement("div",{className:n.heightOverflowed,style:{top:a.layout.getTotalHeight()-16,pointerEvents:"none",height:16}},"Max height reached"):null)}if(e instanceof E.ElidedBlock)return r.createElement(qe,{key:"".concat(t.id,"-").concat(e.key),width:e.widthPx});if(e instanceof E.InterRegionPaddingBlock)return r.createElement(Ae,{key:e.key,width:e.widthPx,style:{background:"none"},boundary:"boundary"===e.variant});throw new Error("invalid block type ".concat(ve(e)))})))}));function Ve(e){var t=e.model,n=He(),o=t.blockDefinitions,a=s.getContainingView(t);return r.createElement("div",{"data-testid":"Blockset",className:n.linearBlocks,style:{left:o.offsetPx-a.offsetPx}},r.createElement(We,{model:t}))}Ve.propTypes={model:x.PropTypes.observableObject.isRequired};var _e=x.observer(Ve),Ge=k.makeStyles({display:{position:"relative",whiteSpace:"nowrap",textAlign:"left",width:"100%",minHeight:"100%"}}),Xe=x.observer((function(e){var t=e.model,o=e.mouseCoord,a=t.featureUnderMouse,i=a?n.getConf(t,"mouseover",{feature:a}):void 0;return i?r.createElement(w,{title:i,open:!0,placement:"right"},r.createElement("div",{style:{position:"absolute",left:o[0],top:o[1]}}," ")):null})),Ue=x.observer((function(e){var o=Ge(),a=k.useTheme(),i=Re(t.useState([0,0]),2),l=i[0],c=i[1],s=Re(t.useState(),2),u=s[0],d=s[1],f=t.useRef(null),m=e.model,p=e.children,g=m.TooltipComponent,h=m.DisplayMessageComponent,v=m.contextMenuItems,y=m.height,x=m.setContextMenuFeature;return r.createElement("div",{ref:f,"data-testid":"display-".concat(n.getConf(m,"displayId")),className:o.display,onContextMenu:function(e){e.preventDefault(),u?d(void 0):f.current&&d([e.clientX,e.clientY])},onMouseMove:function(e){if(f.current){var t=f.current.getBoundingClientRect();c([e.clientX-t.left,e.clientY-t.top])}},role:"presentation"},h?r.createElement(h,{model:m}):r.createElement(_e,Object.assign({},e)),p,r.createElement(g,{model:m,height:y,mouseCoord:l}),r.createElement(b.Menu,{open:Boolean(u)&&Boolean(v.length),onMenuItemClick:function(e,t){t(),d(void 0)},onClose:function(){d(void 0),x(void 0)},onExit:function(){d(void 0),x(void 0)},anchorReference:"anchorPosition",anchorPosition:u?{top:u[1],left:u[0]}:void 0,style:{zIndex:a.zIndex.tooltip},menuItems:v,"data-testid":"base_linear_display_context_menu"}))})),Je=k.makeStyles((function(e){return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.action.disabledBackground,backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)",height:"100%",width:"100%",pointerEvents:"none",textAlign:"center"},blockMessage:{width:"100%",background:e.palette.action.disabledBackground,padding:e.spacing(2),pointerEvents:"none",textAlign:"center"},blockError:{padding:e.spacing(2),width:"100%",whiteSpace:"normal",color:e.palette.error.main,overflowY:"auto"},blockReactNodeMessage:{width:"100%",background:e.palette.action.disabledBackground,padding:e.spacing(2),textAlign:"center"},dots:{"&::after":{display:"inline-block",animation:"$ellipsis 1.5s infinite",content:'"."',width:"1em",textAlign:"left"}},"@keyframes ellipsis":{"0%":{content:'"."'},"33%":{content:'".."'},"66%":{content:'"..."'}}}}));function Ye(e){var t=e.children;return r.createElement("div",{style:{display:"flex"}},t,t)}var Ze=x.observer((function(e){var n=e.model,o=Re(t.useState(!1),2),a=o[0],i=o[1],l=Je();t.useEffect((function(){var e=!1,t=setTimeout((function(){e||i(!0)}),300);return function(){clearTimeout(t),e=!0}}),[]);var c=n.status,s=y.getParent(n,2).message||c;return r.createElement(r.Fragment,null,a?r.createElement("div",{className:l.loading},r.createElement(g,{className:l.dots,variant:"body2"},s?"".concat(s):"Loading")):null)}));function Ke(e){var t=e.messageContent,n=Je();return r.isValidElement(t)?r.createElement("div",{className:n.blockReactNodeMessage},t):r.createElement(g,{variant:"body2",className:n.blockMessage},t)}function Qe(e){var t=e.error,n=e.reload,o=e.displayHeight,a=Je();return r.createElement("div",{className:a.blockError,style:{height:o}},n?r.createElement(p,{"data-testid":"reload_button",onClick:n,startIcon:r.createElement(C,null)},"Reload"):null,r.createElement(g,{color:"error",variant:"body2",display:"inline"},"".concat(t)))}var $e=x.observer((function(e){var t=e.model;return t.error?r.createElement(Ye,null,r.createElement(Qe,{error:t.error,reload:t.reload,displayHeight:m.getParentRenderProps(t).displayModel.height})):t.message?r.createElement(Ye,null,r.createElement(Ke,{messageContent:t.message})):t.filled?t.reactElement:r.createElement(Ye,null,r.createElement(Ze,{model:t}))})),et=y.types.model("BlockState",{key:y.types.string,region:S.Region,isLeftEndOfDisplayedRegion:!1,isRightEndOfDisplayedRegion:!1}).volatile((function(){return{renderInProgress:void 0,filled:!1,reactElement:void 0,features:void 0,layout:void 0,status:"",error:void 0,message:void 0,maxHeightReached:!1,ReactComponent:$e,renderProps:void 0}})).actions((function(e){var t;return{afterAttach:function(){var t=s.getContainingDisplay(e);s.makeAbortableReaction(e,tt,rt,{name:"".concat(t.id,"/").concat(s.assembleLocString(e.region)," rendering"),delay:t.renderDelay,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setStatus:function(t){e.status=t},setLoading:function(r){void 0!==t&&(t.signal.aborted||t.abort()),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,t=r},setMessage:function(r){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=r,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,t=void 0},setRendered:function(r){if(r){var n=r.reactElement,o=r.features,a=r.layout,i=r.maxHeightReached,l=r.renderProps;e.filled=!0,e.message=void 0,e.reactElement=n,e.features=o,e.layout=a,e.error=void 0,e.maxHeightReached=i,e.renderProps=l,t=void 0}},setError:function(r){console.error(r),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.maxHeightReached=!1,e.error=r,e.renderProps=void 0,t=void 0},reload:function(){e.renderInProgress=void 0,e.filled=!1,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.message=void 0,e.maxHeightReached=!1,e.ReactComponent=$e,e.renderProps=void 0,y.getParent(e,2).reload()},beforeDestroy:function(){t&&!t.signal.aborted&&t.abort();var r=s.getContainingDisplay(e),n=s.getSession(e).rpcManager,o=r.rendererType,a=tt(y.cast(e)).renderArgs;a&&o.freeResourcesInClient(n,JSON.parse(JSON.stringify(a))).catch((function(e){console.warn("Error while destroying block",e)}))}}}));function tt(e,t){try{var r=t||s.getContainingDisplay(e),o=s.getSession(r),a=o.assemblyManager,i=o.rpcManager,l=r.adapterConfig,c=r.renderProps,u=r.rendererType,d=r.error,f=m.getTrackAssemblyNames(r.parentTrack),p=e.region.assemblyName;if(!f.includes(p)&&!f.find((function(e){var t;return null===(t=a.get(e))||void 0===t?void 0:t.hasName(p)})))throw new Error("region assembly (".concat(p,") does not match track assemblies (").concat(f,")"));n.readConfObject(c.config);var g=m.getRpcSessionId(r);return{rendererType:u,rpcManager:i,renderProps:c,cannotBeRenderedReason:r.regionCannotBeRendered(e.region),displayError:d,renderArgs:{statusCallback:function(t){y.isAlive(e)&&e.setStatus(t)},assemblyName:e.region.assemblyName,regions:[e.region],adapterConfig:l,rendererType:u.name,sessionId:g,blockKey:e.key,timeout:1e6}}}catch(e){return{displayError:e}}}function rt(e,t,r){return nt.apply(this,arguments)}function nt(){return(nt=be(Fe.mark((function e(t,r,n){var o,a,i,l,c,s,u;return Fe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.rendererType,a=t.renderProps,i=t.rpcManager,l=t.renderArgs,c=t.cannotBeRenderedReason,s=t.displayError,y.isAlive(n)){e.next=3;break}return e.abrupt("return",void 0);case 3:if(!s){e.next=6;break}return n.setError(s),e.abrupt("return",void 0);case 6:if(!c){e.next=9;break}return n.setMessage(c),e.abrupt("return",void 0);case 9:if(!a.notReady){e.next=11;break}return e.abrupt("return",void 0);case 11:return e.next=13,o.renderInClient(i,Ee(Ee(Ee({},l),a),{},{signal:r}));case 13:return e.abrupt("return",{reactElement:(u=e.sent).reactElement,features:u.features,layout:u.layout,maxHeightReached:u.maxHeightReached});case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ot=y.types.compose("BaseLinearDisplay",o.BaseDisplay,y.types.model({height:y.types.optional(y.types.refinement("displayHeight",y.types.number,(function(e){return e>=20})),100),blockState:y.types.map(et),userBpPerPxLimit:y.types.maybe(y.types.number)})).volatile((function(){return{message:"",featureIdUnderMouse:void 0,contextMenuFeature:void 0,additionalContextMenuItemCallbacks:[],scrollTop:0}})).views((function(e){return{get blockType(){return"staticBlocks"},get blockDefinitions(){var t=this.blockType,r=s.getContainingView(e);if(!r.initialized)throw new Error("view not initialized yet");return r[t]}}})).views((function(e){return{get maxViewBpPerPx(){return e.userBpPerPxLimit||n.getConf(e,"maxDisplayedBpPerPx")},get renderDelay(){return 50},get TooltipComponent(){return Xe},get selectedFeatureId(){if(y.isAlive(e)){var t=s.getSession(e).selection;if(f.isFeature(t))return t.id()}},get DisplayMessageComponent(){}}})).views((function(e){return{get features(){var t,r=[],n=Ie(e.blockState.values());try{for(n.s();!(t=n.n()).done;){var o=t.value;o&&o.features&&r.push(o.features)}}catch(e){n.e(e)}finally{n.f()}return new d(r)},get featureUnderMouse(){return e.featureIdUnderMouse?this.features.get(e.featureIdUnderMouse):void 0},get blockLayoutFeatures(){var t,r=new Map,n=Ie(e.blockState.values());try{for(n.s();!(t=n.n()).done;){var o=t.value;o&&o.layout&&o.layout.rectangles&&r.set(o.key,o.layout.getRectangles())}}catch(e){n.e(e)}finally{n.f()}return r},getFeatureOverlapping:function(t,r,n){var o,a;return null===(o=e.blockState.get(t))||void 0===o||null===(a=o.layout)||void 0===a?void 0:a.getByCoord(r,n)},getFeatureByID:function(t){var r;return e.blockState.forEach((function(e){var n,o=null==e||null===(n=e.layout)||void 0===n?void 0:n.getByID(t);o&&(r=o)})),r}}})).actions((function(e){return{afterAttach:function(){var t=this,r=v.autorun((function(){var r={};s.getContainingView(e).initialized&&(e.blockDefinitions.contentBlocks.forEach((function(n){r[n.key]=!0,e.blockState.has(n.key)||t.addBlock(n.key,n)})),e.blockState.forEach((function(e,n){r[n]||t.deleteBlock(n)})))}));y.addDisposer(e,r)},setHeight:function(t){return e.height=t>20?t:20,e.height},resizeHeight:function(t){var r=e.height;return this.setHeight(e.height+t)-r},setScrollTop:function(t){e.scrollTop=t},setUserBpPerPxLimit:function(t){e.userBpPerPxLimit=t},setMessage:function(t){e.message=t},addBlock:function(t,r){e.blockState.set(t,et.create({key:t,region:r.toRegion()}))},deleteBlock:function(t){e.blockState.delete(t)},selectFeature:function(t){var r=s.getSession(e);if(s.isSessionModelWithWidgets(r)){var n=r.addWidget("BaseFeatureWidget","baseFeature",{featureData:t.toJSON(),view:s.getContainingView(e)});r.showWidget(n)}s.isSelectionContainer(r)&&r.setSelection(t)},clearFeatureSelection:function(){s.getSession(e).clearSelection()},setFeatureIdUnderMouse:function(t){e.featureIdUnderMouse=t},reload:function(){var t=JSON.parse(JSON.stringify(e.blockState));Object.keys(t).forEach((function(e){t[e].key+="-reload"})),e.blockState=t},addAdditionalContextMenuItemCallback:function(t){e.additionalContextMenuItemCallbacks.push(t)},setContextMenuFeature:function(t){e.contextMenuFeature=t}}})).views((function(e){return{regionCannotBeRenderedText:function(t){var r=s.getContainingView(e);return r&&r.bpPerPx>e.maxViewBpPerPx?"Zoom in to see features":""},regionCannotBeRendered:function(t){var n=s.getContainingView(e);if(n&&n.bpPerPx>e.maxViewBpPerPx)return r.createElement(r.Fragment,null,r.createElement(g,{component:"span",variant:"body2"},"Zoom in to see features or"," "),r.createElement(p,{"data-testid":"reload_button",onClick:function(){e.setUserBpPerPxLimit(n.bpPerPx),e.reload()},variant:"outlined"},"Force Load"),r.createElement(g,{component:"span",variant:"body2"},"(force load may be slow)"))},get trackMenuItems(){return[]},get composedTrackMenuItems(){return[]},get contextMenuItems(){var t=y.getEnv(e).pluginManager,r=e.contextMenuFeature?[{label:"Open feature details",icon:h,onClick:function(){e.contextMenuFeature&&e.selectFeature(e.contextMenuFeature)}}]:[];return e.additionalContextMenuItemCallbacks.forEach((function(n){var o=n(e.contextMenuFeature,e,t);r.push.apply(r,Ne(o))})),r},get composedRenderProps(){return Ee(Ee({},m.getParentRenderProps(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e,onFeatureClick:function(t,r){var n=r||e.featureIdUnderMouse;if(n){var o=e.features.get(n);e.selectFeature(o)}else e.clearFeatureSelection()},onClick:function(){e.clearFeatureSelection()},onFeatureContextMenu:function(t,r){var n=r||e.featureIdUnderMouse;n?e.setContextMenuFeature(e.features.get(n)):e.clearFeatureSelection()},onMouseMove:function(t,r){e.setFeatureIdUnderMouse(r)},onMouseLeave:function(t){e.setFeatureIdUnderMouse(void 0)},onContextMenu:function(){e.setContextMenuFeature(void 0),e.clearFeatureSelection()}})},get renderProps(){return this.composedRenderProps}}})).actions((function(e){return{renderSvg:function(t){return be(Fe.mark((function n(){var o,a,i,l,c,u,d;return Fe.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=e.height,a=e.id,i=t.overrideHeight,l=s.getContainingView(e),c=l.offsetPx,u=l.roundedDynamicBlocks,d=l.width,n.next=6,Promise.all(u.map((function(n){var o=et.create({key:n.key,region:n}),a=e.regionCannotBeRenderedText(n)||e.regionCannotBeRendered(n);if(a)return{reactElement:r.createElement(r.Fragment,null,r.createElement("rect",{x:0,y:0,width:d,height:20,fill:"#aaa"}),r.createElement("text",{x:0,y:15},a))};var i=tt(o,e),l=i.renderProps;return i.rendererType.renderInClient(i.rpcManager,Ee(Ee(Ee({},i.renderArgs),l),{},{exportSVG:t}))})));case 6:return n.abrupt("return",r.createElement(r.Fragment,null,n.sent.map((function(e,t){var n=u[t].offsetPx-c,l="clip-".concat("undefined"==typeof jest?a:"jest","-").concat(t);return r.createElement(r.Fragment,{key:"frag-".concat(t)},r.createElement("defs",null,r.createElement("clipPath",{id:l},r.createElement("rect",{x:0,y:0,width:d,height:i||o}))),r.createElement("g",{transform:"translate(".concat(n," 0)")},r.createElement("g",{clipPath:"url(#".concat(l,")")},r.isValidElement(e.reactElement)?e.reactElement:r.createElement("g",{dangerouslySetInnerHTML:{__html:e.html}}))))}))));case 8:case"end":return n.stop()}}),n)})))()}}})).postProcessSnapshot((function(e){return Pe(e,["blockState"])}));function at(e){return n.ConfigurationSchema("LinearBareDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:De,explicitlyTyped:!0})}function it(e){return y.types.compose("LinearBareDisplay",ot,y.types.model({type:y.types.literal("LinearBareDisplay"),configuration:P.ConfigurationReference(e)})).views((function(e){return{get renderProps(){return Ee(Ee(Ee({},e.composedRenderProps),m.getParentRenderProps(e)),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer})},get rendererTypeName(){return e.configuration.renderer.type}}}))}var lt=J.createFilterOptions({trim:!0,matchFrom:"start",ignoreCase:!0,limit:101}),ct=k.makeStyles((function(){return{customWidth:{maxWidth:150}}}));function st(e,t,r){return ut.apply(this,arguments)}function ut(){return(ut=be(Fe.mark((function e(t,r,n){var o,a,i,l,c,u;return Fe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=s.getSession(t),a=y.getEnv(o),i=t.rankSearchResults,l=a.pluginManager.rootModel.textSearchManager,c=t.searchScope(n),u={queryString:r,searchType:"prefix"},e.next=8,null==l?void 0:l.search(u,c,i);case 8:if(e.t0=e.sent,e.t0){e.next=11;break}e.t0=[];case 11:return e.abrupt("return",e.t0);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dt(e){var n=e.model,o=e.onSelect,a=e.assemblyName,i=e.style,l=e.value,c=e.TextFieldProps,u=void 0===c?{}:c,d=ct(),f=s.getSession(n),m=Re(t.useState(!1),2),p=m[0],h=m[1],v=Re(t.useState(),2)[1],y=Re(t.useState(""),2),b=y[0],k=y[1],x=s.useDebounce(b,350),E=Re(t.useState([]),2),S=E[0],C=E[1],P=n.coarseVisibleLocStrings,T=a&&f.assemblyManager.get(a),B=t.useMemo((function(){return T&&T.regions||[]}),[T]),R=[{group:"reference sequence",result:new _({refName:"",label:"",renderingComponent:r.createElement(w,{title:"Displaying first 100 refNames. Search for more results"},r.createElement(g,{noWrap:!0},"more results..."))})}],N=t.useMemo((function(){return B.map((function(e){return{group:"reference sequence",result:new V.RefSequenceResult({refName:e.refName,label:e.refName,matchedAttribute:"refName"})}}))}),[B]);return N=N.length>100?N.slice(0,100).concat(R):N,t.useEffect((function(){var e=!0;return be(Fe.mark((function t(){var r,o;return Fe.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=[],!x||""===x||!a){t.next=7;break}return t.next=5,st(n,x,a);case 5:r=r.concat(t.sent);case 7:r.length>0&&e&&(o=r.map((function(e){return{group:"text search results",result:e}})),C(o)),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.error(t.t0),e&&v(t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,10]])})))(),function(){e=!1}}),[a,x,n]),r.createElement(Y,{id:"refNameAutocomplete-".concat(n.id),"data-testid":"autocomplete",freeSolo:!0,disableListWrap:!0,disableClearable:!0,includeInputInList:!0,clearOnBlur:!0,selectOnFocus:!0,disabled:!a,style:i,value:P||l||"",open:p,onOpen:function(){return h(!0)},onClose:function(){h(!1),k(""),C([])},options:0===S.length?N:S,groupBy:function(e){return String(e.group)},filterOptions:function(e,t){return lt(e,t)},ListboxProps:{style:{maxHeight:250}},onChange:function(e,t){return function(e){if(e&&a)if("string"==typeof e){var t=new _({label:e});o(t)}else o(e.result)}(t)},renderInput:function(e){var t=u.helperText,n=u.InputProps,o=void 0===n?{}:n,a=Ee(Ee(Ee({},e.InputProps),o),{},{endAdornment:r.createElement(r.Fragment,null,0===B.length&&0===S.length?r.createElement(G,{color:"inherit",size:20}):r.createElement(w,{title:'Search for features or navigate to a location using syntax "chr1:1-100" or "chr1:1..100"',leaveDelay:300,placement:"top",classes:{tooltip:d.customWidth}},r.createElement(z.InputAdornment,{position:"end",style:{marginRight:7}},r.createElement(U,null))),e.InputProps.endAdornment)});return r.createElement(X,Object.assign({},e,u,{helperText:t,value:P||l||"",InputProps:a,placeholder:"Search for location",onChange:function(e){k(e.target.value)}}))},renderOption:function(e,t){var n=t.inputValue,o=e.result,a=o.getLabel(),i=o.getRenderingComponent();return i&&r.isValidElement(i)?i:""!==b&&n.length<=a.length?r.createElement(g,{noWrap:!0},r.createElement("b",null,a.slice(0,n.length)),a.slice(n.length)):r.createElement(g,{noWrap:!0},a)},getOptionLabel:function(e){return("string"==typeof e?e:e.result.getLabel())||""}})}var ft=x.observer(dt);function mt(e,t,r){for(var n=t*(e=Math.abs(e)),o=parseInt(Number(n).toExponential().split(/e/i)[1],10),a=Math.pow(10,o);a<n&&!((a*=2)>=n);)a*=2.5;var i=(a=Math.max(a,5))/e,l=0;return!(a%10)&&i/10>=r?l=a/10:!(a%5)&&i/5>=r?l=a/5:!(a%2)&&i/2>=r&&(l=a/2),{majorPitch:a,minorPitch:l}}function pt(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=mt(r,60,15),i=e,l=t;if(null===i||null===l)return[];if(r<0){var c=[l,i];i=c[0],l=c[1]}i-=Math.abs(20*r)-1,l+=Math.abs(20*r)+1;for(var s=a.minorPitch||a.majorPitch,u=0,d=[],f=Math.ceil(i/s)*s;f<l;f+=s)o&&f%(2*a.majorPitch)?(d.push({type:"minor",base:f-1,index:u}),u+=1):!n||f%(2*a.majorPitch)||(d.push({type:"major",base:f-1,index:u}),u+=1);return d}var gt=k.makeStyles((function(e){return{rubberBand:{height:"100%",background:q.fade(e.palette.tertiary?e.palette.tertiary.main:e.palette.primary.main,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberBandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberBandText:{color:e.palette.tertiary?e.palette.tertiary.contrastText:e.palette.primary.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}}}));function ht(e){var n=e.model,o=e.overview,a=e.ControlComponent,i=void 0===a?r.createElement("div",null):a,l=Re(t.useState(),2),c=l[0],u=l[1],d=Re(t.useState(),2),f=d[0],m=d[1],p=Re(t.useState(),2),h=p[0],v=p[1],y=t.useRef(null),b=t.useRef(null),k=gt(),x=void 0!==c;function E(e){e.preventDefault(),e.stopPropagation(),y.current&&u(e.clientX-y.current.getBoundingClientRect().left)}function S(e){y.current&&v(e.clientX-y.current.getBoundingClientRect().left)}function C(){v(void 0)}if(t.useEffect((function(){function e(e){if(y.current&&x){var t=e.clientX-y.current.getBoundingClientRect().left;m(t)}}function t(){if(y.current&&void 0!==c&&void 0!==f&&Math.abs(f-c)>3&&n.zoomToDisplayedRegions(o.pxToBp(c),o.pxToBp(f)),y.current&&void 0!==c&&void 0===f){var e=o.pxToBp(c);n.centerAt(Math.round(e.coord),e.refName,e.index)}u(void 0),m(void 0),void 0!==c&&v(void 0)}function r(e){"Escape"===e.key&&(u(void 0),m(void 0))}return x?(window.addEventListener("mousemove",e,!0),window.addEventListener("mouseup",t,!0),window.addEventListener("keydown",r,!0),function(){window.removeEventListener("mousemove",e,!0),window.removeEventListener("mouseup",t,!0),window.removeEventListener("keydown",r,!0)}):function(){}}),[x,f,c,n,o]),void 0===c)return r.createElement("div",{style:{position:"relative"}},void 0!==h?r.createElement(w,{open:!x,placement:"top",title:s.stringify(o.pxToBp(h)),arrow:!0},r.createElement("div",{className:k.guide,style:{left:h}})):null,r.createElement("div",{className:k.rubberBandControl,role:"presentation",ref:y,onMouseDown:E,onMouseOut:C,onMouseMove:S},i));var P,T,B=c||0,R=0;if(void 0!==c&&void 0!==f&&(B=f<c?f:c,R=f-c),c&&(P=o.pxToBp(c),T=o.pxToBp(c+R),f&&f<c)){var N=[T,P];P=N[0],T=N[1]}return r.createElement("div",{style:{position:"relative"}},b.current?r.createElement(r.Fragment,null,r.createElement(Q,{className:k.popover,classes:{paper:k.paper},open:!0,anchorEl:b.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0},r.createElement(g,null,P?s.stringify(P):"")),r.createElement(Q,{className:k.popover,classes:{paper:k.paper},open:!0,anchorEl:b.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0},r.createElement(g,null,T?s.stringify(T):""))):null,r.createElement("div",{ref:b,className:k.rubberBand,style:{left:B,width:Math.abs(R),height:Nr}}),r.createElement("div",{"data-testid":"rubberBand_controls",className:k.rubberBandControl,role:"presentation",ref:y,onMouseDown:E,onMouseOut:C,onMouseMove:S},i))}ht.propTypes={model:x.PropTypes.objectOrObservableObject.isRequired,overview:x.PropTypes.objectOrObservableObject.isRequired,ControlComponent:$.node},ht.defaultProps={ControlComponent:r.createElement("div",null)};var vt=x.observer(ht),yt=k.makeStyles((function(e){var t=e.palette.tertiary?e.palette.tertiary.light:e.palette.primary.light;return{scaleBar:{width:"100%",height:Nr,overflow:"hidden"},scaleBarContig:{backgroundColor:e.palette.background.default,position:"absolute",top:0,height:Nr,border:"1px solid",borderBottomColor:"black"},scaleBarContigForward:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")",backgroundRepeat:"repeat"},scaleBarContigReverse:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")",backgroundRepeat:"repeat"},scaleBarRegionIncompleteLeft:{width:10,height:17.5,background:"linear-gradient(-225deg,black 3px, transparent 1px),\n      linear-gradient(45deg, black 3px, transparent 1px)",backgroundRepeat:"repeat-y",backgroundSize:"10px 8px",borderTopLeftRadius:"2px",borderBottomLeftRadius:"2px",float:"left"},scaleBarRegionIncompleteRight:{width:10,height:17.5,background:"linear-gradient(225deg, black 3px, transparent 1px),\n      linear-gradient(-45deg, black 3px, transparent 1px)",backgroundRepeat:"repeat-y",backgroundSize:"10px 8px",borderTopRightRadius:"2px",borderBottomRightRadius:"2px",float:"right"},scaleBarRefName:{position:"absolute",fontWeight:"bold",lineHeight:"normal",pointerEvents:"none",left:5},scaleBarLabel:{height:Nr,width:1,position:"absolute",display:"flex",justifyContent:"center",pointerEvents:"none"},scaleBarVisibleRegion:{background:q.fade(t,.3),position:"absolute",height:Nr,pointerEvents:"none",top:-1,zIndex:100,borderWidth:1,borderStyle:"solid",borderColor:q.fade(t,.8),boxSizing:"content-box"},overview:{height:Rr,position:"relative"},overviewSvg:{position:"absolute"}}})),bt=x.observer((function(e){var t=e.model,n=e.overview,o=k.useTheme(),a=yt(),i=t.offsetPx,l=t.dynamicBlocks,c=l.contentBlocks,s=l.totalWidthPxWithoutBorders,u=o.palette.tertiary?o.palette.tertiary.light:o.palette.primary.light;if(!c.length)return null;var d=c[0],f=c[c.length-1],m=n.bpToPx({refName:d.refName,coord:d.reversed?d.end:d.start,regionNumber:d.regionNumber}),p=n.bpToPx({refName:f.refName,coord:f.reversed?f.start:f.end,regionNumber:f.regionNumber}),g=Math.max(0,-i),h=[[g,Rr],[g+s+c.length*t.interRegionPaddingWidth/2,Rr],[p,0],[m,0]];return r.createElement("svg",{height:Rr,width:"100%",className:a.overviewSvg},h&&r.createElement("polygon",{points:h.toString(),fill:q.fade(u,.3),stroke:q.fade(u,.8)}))})),kt=x.observer((function(e){var t=e.model,n=e.scale,o=e.overview,a=yt(),i=t.dynamicBlocks,l=s.getSession(t).assemblyManager,c=mt(n,120,15),u=o.dynamicBlocks;if(!i.contentBlocks.length)return null;var d=i.contentBlocks[0],f=o.bpToPx({refName:d.refName,regionNumber:d.regionNumber,coord:d.reversed?d.end:d.start})||0,m=i.contentBlocks[i.contentBlocks.length-1],p=o.bpToPx({refName:m.refName,coord:m.reversed?m.start:m.end,regionNumber:m.regionNumber})||0;return r.createElement("div",{className:a.scaleBar},r.createElement("div",{className:a.scaleBarVisibleRegion,style:{width:p-f,left:f}}),u.map((function(e,t){var o,i=l.get(e.assemblyName);i&&(o=i.getRefNameColor(e.refName));for(var s=e.end-e.start,u=[],d=0;d<Math.floor(s/c.majorPitch);d++){var f=(d+1)*c.majorPitch;u.push(e.reversed?e.end-f:e.start+f)}return e instanceof E.ContentBlock?r.createElement("div",{key:"".concat(JSON.stringify(e),"-").concat(t),className:K(a.scaleBarContig,e.reversed?a.scaleBarContigReverse:a.scaleBarContigForward),style:{left:e.offsetPx,width:e.widthPx,borderColor:o}},r.createElement(z.Typography,{style:{color:o},className:a.scaleBarRefName},e.refName),u.map((function(t,i){return r.createElement(z.Typography,{key:"".concat(JSON.stringify(e),"-").concat(t,"-").concat(i),className:a.scaleBarLabel,variant:"body2",style:{left:(i+1)*c.majorPitch/n,pointerEvents:"none",color:o}},t.toLocaleString("en-US"))}))):r.createElement("div",{key:"".concat(JSON.stringify(e),"-").concat(t),className:a.scaleBarContig,style:{width:e.widthPx,left:e.offsetPx,backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"}})})))}));function xt(e){var t=e.model,n=e.children,o=yt(),a=t.width,i=t.displayedRegions,l=R.create({displayedRegions:JSON.parse(JSON.stringify(i)),interRegionPaddingWidth:0,minimumBlockWidth:t.minimumBlockWidth});return l.setVolatileWidth(a),l.showAllRegions(),i.length?r.createElement("div",null,r.createElement(vt,{model:t,overview:l,ControlComponent:r.createElement(kt,{model:t,overview:l,scale:t.totalBp/(a-2*(i.length-1))})}),r.createElement("div",{className:o.overview},r.createElement(bt,{model:t,overview:l}),n)):r.createElement(r.Fragment,null,r.createElement("div",{className:o.scaleBar},r.createElement(Z,{variant:"indeterminate",style:{marginTop:4,width:"100%"}})),r.createElement("div",null,n))}var wt=x.observer(xt),Et=k.makeStyles({container:{display:"flex",flexDirection:"row",alignItems:"center"},slider:{width:70}});function St(e){var n=e.model,o=Et(),a=n.maxBpPerPx,i=n.minBpPerPx,l=n.bpPerPx,c=n.scaleFactor,s=Re(t.useState(100*-Math.log2(l)),2),u=s[0],d=s[1];return t.useEffect((function(){d(100*-Math.log2(l))}),[d,l]),r.createElement("div",{className:o.container},r.createElement(ee,{"data-testid":"zoom_out",onClick:function(){n.zoom(2*l)},disabled:l>=a-1e-4||1!==c,color:"secondary"},r.createElement(ne,null)),r.createElement(te,{className:o.slider,value:u,min:100*-Math.log2(a),max:100*-Math.log2(i),onChange:function(e,t){return d(t)},onChangeCommitted:function(){return n.zoomTo(Math.pow(2,-u/100))},disabled:1!==c}),r.createElement(ee,{"data-testid":"zoom_in",onClick:function(){n.zoom(n.bpPerPx/2)},disabled:l<=i+1e-4||1!==c,color:"secondary"},r.createElement(re,null)))}var Ct=x.observer(St),Pt=k.makeStyles((function(e){return{headerBar:{height:Rr,display:"flex"},headerForm:{flexWrap:"nowrap",marginRight:7},spacer:{flexGrow:1},input:{},headerRefName:{minWidth:100},panButton:{background:q.fade(e.palette.background.paper,.8),height:32,margin:7},bp:{display:"flex",alignItems:"center",marginLeft:5},toggleButton:{height:44,border:"none",margin:e.spacing(.5)},buttonSpacer:{marginRight:e.spacing(2)}}})),Tt=x.observer((function(e){var t=e.model,n=Pt();return r.createElement(p,{onClick:t.activateTrackSelector,className:n.toggleButton,title:"Open track selector",value:"track_select",color:"secondary"},r.createElement(N.TrackSelector,{className:n.buttonSpacer}))}));function Bt(e){var t=e.model,n=Pt();return r.createElement(r.Fragment,null,r.createElement(p,{variant:"outlined",className:n.panButton,onClick:function(){return t.slide(-.9)}},r.createElement(W,null)),r.createElement(p,{variant:"outlined",className:n.panButton,onClick:function(){return t.slide(.9)}},r.createElement(H,null)))}var Rt=x.observer((function(e){var t=e.model,n=Pt();return r.createElement(g,{variant:"body2",color:"textSecondary",className:n.bp},"".concat(Math.round(t.coarseTotalBp).toLocaleString("en-US")," bp"))})),Nt=x.observer((function(e){var t=e.model,n=Pt(),o=k.useTheme(),a=s.getSession(t),i=a.assemblyManager,l=y.getEnv(a).pluginManager.rootModel.textSearchManager,c=t.displayedRegions,u=t.rankSearchResults,d=t.coarseDynamicBlocks[0]||{refName:""},f=d.assemblyName,m=d.refName,p=f&&i.get(f),g=p&&p.regions||[],h=t.searchScope(f);function v(){return(v=be(Fe.mark((function e(r){var n,o,i;return Fe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=15;break}if(n=r.getLocation(),!(o=g.find((function(e){return n===e.refName})))){e.next=8;break}t.setDisplayedRegions([o]),t.showAllRegions(),e.next=15;break;case 8:return e.next=10,null==l?void 0:l.search({queryString:n.toLocaleLowerCase(),searchType:"exact"},h,u);case 10:if(e.t0=e.sent,e.t0){e.next=13;break}e.t0=[];case 13:if((i=e.t0).length>0)t.setSearchResults(i,n.toLocaleLowerCase());else try{""!==n&&t.navToLocString(n)}catch(e){"".concat(e)==='Error: Unknown reference sequence "'.concat(n,'"')?t.setSearchResults(i,n.toLocaleLowerCase()):(console.warn(e),a.notify("".concat(e),"warning"))}case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var b=r.createElement("div",{className:n.headerBar},r.createElement(Tt,{model:t}),r.createElement("div",{className:n.spacer}),r.createElement(A,{row:!0,className:n.headerForm},r.createElement(Bt,{model:t}),r.createElement(ft,{onSelect:function(e){return v.apply(this,arguments)},assemblyName:f,value:c.length>1?"":m,model:t,TextFieldProps:{variant:"outlined",className:n.headerRefName,style:{margin:7,minWidth:"175px"},InputProps:{style:{padding:0,height:32,background:q.fade(o.palette.background.paper,.8)}}}})),r.createElement(Rt,{model:t}),r.createElement(Ct,{model:t}),r.createElement("div",{className:n.spacer}));return t.hideHeaderOverview?b:r.createElement(wt,{model:t},b)})),Mt=k.makeStyles((function(e){return{root:{background:q.fade(e.palette.background.paper,.8),"&:hover":{background:e.palette.background.paper},transition:e.transitions.create(["background"],{duration:e.transitions.duration.shortest})},trackName:{margin:"0 auto",width:"90%",fontSize:"0.8rem",pointerEvents:"none"},dragHandle:{cursor:"grab",color:"#135560"},dragHandleIcon:{display:"inline-block",verticalAlign:"middle",pointerEvents:"none"},iconButton:{padding:e.spacing(1)}}})),Lt=x.observer(r.forwardRef((function(e,t){var o=Mt(),a=Re(r.useState(null),2),i=a[0],l=a[1],c=e.track,u=e.className,d=s.getContainingView(c),f=s.getSession(c),m=c.configuration,p=n.getConf(c,"trackId"),h=function(){l(null)},v=n.getConf(c,"name");return"ReferenceSequenceTrack"===n.getConf(c,"type")&&(v="Reference Sequence",f.assemblies.forEach((function(e){e.sequence===m&&(v="Reference Sequence (".concat(n.readConfObject(e,"name"),")"))}))),r.createElement(r.Fragment,null,r.createElement(oe,{ref:t,className:K(u,o.root)},r.createElement("span",{draggable:!0,className:o.dragHandle,onDragStart:function(e){var t=e.target;t.parentNode&&(e.dataTransfer.setDragImage(t.parentNode,20,20),d.setDraggingTrackId(c.id))},onDragEnd:function(){d.setDraggingTrackId(void 0)},"data-testid":"dragHandle-".concat(d.id,"-").concat(p)},r.createElement(ie,{className:o.dragHandleIcon})),r.createElement(ee,{onClick:function(){return d.hideTrack(p)},className:o.iconButton,title:"close this track",color:"secondary"},r.createElement(le,null)),r.createElement(g,{variant:"body1",component:"span",className:o.trackName},v),r.createElement(ee,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){l(e.currentTarget)},className:o.iconButton,color:"secondary","data-testid":"track_menu_icon",disabled:!c.trackMenuItems.length},r.createElement(ae,null))),r.createElement(b.Menu,{anchorEl:i,onMenuItemClick:function(e,t){t(),h()},open:Boolean(i),onClose:h,menuItems:[].concat(Ne(f.getTrackActionMenuItems?f.getTrackActionMenuItems(m):[]),Ne(c.trackMenuItems)).sort((function(e,t){return(t.priority||0)-(e.priority||0)}))}))}))),It=k.makeStyles((function(e){return{root:{},resizeHandle:{height:Lr,boxSizing:"border-box",position:"relative",zIndex:2},overlay:{pointerEvents:"none",position:"absolute",top:0,left:0,width:"100%",zIndex:3,borderRadius:e.shape.borderRadius},renderingComponentContainer:{position:"absolute",left:-1,height:"100%",width:"100%"},trackLabel:{zIndex:3,margin:e.spacing(1)},trackLabelInline:{position:"relative",display:"inline-block"},trackLabelOverlap:{position:"absolute"},trackRenderingContainer:{overflowY:"auto",overflowX:"hidden",whiteSpace:"nowrap",position:"relative",background:"none",zIndex:2,boxSizing:"content-box"}}}));function Dt(e){var o=It(),a=e.model,i=e.track,l=i.displays[0],c=a.horizontalScroll,u=a.draggingTrackId,d=a.moveTrack,f=l.height,m=s.getContainingView(l),p=n.getConf(i,"trackId"),g=t.useRef(null);t.useEffect((function(){return g.current&&(a.trackRefs[p]=g.current),function(){delete a.trackRefs[p]}}),[a.trackRefs,p]);var h=s.useDebouncedCallback((function(){void 0!==u&&y.isAlive(l)&&u!==l.id&&d(u,i.id)}),100),v=l.RenderingComponent,k=l.DisplayBlurb,x=void 0!==u&&u!==l.id;return r.createElement("div",{className:o.root},"hidden"!==m.trackLabels?r.createElement(Lt,{track:i,className:K(o.trackLabel,"overlapping"===m.trackLabels?o.trackLabelOverlap:o.trackLabelInline)}):null,r.createElement(oe,{variant:"outlined",className:o.trackRenderingContainer,style:{height:f},onScroll:function(e){l.setScrollTop(e.target.scrollTop)},onDragEnter:h,"data-testid":"trackRenderingContainer-".concat(m.id,"-").concat(p),role:"presentation"},r.createElement("div",{ref:g,className:o.renderingComponentContainer,style:{transform:"scaleX(".concat(a.scaleFactor,")")}},r.createElement(v,{model:l,blockState:{},onHorizontalScroll:c})),k?r.createElement("div",{style:{position:"absolute",left:0,top:l.height-20}}," ",r.createElement(k,{model:l})):null),r.createElement("div",{className:o.overlay,style:{height:l.height,background:x?"rgba(0, 0, 0, 0.4)":void 0},onDragEnter:h}),r.createElement(b.ResizeHandle,{onDrag:l.resizeHeight,className:o.resizeHandle}))}var Ot=x.observer(Dt),Ft=k.makeStyles((function(e){return{rubberBand:{height:"100%",background:q.fade(e.palette.tertiary?e.palette.tertiary.main:e.palette.primary.main,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberBandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberBandText:{color:e.palette.tertiary?e.palette.tertiary.contrastText:e.palette.primary.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}}})),jt=x.observer((function(e){var t=e.model,n=e.coordX,o=Ft();return r.createElement(w,{open:!0,placement:"top",title:s.stringify(t.pxToBp(n)),arrow:!0},r.createElement("div",{className:o.guide,style:{left:n,background:"red"}}))}));function zt(e){var n=e.model,o=e.ControlComponent,a=void 0===o?r.createElement("div",null):o,i=Re(t.useState(),2),l=i[0],c=i[1],u=Re(t.useState(),2),d=u[0],f=u[1],m=Re(t.useState(),2),p=m[0],v=m[1],y=Re(t.useState(),2),k=y[0],x=y[1],w=t.useRef(null),E=t.useRef(null),S=Ft(),C=void 0!==l&&void 0===p;function P(e){e.preventDefault(),e.stopPropagation();var t=e.clientX-e.target.getBoundingClientRect().left;c(t),f(t)}function T(e){x(e.clientX-e.target.getBoundingClientRect().left)}function B(){x(void 0),n.setOffsets(void 0,void 0)}function R(){v(void 0),c(void 0),f(void 0)}t.useEffect((function(){function e(e){if(w.current&&C){var t=e.clientX-w.current.getBoundingClientRect().left;f(t)}}function t(e){if(void 0!==l&&w.current){var t=e.clientX,r=e.clientY,n=t-w.current.getBoundingClientRect().left;v({offsetX:n,clientX:t,clientY:r}),x(void 0)}}return C?(window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),function(){window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}):function(){}}),[l,C,p]),t.useEffect((function(){!C&&void 0!==d&&void 0!==l&&Math.abs(d-l)<=3&&R()}),[C,d,l,n.bpPerPx]);var N=Boolean(p),M=[{label:"Zoom to region",icon:re,onClick:function(){!function(){if(void 0!==l&&void 0!==p){var e=l,t=p.offsetX;if(t<e){var r=[t,e];e=r[0],t=r[1]}var o=n.pxToBp(e),a=n.pxToBp(t);n.moveTo(o,a)}}(),R()}},{label:"Get sequence",disabled:void 0!==d&&void 0!==l&&Math.abs(d-l)*n.bpPerPx>5e8,icon:h,onClick:function(){!function(){if(void 0!==l&&void 0!==p){var e=l,t=p.offsetX;if(t<e){var r=[t,e];e=r[0],t=r[1]}var o=n.pxToBp(e),a=n.pxToBp(t);n.setOffsets(o,a)}}(),R()}}];if(void 0===l)return r.createElement(r.Fragment,null,void 0!==k?r.createElement(jt,{model:n,coordX:k}):null,r.createElement("div",{"data-testid":"rubberBand_controls",className:S.rubberBandControl,role:"presentation",ref:w,onMouseDown:P,onMouseOut:B,onMouseMove:T},a));var L=p?p.offsetX:d||0,I=L<l?L:l,D=Math.abs(L-l),O=n.pxToBp(I),F=n.pxToBp(I+D),j=Math.ceil(D*n.bpPerPx);return r.createElement(r.Fragment,null,E.current?r.createElement(r.Fragment,null,r.createElement(Q,{className:S.popover,classes:{paper:S.paper},open:!0,anchorEl:E.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0},r.createElement(g,null,s.stringify(O))),r.createElement(Q,{className:S.popover,classes:{paper:S.paper},open:!0,anchorEl:E.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0},r.createElement(g,null,s.stringify(F)))):null,r.createElement("div",{ref:E,className:S.rubberBand,style:{left:I,width:D}},r.createElement(g,{variant:"h6",className:S.rubberBandText},j.toLocaleString("en-US")," bp")),r.createElement("div",{"data-testid":"rubberBand_controls",className:S.rubberBandControl,role:"presentation",ref:w,onMouseDown:P,onMouseOut:B,onMouseMove:T},a),p?r.createElement(b.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:p.clientX,top:p.clientY},onMenuItemClick:function(e,t){t(),R()},open:N,onClose:R,menuItems:M}):null)}zt.propTypes={model:x.PropTypes.objectOrObservableObject.isRequired,ControlComponent:$.node},zt.defaultProps={ControlComponent:r.createElement("div",null)};var qt=x.observer(zt),At=k.makeStyles((function(e){return{scaleBarContainer:{overflow:"hidden",position:"relative"},scaleBarZoomContainer:{position:"relative",zIndex:1},scaleBar:{position:"absolute",display:"flex",pointerEvents:"none"},majorTickLabel:{fontSize:"11px",zIndex:1,background:e.palette.background.paper,lineHeight:"normal",pointerEvents:"none"},tick:{position:"absolute",width:0,display:"flex",justifyContent:"center",pointerEvents:"none"},refLabel:{fontSize:"11px",position:"absolute",left:"2px",top:"-1px",fontWeight:"bold",lineHeight:"normal",zIndex:1,pointerEvents:"none",background:e.palette.background.paper}}})),Ht=x.observer((function(e){var t=e.model,n=At(),o=0;return t.staticBlocks.forEach((function(e,r){e.offsetPx-t.offsetPx<0&&(o=r)})),r.createElement(r.Fragment,null,t.staticBlocks.map((function(e,a){return e instanceof E.ContentBlock&&(e.isLeftEndOfDisplayedRegion||a===o)?r.createElement(g,{key:"refLabel-".concat(e.key,"-").concat(a),style:{left:a===o?Math.max(0,-t.offsetPx):e.offsetPx-t.offsetPx-1,paddingLeft:a===o?0:1},className:n.refLabel,"data-testid":"refLabel-".concat(e.refName)},e.refName):null})))})),Wt=x.observer((function(e){var t=e.model,n=At();return r.createElement(r.Fragment,null,t.staticBlocks.map((function(e,o){if(e instanceof E.ContentBlock){var a=pt(e.start,e.end,t.bpPerPx,!0,!1);return r.createElement(ze,{key:"".concat(e.key,"-").concat(o),block:e},a.map((function(o){if("major"===o.type){var a=(e.reversed?e.end-o.base:o.base-e.start)/t.bpPerPx,i=(o.base+1).toLocaleString("en-US");return r.createElement("div",{key:o.base,className:n.tick,style:{left:a}},i?r.createElement(g,{className:n.majorTickLabel},i):null)}return null})))}return e instanceof E.ElidedBlock?r.createElement(qe,{key:e.key,width:e.widthPx}):e instanceof E.InterRegionPaddingBlock?r.createElement(Ae,{key:e.key,width:e.widthPx,style:{background:"none"},boundary:"boundary"===e.variant}):null})))})),Vt=x.observer(r.forwardRef((function(e,t){var n=e.model,o=e.style,a=e.className,i=Pe(e,["model","style","className"]),l=At(),c=n.staticBlocks.offsetPx-n.offsetPx;return r.createElement(oe,Object.assign({"data-resizer":"true",className:K(l.scaleBarContainer,a),variant:"outlined",ref:t,style:o},i),r.createElement("div",{className:l.scaleBarZoomContainer,style:{transform:1!==n.scaleFactor?"scaleX(".concat(n.scaleFactor,")"):void 0}},r.createElement("div",{className:l.scaleBar,style:Ee({left:c-1,width:n.staticBlocks.totalWidthPx},o)},r.createElement(Wt,{model:n}))),r.createElement(Ht,{model:n}))}))),_t=k.makeStyles((function(e){return{verticalGuidesZoomContainer:{position:"absolute",height:"100%",width:"100%",zIndex:1,pointerEvents:"none"},verticalGuidesContainer:{position:"absolute",height:"100%",zIndex:1,pointerEvents:"none",display:"flex"},tick:{position:"absolute",height:"100%",width:1},majorTick:{background:e.palette.text.hint},minorTick:{background:e.palette.divider}}})),Gt=x.observer((function(e){var t=e.model,n=_t();return r.createElement(r.Fragment,null,t.staticBlocks.map((function(e,o){if(e instanceof E.ContentBlock){var a=pt(e.start,e.end,t.bpPerPx);return r.createElement(ze,{key:"".concat(e.key,"-").concat(o),block:e},a.map((function(o){var a=(e.reversed?e.end-o.base:o.base-e.start)/t.bpPerPx;return r.createElement("div",{key:o.base,className:K(n.tick,"major"===o.type||"labeledMajor"===o.type?n.majorTick:n.minorTick),style:{left:a}})})))}return e instanceof E.ElidedBlock?r.createElement(qe,{key:e.key,width:e.widthPx}):e instanceof E.InterRegionPaddingBlock?r.createElement(Ae,{key:e.key,width:e.widthPx,boundary:"boundary"===e.variant}):null})))}));function Xt(e){var t=e.model,n=_t(),o=t.staticBlocks.offsetPx-t.offsetPx;return r.createElement("div",{className:n.verticalGuidesZoomContainer,style:{transform:1!==t.scaleFactor?"scaleX(".concat(t.scaleFactor,")"):void 0}},r.createElement("div",{className:n.verticalGuidesContainer,style:{left:o,width:t.staticBlocks.totalWidthPx}},r.createElement(Gt,{model:t})))}var Ut=x.observer(Xt),Jt=k.makeStyles((function(){return{centerLineContainer:{background:"transparent",height:"100%",zIndex:5,position:"absolute",border:"1px black dashed",borderTop:"none",borderBottom:"none",pointerEvents:"none"},centerLineText:{position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",fontWeight:"bold"}}}));function Yt(e){var n=e.model,o=n.bpPerPx,a=n.centerLineInfo,i=n.trackHeights,l=n.tracks,c=n.width,s=t.useRef(null),u=Jt();return l.length?r.createElement("div",{"data-testid":"centerline_container",className:u.centerLineContainer,role:"presentation",ref:s,style:{left:"".concat(c/2,"px"),width:Math.max(1/o,1)}},a&&r.createElement("div",{"data-testid":"centerline_text",className:u.centerLineText,role:"presentation",style:{left:Math.max(1/o,1)+5,top:i}},a.refName,":"," ",Math.max(Math.round(a.offset)+1,0))):null}Yt.propTypes={model:x.PropTypes.objectOrObservableObject.isRequired};var Zt=x.observer(Yt),Kt=k.makeStyles((function(e){return{tracksContainer:{position:"relative",borderRadius:e.shape.borderRadius,overflow:"hidden"},spacer:{position:"relative",height:Lr}}}));function Qt(e){var n=e.children,o=e.model,a=Kt(),i=t.useRef(0),l=t.useRef(!1),c=t.useRef(),s=t.useRef(null),u=t.useRef(0),d=Re(t.useState(!1),2),f=d[0],m=d[1];return t.useEffect((function(){var e=function(){};function t(e){e.preventDefault();var t=e.clientX-u.current;t&&(l.current||(l.current=!0,window.requestAnimationFrame((function(){o.horizontalScroll(-t),l.current=!1,u.current=e.clientX}))))}function r(){u.current=0,f&&m(!1)}return f&&(window.addEventListener("mousemove",t,!0),window.addEventListener("mouseup",r,!0),e=function(){window.removeEventListener("mousemove",t,!0),window.removeEventListener("mouseup",r,!0)}),e}),[o,f,u]),t.useEffect((function(){var e=s.current;function t(e){var t=ce(e);!0===e.ctrlKey?(e.preventDefault(),i.current+=t.pixelY/500,o.setScaleFactor(i.current<0?1-i.current:1/(1+i.current)),c.current&&clearTimeout(c.current),c.current=setTimeout((function(){o.setScaleFactor(1),o.zoomTo(i.current>0?o.bpPerPx*(1+i.current):o.bpPerPx/(1-i.current)),i.current=0}),300)):(Math.abs(t.pixelX)>Math.abs(2*t.pixelY)&&e.preventDefault(),i.current+=t.pixelX,l.current||(l.current=!0,window.requestAnimationFrame((function(){o.horizontalScroll(i.current),i.current=0,l.current=!1}))))}return e?(e.addEventListener("wheel",t),function(){e.removeEventListener("wheel",t)}):function(){}}),[o]),r.createElement("div",{ref:s,role:"presentation",className:a.tracksContainer,onMouseDown:function(e){var t=e.target;t.draggable||t.dataset.resizer||0===e.button&&(u.current=e.clientX,m(!0))},onMouseUp:function(e){e.preventDefault(),m(!1)},onMouseLeave:function(e){e.preventDefault()}},r.createElement(Ut,{model:o}),o.showCenterLine?r.createElement(Zt,{model:o}):null,r.createElement(qt,{model:o,ControlComponent:r.createElement(Vt,{model:o,style:{height:Mr,boxSizing:"border-box"}})}),r.createElement("div",{className:a.spacer}),n)}var $t=x.observer(Qt),er=k.makeStyles((function(e){return{dialogContent:{width:"80em"},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function tr(e){var t,n,o=e.model,a=e.optAssemblyName,i=e.handleClose,l=er(),c=s.getSession(o),u=y.getEnv(c).pluginManager,d=c.assemblyManager,f=a;if(o.displayedRegions.length>0&&(f=null===(n=o.displayedRegions[0])||void 0===n?void 0:n.assemblyName),!f)throw new Error("Assembly name not found");var m=d.get(f);if(!m)throw new Error("assembly ".concat(f," not found"));if(!m.regions)throw new Error("assembly ".concat(f," regions not loaded"));var p=m.regions;function g(e){try{var t=p.find((function(t){return e===t.refName}));t?(o.setDisplayedRegions([t]),o.showAllRegions()):o.navToLocString(e,f)}catch(e){console.warn(e),c.notify("".concat(e),"warning")}}function h(e){if(e){var t,r=u.pluggableConfigSchemaType("track"),n=y.resolveIdentifier(r,y.getRoot(o),e);if(n)return null===(t=n.name)||void 0===t?void 0:t.value}return""}return r.createElement(z.Dialog,{open:!0,maxWidth:"xl",onClose:i},r.createElement(z.DialogTitle,{id:"search-results-dialog"},"Search Results",i?r.createElement(z.IconButton,{"data-testid":"close-resultsDialog",className:l.closeButton,onClick:function(){i()}},r.createElement(le,null)):null),r.createElement(z.Divider,null),r.createElement(z.DialogContent,null,0===(null===(t=o.searchResults)||void 0===t?void 0:t.length)||void 0===o.searchResults?r.createElement(z.Typography,null,"No results found for ",r.createElement("b",null,o.searchQuery)):r.createElement(r.Fragment,null,r.createElement(z.DialogContentText,{id:"alert-dialog-slide-description"},"Showing results for ",r.createElement("b",null,o.searchQuery)),r.createElement(z.TableContainer,{component:z.Paper},r.createElement(z.Table,null,r.createElement(z.TableHead,null,r.createElement(z.TableRow,null,r.createElement(z.TableCell,null,"Name"),r.createElement(z.TableCell,{align:"right"},"Location"),r.createElement(z.TableCell,{align:"right"},"Track"),r.createElement(z.TableCell,{align:"right"}))),r.createElement(z.TableBody,null,o.searchResults.map((function(e,t){return r.createElement(z.TableRow,{key:"".concat(e.getLabel(),"-").concat(t)},r.createElement(z.TableCell,{component:"th",scope:"row"},e.getLabel()),r.createElement(z.TableCell,{align:"right"},e.getLocation()),r.createElement(z.TableCell,{align:"right"},h(e.getTrackId())||"N/A"),r.createElement(z.TableCell,{align:"right"},r.createElement(z.Button,{onClick:function(){g(e.getLocation()),i()},color:"primary",variant:"contained"},"Go to location")),r.createElement(z.TableCell,{align:"right"},r.createElement(z.Button,{onClick:function(){g(e.getLocation());var t=e.getTrackId();t&&function(e){var t=u.pluggableConfigSchemaType("track"),r=y.resolveIdentifier(t,y.getRoot(o),e);0===o.tracks.filter((function(e){return e.configuration===r})).length&&o.showTrack(e)}(t),i()},disabled:!h(e.getTrackId()),color:"primary",variant:"contained"},"Show Track")))}))))))),r.createElement(z.Divider,null),r.createElement(z.DialogActions,null,r.createElement(z.Button,{onClick:function(){i()},color:"primary"},"Cancel")))}var rr=k.makeStyles((function(e){return{importFormContainer:{padding:e.spacing(2)},importFormEntry:{minWidth:180},button:{margin:e.spacing(2)}}})),nr=x.observer((function(e){var n=e.model,o=rr(),a=s.getSession(n),i=a.assemblyNames,l=a.assemblyManager,c=y.getEnv(a).pluginManager.rootModel.textSearchManager,u=n.rankSearchResults,d=Re(t.useState(0),2),f=d[0],m=d[1],g=Re(t.useState(void 0),2),h=g[0],v=g[1],b=Re(t.useState([]),2),k=b[0],x=b[1],w=i.length?"":"No configured assemblies",E=Boolean(w),S=i[f],C=S&&!w?f:"",P=n.searchScope(S);function T(e){return B.apply(this,arguments)}function B(){return(B=be(Fe.mark((function e(t){var r,o;return Fe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=k.find((function(e){return h===e.refName})))){e.next=6;break}n.setDisplayedRegions([r]),n.showAllRegions(),e.next=13;break;case 6:return e.next=8,null==c?void 0:c.search({queryString:t.toLocaleLowerCase(),searchType:"exact"},P,u);case 8:if(e.t0=e.sent,e.t0){e.next=11;break}e.t0=[];case 11:if((o=e.t0).length>0)n.setSearchResults(o,t.toLocaleLowerCase());else try{t&&n.navToLocString(t,S)}catch(e){"".concat(e)==='Error: Unknown reference sequence "'.concat(t,'"')?n.setSearchResults(o,t.toLocaleLowerCase()):(console.warn(e),a.notify("".concat(e),"warning"))}case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return t.useEffect((function(){var e=!1;return be(Fe.mark((function t(){var r,n;return Fe.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!S){t.next=5;break}return t.next=3,l.waitForAssembly(S);case 3:(r=t.sent)&&r.regions&&(n=r.regions,!e&&n&&(v(n[0].refName),x(n)));case 5:case"end":return t.stop()}}),t)})))(),function(){e=!0}}),[l,S]),r.createElement("div",null,n.isSearchDialogDisplayed?r.createElement(tr,{model:n,optAssemblyName:S,handleClose:function(){n.setSearchResults(void 0,void 0)}}):null,r.createElement(se,{className:o.importFormContainer},r.createElement(ue,{container:!0,spacing:1,justify:"center",alignItems:"center"},r.createElement(ue,{item:!0},r.createElement(X,{select:!0,variant:"outlined",value:C,onChange:function(e){m(Number(e.target.value))},label:"Assembly",helperText:w||"Select assembly to view",error:E,disabled:E,margin:"normal",className:o.importFormEntry},i.map((function(e,t){return r.createElement(de,{key:e,value:t},e)})))),r.createElement(ue,{item:!0},S?void 0!==h&&n.volatileWidth?r.createElement(ft,{model:n,assemblyName:w?void 0:i[f],value:h,onSelect:function(e){v(e.getLocation())},TextFieldProps:{margin:"normal",variant:"outlined",className:o.importFormEntry,helperText:"Enter a sequence or locstring",onBlur:function(e){""!==e.target.value&&v(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&T(e.target.value)}}}):r.createElement(G,{role:"progressbar",color:"inherit",size:20,disableShrink:!0}):null),r.createElement(ue,{item:!0},r.createElement(p,{disabled:!h,className:o.button,onClick:function(){h&&T(h)},variant:"contained",color:"primary"},"Open"),r.createElement(p,{disabled:!h,className:o.button,onClick:function(){n.showAllRegionsInAssembly(S)},variant:"contained",color:"secondary"},"Show all regions in assembly")))))})),or=x.observer((function(e){var n=e.model,o=n.bpPerPx,a=n.maxBpPerPx,i=n.minBpPerPx,l=n.scaleFactor,c=Re(t.useState(),2),s=c[0],u=c[1];return r.createElement(r.Fragment,null,r.createElement(oe,{style:{background:"#aaa7"}},r.createElement(ee,{color:"secondary",onClick:function(e){u(e.currentTarget)}},r.createElement(fe,null)),r.createElement(ee,{"data-testid":"zoom_out",onClick:function(){n.zoom(2*o)},disabled:o>=a-1e-4||1!==l,color:"secondary"},r.createElement(ne,null)),r.createElement(ee,{"data-testid":"zoom_in",onClick:function(){n.zoom(n.bpPerPx/2)},disabled:o<=i+1e-4||1!==l,color:"secondary"},r.createElement(re,null))),r.createElement(me,{anchorEl:s,open:Boolean(s),onMenuItemClick:function(e,t){t(),u(void 0)},onClose:function(){u(void 0)},menuItems:n.menuItems}))})),ar=k.makeStyles((function(e){return{loadingMessage:{padding:e.spacing(5)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},dialogContent:{width:"80em"},textAreaFont:{fontFamily:"Courier New"}}}));function ir(e,t){return lr.apply(this,arguments)}function lr(){return(lr=be(Fe.mark((function e(t,r){var o,a,i,l,c,u,d,f;return Fe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=s.getSession(t),c=(null===(o=t.leftOffset)||void 0===o?void 0:o.assemblyName)||(null===(a=t.rightOffset)||void 0===a?void 0:a.assemblyName)||"",u=l.rpcManager,d=null===(i=l.assemblyManager.get(c))||void 0===i?void 0:i.configuration,f=n.readConfObject(d,["sequence","adapter"]),e.next=8,Promise.all(r.map((function(e){return u.call("getSequence","CoreGetFeatures",{adapterConfig:f,region:e,sessionId:"getSequence"})})));case 8:return e.abrupt("return",e.sent.map((function(e){return e[0]})));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cr(e){var n=e.model,o=e.handleClose,a=ar(),i=s.getSession(n),l=Re(t.useState(),2),c=l[0],u=l[1],d=Re(t.useState(""),2),f=d[0],m=d[1],p=Boolean(!f)||Boolean(c),g=n.leftOffset,h=n.rightOffset,v=t.useMemo((function(){return n.getSelectedRegions(g,h)}),[n,g,h]);t.useEffect((function(){var e=!0;function t(e){var t=[],r=[];e.forEach((function(e){var n=e.get("seq"),o=e.get("refName"),a=e.get("start")+1,i=e.get("end"),l="".concat(o,":").concat(a,"-").concat(i);n&&(t.push({header:l,seq:n}),n.length!==i-a+1&&r.push("".concat(l," returned ").concat(n.length.toLocaleString()," bases, but should have returned ").concat((i-a).toLocaleString())))})),r.length>0&&i.notify("Unable to retrieve complete reference sequence from regions:".concat(r.join())),m(he.formatSeqFasta(t))}return be(Fe.mark((function r(){var o;return Fe.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!(v.length>0)){r.next=8;break}return r.next=4,ir(n,v);case 4:o=r.sent,e&&t(o),r.next=9;break;case 8:throw new Error("Selected region is out of bounds");case 9:r.next=15;break;case 11:r.prev=11,r.t0=r.catch(0),console.error(r.t0),e&&u(r.t0);case 15:case"end":return r.stop()}}),r,null,[[0,11]])})))(),function(){e=!1}}),[n,i,v,m]);var y=f.length>1e6;return r.createElement(z.Dialog,{"data-testid":"sequence-dialog",maxWidth:"xl",open:!0,onClose:o,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.createElement(z.DialogTitle,{id:"alert-dialog-title"},"Reference sequence",o?r.createElement(z.IconButton,{"data-testid":"close-seqDialog",className:a.closeButton,onClick:function(){o(),n.setOffsets(void 0,void 0)}},r.createElement(le,null)):null),r.createElement(z.Divider,null),r.createElement(z.DialogContent,null,c?r.createElement(z.Typography,{color:"error"},"".concat(c)):null,p&&!c?r.createElement(z.Container,null,"Retrieving reference sequence...",r.createElement(z.CircularProgress,{style:{marginLeft:10},size:20,disableShrink:!0})):null,void 0!==f?r.createElement(z.TextField,{"data-testid":"rubberband-sequence",variant:"outlined",multiline:!0,rows:3,rowsMax:5,disabled:y,className:a.dialogContent,fullWidth:!0,value:y?"Reference sequence too large to display, use the download FASTA button":f,InputProps:{readOnly:!0,classes:{input:a.textAreaFont}}}):null),r.createElement(z.DialogActions,null,r.createElement(z.Button,{onClick:function(){pe(f||""),i.notify("Copied to clipboard","success")},disabled:p||y,color:"primary",startIcon:r.createElement(N.ContentCopy,null)},"Copy to clipboard"),r.createElement(z.Button,{onClick:function(){var e=new Blob([f||""],{type:"text/x-fasta;charset=utf-8"});F.saveAs(e,"jbrowse_ref_seq.fa")},disabled:p,color:"primary",startIcon:r.createElement(ge,null)},"Download FASTA"),r.createElement(z.Button,{onClick:function(){o(),n.setOffsets(void 0,void 0)},color:"primary",autoFocus:!0},"Close")))}var sr=x.observer(cr),ur=k.makeStyles((function(){return{majorTickLabel:{fontSize:"11px"},majorTick:{stroke:"#555"},minorTick:{stroke:"#999"}}}));function dr(e){var t=e.start,n=e.end,o=e.bpPerPx,a=e.reversed,i=e.major,l=e.minor,c=ur(),s=pt(t,n,o,i,l);return r.createElement(r.Fragment,null,s.map((function(e){var i=(a?n-e.base:e.base-t)/o;return r.createElement("line",{key:e.base,x1:i,x2:i,y1:0,y2:"major"===e.type?6:4,strokeWidth:1,stroke:"major"===e.type?"#555":"#999",className:"major"===e.type?c.majorTick:c.minorTick,"data-bp":e.base})})),s.filter((function(e){return"major"===e.type})).map((function(e){return r.createElement("text",{x:(a?n-e.base:e.base-t)/o-3,y:18,key:"label-".concat(e.base),style:{fontSize:"11px"},className:c.majorTickLabel},function e(t){return t<999?String(t):"".concat(e(~~(t/1e3)),",").concat("00".concat(~~(t%1e3)).substr(-3,3))}(e.base+1))})))}dr.propTypes={start:$.number.isRequired,end:$.number.isRequired,bpPerPx:$.number.isRequired,reversed:$.bool,major:$.bool,minor:$.bool},dr.defaultProps={reversed:!1,major:!0,minor:!0};var fr=x.observer(dr),mr=z.makeStyles((function(e){return{errorMessage:{textAlign:"center",paddingTop:e.spacing(1),paddingBottom:e.spacing(1)},spacer:{marginRight:e.spacing(2)}}}));function pr(e){var t,n=e.model,o=e.fontSize,a=n.offsetPx,i=n.dynamicBlocks,l=i.totalWidthPxWithoutBorders,c=i.totalBp;t=Math.floor(c/1e6)>0?"".concat(parseFloat((c/1e6).toPrecision(3)),"Mbp"):Math.floor(c/1e3)>0?"".concat(parseFloat((c/1e3).toPrecision(3)),"Kbp"):"".concat(Math.floor(c),"bp");var s=Math.max(-a,0),u=s+l;return r.createElement(r.Fragment,null,r.createElement("line",{x1:s,x2:u,y1:10,y2:10,stroke:"black"}),r.createElement("line",{x1:s,x2:s,y1:5,y2:15,stroke:"black"}),r.createElement("line",{x1:u,x2:u,y1:5,y2:15,stroke:"black"}),r.createElement("text",{x:s+(u-s)/2,y:2*o,textAnchor:"middle",fontSize:o},t))}function gr(e){var t=e.model,n=e.fontSize,o=t.dynamicBlocks.contentBlocks,a=t.offsetPx,i=t.bpPerPx,l=o.length<5;return r.createElement(r.Fragment,null,r.createElement("defs",null,r.createElement("clipPath",{id:"clip-ruler"},r.createElement("rect",{x:0,y:0,width:e.width,height:20}))),o.map((function(e){var t=e.offsetPx-a;return r.createElement("g",{key:"".concat(e.key),transform:"translate(".concat(t," 0)")},r.createElement("text",{x:t/i,y:n,fontSize:n},e.refName),l?r.createElement("g",{transform:"translate(0 20)",clipPath:"url(#clip-ruler)"},r.createElement(fr,{start:e.start,end:e.end,bpPerPx:i,reversed:e.reversed})):r.createElement("line",{strokeWidth:1,stroke:"black",x1:e.start/i,x2:e.end/i,y1:20,y2:20}))})))}var hr=function(e){return e.reduce((function(e,t){return e+t.displays[0].height+20+20}),0)},vr=function(e){var t=e.model,n=t.width,o=t.assemblyNames;return r.createElement("g",{id:"header"},r.createElement("text",{x:0,y:15,fontSize:15},o.length>1?"":o[0]),r.createElement("g",{transform:"translate(0 ".concat(15,")")},r.createElement(pr,{model:t,fontSize:15})),r.createElement("g",{transform:"translate(0 ".concat(50,")")},r.createElement(gr,{model:t,fontSize:15,width:n})))},yr=function(e){var t=e.model,n=t.dynamicBlocks,o=hr(t.tracks);return r.createElement(r.Fragment,null,n.contentBlocks.slice(1).map((function(e){return r.createElement("line",{key:e.key,x1:e.offsetPx-t.offsetPx,x2:e.offsetPx-t.offsetPx,y1:110,y2:o,stroke:"black",strokeOpacity:.3})})))};function br(e){var t=e.model,o=e.offset;return r.createElement(r.Fragment,null,e.displayResults.map((function(e){var a=e.track,i=e.result,l=o,c=n.getConf(a,"name")||"Reference sequence (".concat(n.readConfObject(y.getParent(a.configuration),"name"),")");return o+=a.displays[0].height+20+20,r.createElement("g",{key:a.configuration.trackId,transform:"translate(0 ".concat(l,")")},r.createElement("text",{fontSize:15,x:Math.max(-t.offsetPx,0)},c),r.createElement("g",{transform:"translate(0 ".concat(20,")")},i))})))}function kr(e,t){return xr.apply(this,arguments)}function xr(){return(xr=be(Fe.mark((function e(t,n){var o,a,i,l,c,s;return Fe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.when((function(){return t.initialized}));case 2:return o=t.width,i=50,l=110,c=hr(a=t.tracks)+l,e.next=8,Promise.all(a.map(function(){var e=be(Fe.mark((function e(t){var r;return Fe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.displays[0],e.next=3,v.when((function(){return void 0===r.ready||r.ready}));case 3:return e.next=5,r.renderSvg(n);case 5:return e.abrupt("return",{track:t,result:e.sent});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return s=e.sent,e.abrupt("return",j.renderToStaticMarkup(r.createElement("svg",{width:o,height:c,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,o+2*i,c].toString()},r.createElement("rect",{width:o+2*i,height:c,fill:"white"}),r.createElement("g",{stroke:"none",transform:"translate(".concat(i," ").concat(15,")")},r.createElement(vr,{model:t}),r.createElement(br,{model:t,displayResults:s,offset:l}),r.createElement(yr,{model:t})))));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var wr={__proto__:null,default:x.observer((function(e){var t=e.model,n=t.tracks,o=t.error,a=t.hideHeader,i=t.initialized,l=t.hasDisplayedRegions,c=mr();return i?l?r.createElement("div",{style:{position:"relative"}},t.isSeqDialogDisplayed?r.createElement(sr,{model:t,handleClose:function(){t.setOffsets(void 0,void 0)}}):null,t.isSearchDialogDisplayed?r.createElement(tr,{model:t,handleClose:function(){t.setSearchResults(void 0,void 0)}}):null,a?r.createElement("div",{style:{position:"absolute",right:0,zIndex:1001}},r.createElement(or,{model:t})):r.createElement(Nt,{model:t}),o?r.createElement(z.Paper,{variant:"outlined",className:c.errorMessage},r.createElement(z.Typography,{color:"error"},o.message)):r.createElement(r.Fragment,null,r.createElement($t,{model:t},n.length?n.map((function(e){return r.createElement(Ot,{key:e.id,model:t,track:e})})):r.createElement(z.Paper,{variant:"outlined",className:c.errorMessage},r.createElement(z.Typography,null,"No tracks active."),r.createElement(z.Button,{variant:"contained",color:"primary",onClick:t.activateTrackSelector,style:{zIndex:1e3}},r.createElement(N.TrackSelector,{className:c.spacer}),"Open track selector"))))):r.createElement(nr,{model:t}):null})),renderToSvg:kr},Er=k.makeStyles((function(e){return{closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function Sr(e){var n,o=e.model,a=e.handleClose,i=Re(t.useState("undefined"!=typeof OffscreenCanvas),2),l=i[0],c=i[1],s=Re(t.useState(!1),2),u=s[0],d=s[1],f=Re(t.useState(),2),m=f[0],p=f[1],g=Er();return r.createElement(z.Dialog,{open:!0,onClose:a},r.createElement(z.DialogTitle,null,"Export SVG",r.createElement(z.IconButton,{className:g.closeButton,onClick:a},r.createElement(le,null))),r.createElement(z.DialogContent,null,m?r.createElement("div",{style:{color:"red"}},"".concat(m)):u?r.createElement("div",null,r.createElement(z.CircularProgress,{size:20,style:{marginRight:20}}),r.createElement(z.Typography,{display:"inline"},"Creating SVG")):null,"undefined"!=typeof OffscreenCanvas?r.createElement(z.FormControlLabel,{control:r.createElement(z.Checkbox,{checked:l,onChange:function(){return c((function(e){return!e}))}}),label:"Rasterize canvas based tracks? File may be much larger if this is turned off"}):r.createElement(z.Typography,null,"Note: rasterizing layers not yet supported in this browser, so SVG size may be large"),r.createElement(z.Button,{variant:"contained",color:"primary",type:"submit",onClick:(n=be(Fe.mark((function e(){return Fe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(!0),p(void 0),e.prev=2,e.next=5,o.exportSvg({rasterizeLayers:l});case 5:a(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),p(e.t0);case 11:return e.prev=11,d(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[2,8,11,14]])}))),function(){return n.apply(this,arguments)})},"Submit")))}var Cr=k.makeStyles((function(e){return{closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function Pr(e){var t=e.model,n=e.handleClose,o=Cr();return r.createElement(z.Dialog,{maxWidth:"xl",open:!0,onClose:n},r.createElement(z.DialogTitle,null,"Reference sequence",n?r.createElement(z.IconButton,{className:o.closeButton,onClick:function(){n()}},r.createElement(le,null)):null),r.createElement(z.Divider,null),r.createElement(z.DialogContent,null,r.createElement(z.Typography,null,"Are you sure you want to return to the import form? This will lose your current view")),r.createElement(z.DialogActions,null,r.createElement(z.Button,{onClick:function(){t.clearView(),n()},variant:"contained",color:"primary",autoFocus:!0},"OK"),r.createElement(z.Button,{onClick:function(){n()},color:"secondary",variant:"contained",autoFocus:!0},"Cancel")))}var Tr=x.observer(Pr);function Br(e){if(!e.length)return"";var t=e.every((function(t){return t.assemblyName===e[0].assemblyName}));return e.map((function(e){return s.assembleLocString(Ee(Ee({},e),{},{start:Math.round(e.start),end:Math.round(e.end),assemblyName:t?void 0:e.assemblyName}))})).join(";")}var Rr=48,Nr=20,Mr=17,Lr=3;function Ir(e){return y.types.compose(o.BaseViewModel,y.types.model("LinearGenomeView",{id:S.ElementId,type:y.types.literal("LinearGenomeView"),offsetPx:0,bpPerPx:1,displayedRegions:y.types.array(S.Region),tracks:y.types.array(e.pluggableMstType("track","stateModel")),hideHeader:!1,hideHeaderOverview:!1,trackSelectorType:y.types.optional(y.types.enumeration(["hierarchical"]),"hierarchical"),trackLabels:"overlapping",showCenterLine:!1})).volatile((function(){return{volatileWidth:void 0,minimumBlockWidth:3,draggingTrackId:void 0,error:void 0,afterDisplayedRegionsSetCallbacks:[],scaleFactor:1,trackRefs:{},coarseDynamicBlocks:[],coarseTotalBp:0,leftOffset:void 0,rightOffset:void 0,searchResults:void 0,searchQuery:void 0}})).views((function(e){return{get width(){if(void 0===e.volatileWidth)throw new Error("width undefined, make sure to check for model.initialized");return e.volatileWidth}}})).views((function(e){return{get initialized(){var t=s.getSession(e).assemblyManager,r=this.assemblyNames.every((function(e){var r;return null===(r=t.assemblyList)||void 0===r||!r.map((function(e){return e.name})).includes(e)||(t.get(e)||{}).initialized}));return void 0!==e.volatileWidth&&r},get hasDisplayedRegions(){return e.displayedRegions.length>0},get isSeqDialogDisplayed(){return e.leftOffset&&e.rightOffset},get isSearchDialogDisplayed(){return void 0!==e.searchResults},get scaleBarHeight(){return Mr+Lr},get headerHeight(){return e.hideHeader?0:e.hideHeaderOverview?Rr:Rr+Nr},get trackHeights(){return e.tracks.map((function(e){return e.displays[0].height})).reduce((function(e,t){return e+t}),0)},get trackHeightsWithResizeHandles(){return this.trackHeights+e.tracks.length*Lr},get height(){return this.trackHeightsWithResizeHandles+this.headerHeight+this.scaleBarHeight},get interRegionPaddingWidth(){return 2},get totalBp(){var t=0;return e.displayedRegions.forEach((function(e){t+=e.end-e.start})),t},get maxBpPerPx(){return this.totalBp/(.9*e.width)},get minBpPerPx(){return.02},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-e.width},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},get renderProps(){return Ee(Ee({},m.getParentRenderProps(e)),{},{bpPerPx:e.bpPerPx,highResolutionScaling:n.getConf(s.getSession(e),"highResolutionScaling")})},get assemblyNames(){return Ne(new Set(e.displayedRegions.map((function(e){return e.assemblyName}))))},searchScope:function(t){return{assemblyName:t,includeAggregateIndexes:!0,tracks:e.tracks}},bpToPx:function(t){var r=t.refName,n=t.coord,o=t.regionNumber,a=0,i=this.interRegionPaddingWidth*e.bpPerPx,l=e.minimumBlockWidth*e.bpPerPx,c=e.displayedRegions.findIndex((function(t,c){var s=t.end-t.start;return r===t.refName&&n>=t.start&&n<=t.end&&(!o||o===c)?(a+=t.reversed?t.end-n:n-t.start,!0):(a+=s>l&&a/e.bpPerPx>=0&&a/e.bpPerPx<e.width?s+i:s,!1)}));if(e.displayedRegions[c])return{index:c,offsetPx:Math.round(a/e.bpPerPx)}},pxToBp:function(t){var r=0,n=(e.offsetPx+t)*e.bpPerPx,o=e.displayedRegions.length;if(n<0){var a=e.displayedRegions[0],i=n;return Ee(Ee({},y.getSnapshot(a)),{},{oob:!0,coord:a.reversed?Math.floor(a.end-i)+1:Math.floor(a.start+i)+1,offset:i,index:0})}for(var l=this.interRegionPaddingWidth*e.bpPerPx,c=e.minimumBlockWidth*e.bpPerPx,s=0;s<e.displayedRegions.length;s+=1){var u=e.displayedRegions[s],d=u.end-u.start,f=n-r;if(d+r>n&&r<=n)return Ee(Ee({},y.getSnapshot(u)),{},{oob:!1,offset:f,coord:u.reversed?Math.floor(u.end-f)+1:Math.floor(u.start+f)+1,index:s});r+=u.end-u.start>c&&f/e.bpPerPx>0&&f/e.bpPerPx<e.width?d+l:d}if(n>=r){var m=e.displayedRegions[o-1],p=n-r+(m.end-m.start);return Ee(Ee({},y.getSnapshot(m)),{},{oob:!0,offset:p,coord:m.reversed?Math.floor(m.end-p)+1:Math.floor(m.start+p)+1,index:o-1})}return{coord:0,index:0,refName:"",oob:!0,assemblyName:"",offset:0,start:0,end:0,reversed:!1}},getTrack:function(t){return e.tracks.find((function(e){return e.configuration.trackId===t}))},rankSearchResults:function(t){var r=e.tracks.map((function(e){return e.configuration.trackId}));return t.forEach((function(e){r!==[]&&r.includes(e.trackId)&&e.updateScore(e.getScore()+1)})),t},rewriteOnClicks:function(t,r){var n=this;r.forEach((function(r){if("subMenu"in r&&n.rewriteOnClicks(t,r.subMenu),"onClick"in r){var o=r.onClick;r.onClick=function(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];e.tracks.forEach((function(e){e.type===t&&o.apply(e,[e].concat(n))}))}}}))},get trackTypeActions(){var t=this,r=new Map;return e.tracks.forEach((function(e){if(!r.get(e.type)){var n=O(e.viewMenuActions);t.rewriteOnClicks(e.type,n),r.set(e.type,n)}})),r},get centerLineInfo(){return e.displayedRegions.length?this.pxToBp(e.width/2):void 0}}})).actions((function(t){return{setWidth:function(e){t.volatileWidth=e},setError:function(e){t.error=e},toggleHeader:function(){t.hideHeader=!t.hideHeader},toggleHeaderOverview:function(){t.hideHeaderOverview=!t.hideHeaderOverview},scrollTo:function(e){var r=s.clamp(e,t.minOffset,t.maxOffset);return t.offsetPx=r,r},zoomTo:function(e){var r=s.clamp(e,t.minBpPerPx,t.maxBpPerPx);if(r===t.bpPerPx)return r;var n=t.bpPerPx;if(t.bpPerPx=r,Math.abs(n-r)<1e-6)return console.warn("zoomTo bpPerPx rounding error"),n;var o=t.width;return this.scrollTo(Math.round((t.offsetPx+o/2)*n/r-o/2)),r},setOffsets:function(e,r){t.leftOffset=e,t.rightOffset=r},setSearchResults:function(e,r){t.searchResults=e,t.searchQuery=r},setNewView:function(e,t){this.zoomTo(e),this.scrollTo(t)},horizontallyFlip:function(){t.displayedRegions=y.cast(t.displayedRegions.slice().reverse().map((function(e){return Ee(Ee({},e),{},{reversed:!e.reversed})}))),this.scrollTo(t.totalBp/t.bpPerPx-t.offsetPx-t.width)},showTrack:function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=e.pluggableConfigSchemaType("track"),i=y.resolveIdentifier(a,y.getRoot(t),r),l=e.getTrackType(i.type);if(!l)throw new Error("unknown track type ".concat(i.type));var c=e.getViewType(t.type),s=c.displayTypes.map((function(e){return e.name})),u=i.displays.find((function(e){return s.includes(e.type)}));if(!u)throw new Error("could not find a compatible display for view type ".concat(t.type));var d=l.stateModel.create(Ee(Ee({},n),{},{type:i.type,configuration:i,displays:[Ee({type:u.type,configuration:u},o)]}));return t.tracks.push(d),d},hideTrack:function(r){var n=e.pluggableConfigSchemaType("track"),o=y.resolveIdentifier(n,y.getRoot(t),r),a=t.tracks.filter((function(e){return e.configuration===o}));return v.transaction((function(){return a.forEach((function(e){return t.tracks.remove(e)}))})),a.length}}})).actions((function(e){return{moveTrack:function(t,r){var n=e.tracks.findIndex((function(e){return e.id===t}));if(-1===n)throw new Error("Track ID ".concat(t," not found"));var o=e.tracks.findIndex((function(e){return e.id===r}));if(-1===o)throw new Error("Track ID ".concat(r," not found"));var a=y.getSnapshot(e.tracks[n]);e.tracks.splice(n,1),e.tracks.splice(o,0,a)},closeView:function(){var t=s.getContainingView(e);t?s.isViewContainer(t)&&t.removeView(e):s.getSession(e).removeView(e)},toggleTrack:function(t){e.hideTrack(t)||e.showTrack(t)},setTrackLabels:function(t){e.trackLabels=t},toggleCenterLine:function(){e.showCenterLine=!e.showCenterLine},setDisplayedRegions:function(t){e.displayedRegions=y.cast(t),e.zoomTo(e.bpPerPx)},activateTrackSelector:function(){if("hierarchical"===e.trackSelectorType){var t=s.getSession(e);if(s.isSessionModelWithWidgets(t)){var r=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(r),r}}throw new Error("invalid track selector type ".concat(e.trackSelectorType))},navToLocString:function(t,r){var n=s.getSession(e).assemblyManager,o=n.isValidRefName,a=t.split(";");if(e.displayedRegions.length>1){var i=a.map((function(e){return s.parseLocString(e,o)}));this.navToMultiple(i)}else{var l=r,c="";0!==e.displayedRegions.length&&(l=e.displayedRegions[0].assemblyName,c=e.displayedRegions[0].refName);var u=l&&n.get(l);if(!u)throw new Error("Could not find assembly ".concat(l));var d=u.regions;if(!d)throw new Error("Regions for assembly ".concat(l," not yet loaded"));if(a.length>1)throw new Error("Navigating to multiple locations is not allowed when viewing a whole chromosome");var f=s.parseLocString(a[0],(function(e){return o(e,l)})),m=!1;if(f.assemblyName&&f.assemblyName!==l){var p=n.get(f.assemblyName);if(!p)throw new Error("Could not find assembly ".concat(f.assemblyName));u=p,m=!0;var g=p.regions;if(!g)throw new Error("Regions for assembly ".concat(f.assemblyName," not yet loaded"));d=g}var h=u.getCanonicalRefName(f.refName);if(!h)throw new Error("Could not find refName ".concat(f.refName," in ").concat(u.name));if(m||h!==c){var v=d.find((function(e){return e.refName===h}));if(!v)throw new Error("Could not find refName ".concat(f.refName," in ").concat(u.name));this.setDisplayedRegions([v])}var y=d.find((function(e){return e.refName===h}));if(y){var b,k,x=s.clamp(null!==(b=null==f?void 0:f.start)&&void 0!==b?b:0,0,y.end),w=s.clamp(null!==(k=null==f?void 0:f.end)&&void 0!==k?k:y.end,0,y.end);this.navTo(Ee(Ee({},f),{},{start:x,end:w}))}}},navTo:function(e){this.navToMultiple([e])},navToMultiple:function(t){var r=t[0],n=r.refName,o=r.start,a=r.end,i=r.assemblyName,l=void 0===i?e.assemblyNames[0]:i;if(void 0!==o&&void 0!==a&&o>a)throw new Error('start "'.concat(o+1,'" is greater than end "').concat(a,'"'));var c=s.getSession(e).assemblyManager.get(l);if(c){var u=c.getCanonicalRefName(n);u&&(n=u)}for(var d,f=o,m=a,p=!1,g=function(e){if(n===e.refName){if(p=!0,void 0===f&&(f=e.start),void 0===m&&(m=e.end),f>=e.start&&f<=e.end&&m<=e.end&&m>=e.start)return!0;f=o,m=a}return!1},h=s.findLastIndex(e.displayedRegions,g);d!==h;)try{var v=d;if(d=e.displayedRegions.slice(void 0===v?0:v+1).findIndex(g),void 0!==v&&(d+=v+1),!p)throw new Error('could not find a region with refName "'.concat(n,'"'));if(void 0===f)throw new Error('could not find a region with refName "'.concat(n,'" that contained an end position ').concat(m));if(void 0===m)throw new Error('could not find a region with refName "'.concat(n,'" that contained a start position ').concat(f+1));if(-1===d)throw new Error('could not find a region that completely contained "'.concat(s.assembleLocString(r),'"'));if(1===t.length){var y=e.displayedRegions[d];return void this.moveTo({index:d,offset:y.reversed?y.end-m:f-y.start},{index:d,offset:y.reversed?y.end-f:m-y.start})}for(var b=0,k=0,x=0;b<t.length;b++){var w=t[b],E=e.displayedRegions[d+b];if(k=w.start||E.start,x=w.end||E.end,w.refName!==E.refName)throw new Error("Entered location ".concat(s.assembleLocString(w)," does not match with displayed regions"));if(b>0&&!(E.reversed?x===E.end:k===E.start))throw new Error("".concat(E.reversed?"End":"Start"," of region ").concat(s.assembleLocString(w)," should be ").concat((E.reversed?E.end:E.start+1).toLocaleString("en-US"),", but it is not"));if(b!==t.length-1&&!(E.reversed?k===E.start:x===E.end))throw new Error("".concat(E.reversed?"Start":"End"," of region ").concat(s.assembleLocString(w)," should be ").concat((E.reversed?E.start+1:E.end).toLocaleString("en-US"),", but it is not"))}var S=e.displayedRegions[d],C=e.displayedRegions[d+(b-=1)];return void this.moveTo({index:d,offset:S.reversed?S.end-m:f-S.start},{index:d+b,offset:C.reversed?C.end-k:x-C.start})}catch(e){if(d===h)throw e}},zoomToDisplayedRegions:function(t,r){if(void 0!==t&&void 0!==r){if(t.refName===r.refName&&t.index===r.index&&r.offset<t.offset||t.index>r.index){var n=[r,t];t=n[0],r=n[1]}var o={start:t.start,end:t.end,index:t.index,offset:t.offset},a={start:r.start,end:r.end,index:r.index,offset:r.offset};o&&a?this.moveTo(o,a):s.getSession(e).notify("No regions found to navigate to","warning")}},getSelectedRegions:function(t,r){var n=R.create(Ee(Ee({},y.getSnapshot(e)),{},{interRegionPaddingWidth:e.interRegionPaddingWidth}));return n.setVolatileWidth(e.width),n.zoomToDisplayedRegions(t,r),n.dynamicBlocks.contentBlocks.map((function(e){return Ee(Ee({},e),{},{start:Math.floor(e.start),end:Math.ceil(e.end)})}))},afterDisplayedRegionsSet:function(t){e.afterDisplayedRegionsSetCallbacks.push(t)},moveTo:function(t,r){var n=0;if(t.index===r.index)n+=r.offset-t.offset;else{var o=e.displayedRegions[t.index];if(n+=o.end-o.start-t.offset,r.index-t.index>=2)for(var a=t.index+1;a<r.index;a+=1)n+=e.displayedRegions[a].end-e.displayedRegions[a].start;n+=r.offset}var i=n/(e.width-e.interRegionPaddingWidth*(r.index-t.index)),l=e.zoomTo(i),c=0;i<l&&(c=(l-i)*e.width/2);for(var s=-c,u=0;u<e.displayedRegions.length;u+=1){var d=e.displayedRegions[u];if(t.index===u){s+=t.offset;break}s+=d.end-d.start}e.scrollTo(Math.round(s/e.bpPerPx)+e.interRegionPaddingWidth*t.index)},horizontalScroll:function(t){var r=e.offsetPx;return e.scrollTo(e.offsetPx+t)-r},centerAt:function(t,r,n){var o=e.bpToPx({refName:r,coord:t,regionNumber:n});o&&e.scrollTo(Math.round(o.offsetPx-e.width/2))},center:function(){e.scrollTo(Math.round(e.totalBp/2/e.bpPerPx-e.width/2))},showAllRegions:function(){e.zoomTo(e.maxBpPerPx),this.center()},showAllRegionsInAssembly:function(t){var r=s.getSession(e),n=r.assemblyManager;if(!t){var o=Ne(new Set(e.displayedRegions.map((function(e){return e.assemblyName}))));if(o.length>1)return void r.notify("Can't perform this with multiple assemblies currently");t=Re(o,1)[0]}var a=n.get(t);if(a){var i=a.regions;i&&(this.setDisplayedRegions(i),e.zoomTo(e.maxBpPerPx),this.center())}},setDraggingTrackId:function(t){e.draggingTrackId=t},setScaleFactor:function(t){e.scaleFactor=t}}})).actions((function(e){var t=function(){};return{slide:function(r){var n=Re(s.springAnimate(e.offsetPx,e.offsetPx+e.width*r,e.scrollTo),2),o=n[0],a=n[1];t(),t=a,o()}}})).actions((function(e){var t=function(){};return{zoom:function(r){if(e.zoomTo(e.bpPerPx),!(r<e.bpPerPx&&e.bpPerPx===e.minBpPerPx||r>e.bpPerPx&&e.bpPerPx===e.maxBpPerPx)){var n=Re(s.springAnimate(1,e.bpPerPx/r,e.setScaleFactor,(function(){e.zoomTo(r),e.setScaleFactor(1)})),2),o=n[0],a=n[1];t(),t=a,o()}}}})).views((function(e){var t,r="";return{get menuItems(){var t,r=[{label:"Return to import form",onClick:function(){s.getSession(e).setDialogComponent(Tr,{model:e})},icon:D},{label:"Export SVG",onClick:function(){s.getSession(e).setDialogComponent(Sr,{model:e})}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:N.TrackSelector},{label:"Horizontally flip",icon:M,onClick:e.horizontallyFlip},{label:"Show all regions in assembly",icon:L,onClick:e.showAllRegionsInAssembly},{label:"Show center line",icon:L,type:"checkbox",checked:e.showCenterLine,onClick:e.toggleCenterLine},{type:"divider"},{label:"Show header",icon:L,type:"checkbox",checked:!e.hideHeader,onClick:e.toggleHeader},{label:"Show header overview",icon:L,type:"checkbox",checked:!e.hideHeaderOverview,onClick:e.toggleHeaderOverview,disabled:e.hideHeader},{label:"Track labels",icon:I,subMenu:[{label:"Overlapping",icon:L,type:"radio",checked:"overlapping"===e.trackLabels,onClick:function(){return e.setTrackLabels("overlapping")}},{label:"Offset",icon:L,type:"radio",checked:"offset"===e.trackLabels,onClick:function(){return e.setTrackLabels("offset")}},{label:"Hidden",icon:L,type:"radio",checked:"hidden"===e.trackLabels,onClick:function(){return e.setTrackLabels("hidden")}}]}],n=Ie(e.trackTypeActions.entries());try{for(n.s();!(t=n.n()).done;){var o=Re(t.value,2),a=o[1];a.length&&(r.push({type:"divider"},{type:"subHeader",label:o[0]}),a.forEach((function(e){r.push(e)})))}}catch(e){n.e(e)}finally{n.f()}return r},get staticBlocks(){var n=B(e),o=JSON.stringify(n);return r!==o&&(t=n,r=o),t},get dynamicBlocks(){return T(e)},get roundedDynamicBlocks(){return this.dynamicBlocks.contentBlocks.map((function(e){return Ee(Ee({},e),{},{start:Math.floor(e.start),end:Math.ceil(e.end)})}))},get visibleLocStrings(){return Br(this.dynamicBlocks.contentBlocks)},get coarseVisibleLocStrings(){return Br(e.coarseDynamicBlocks)}}})).actions((function(e){return{clearView:function(){e.setDisplayedRegions([]),e.tracks.clear(),e.scrollTo(0),e.zoomTo(10)},setCoarseDynamicBlocks:function(t){e.coarseDynamicBlocks=t.contentBlocks,e.coarseTotalBp=t.totalBp},afterAttach:function(){var t=this;y.addDisposer(e,v.autorun((function(){e.initialized&&t.setCoarseDynamicBlocks(e.dynamicBlocks)}),{delay:150}))}}})).actions((function(e){return{exportSvg:function(){var t=arguments;return be(Fe.mark((function r(){var n,o;return Fe.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.length>0&&void 0!==t[0]?t[0]:{},r.next=3,kr(e,n);case 3:o=new Blob([r.sent],{type:"image/svg+xml"}),F.saveAs(o,"image.svg");case 6:case"end":return r.stop()}}),r)})))()}}}))}var Dr=t.lazy((function(){return Promise.resolve().then((function(){return Ar}))})),Or=function(e){return y.types.compose("LinearBasicDisplay",ot,y.types.model({type:y.types.literal("LinearBasicDisplay"),trackShowLabels:y.types.maybe(y.types.boolean),trackDisplayMode:y.types.maybe(y.types.string),trackMaxHeight:y.types.maybe(y.types.number),configuration:n.ConfigurationReference(e)})).views((function(e){return{get rendererTypeName(){return n.getConf(e,["renderer","type"])},get showLabels(){var t=n.getConf(e,["renderer","showLabels"]);return void 0!==e.trackShowLabels?e.trackShowLabels:t},get maxHeight(){var t=n.getConf(e,["renderer","maxHeight"]);return void 0!==e.trackMaxHeight?e.trackMaxHeight:t},get displayMode(){var t=n.getConf(e,["renderer","displayMode"]);return void 0!==e.trackDisplayMode?e.trackDisplayMode:t},get rendererConfig(){var t=n.getConf(e,["renderer"])||{};return e.rendererType.configSchema.create(Ee(Ee({},t),{},{showLabels:this.showLabels,displayMode:this.displayMode,maxHeight:this.maxHeight}),y.getEnv(e))}}})).actions((function(e){return{toggleShowLabels:function(){e.trackShowLabels=!e.showLabels},setDisplayMode:function(t){e.trackDisplayMode=t},setMaxHeight:function(t){e.trackMaxHeight=t}}})).views((function(e){var t=e.trackMenuItems;return{get renderProps(){var t=e.rendererConfig;return Ee(Ee(Ee({},e.composedRenderProps),m.getParentRenderProps(e)),{},{config:t})},get trackMenuItems(){return[].concat(Ne(t),[{label:"Show labels",icon:L,type:"checkbox",checked:e.showLabels,onClick:function(){e.toggleShowLabels()}},{label:"Display mode",icon:L,subMenu:["compact","reducedRepresentation","normal","collapse"].map((function(t){return{label:t,onClick:function(){e.setDisplayMode(t)}}}))},{label:"Set max height",onClick:function(){s.getSession(e).setDialogComponent(Dr,{model:e})}}])}}}))};function Fr(e){return n.ConfigurationSchema("LinearBasicDisplay",{mouseover:{type:"string",description:"what to display in a given mouseover",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},renderer:e.pluggableConfigSchemaType("renderer"),maxDisplayedBpPerPx:{type:"number",description:"maximum bpPerPx that is displayed in the view",defaultValue:1e3}},{baseConfiguration:De,explicitlyTyped:!0})}var jr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ce(e,t)}(f,c);var r,d=Be(f);function f(){var e;return ke(this,f),(e=d.apply(this,arguments)).name="LinearGenomeViewPlugin",e.exports={BaseLinearDisplayComponent:Ue,BaseLinearDisplay:ot,baseLinearDisplayConfigSchema:De},e}return(r=[{key:"install",value:function(e){e.addTrackType((function(){var t=n.ConfigurationSchema("FeatureTrack",{},{baseConfiguration:o.createBaseTrackConfig(e),explicitIdentifier:"trackId"});return new a({name:"FeatureTrack",configSchema:t,stateModel:o.createBaseTrackModel(e,"FeatureTrack",t)})})),e.addTrackType((function(){var t=n.ConfigurationSchema("BasicTrack",{},{baseConfiguration:o.createBaseTrackConfig(e),explicitIdentifier:"trackId"});return new a({name:"BasicTrack",configSchema:t,stateModel:o.createBaseTrackModel(e,"BasicTrack",t)})})),e.addDisplayType((function(){var t=at(e);return new i({name:"LinearBareDisplay",configSchema:t,stateModel:it(t),trackType:"BasicTrack",viewType:"LinearGenomeView",ReactComponent:Ue})})),e.addDisplayType((function(){var t=Fr(e);return new i({name:"LinearBasicDisplay",configSchema:t,stateModel:Or(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:Ue})})),e.addViewType((function(){return new l({name:"LinearGenomeView",stateModel:Ir(e),ReactComponent:t.lazy((function(){return Promise.resolve().then((function(){return wr}))}))})}))}},{key:"configure",value:function(e){s.isAbstractMenuManager(e.rootModel)&&e.rootModel.appendToSubMenu(["File","Add"],{label:"Linear genome view",icon:u,onClick:function(e){e.addView("LinearGenomeView",{})}})}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(f.prototype,r),f}(),zr=z.makeStyles((function(e){return{root:{width:500},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},field:{margin:e.spacing(2)}}}));function qr(e){var n=e.model,o=e.handleClose,a=zr(),i=n.maxHeight,l=Re(t.useState("".concat(void 0===i?"":i)),2),c=l[0],s=l[1];return r.createElement(z.Dialog,{open:!0,onClose:o,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.createElement(z.DialogTitle,{id:"alert-dialog-title"},"Filter options",r.createElement(z.IconButton,{"aria-label":"close",className:a.closeButton,onClick:o},r.createElement(le,null))),r.createElement(z.DialogContent,null,r.createElement("div",{className:a.root},r.createElement(z.Typography,null,"Set max height for the track"),r.createElement(z.TextField,{value:c,onChange:function(e){s(e.target.value)},placeholder:"Enter max score"}),r.createElement(z.Button,{variant:"contained",color:"primary",type:"submit",style:{marginLeft:20},onClick:function(){n.setMaxHeight(""===c||Number.isNaN(+c)?void 0:+c),o()}},"Submit"))))}var Ar={__proto__:null,default:x.observer(qr)};exports.BaseLinearDisplay=ot,exports.BaseLinearDisplayComponent=Ue,exports.baseLinearDisplayConfigSchema=De,exports.default=jr,exports.linearBareDisplayConfigSchemaFactory=at,exports.linearBasicDisplayConfigSchemaFactory=Fr,exports.linearBasicDisplayModelFactory=Or,exports.renderToSvg=kr;
//# sourceMappingURL=plugin-linear-genome-view.cjs.production.min.js.map
