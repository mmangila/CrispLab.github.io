"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("@jbrowse/core/pluggableElementTypes/AdapterType")),r=e(require("@jbrowse/core/pluggableElementTypes/TrackType")),n=e(require("@jbrowse/core/Plugin")),o=require("@jbrowse/core/configuration"),a=require("@jbrowse/core/pluggableElementTypes/models"),i=e(require("@jbrowse/core/pluggableElementTypes/DisplayType")),l=e(require("@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType")),s=require("@jbrowse/core/util/offscreenCanvasUtils"),c=require("mobx-react"),u=require("react"),f=e(u),p=require("@jbrowse/core/ui"),d=require("@gmod/bbi"),g=require("@jbrowse/core/data_adapters/BaseAdapter"),y=require("@jbrowse/core/util/io"),h=require("@jbrowse/core/util/rxjs"),m=e(require("@jbrowse/core/util/simpleFeature")),v=require("rxjs/operators"),b=require("@jbrowse/core/util/stats"),w=require("@jbrowse/core/util"),S=require("d3-scale"),x=require("mobx-state-tree"),C=require("@jbrowse/plugin-linear-genome-view"),k=require("@jbrowse/core/util/tracks"),E=require("mobx"),T=require("react-d3-axis"),R=e(require("@material-ui/core/Tooltip")),M=require("@material-ui/core/styles"),O=e(require("color")),P=require("@jbrowse/core/data_adapters/dataAdapterCache"),j=e(require("@jbrowse/core/pluggableElementTypes/RpcMethodType")),L=e(require("@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain")),N=e(require("@material-ui/core/Button")),A=e(require("@material-ui/core/TextField")),_=e(require("@material-ui/core/Typography")),D=e(require("@material-ui/core/Dialog")),q=e(require("@material-ui/core/DialogContent")),V=e(require("@material-ui/core/DialogTitle")),F=e(require("@material-ui/core/IconButton")),I=e(require("@material-ui/icons/Close")),B=require("@material-ui/core"),G=require("react-color");function W(e,t,r,n,o,a,i){try{var l=e[a](i),s=l.value}catch(e){return void r(e)}l.done?t(s):Promise.resolve(s).then(n,o)}function H(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){W(a,n,o,i,l,"next",e)}function l(e){W(a,n,o,i,l,"throw",e)}i(void 0)}))}}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function X(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function U(e,t,r){return t&&X(e.prototype,t),r&&X(e,r),e}function Y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){Y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function $(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(e){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Z(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=K(e);if(t){var o=K(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Z(this,r)}}function te(e,t,r){return(te="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=K(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function re(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=r){var n,o,a=[],i=!0,l=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(l)throw o}}return a}}(e,t)||oe(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ne(e){return function(e){if(Array.isArray(e))return ae(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||oe(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oe(e,t){if(e){if("string"==typeof e)return ae(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ae(e,t):void 0}}function ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ie(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=oe(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw a}}}}function le(e,t){return e(t={exports:{}},t.exports),t.exports}var se=le((function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var o=Object.create((t&&t.prototype instanceof f?t:f).prototype),a=new C(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return{value:void 0,done:!0}}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var l=w(i,r);if(l){if(l===u)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=c(e,t,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===u)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(e,r,a),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var u={};function f(){}function p(){}function d(){}var g={};g[o]=function(){return this};var y=Object.getPrototypeOf,h=y&&y(y(k([])));h&&h!==t&&r.call(h,o)&&(g=h);var m=d.prototype=f.prototype=Object.create(g);function v(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var n;this._invoke=function(o,a){function i(){return new t((function(n,i){!function n(o,a,i,l){var s=c(e[o],e,a);if("throw"!==s.type){var u=s.arg,f=u.value;return f&&"object"==typeof f&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,i,l)}),(function(e){n("throw",e,i,l)})):t.resolve(f).then((function(e){u.value=e,i(u)}),(function(e){return n("throw",e,i,l)}))}l(s.arg)}(o,a,n,i)}))}return n=n?n.then(i,i):i()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,u;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function k(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:E}}function E(){return{value:void 0,done:!0}}return p.prototype=m.constructor=d,d.constructor=p,p.displayName=l(d,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,l(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},v(b.prototype),b.prototype[a]=function(){return this},e.AsyncIterator=b,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new b(s(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},v(m),l(m,i,"Generator"),m[o]=function(){return this},m.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=k,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),s=r.call(a,"finallyLoc");if(l&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),x(r),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;x(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:k(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}})),ce=function(e){$(n,l);var t,r=ee(n);function n(){var e;return z(this,n),(e=r.apply(this,arguments)).supportsSVG=!0,e}return U(n,[{key:"render",value:(t=H(se.mark((function e(t){var r,o,a,i,l,c,u,f=this;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getFeatures(t);case 2:return r=e.sent,o=t.height,a=t.bpPerPx,i=re(t.regions,1),c=((l=i[0]).end-l.start)/a,e.next=8,s.renderToAbstractCanvas(c,o,t,(function(e){return f.draw(e,J(J({},t),{},{features:r}))}));case 8:return u=e.sent,e.next=11,te(K(n.prototype),"render",this).call(this,J(J(J({},t),u),{},{features:r,height:o,width:c}));case 11:return e.abrupt("return",J(J(J({},e.sent),u),{},{features:r,height:o,width:c}));case 13:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),n}();function ue(e){var t=e.features,r=e.bpPerPx,n=e.width,o=e.height,a=e.onMouseLeave,i=void 0===a?function(){}:a,l=e.onMouseMove,s=void 0===l?function(){}:l,c=e.onFeatureClick,d=void 0===c?function(){}:c,g=re(e.regions,1)[0],y=u.useRef(null);function h(e){var o=0;y.current&&(o=y.current.getBoundingClientRect().left);var a,i,l=e-o,s=g.start+r*(g.reversed?n-l:l),c=ie(t.values());try{for(c.s();!(i=c.n()).done;){var u=i.value;if(s<=u.get("end")&&s>=u.get("start")){a=u;break}}}catch(e){c.e(e)}finally{c.f()}return a}return f.createElement("div",{ref:y,"data-testid":"wiggle-rendering-test",onMouseMove:function(e){var t=h(e.clientX);s(e,t?t.id():void 0)},onClick:function(e){var t=h(e.clientX);d(e,t?t.id():void 0)},onMouseLeave:function(e){return i(e)},role:"presentation",className:"WiggleRendering",style:{overflow:"visible",position:"relative",height:o}},f.createElement(p.PrerenderedCanvas,Object.assign({},e)))}var fe=c.observer(ue),pe=o.ConfigurationSchema("BigWigAdapter",{bigWigLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bw"}}},{explicitlyTyped:!0}),de=function(e){$(l,g.BaseFeatureDataAdapter);var t,r,n,a,i=ee(l);function l(e){var t;return z(this,l),(t=i.call(this,e)).bigwig=new d.BigWig({filehandle:y.openLocation(o.readConfObject(e,"bigWigLocation"))}),t}return U(l,[{key:"setup",value:(a=H(se.mark((function e(t){var r,n,o;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=void 0===(r=(t||{}).statusCallback)?function(){}:r)("Downloading bigwig header"),e.next=4,this.bigwig.getHeader(t);case 4:return o=e.sent,n(""),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getRefNames",value:(n=H(se.mark((function e(t){return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setup(t);case 2:return e.abrupt("return",Object.keys(e.sent.refsByName));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"refIdToName",value:(r=H(se.mark((function e(t){return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setup();case 2:return e.abrupt("return",(e.sent.refsByNumber[t]||{name:void 0}).name);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getGlobalStats",value:(t=H(se.mark((function e(t){return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setup(t);case 2:return e.abrupt("return",b.rectifyStats(e.sent.totalSummary));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getFeatures",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.refName,o=e.start,a=e.end,i=r.bpPerPx,l=void 0===i?0:i,s=r.signal,c=r.resolution,u=void 0===c?1:c,f=r.statusCallback,p=void 0===f?function(){}:f;return h.ObservableCreate(function(){var e=H(se.mark((function e(i){return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p("Downloading bigwig data"),e.next=3,t.bigwig.getFeatureStream(n,o,a,J(J({},r),{},{basesPerSpan:l/u}));case 3:e.sent.pipe(v.mergeAll(),v.map((function(e){return new m({id:"".concat(n,":").concat(e.start,"-").concat(e.end),data:J(J({},e),{},{refName:n})})}))).subscribe(i);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s)}},{key:"freeResources",value:function(){}}]),l}();de.capabilities=["hasResolution","hasLocalStats","hasGlobalStats"];var ge=de.capabilities,ye={__proto__:null,default:de,adapterCapabilities:ge};function he(e){var t,r=e.domain,n=e.range,o=void 0===n?[]:n,a=e.scaleType,i=e.pivotValue,l=e.inverted,s=re(void 0===r?[]:r,2),c=s[0],u=s[1];if(void 0===c||void 0===u)throw new Error("invalid domain");if("linear"===a)t=S.scaleLinear();else if("log"===a)(t=S.scaleLog()).base(2);else{if("quantize"!==a)throw new Error("undefined scaleType");t=S.scaleQuantize()}t.domain(void 0!==i?[c,i,u]:[c,u]),t.nice();var f=re(o,2);if(void 0===f[0]||void 0===f[1])throw new Error("invalid range");return t.range(l?o.slice().reverse():o),t}function me(e){return"log"===e?1:0}function ve(e){var t=e.scaleType,r=e.domain,n=re(e.bounds,2),o=n[0],a=n[1],i=re(r,2),l=i[0],s=i[1];if("linear"===t&&(s<0&&(s=0),l>0&&(l=0)),"log"===t&&(0===l||l>1)&&(l=1),void 0===l||void 0===s)throw new Error("invalid domain");void 0!==o&&o!==Number.MIN_VALUE&&(l=o),void 0!==a&&a!==Number.MAX_VALUE&&(s=a);var c=function(e){if("linear"===e)return S.scaleLinear();if("log"===e){var t=S.scaleLog();return t.base(2),t}if("quantize"===e)return S.scaleQuantize();throw new Error("undefined scaleType ".concat(e))}(t);return c.domain([l,s]),c.nice(),c.domain()}var be={__proto__:null,getScale:he,getOrigin:me,getNiceDomain:ve},we=o.ConfigurationSchema("WiggleRenderer",{color:{type:"color",description:"the color of track, overrides posColor and negColor",defaultValue:"#f0f"},posColor:{type:"color",description:"the color to use when the score is positive",defaultValue:"blue"},negColor:{type:"color",description:"the color to use when the score is negative",defaultValue:"red"},highlightColor:{type:"color",description:"the color of highlights over the wiggle track",defaultValue:"rgba(255,255,0,0.5)"},clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},renderType:{type:"stringEnum",model:x.types.enumeration("Rendering type",["xyplot","density","line"]),description:"The type of rendering for wiggle data to use",defaultValue:"xyplot"},filled:{type:"boolean",description:"fill in histogram",defaultValue:!0},bicolorPivot:{type:"stringEnum",model:x.types.enumeration("Scale type",["numeric","mean","z_score","none"]),description:"type of bicolor pivot",defaultValue:"numeric"},bicolorPivotValue:{type:"number",defaultValue:0,description:"value to use for bicolor pivot"},summaryScoreMode:{type:"stringEnum",model:x.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1}},{explicitlyTyped:!0}),Se=function(e){$(r,ce);var t=ee(r);function r(){return z(this,r),t.apply(this,arguments)}return U(r,[{key:"draw",value:function(e,t){var r,n,a=t.features,i=t.bpPerPx,l=t.scaleOpts,s=t.height,c=t.config,u=re(t.regions,1)[0],f=o.readConfObject(c,"bicolorPivot"),p=o.readConfObject(c,"bicolorPivotValue"),d=o.readConfObject(c,"negColor"),g=o.readConfObject(c,"posColor");"#f0f"===o.readConfObject(c,"color")?(n=he(J(J({},l),{},"none"!==f?{pivotValue:p,range:[d,"white",g]}:{range:["white",g]})),r=function(e){return n(e.get("score"))}):r=function(e){return o.readConfObject(c,"color",{feature:e})};var y,h=ie(a.values());try{for(h.s();!(y=h.n()).done;){var m=y.value,v=re(w.featureSpanPx(m,u,i),2),b=v[0],S=v[1]-b+.3;e.fillStyle=r(m),e.fillRect(b,0,S,s)}}catch(e){h.e(e)}finally{h.f()}}}]),r}(),xe=o.ConfigurationSchema("DensityRenderer",{},{baseConfiguration:we,explicitlyTyped:!0}),Ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return parseFloat(e.toPrecision(6))},ke=M.makeStyles((function(e){return{popper:{fontSize:"0.8em",zIndex:e.zIndex.tooltip,pointerEvents:"none"},hoverVertical:{background:"#333",border:"none",width:1,height:"100%",top:0,cursor:"default",position:"absolute",pointerEvents:"none"}}}));function Ee(e){var t=e.feature,r=t.get("refName"),n="".concat(r?"".concat(r,":"):""),o=(t.get("start")+1).toLocaleString("en-US"),a=t.get("end").toLocaleString("en-US"),i=o===a?o:"".concat(o,"..").concat(a),l="".concat(n).concat(i);return void 0!==t.get("summary")?f.createElement("div",null,l,f.createElement("br",null),"Max: ",Ce(t.get("maxScore")),f.createElement("br",null),"Avg: ",Ce(t.get("score")),f.createElement("br",null),"Min: ",Ce(t.get("minScore"))):f.createElement("div",null,l,f.createElement("br",null),"".concat(Ce(t.get("score"))))}var Te=c.observer((function(e){var t=e.height,r=e.mouseCoord,n=e.model.featureUnderMouse,o=ke();return n?f.createElement(f.Fragment,null,f.createElement(R,{placement:"right-start",className:o.popper,open:!0,title:f.createElement(Ee,{feature:n})},f.createElement("div",{style:{position:"absolute",left:r[0],top:5}}," ")),f.createElement("div",{className:o.hoverVertical,style:{left:r[0],height:t-2*je}})):null})),Re=c.observer((function(e){return f.createElement(T.Axis,Object.assign({},e.model.ticks,{format:function(e){return e},style:{orient:"left"===e.orientation?T.LEFT:T.RIGHT}}))})),Me=c.observer((function(e){var t=e.model,r=t.ready,n=t.stats,o=t.height,a=t.needsScalebar;return f.createElement("div",null,f.createElement(C.BaseLinearDisplayComponent,Object.assign({},e)),r&&n&&a?f.createElement("svg",{style:{position:"absolute",top:0,left:300,pointerEvents:"none",height:o,width:50}},f.createElement(Re,{model:t})):null)})),Oe=u.lazy((function(){return Promise.resolve().then((function(){return He}))})),Pe=u.lazy((function(){return Promise.resolve().then((function(){return Xe}))})),je=5,Le=new Map([["xyplot","XYPlotRenderer"],["density","DensityRenderer"],["line","LinePlotRenderer"]]);function Ne(e,t){return Math.log(t)/Math.log(e)}function Ae(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.5;return(e>=0?1:-1)*Math.pow(t,1+Math.floor(Ne(t,Math.abs(e))))}var _e=function(e,t){return x.types.compose("LinearWiggleDisplay",C.BaseLinearDisplay,x.types.model({type:x.types.literal("LinearWiggleDisplay"),configuration:o.ConfigurationReference(t),selectedRendering:x.types.optional(x.types.string,""),resolution:x.types.optional(x.types.number,1),fill:x.types.maybe(x.types.boolean),color:x.types.maybe(x.types.string),summaryScoreMode:x.types.maybe(x.types.string),rendererTypeNameState:x.types.maybe(x.types.string),scale:x.types.maybe(x.types.string),autoscale:x.types.maybe(x.types.string),displayCrossHatches:x.types.maybe(x.types.boolean),constraints:x.types.optional(x.types.model({max:x.types.maybe(x.types.number),min:x.types.maybe(x.types.number)}),{})})).volatile((function(){return{ready:!1,message:void 0,stats:E.observable({scoreMin:0,scoreMax:50}),statsFetchInProgress:void 0}})).actions((function(e){return{updateStats:function(t){e.stats.scoreMin=t.scoreMin,e.stats.scoreMax=t.scoreMax,e.ready=!0},setColor:function(t){e.color=t},setLoading:function(t){var r=e.statsFetchInProgress;void 0===r||r.signal.aborted||r.abort(),e.statsFetchInProgress=t},selectFeature:function(t){var r=w.getSession(e);w.isSelectionContainer(r)&&r.setSelection(t)},setResolution:function(t){e.resolution=t},setFill:function(t){e.fill=t},toggleLogScale:function(){e.scale="log"!==e.scale?"log":"linear"},setScaleType:function(t){e.scale=t},setSummaryScoreMode:function(t){e.summaryScoreMode=t},setAutoscale:function(t){e.autoscale=t},setMaxScore:function(t){e.constraints.max=t},setRendererType:function(t){e.rendererTypeNameState=t},setMinScore:function(t){e.constraints.min=t},toggleCrossHatches:function(){e.displayCrossHatches=!e.displayCrossHatches},setCrossHatches:function(t){e.displayCrossHatches=t}}})).views((function(e){return{get TooltipComponent(){return Te},get adapterTypeName(){return e.adapterConfig.type},get rendererTypeName(){var t=e.rendererTypeNameState||o.getConf(e,"defaultRendering"),r=Le.get(t);if(!r)throw new Error("unknown alignments view name ".concat(t));return r},get filters(){},get scaleType(){return e.scale||o.getConf(e,"scaleType")},get filled(){return void 0!==e.fill?e.fill:o.readConfObject(this.rendererConfig,"filled")},get maxScore(){var t=e.constraints.max;return void 0!==t?t:o.getConf(e,"maxScore")},get minScore(){var t=e.constraints.min;return void 0!==t?t:o.getConf(e,"minScore")},get rendererConfig(){var t=o.getConf(e,["renderers",this.rendererTypeName])||{};return e.rendererType.configSchema.create(J(J({},t),{},{filled:e.fill,scaleType:this.scaleType,displayCrossHatches:e.displayCrossHatches,summaryScoreMode:e.summaryScoreMode,color:e.color}),x.getEnv(e))}}})).views((function(e){var t=[0,0];return{get summaryScoreModeSetting(){return e.summaryScoreMode||o.readConfObject(e.rendererConfig,"summaryScoreMode")},get domain(){var r=e.stats,n=e.scaleType,a=e.minScore,i=e.maxScore,l=ve({domain:[r.scoreMin,r.scoreMax],bounds:[a,i],scaleType:n}),s=o.getConf(e,"headroom")||0;return"log"===n&&l[1]===Number.MIN_VALUE?[0,Number.MIN_VALUE]:(i===Number.MAX_VALUE&&l[1]>1&&(l[1]=Ae(l[1]+s)),a===Number.MIN_VALUE&&l[0]<-1&&(l[0]=Ae(l[0]-s)),JSON.stringify(t)!==JSON.stringify(l)&&(t=l),t)},get needsScalebar(){return"XYPlotRenderer"===e.rendererTypeName||"LinePlotRenderer"===e.rendererTypeName},get scaleOpts(){return{domain:this.domain,stats:e.stats,autoscaleType:this.autoscaleType,scaleType:e.scaleType,inverted:o.getConf(e,"inverted")}},get canHaveFill(){return"XYPlotRenderer"===e.rendererTypeName},get autoscaleType(){return e.autoscale||o.getConf(e,"autoscale")},get displayCrossHatchesSetting(){return e.displayCrossHatches||o.readConfObject(e.rendererConfig,"displayCrossHatches")}}})).views((function(t){var r=t.trackMenuItems;return{get ticks(){var e=t.height,r=he({scaleType:t.scaleType,domain:t.domain,range:[e-je,je],inverted:o.getConf(t,"inverted")});return T.axisPropsFromTickScale(r,e<50?2:4)},get renderProps(){return J(J(J({},t.composedRenderProps),k.getParentRenderProps(t)),{},{notReady:!t.ready,rpcDriverName:t.rpcDriverName,displayModel:t,config:t.rendererConfig,scaleOpts:t.scaleOpts,resolution:t.resolution,height:t.height,ticks:this.ticks,displayCrossHatches:t.displayCrossHatches,filters:t.filters})},get adapterCapabilities(){return e.getAdapterType(t.adapterTypeName).adapterCapabilities},get hasResolution(){return this.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return this.adapterCapabilities.includes("hasGlobalStats")},get composedTrackMenuItems(){return[].concat(ne(this.hasResolution?[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:function(){t.setResolution(5*t.resolution)}},{label:"Coarser resolution",onClick:function(){t.setResolution(t.resolution/5)}}]},{label:"Summary score mode",subMenu:["min","max","avg","whiskers"].map((function(e){return{label:e,onClick:function(){return t.setSummaryScoreMode(e)}}}))}]:[]),ne(t.canHaveFill?[{label:t.filled?"Turn off histogram fill":"Turn on histogram fill",onClick:function(){t.setFill(!t.filled)}}]:[]),[{label:"log"===t.scaleType?"Set linear scale":"Set log scale",onClick:function(){t.toggleLogScale()}},{type:"checkbox",label:"Draw cross hatches",checked:t.displayCrossHatchesSetting,onClick:function(){t.toggleCrossHatches()}}],ne(Object.keys(o.getConf(t,"renderers")||{}).length>1?[{label:"Renderer type",subMenu:ne(Le.keys()).map((function(e){return{label:e,onClick:function(){return t.setRendererType(e)}}}))}]:[]),[{label:"Autoscale type",subMenu:[["local","Local"]].concat(ne(this.hasGlobalStats?[["global","Global"],["globalsd","Global ± 3σ"]]:[]),[["localsd","Local ± 3σ"]]).map((function(e){var r=re(e,2),n=r[0];return{label:r[1],onClick:function(){t.setAutoscale(n)}}}))},{label:"Set min/max score",onClick:function(){w.getSession(t).setDialogComponent(Oe,{model:t})}},{label:"Set color",onClick:function(){w.getSession(t).setDialogComponent(Pe,{model:t})}}])},get trackMenuItems(){return[].concat(ne(r),ne(this.composedTrackMenuItems))}}})).actions((function(e){var t=e.reload,r=e.renderSvg;function n(e){return a.apply(this,arguments)}function a(){return(a=H(se.mark((function t(r){var n,a,i,l,s,c,u,f,p,d,g,y,h,m,v,b,S,C;return se.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=w.getSession(e),a=n.rpcManager,i=o.getConf(e,"numStdDev")||3,l=e.adapterConfig,s=e.autoscaleType,c=k.getRpcSessionId(e),u=J({sessionId:c,adapterConfig:l,statusCallback:function(t){x.isAlive(e)&&e.setMessage(t)}},r),"global"!==s&&"globalsd"!==s){t.next=11;break}return t.next=8,a.call(c,"WiggleGetGlobalStats",u);case 8:return p=(f=t.sent).scoreMin,d=f.scoreMean,g=f.scoreStdDev,t.abrupt("return","globalsd"===s?J(J({},f),{},{scoreMin:p>=0?0:d-i*g,scoreMax:d+i*g}):f);case 11:if("local"!==s&&"localsd"!==s){t.next=18;break}return y=w.getContainingView(e),h=y.dynamicBlocks,m=y.bpPerPx,t.next=15,a.call(c,"WiggleGetMultiRegionStats",J(J({},u),{},{assemblyName:k.getTrackAssemblyNames(e.parentTrack)[0],regions:JSON.parse(JSON.stringify(h.contentBlocks.map((function(e){var t=e.start,r=e.end;return J(J({},e),{},{start:Math.floor(t),end:Math.ceil(r)})})))),bpPerPx:m}));case 15:return b=(v=t.sent).scoreMin,S=v.scoreMean,C=v.scoreStdDev,t.abrupt("return","localsd"===s?J(J({},v),{},{scoreMin:b>=0?0:S-i*C,scoreMax:S+i*C}):v);case 18:if("zscale"!==s){t.next=20;break}return t.abrupt("return",a.call(c,"WiggleGetGlobalStats",u));case 20:throw new Error("invalid autoscaleType '".concat(s,"'"));case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return{reload:function(){return H(se.mark((function r(){var o,a;return se.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.setError(),o=new AbortController,r.next=4,n({signal:o.signal,filters:e.filters});case 4:a=r.sent,x.isAlive(e)&&(e.updateStats(a),t());case 6:case"end":return r.stop()}}),r)})))()},afterAttach:function(){x.addDisposer(e,E.autorun(H(se.mark((function t(){var r,o,a;return se.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=new AbortController,o=w.getContainingView(e),e.setLoading(r),o.initialized){t.next=6;break}return t.abrupt("return");case 6:if(!(o.bpPerPx>e.maxViewBpPerPx)){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,n({signal:r.signal,filters:e.filters});case 10:a=t.sent,x.isAlive(e)&&e.updateStats(a),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),!w.isAbortException(t.t0)&&x.isAlive(e)&&e.setError(t.t0);case 17:case"end":return t.stop()}}),t,null,[[0,14]])}))),{delay:1e3}))},renderSvg:function(t){return H(se.mark((function n(){var o,a,i,l;return se.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,E.when((function(){return e.ready&&!!e.regionCannotBeRenderedText}));case 2:return o=e.needsScalebar,a=e.stats,i=w.getContainingView(e),l=i.offsetPx,n.t0=f,n.t1=f.Fragment,n.t2=f,n.t3={id:"snpcov"},n.next=10,r(t);case 10:return n.t4=n.sent,n.t5=n.t2.createElement.call(n.t2,"g",n.t3,n.t4),n.t6=o&&a?f.createElement("g",{transform:"translate(".concat(Math.max(-l,0),")")},f.createElement(Re,{model:e,orientation:"left"})):null,n.abrupt("return",n.t0.createElement.call(n.t0,n.t1,null,n.t5,n.t6));case 14:case"end":return n.stop()}}),n)})))()}}}))},De=function(e){$(r,ce);var t=ee(r);function r(){return z(this,r),t.apply(this,arguments)}return U(r,[{key:"draw",value:function(e,t){var r=t.features,n=t.bpPerPx,a=t.scaleOpts,i=t.height,l=t.config,s=t.ticks.values,c=t.displayCrossHatches,u=re(t.regions,1)[0],f=(u.end-u.start)/n,p=je,d=i-2*p,g=o.readConfObject(l,"bicolorPivotValue"),y=o.readConfObject(l,"negColor"),h=o.readConfObject(l,"posColor"),m=o.readConfObject(l,"filled"),v=o.readConfObject(l,"clipColor"),b=o.readConfObject(l,"highlightColor"),S=o.readConfObject(l,"summaryScoreMode"),x=he(J(J({},a),{},{range:[0,d]})),C=me(a.scaleType),k=re(x.domain(),2),E=k[0],T=k[1],R=function(e){return d-x(e)+p},M=function(e){return R(C)-R(e)},P="#f0f"===o.readConfObject(l,"color")?function(e,t){return t<g?y:h}:function(e,t){return o.readConfObject(l,"color",{feature:e})};e.strokeStyle="grey",e.moveTo(0,R(0)),e.lineTo(f,R(0)),e.stroke();var j,L=E<g&&T>g,N=ie(r.values());try{for(N.s();!(j=N.n()).done;){var A=j.value,_=re(w.featureSpanPx(A,u,n),2),D=_[0],q=_[1],V=A.get("score"),F=A.get("maxScore"),I=A.get("minScore"),B=V<E,G=V>T,W=q-D+.4,H=A.get("summary");if("max"===S)e.fillStyle=P(A,V=H?F:V),e.fillRect(D,R(V),W,m?M(V):1);else if("min"===S)e.fillStyle=P(A,V=H?I:V),e.fillRect(D,R(V),W,m?M(V):1);else if("whiskers"===S){var z=P(A,V);H&&(e.fillStyle=L?P(A,F):O(z).lighten(.6).toString(),e.fillRect(D,R(F),W,m?M(F)-M(V):1)),e.fillStyle=L&&H?O(P(A,F)).mix(O(P(A,I))):z,e.fillRect(D,R(V),W,m?M(V)-(H?M(I):0):1),H&&(e.fillStyle=L?P(A,I):O(z).darken(.6).toString(),e.fillRect(D,R(I),W,m?M(I):1))}else e.fillStyle=P(A,V),e.fillRect(D,R(V),W,m?M(V):1);G?(e.fillStyle=v,e.fillRect(D,0,W,4)):B&&"log"!==a.scaleType&&(e.fillStyle=v,e.fillRect(D,i-4,W,4)),A.get("highlighted")&&(e.fillStyle=b,e.fillRect(D,0,W,d))}}catch(e){N.e(e)}finally{N.f()}c&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.8)",s.forEach((function(t){e.beginPath(),e.moveTo(0,Math.round(R(t))),e.lineTo(f,Math.round(R(t))),e.stroke()})))}}]),r}(),qe=o.ConfigurationSchema("XYPlotRenderer",{},{baseConfiguration:we,explicitlyTyped:!0}),Ve=function(e){$(r,ce);var t=ee(r);function r(){return z(this,r),t.apply(this,arguments)}return U(r,[{key:"draw",value:function(e,t){var r,n=t.features,a=t.bpPerPx,i=t.scaleOpts,l=t.height,s=t.ticks.values,c=t.displayCrossHatches,u=t.config,f=re(t.regions,1)[0],p=(f.end-f.start)/a,d=je,g=l-2*d,y=o.readConfObject(u,"clipColor"),h=o.readConfObject(u,"highlightColor"),m=he(J(J({},i),{},{range:[0,g]})),v=re(m.domain(),2),b=v[0],S=v[1],x=function(e){return g-m(e)+d},C="#f0f"===o.readConfObject(u,"color")?function(){return"grey"}:function(e){return o.readConfObject(u,"color",{feature:e})};e.strokeStyle="grey",e.moveTo(0,x(0)),e.lineTo(p,x(0)),e.stroke();var k,E=ie(n.values());try{for(E.s();!(k=E.n()).done;){var T=k.value,R=re(w.featureSpanPx(T,f,a),2),M=R[0],O=R[1],P=T.get("score"),j=P<b,L=P>S,N=O-M+.3,A=C(T);e.strokeStyle=A,e.beginPath(),f.reversed?(e.moveTo(O,x(void 0!==r?r:P)),e.lineTo(O,x(P)),e.lineTo(M,x(P))):(e.moveTo(M,x(void 0!==r?r:P)),e.lineTo(M,x(P)),e.lineTo(O,x(P))),e.stroke(),r=P,L?(e.fillStyle=y,e.fillRect(M,0,N,4)):j&&"log"!==i.scaleType&&(e.fillStyle=y,e.fillRect(M,g-4,N,g)),T.get("highlighted")&&(e.fillStyle=h,e.fillRect(M,0,N,g))}}catch(e){E.e(e)}finally{E.f()}c&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.8)",s.forEach((function(t){e.beginPath(),e.moveTo(0,Math.round(x(t))),e.lineTo(p,Math.round(x(t))),e.stroke()})))}}]),r}(),Fe=o.ConfigurationSchema("LinePlotRenderer",{},{baseConfiguration:we,explicitlyTyped:!0}),Ie=function(e){$(o,j);var t,r,n=ee(o);function o(){var e;return z(this,o),(e=n.apply(this,arguments)).name="WiggleGetGlobalStats",e}return U(o,[{key:"deserializeArguments",value:(r=H(se.mark((function e(t,r){return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te(K(o.prototype),"deserializeArguments",this).call(this,t,r);case 2:return e.abrupt("return",J(J({},e.sent),{},{filters:t.filters?new L({filters:t.filters}):void 0}));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"execute",value:(t=H(se.mark((function e(t,r){var n,o,a,i;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,r);case 2:return o=(n=e.sent).adapterConfig,a=n.sessionId,e.next=6,P.getAdapter(this.pluginManager,a,o);case 6:if(!((i=e.sent.dataAdapter)instanceof g.BaseFeatureDataAdapter)){e.next=12;break}if(!i.capabilities.includes("hasGlobalStats")){e.next=11;break}return e.abrupt("return",i.getGlobalStats(n));case 11:throw new Error("Data adapter does not support global stats");case 12:throw new Error("Data adapter not found");case 13:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),o}(),Be=function(e){$(a,j);var t,r,n,o=ee(a);function a(){var e;return z(this,a),(e=o.apply(this,arguments)).name="WiggleGetMultiRegionStats",e}return U(a,[{key:"deserializeArguments",value:(n=H(se.mark((function e(t,r){return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te(K(a.prototype),"deserializeArguments",this).call(this,t,r);case 2:return e.abrupt("return",J(J({},e.sent),{},{filters:t.filters?new L({filters:t.filters}):void 0}));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"serializeArguments",value:(r=H(se.mark((function e(t){var r,n,o;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=null===(r=this.pluginManager.rootModel)||void 0===r||null===(n=r.session)||void 0===n?void 0:n.assemblyManager){e.next=3;break}return e.abrupt("return",t);case 3:return e.abrupt("return",w.renameRegionsIfNeeded(o,J(J({},t),{},{filters:t.filters&&t.filters.toJSON().filters})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"execute",value:(t=H(se.mark((function e(t,r){var n,o,a,i,l;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,r);case 2:return o=(n=e.sent).regions,a=n.adapterConfig,i=n.sessionId,e.next=6,P.getAdapter(this.pluginManager,i,a);case 6:if(!((l=e.sent.dataAdapter)instanceof g.BaseFeatureDataAdapter)){e.next=10;break}return e.abrupt("return",l.getMultiRegionStats(o,n));case 10:throw new Error("Data adapter not found");case 11:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),a}(),Ge=function(e){$(s,n);var l=ee(s);function s(){var e;return z(this,s),(e=l.apply(this,arguments)).name="WigglePlugin",e.exports={LinearWiggleDisplayReactComponent:Me,XYPlotRendererReactComponent:fe,XYPlotRenderer:De,xyPlotRendererConfigSchema:qe,utils:be,WiggleBaseRenderer:ce,linearWiggleDisplayModelFactory:_e},e}return U(s,[{key:"install",value:function(e){e.addTrackType((function(){var t=o.ConfigurationSchema("QuantitativeTrack",{},{baseConfiguration:a.createBaseTrackConfig(e)});return new r({name:"QuantitativeTrack",configSchema:t,stateModel:a.createBaseTrackModel(e,"QuantitativeTrack",t)})})),e.addDisplayType((function(){var t=function(e){var t=e.getRendererType("XYPlotRenderer").configSchema,r=e.getRendererType("DensityRenderer").configSchema,n=e.getRendererType("LinePlotRenderer").configSchema;return o.ConfigurationSchema("LinearWiggleDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:x.types.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:x.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},defaultRendering:{type:"stringEnum",model:x.types.enumeration("Rendering",["density","xyplot","line"]),defaultValue:"xyplot"},renderers:o.ConfigurationSchema("RenderersConfiguration",{DensityRenderer:r,XYPlotRenderer:t,LinePlotRenderer:n})},{baseConfiguration:C.baseLinearDisplayConfigSchema,explicitlyTyped:!0})}(e);return new i({name:"LinearWiggleDisplay",configSchema:t,stateModel:_e(e,t),trackType:"QuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:Me})})),e.addAdapterType((function(){return new t({name:"BigWigAdapter",configSchema:pe,adapterCapabilities:ge,getAdapterClass:function(){return Promise.resolve().then((function(){return ye})).then((function(e){return e.default}))}})})),e.addRendererType((function(){return new Se({name:"DensityRenderer",ReactComponent:fe,configSchema:xe,pluginManager:e})})),e.addRendererType((function(){return new Ve({name:"LinePlotRenderer",ReactComponent:fe,configSchema:Fe,pluginManager:e})})),e.addRendererType((function(){return new De({name:"XYPlotRenderer",ReactComponent:fe,configSchema:qe,pluginManager:e})})),e.addRpcMethod((function(){return new Ie(e)})),e.addRpcMethod((function(){return new Be(e)}))}}]),s}(),We=M.makeStyles((function(e){return{root:{},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})),He={__proto__:null,default:function(e){var t=We(),r=e.model,n=e.handleClose,o=r.minScore,a=r.maxScore,i=r.scaleType,l=re(u.useState("".concat(o!==Number.MIN_VALUE?o:"")),2),s=l[0],c=l[1],p=re(u.useState("".concat(a!==Number.MAX_VALUE?a:"")),2),d=p[0],g=p[1],y=!(""!==s&&""!==d&&!Number.isNaN(+s)&&!Number.isNaN(+d))||+d>+s,h=!("log"===i&&""!==s&&!Number.isNaN(+s))||+s>0;return f.createElement(D,{open:!0,onClose:n},f.createElement(V,null,"Set min/max score for track",f.createElement(F,{className:t.closeButton,onClick:n},f.createElement(I,null))),f.createElement(q,{style:{overflowX:"hidden"}},f.createElement("div",{className:t.root},f.createElement(_,null,"Enter min/max score: "),y?null:f.createElement(_,{color:"error"},"Max is greater than or equal to min"),h?null:f.createElement(_,{color:"error"},"Min score should be greater than 0 for log scale"),f.createElement(A,{value:s,onChange:function(e){c(e.target.value)},placeholder:"Enter min score"}),f.createElement(A,{value:d,onChange:function(e){g(e.target.value)},placeholder:"Enter max score"}),f.createElement(N,{variant:"contained",color:"primary",type:"submit",style:{marginLeft:20},disabled:!y,onClick:function(){r.setMinScore(""===s||Number.isNaN(+s)?void 0:+s),r.setMaxScore(""===d||Number.isNaN(+d)?void 0:+d),n()}},"Submit"))))}},ze=M.makeStyles((function(e){return{root:{},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})),Xe={__proto__:null,default:function(e){var t=ze(),r=e.model,n=e.handleClose;return f.createElement(B.Dialog,{open:!0,onClose:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},f.createElement(B.DialogTitle,{id:"alert-dialog-title"},"Select a color",f.createElement(B.IconButton,{"aria-label":"close",className:t.closeButton,onClick:n},f.createElement(I,null))),f.createElement(B.DialogContent,{style:{overflowX:"hidden"}},f.createElement("div",{className:t.root},f.createElement(G.CompactPicker,{onChange:function(e){r.setColor(function(e){if(e instanceof Object){var t=e.g,r=e.b,n=e.a;return"rgb(".concat(e.r,",").concat(t,",").concat(r,",").concat(n,")")}return e}(e.rgb))}}),f.createElement("br",null),f.createElement("div",{style:{margin:20}},f.createElement(B.Button,{onClick:function(){r.setColor(void 0)},color:"secondary",variant:"contained"},"Restore default from config"),f.createElement(B.Button,{variant:"contained",color:"primary",type:"submit",onClick:function(){n()}},"Submit")))))}};exports.LinearWiggleDisplayReactComponent=Me,exports.WiggleBaseRenderer=ce,exports.WiggleRendering=fe,exports.YSCALEBAR_LABEL_OFFSET=je,exports.default=Ge,exports.getNiceDomain=ve,exports.getOrigin=me,exports.getScale=he,exports.linearWiggleDisplayModelFactory=_e;
//# sourceMappingURL=plugin-wiggle.cjs.production.min.js.map
