{"version":3,"file":"plugin-alignments.cjs.development.js","sources":["../src/AlignmentsFeatureDetail/index.js","../src/BamAdapter/configSchema.ts","../src/BamAdapter/index.ts","../../../node_modules/regenerator-runtime/runtime.js","../src/BamAdapter/MismatchParser.ts","../src/CramAdapter/configSchema.ts","../src/CramAdapter/index.ts","../src/HtsgetBamAdapter/configSchema.ts","../src/HtsgetBamAdapter/index.ts","../src/LinearAlignmentsDisplay/models/configSchema.ts","../src/LinearAlignmentsDisplay/models/model.tsx","../src/LinearAlignmentsDisplay/components/AlignmentsDisplay.tsx","../src/LinearPileupDisplay/configSchema.ts","../src/LinearPileupDisplay/components/LinearPileupDisplayBlurb.tsx","../src/shared.ts","../src/LinearPileupDisplay/model.ts","../src/LinearSNPCoverageDisplay/models/configSchema.ts","../src/LinearSNPCoverageDisplay/components/Tooltip.tsx","../src/LinearSNPCoverageDisplay/models/model.ts","../src/PileupRenderer/components/PileupRendering.tsx","../src/PileupRenderer/configSchema.ts","../src/PileupRenderer/sortUtil.ts","../src/util.ts","../src/PileupRenderer/PileupLayoutSession.ts","../src/PileupRenderer/PileupRenderer.tsx","../src/SNPCoverageAdapter/configSchema.ts","../src/SNPCoverageAdapter/SNPCoverageAdapter.ts","../src/SNPCoverageAdapter/index.ts","../src/SNPCoverageRenderer/configSchema.js","../src/SNPCoverageRenderer/SNPCoverageRenderer.ts","../src/SNPCoverageRenderer/index.js","../src/PileupRPC/rpcMethods.ts","../src/index.ts","../src/BamAdapter/BamSlightlyLazyFeature.ts","../src/BamAdapter/BamAdapter.ts","../src/CramAdapter/CramSlightlyLazyFeature.ts","../src/CramAdapter/CramAdapter.ts","../src/HtsgetBamAdapter/HtsgetBamAdapter.ts","../src/LinearPileupDisplay/components/ColorByTag.tsx","../src/LinearPileupDisplay/components/FilterByTag.tsx","../src/LinearPileupDisplay/components/SortByTag.tsx","../src/LinearPileupDisplay/components/SetFeatureHeight.tsx","../src/LinearPileupDisplay/components/SetMaxHeight.tsx","../src/LinearPileupDisplay/components/ColorByModifications.tsx","../src/AlignmentsFeatureDetail/AlignmentsFeatureDetail.tsx"],"sourcesContent":["import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nconst configSchema = ConfigurationSchema('AlignmentsFeatureWidget', {})\n\nexport default function stateModelFactory(pluginManager) {\n  return types\n    .model('AlignmentsFeatureWidget', {\n      id: ElementId,\n      type: types.literal('AlignmentsFeatureWidget'),\n      featureData: types.frozen(),\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n    })\n    .actions(self => ({\n      setFeatureData(data) {\n        self.featureData = data\n      },\n      clearFeatureData() {\n        self.featureData = undefined\n      },\n    }))\n}\n\nexport { configSchema, stateModelFactory }\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default types.late(() =>\n  ConfigurationSchema(\n    'BamAdapter',\n    {\n      bamLocation: {\n        type: 'fileLocation',\n        defaultValue: { uri: '/path/to/my.bam' },\n      },\n      index: ConfigurationSchema('BamIndex', {\n        indexType: {\n          model: types.enumeration('IndexType', ['BAI', 'CSI']),\n          type: 'stringEnum',\n          defaultValue: 'BAI',\n        },\n        location: {\n          type: 'fileLocation',\n          defaultValue: { uri: '/path/to/my.bam.bai' },\n        },\n      }),\n      chunkSizeLimit: {\n        type: 'number',\n        defaultValue: 100000000,\n      },\n      fetchSizeLimit: {\n        type: 'number',\n        defaultValue: 500000000,\n      },\n      sequenceAdapter: {\n        type: 'frozen',\n        defaultValue: null,\n      },\n    },\n    { explicitlyTyped: true },\n  ),\n)\n","import configSchema from './configSchema'\n\nexport default (/* pluginManager: PluginManager */) => {\n  return {\n    configSchema,\n    getAdapterClass: () => import('./BamAdapter').then(r => r.default),\n  }\n}\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n    return obj[key];\n  }\n  try {\n    // IE 8 has a broken Object.defineProperty that only works on DOM objects.\n    define({}, \"\");\n  } catch (err) {\n    define = function(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunction.displayName = define(\n    GeneratorFunctionPrototype,\n    toStringTagSymbol,\n    \"GeneratorFunction\"\n  );\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      define(prototype, method, function(arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      define(genFun, toStringTagSymbol, \"GeneratorFunction\");\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return PromiseImpl.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return PromiseImpl.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    if (PromiseImpl === void 0) PromiseImpl = Promise;\n\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList),\n      PromiseImpl\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  define(Gp, toStringTagSymbol, \"Generator\");\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  typeof module === \"object\" ? module.exports : {}\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n}\n","export interface Mismatch {\n  qual?: number\n  start: number\n  length: number\n  type: string\n  base: string\n  altbase?: string\n  seq?: string\n  cliplen?: number\n}\n\nexport function parseCigar(cigar: string) {\n  return (cigar || '').split(/([MIDNSHPX=])/)\n}\nexport function cigarToMismatches(\n  ops: string[],\n  seq: string,\n  qual?: Buffer,\n): Mismatch[] {\n  let currOffset = 0\n  let seqOffset = 0\n  const mismatches: Mismatch[] = []\n  for (let i = 0; i < ops.length - 1; i += 2) {\n    const len = +ops[i]\n    const op = ops[i + 1]\n    if (op === 'M' || op === '=' || op === 'E') {\n      seqOffset += len\n    }\n    if (op === 'I') {\n      mismatches.push({\n        start: currOffset,\n        type: 'insertion',\n        base: `${len}`,\n        length: 0,\n      })\n      seqOffset += len\n    } else if (op === 'D') {\n      mismatches.push({\n        start: currOffset,\n        type: 'deletion',\n        base: '*',\n        length: len,\n      })\n    } else if (op === 'N') {\n      mismatches.push({\n        start: currOffset,\n        type: 'skip',\n        base: 'N',\n        length: len,\n      })\n    } else if (op === 'X') {\n      const r = seq.slice(seqOffset, seqOffset + len)\n      const q = qual?.slice(seqOffset, seqOffset + len) || []\n\n      for (let j = 0; j < len; j++) {\n        mismatches.push({\n          start: currOffset + j,\n          type: 'mismatch',\n          base: r[j],\n          qual: q[j],\n          length: 1,\n        })\n      }\n      seqOffset += len\n    } else if (op === 'H') {\n      mismatches.push({\n        start: currOffset,\n        type: 'hardclip',\n        base: `H${len}`,\n        cliplen: len,\n        length: 1,\n      })\n    } else if (op === 'S') {\n      mismatches.push({\n        start: currOffset,\n        type: 'softclip',\n        base: `S${len}`,\n        cliplen: len,\n        length: 1,\n      })\n      seqOffset += len\n    }\n\n    if (op !== 'I' && op !== 'S' && op !== 'H') {\n      currOffset += len\n    }\n  }\n  return mismatches\n}\n\n/**\n * parse a SAM MD tag to find mismatching bases of the template versus the reference\n * @returns array of mismatches and their positions\n */\nexport function mdToMismatches(\n  mdstring: string,\n  cigarOps: string[],\n  cigarMismatches: Mismatch[],\n  seq: string,\n  qual?: Buffer,\n): Mismatch[] {\n  const mismatchRecords: Mismatch[] = []\n  let curr: Mismatch = { start: 0, base: '', length: 0, type: 'mismatch' }\n  const skips = cigarMismatches.filter(cigar => cigar.type === 'skip')\n  let lastCigar = 0\n  let lastTemplateOffset = 0\n  let lastRefOffset = 0\n  let lastSkipPos = 0\n\n  // convert a position on the reference sequence to a position\n  // on the template sequence, taking into account hard and soft\n  // clipping of reads\n\n  function nextRecord(): void {\n    mismatchRecords.push(curr)\n\n    // get a new mismatch record ready\n    curr = {\n      start: curr.start + curr.length,\n      length: 0,\n      base: '',\n      type: 'mismatch',\n    }\n  }\n\n  function getTemplateCoordLocal(refCoord: number): number {\n    let templateOffset = lastTemplateOffset\n    let refOffset = lastRefOffset\n    for (\n      let i = lastCigar;\n      i < cigarOps.length && refOffset <= refCoord;\n      i += 2, lastCigar = i\n    ) {\n      const len = +cigarOps[i]\n      const op = cigarOps[i + 1]\n      if (op === 'S' || op === 'I') {\n        templateOffset += len\n      } else if (op === 'D' || op === 'P' || op === 'N') {\n        refOffset += len\n      } else if (op !== 'H') {\n        templateOffset += len\n        refOffset += len\n      }\n    }\n    lastTemplateOffset = templateOffset\n    lastRefOffset = refOffset\n\n    return templateOffset - (refOffset - refCoord)\n  }\n\n  // now actually parse the MD string\n  const md = mdstring.match(/(\\d+|\\^[a-z]+|[a-z])/gi) || []\n  for (let i = 0; i < md.length; i++) {\n    const token = md[i]\n    if (token.match(/^\\d/)) {\n      curr.start += parseInt(token, 10)\n    } else if (token.match(/^\\^/)) {\n      curr.length = token.length - 1\n      curr.base = '*'\n      curr.type = 'deletion'\n      curr.seq = token.substring(1)\n      nextRecord()\n    } else if (token.match(/^[a-z]/i)) {\n      // mismatch\n      for (let j = 0; j < token.length; j += 1) {\n        curr.length = 1\n\n        while (lastSkipPos < skips.length) {\n          const mismatch = skips[lastSkipPos]\n          if (curr.start >= mismatch.start) {\n            curr.start += mismatch.length\n            lastSkipPos++\n          } else {\n            break\n          }\n        }\n        const s = cigarOps ? getTemplateCoordLocal(curr.start) : curr.start\n        curr.base = seq ? seq.substr(s, 1) : 'X'\n        const qualScore = qual?.slice(s, s + 1)[0]\n        if (qualScore) {\n          curr.qual = qualScore\n        }\n        curr.altbase = token\n        nextRecord()\n      }\n    }\n  }\n  return mismatchRecords\n}\n\nexport function getTemplateCoord(refCoord: number, cigarOps: string[]): number {\n  let templateOffset = 0\n  let refOffset = 0\n  for (let i = 0; i < cigarOps.length && refOffset <= refCoord; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op === 'S' || op === 'I') {\n      templateOffset += len\n    } else if (op === 'D' || op === 'P') {\n      refOffset += len\n    } else if (op !== 'H') {\n      templateOffset += len\n      refOffset += len\n    }\n  }\n  return templateOffset - (refOffset - refCoord)\n}\n\nexport function getMismatches(\n  cigarString: string,\n  mdString: string,\n  seq: string,\n  qual?: Buffer,\n): Mismatch[] {\n  let mismatches: Mismatch[] = []\n  let cigarOps: string[] = []\n\n  // parse the CIGAR tag if it has one\n  if (cigarString) {\n    cigarOps = parseCigar(cigarString)\n    mismatches = mismatches.concat(cigarToMismatches(cigarOps, seq, qual))\n  }\n\n  // now let's look for CRAM or MD mismatches\n  if (mdString) {\n    mismatches = mismatches.concat(\n      mdToMismatches(mdString, cigarOps, mismatches, seq, qual),\n    )\n  }\n\n  // uniqify the mismatches\n  const seen: { [index: string]: boolean } = {}\n  return mismatches.filter(m => {\n    const key = `${m.type},${m.start},${m.length}`\n    const s = seen[key]\n    seen[key] = true\n    return !s\n  })\n}\n\n// adapted from minimap2 code static void write_MD_core function\nexport function generateMD(target: string, query: string, cigar: string) {\n  let queryOffset = 0\n  let targetOffset = 0\n  let lengthMD = 0\n  if (!target) {\n    console.warn('no ref supplied to generateMD')\n    return ''\n  }\n  const cigarOps = parseCigar(cigar)\n  let str = ''\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op === 'M' || op === 'X' || op === '=') {\n      for (let j = 0; j < len; j++) {\n        if (\n          query[queryOffset + j].toLowerCase() !==\n          target[targetOffset + j].toLowerCase()\n        ) {\n          str += `${lengthMD}${target[targetOffset + j].toUpperCase()}`\n          lengthMD = 0\n        } else {\n          lengthMD++\n        }\n      }\n      queryOffset += len\n      targetOffset += len\n    } else if (op === 'I') {\n      queryOffset += len\n    } else if (op === 'D') {\n      let tmp = ''\n      for (let j = 0; j < len; j++) {\n        tmp += target[targetOffset + j].toUpperCase()\n      }\n      str += `${lengthMD}^${tmp}`\n      lengthMD = 0\n      targetOffset += len\n    } else if (op === 'N') {\n      targetOffset += len\n    } else if (op === 'S') {\n      queryOffset += len\n    }\n  }\n  if (lengthMD > 0) {\n    str += lengthMD\n  }\n  return str\n}\n\n// get relative reference sequence positions for positions given relative to\n// the read sequence\nexport function* getNextRefPos(cigarOps: string[], positions: number[]) {\n  let cigarIdx = 0\n  let readPos = 0\n  let refPos = 0\n\n  for (let i = 0; i < positions.length; i++) {\n    const pos = positions[i]\n    for (; cigarIdx < cigarOps.length && readPos < pos; cigarIdx += 2) {\n      const len = +cigarOps[cigarIdx]\n      const op = cigarOps[cigarIdx + 1]\n      if (op === 'S' || op === 'I') {\n        readPos += len\n      } else if (op === 'D' || op === 'N') {\n        refPos += len\n      } else if (op === 'M' || op === 'X' || op === '=') {\n        readPos += len\n        refPos += len\n      }\n    }\n\n    yield positions[i] - readPos + refPos\n  }\n}\n\nexport function getModificationPositions(mm: string, seq: string) {\n  const mods = mm.split(';')\n  return mods\n    .filter(mod => !!mod)\n    .map(mod => {\n      const [basemod, ...rest] = mod.split(',')\n\n      // regexes based on parse_mm.pl from hts-specs\n      const matches = basemod.match(/([A-Z])([-+])([^,]+)/)\n      if (!matches) {\n        throw new Error('bad format for MM tag')\n      }\n      const [, base, strand, typestr] = matches\n\n      // can be a multi e.g. C+mh for both meth (m) and hydroxymeth (h) so\n      // split, and they can also be chemical codes (ChEBI) e.g. C+16061\n      const types = typestr.split(/(\\d+|.)/).filter(f => !!f)\n\n      if (strand === '-') {\n        console.warn('unsupported negative strand modifications')\n        // make sure to return a somewhat matching type even in this case\n        return { type: 'unsupported', positions: [] }\n      }\n\n      // this logic also based on parse_mm.pl from hts-specs is that in the\n      // sequence of the read, if we have a modification type e.g. C+m;2 and a\n      // sequence ACGTACGTAC we skip the two instances of C and go to the last\n      // C\n      return types.map(type => {\n        let i = 0\n        return {\n          type,\n          positions: rest\n            .map(score => +score)\n            .map(delta => {\n              i++\n              do {\n                if (base === 'N' || base === seq[i]) {\n                  delta--\n                }\n                i++\n              } while (delta >= 0 && i < seq.length)\n              i--\n              return i\n            }),\n        }\n      })\n    })\n    .flat()\n}\n\nexport function getModificationTypes(mm: string) {\n  const mods = mm.split(';')\n  return mods\n    .filter(mod => !!mod)\n    .map(mod => {\n      const [basemod] = mod.split(',')\n\n      const matches = basemod.match(/([A-Z])([-+])([^,]+)/)\n      if (!matches) {\n        throw new Error('bad format for MM tag')\n      }\n      const [, , , typestr] = matches\n\n      // can be a multi e.g. C+mh for both meth (m) and hydroxymeth (h) so\n      // split, and they can also be chemical codes (ChEBI) e.g. C+16061\n      return typestr.split(/(\\d+|.)/).filter(f => !!f)\n    })\n    .flat()\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default (pluginManager: PluginManager) => {\n  const { types } = pluginManager.lib['mobx-state-tree']\n  return types.late(() =>\n    ConfigurationSchema(\n      'CramAdapter',\n      {\n        cramLocation: {\n          type: 'fileLocation',\n          defaultValue: { uri: '/path/to/my.cram' },\n        },\n        craiLocation: {\n          type: 'fileLocation',\n          defaultValue: { uri: '/path/to/my.cram.crai' },\n        },\n        sequenceAdapter: pluginManager.pluggableConfigSchemaType('adapter'),\n      },\n      { explicitlyTyped: true },\n    ),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaF from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  return {\n    configSchema: pluginManager.load(configSchemaF),\n    getAdapterClass: () => import('./CramAdapter').then(r => r.default),\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default types.late(() =>\n  ConfigurationSchema(\n    'HtsgetBamAdapter',\n    {\n      htsgetBase: {\n        type: 'string',\n        defaultValue: '',\n      },\n      htsgetTrackId: {\n        type: 'string',\n        defaultValue: '',\n      },\n      sequenceAdapter: {\n        type: 'frozen',\n        defaultValue: null,\n      },\n    },\n    { explicitlyTyped: true },\n  ),\n)\n","import configSchema from './configSchema'\n\nexport default (/* pluginManager: PluginManager */) => {\n  return {\n    configSchema,\n    getAdapterClass: () => import('./HtsgetBamAdapter').then(r => r.default),\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nconst configModelFactory = (pluginManager: PluginManager) => {\n  const PileupDisplayConfigSchema = pluginManager.getDisplayType(\n    'LinearPileupDisplay',\n  ).configSchema\n  const SNPCoverageDisplayConfigSchema = pluginManager.getDisplayType(\n    'LinearSNPCoverageDisplay',\n  ).configSchema\n\n  return ConfigurationSchema(\n    'LinearAlignmentsDisplay',\n    {\n      pileupDisplay: PileupDisplayConfigSchema,\n      snpCoverageDisplay: SNPCoverageDisplayConfigSchema,\n    },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n\nexport type AlignmentsConfigModel = ReturnType<typeof configModelFactory>\nexport default configModelFactory\n","import React from 'react'\nimport { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport deepEqual from 'fast-deep-equal'\nimport { autorun, when } from 'mobx'\nimport { addDisposer, getSnapshot, Instance, types } from 'mobx-state-tree'\nimport { getContainingTrack } from '@jbrowse/core/util'\nimport { AlignmentsConfigModel } from './configSchema'\n\nconst minDisplayHeight = 20\nconst stateModelFactory = (\n  pluginManager: PluginManager,\n  configSchema: AlignmentsConfigModel,\n) => {\n  return types\n    .compose(\n      'LinearAlignmentsDisplay',\n      BaseDisplay,\n      types.model({\n        PileupDisplay: types.maybe(\n          pluginManager.getDisplayType('LinearPileupDisplay').stateModel,\n        ),\n        SNPCoverageDisplay: types.maybe(\n          pluginManager.getDisplayType('LinearSNPCoverageDisplay').stateModel,\n        ),\n        snpCovHeight: 45,\n        type: types.literal('LinearAlignmentsDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        height: 250,\n        showCoverage: true,\n        showPileup: true,\n      }),\n    )\n    .volatile(() => ({\n      scrollTop: 0,\n    }))\n    .actions(self => ({\n      toggleCoverage() {\n        self.showCoverage = !self.showCoverage\n      },\n      togglePileup() {\n        self.showPileup = !self.showPileup\n      },\n      setScrollTop(scrollTop: number) {\n        self.scrollTop = scrollTop\n      },\n      setSNPCoverageHeight(n: number) {\n        self.snpCovHeight = n\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems } = self\n      return {\n        get pileupDisplayConfig() {\n          const conf = getConf(self, 'pileupDisplay')\n          const track = getContainingTrack(self)\n          return {\n            ...conf,\n            type: 'LinearPileupDisplay',\n            name: `${getConf(track, 'name')} pileup`,\n            displayId: `${self.configuration.displayId}_pileup_xyz`, // xyz to avoid someone accidentally naming the displayId similar to this\n          }\n        },\n\n        getFeatureByID(id: string) {\n          return self.PileupDisplay.getFeatureByID(id)\n        },\n\n        get features() {\n          return self.PileupDisplay.features\n        },\n\n        get DisplayBlurb() {\n          return self.PileupDisplay?.DisplayBlurb\n        },\n\n        get sortedBy() {\n          return self.PileupDisplay.sortedBy\n        },\n        get sortedByPosition() {\n          return self.PileupDisplay.sortedByPosition\n        },\n        get sortedByRefName() {\n          return self.PileupDisplay.sortedByRefName\n        },\n\n        get snpCoverageDisplayConfig() {\n          const conf = getConf(self, 'snpCoverageDisplay')\n          const track = getContainingTrack(self)\n          return {\n            ...conf,\n            type: 'LinearSNPCoverageDisplay',\n            name: `${getConf(track, 'name')} snp coverage`,\n            displayId: `${self.configuration.displayId}_snpcoverage_xyz`, // xyz to avoid someone accidentally naming the displayId similar to this\n          }\n        },\n\n        get trackMenuItems(): MenuItem[] {\n          return [\n            ...trackMenuItems,\n            {\n              type: 'subMenu',\n              label: 'Pileup settings',\n              subMenu: self.PileupDisplay.composedTrackMenuItems,\n            },\n            {\n              type: 'subMenu',\n              label: 'SNPCoverage settings',\n              subMenu: [\n                ...self.SNPCoverageDisplay.composedTrackMenuItems,\n                ...self.SNPCoverageDisplay.extraTrackMenuItems,\n              ],\n            },\n          ]\n        },\n      }\n    })\n    .actions(self => ({\n      setSNPCoverageDisplay(displayConfig: AnyConfigurationModel) {\n        self.SNPCoverageDisplay = {\n          type: 'LinearSNPCoverageDisplay',\n          configuration: displayConfig,\n          height: self.snpCovHeight,\n        }\n      },\n      setUserBpPerPxLimit(limit: number) {\n        self.PileupDisplay.setUserBpPerPxLimit(limit)\n        self.SNPCoverageDisplay.setUserBpPerPxLimit(limit)\n      },\n      setPileupDisplay(displayConfig: AnyConfigurationModel) {\n        self.PileupDisplay = {\n          type: 'LinearPileupDisplay',\n          configuration: displayConfig,\n        }\n      },\n      setHeight(displayHeight: number) {\n        if (displayHeight > minDisplayHeight) {\n          self.height = displayHeight\n        } else {\n          self.height = minDisplayHeight\n        }\n        return self.height\n      },\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = this.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            if (!self.SNPCoverageDisplay) {\n              self.setSNPCoverageDisplay(self.snpCoverageDisplayConfig)\n            } else if (\n              !deepEqual(\n                self.snpCoverageDisplayConfig,\n                getSnapshot(self.SNPCoverageDisplay.configuration),\n              )\n            ) {\n              self.SNPCoverageDisplay.setHeight(self.snpCovHeight)\n              self.SNPCoverageDisplay.setConfig(self.snpCoverageDisplayConfig)\n            }\n\n            if (!self.PileupDisplay) {\n              self.setPileupDisplay(self.pileupDisplayConfig)\n            } else if (\n              !deepEqual(\n                self.pileupDisplayConfig,\n                getSnapshot(self.PileupDisplay.configuration),\n              )\n            ) {\n              self.PileupDisplay.setConfig(self.pileupDisplayConfig)\n            }\n\n            // propagate the filterBy setting from pileupdisplay to snpcoverage\n            // note: the snpcoverage display is not able to control filterBy\n            // itself\n            if (\n              self.PileupDisplay.filterBy &&\n              !deepEqual(\n                getSnapshot(self.PileupDisplay.filterBy),\n                getSnapshot(self.SNPCoverageDisplay.filterBy),\n              )\n            ) {\n              self.SNPCoverageDisplay.setFilterBy(\n                getSnapshot(self.PileupDisplay.filterBy),\n              )\n            }\n            if (\n              self.PileupDisplay.colorBy &&\n              !deepEqual(\n                getSnapshot(self.PileupDisplay.colorBy),\n                self.SNPCoverageDisplay.colorBy\n                  ? getSnapshot(self.SNPCoverageDisplay.colorBy)\n                  : {},\n              )\n            ) {\n              self.SNPCoverageDisplay.setColorBy(\n                getSnapshot(self.PileupDisplay.colorBy),\n              )\n            }\n          }),\n        )\n        addDisposer(\n          self,\n          autorun(() => {\n            self.setSNPCoverageHeight(self.SNPCoverageDisplay.height)\n          }),\n        )\n      },\n      async renderSvg(opts: { rasterizeLayers?: boolean }) {\n        const pileupHeight = self.height - self.SNPCoverageDisplay.height\n        await when(() => self.PileupDisplay.ready)\n        return (\n          <>\n            <g>{await self.SNPCoverageDisplay.renderSvg(opts)}</g>\n            <g transform={`translate(0 ${self.SNPCoverageDisplay.height})`}>\n              {\n                await self.PileupDisplay.renderSvg({\n                  ...opts,\n                  overrideHeight: pileupHeight,\n                })\n              }\n            </g>\n          </>\n        )\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type AlignmentsDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type AlignmentsDisplayModel = Instance<AlignmentsDisplayStateModel>\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { ResizeHandle } from '@jbrowse/core/ui'\nimport { AlignmentsDisplayModel } from '../models/model'\n\nfunction AlignmentsDisplay({ model }: { model: AlignmentsDisplayModel }) {\n  const { PileupDisplay, SNPCoverageDisplay, showPileup, showCoverage } = model\n  return (\n    <div\n      data-testid={`display-${getConf(model, 'displayId')}`}\n      style={{ position: 'relative' }}\n    >\n      <div data-testid=\"Blockset-snpcoverage\">\n        {showCoverage ? (\n          <SNPCoverageDisplay.RenderingComponent model={SNPCoverageDisplay} />\n        ) : null}\n      </div>\n      <ResizeHandle\n        onDrag={delta => {\n          if (SNPCoverageDisplay) {\n            SNPCoverageDisplay.setHeight(SNPCoverageDisplay.height + delta)\n            return delta\n          }\n          return 0\n        }}\n        style={{\n          position: 'absolute',\n          top: showCoverage ? SNPCoverageDisplay.height + 2 : 0,\n          height: 3,\n        }}\n      />\n\n      <div\n        data-testid=\"Blockset-pileup\"\n        style={{\n          position: 'absolute',\n          top: showCoverage ? SNPCoverageDisplay.height + 5 : 0,\n          height: 3,\n        }}\n      >\n        {showPileup ? (\n          <PileupDisplay.RenderingComponent model={PileupDisplay} />\n        ) : null}\n      </div>\n    </div>\n  )\n}\n\nexport default observer(AlignmentsDisplay)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\nimport { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nfunction PileupConfigFactory(pluginManager: PluginManager) {\n  const PileupRendererConfigSchema = pluginManager.getRendererType(\n    'PileupRenderer',\n  ).configSchema\n  const SvgFeatureRendererConfigSchema = pluginManager.getRendererType(\n    'SvgFeatureRenderer',\n  ).configSchema\n\n  // modify config schema to take in a sub coverage display\n  return ConfigurationSchema(\n    'LinearPileupDisplay',\n    {\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', ['pileup', 'svg']),\n        defaultValue: 'pileup',\n      },\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        PileupRenderer: PileupRendererConfigSchema,\n        SvgFeatureRenderer: SvgFeatureRendererConfigSchema,\n      }),\n      renderer: '',\n      maxDisplayedBpPerPx: {\n        type: 'number',\n        description: 'maximum bpPerPx that is displayed in the view',\n        defaultValue: 100,\n      },\n      colorScheme: {\n        type: 'stringEnum',\n        model: types.enumeration('colorScheme', [\n          'strand',\n          'normal',\n          'insertSize',\n          'insertSizeAndOrientation',\n          'mappingQuality',\n          'tag',\n        ]),\n        description: 'color scheme to use',\n        defaultValue: 'normal',\n      },\n    },\n    {\n      baseConfiguration: linearBasicDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport type LinearPileupDisplayConfigModel = ReturnType<\n  typeof PileupConfigFactory\n>\nexport type LinearPileupDisplayConfig = Instance<LinearPileupDisplayConfigModel>\nexport default PileupConfigFactory\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport Typography from '@material-ui/core/Typography'\n\nexport interface LinearPileupDisplayBlurbProps {\n  model: {\n    sortedBy?: {\n      pos: number\n      refName: number\n      type: string\n    }\n  }\n}\n\nfunction LinearPileupDisplayBlurb(props: LinearPileupDisplayBlurbProps) {\n  const { model } = props\n  const { sortedBy } = model\n  return sortedBy ? (\n    <div\n      data-testid={`blurb-${model.sortedBy}`}\n      style={{ backgroundColor: 'white' }}\n    >\n      <Typography color=\"secondary\" variant=\"caption\">\n        {model.sortedBy\n          ? `Sorted by ${sortedBy.type.toLowerCase()} at ${sortedBy.refName}:${\n              sortedBy.pos\n            }`\n          : null}\n      </Typography>\n    </div>\n  ) : null\n}\nexport default observer(LinearPileupDisplayBlurb)\n","import { BlockSet } from '@jbrowse/core/util/blockTypes'\n\nimport { getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\nexport async function getUniqueTagValues(\n  self: IAnyStateTreeNode & { adapterConfig: AnyConfigurationModel },\n  colorScheme: { type: string; tag?: string },\n  blocks: BlockSet,\n  opts?: {\n    headers?: Record<string, string>\n    signal?: AbortSignal\n    filters?: string[]\n  },\n) {\n  const { rpcManager } = getSession(self)\n  const { adapterConfig } = self\n  const sessionId = getRpcSessionId(self)\n  const values = await rpcManager.call(\n    getRpcSessionId(self),\n    'PileupGetGlobalValueForTag',\n    {\n      adapterConfig,\n      tag: colorScheme.tag,\n      sessionId,\n      regions: blocks.contentBlocks,\n      ...opts,\n    },\n  )\n  return values as string[]\n}\n\nexport async function getUniqueModificationValues(\n  self: IAnyStateTreeNode,\n  adapterConfig: AnyConfigurationModel,\n  colorScheme: { type: string; tag?: string },\n  blocks: BlockSet,\n  opts?: {\n    headers?: Record<string, string>\n    signal?: AbortSignal\n    filters?: string[]\n  },\n) {\n  const { rpcManager } = getSession(self)\n  const sessionId = getRpcSessionId(self)\n  const values = await rpcManager.call(\n    sessionId,\n    'PileupGetVisibleModifications',\n    {\n      adapterConfig,\n      tag: colorScheme.tag,\n      sessionId,\n      regions: blocks.contentBlocks,\n      ...opts,\n    },\n  )\n  return values as string[]\n}\n","import { lazy } from 'react'\nimport {\n  ConfigurationReference,\n  readConfObject,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n} from '@jbrowse/core/util/tracks'\nimport {\n  getSession,\n  isSessionModelWithWidgets,\n  getContainingView,\n} from '@jbrowse/core/util'\n\nimport VisibilityIcon from '@material-ui/icons/Visibility'\nimport { ContentCopy as ContentCopyIcon } from '@jbrowse/core/ui/Icons'\nimport {\n  LinearGenomeViewModel,\n  BaseLinearDisplay,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { cast, types, addDisposer, getEnv, Instance } from 'mobx-state-tree'\nimport copy from 'copy-to-clipboard'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport MenuOpenIcon from '@material-ui/icons/MenuOpen'\nimport SortIcon from '@material-ui/icons/Sort'\nimport PaletteIcon from '@material-ui/icons/Palette'\nimport FilterListIcon from '@material-ui/icons/ClearAll'\n\nimport { autorun, observable } from 'mobx'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { LinearPileupDisplayConfigModel } from './configSchema'\nimport LinearPileupDisplayBlurb from './components/LinearPileupDisplayBlurb'\n\nimport { getUniqueTagValues, getUniqueModificationValues } from '../shared'\n\nconst ColorByTagDlg = lazy(() => import('./components/ColorByTag'))\nconst FilterByTagDlg = lazy(() => import('./components/FilterByTag'))\nconst SortByTagDlg = lazy(() => import('./components/SortByTag'))\nconst SetFeatureHeightDlg = lazy(() => import('./components/SetFeatureHeight'))\nconst SetMaxHeightDlg = lazy(() => import('./components/SetMaxHeight'))\nconst ModificationsDlg = lazy(() => import('./components/ColorByModifications'))\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['pileup', 'PileupRenderer'],\n  ['svg', 'SvgFeatureRenderer'],\n])\n\ntype LGV = LinearGenomeViewModel\n\nconst stateModelFactory = (\n  pluginManager: PluginManager,\n  configSchema: LinearPileupDisplayConfigModel,\n) =>\n  types\n    .compose(\n      'LinearPileupDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearPileupDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        showSoftClipping: false,\n        featureHeight: types.maybe(types.number),\n        noSpacing: types.maybe(types.boolean),\n        fadeLikelihood: types.maybe(types.boolean),\n        trackMaxHeight: types.maybe(types.number),\n        mismatchAlpha: types.maybe(types.boolean),\n        sortedBy: types.maybe(\n          types.model({\n            type: types.string,\n            pos: types.number,\n            tag: types.maybe(types.string),\n            refName: types.string,\n            assemblyName: types.string,\n          }),\n        ),\n        colorBy: types.maybe(\n          types.model({\n            type: types.string,\n            tag: types.maybe(types.string),\n            extra: types.frozen(),\n          }),\n        ),\n        filterBy: types.optional(\n          types.model({\n            flagInclude: types.optional(types.number, 0),\n            flagExclude: types.optional(types.number, 1536),\n            readName: types.maybe(types.string),\n            tagFilter: types.maybe(\n              types.model({ tag: types.string, value: types.string }),\n            ),\n          }),\n          {},\n        ),\n      }),\n    )\n    .volatile(() => ({\n      colorTagMap: observable.map<string, string>({}),\n      modificationTagMap: observable.map<string, string>({}),\n      ready: false,\n      currBpPerPx: 0,\n    }))\n    .actions(self => ({\n      setReady(flag: boolean) {\n        self.ready = flag\n      },\n      setCurrBpPerPx(n: number) {\n        self.currBpPerPx = n\n      },\n      setMaxHeight(n: number) {\n        self.trackMaxHeight = n\n      },\n      setFeatureHeight(n: number) {\n        self.featureHeight = n\n      },\n      setNoSpacing(flag: boolean) {\n        self.noSpacing = flag\n      },\n\n      setColorScheme(colorScheme: { type: string; tag?: string }) {\n        self.colorTagMap = observable.map({}) // clear existing mapping\n        self.colorBy = cast(colorScheme)\n        self.ready = false\n      },\n\n      updateModificationColorMap(uniqueModifications: string[]) {\n        const colorPalette = ['red', 'blue', 'green', 'orange', 'purple']\n        uniqueModifications.forEach(value => {\n          if (!self.modificationTagMap.has(value)) {\n            const totalKeys = [...self.modificationTagMap.keys()].length\n            const newColor = colorPalette[totalKeys]\n            self.modificationTagMap.set(value, newColor)\n          }\n        })\n      },\n\n      updateColorTagMap(uniqueTag: string[]) {\n        // pale color scheme https://cran.r-project.org/web/packages/khroma/vignettes/tol.html e.g. \"tol_light\"\n        const colorPalette = [\n          '#BBCCEE',\n          'pink',\n          '#CCDDAA',\n          '#EEEEBB',\n          '#FFCCCC',\n          'lightblue',\n          'lightgreen',\n          'tan',\n          '#CCEEFF',\n          'lightsalmon',\n        ]\n\n        uniqueTag.forEach(value => {\n          if (!self.colorTagMap.has(value)) {\n            const totalKeys = [...self.colorTagMap.keys()].length\n            const newColor = colorPalette[totalKeys]\n            self.colorTagMap.set(value, newColor)\n          }\n        })\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            async () => {\n              try {\n                const { rpcManager } = getSession(self)\n                const { sortedBy, colorBy, renderProps } = self\n                const view = getContainingView(self) as LGV\n\n                // continually generate the vc pairing, set and rerender if any\n                // new values seen\n                if (colorBy?.tag) {\n                  const uniqueTagSet = await getUniqueTagValues(\n                    self,\n                    colorBy,\n                    view.staticBlocks,\n                  )\n                  self.updateColorTagMap(uniqueTagSet)\n                }\n\n                if (colorBy?.type === 'modifications') {\n                  const uniqueModificationsSet = await getUniqueModificationValues(\n                    self,\n                    getConf(self.parentTrack, ['adapter']),\n                    colorBy,\n                    view.staticBlocks,\n                  )\n                  self.updateModificationColorMap(uniqueModificationsSet)\n                }\n\n                if (sortedBy) {\n                  const { pos, refName, assemblyName } = sortedBy\n\n                  const region = {\n                    start: pos,\n                    end: (pos || 0) + 1,\n                    refName,\n                    assemblyName,\n                  }\n\n                  // render just the sorted region first\n                  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                  await (self.rendererType as any).renderInClient(rpcManager, {\n                    assemblyName,\n                    regions: [region],\n                    adapterConfig: self.adapterConfig,\n                    rendererType: self.rendererType.name,\n                    sessionId: getRpcSessionId(self),\n                    timeout: 1000000,\n                    ...renderProps,\n                  })\n                  self.setReady(true)\n                  self.setCurrBpPerPx(view.bpPerPx)\n                } else {\n                  self.setReady(true)\n                }\n              } catch (error) {\n                console.error(error)\n                self.setError(error)\n              }\n            },\n            { delay: 1000 },\n          ),\n        )\n      },\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const featureWidget = session.addWidget(\n            'AlignmentsFeatureWidget',\n            'alignmentFeature',\n            { featureData: feature.toJSON(), view: getContainingView(self) },\n          )\n          session.showWidget(featureWidget)\n        }\n        session.setSelection(feature)\n      },\n\n      clearSelected() {\n        self.sortedBy = undefined\n      },\n\n      // uses copy-to-clipboard and generates notification\n      copyFeatureToClipboard(feature: Feature) {\n        const copiedFeature = feature.toJSON()\n        delete copiedFeature.uniqueId\n        const session = getSession(self)\n        copy(JSON.stringify(copiedFeature, null, 4))\n        session.notify('Copied to clipboard', 'success')\n      },\n\n      toggleSoftClipping() {\n        self.showSoftClipping = !self.showSoftClipping\n      },\n      toggleMismatchAlpha() {\n        self.mismatchAlpha = !self.mismatchAlpha\n      },\n\n      setConfig(configuration: AnyConfigurationModel) {\n        self.configuration = configuration\n      },\n\n      setSortedBy(type: string, tag?: string) {\n        const { centerLineInfo } = getContainingView(self) as LGV\n        if (!centerLineInfo) {\n          return\n        }\n        const { refName, assemblyName, offset } = centerLineInfo\n        const centerBp = Math.round(offset) + 1\n        const centerRefName = refName\n\n        if (centerBp < 0) {\n          return\n        }\n\n        self.sortedBy = {\n          type,\n          pos: centerBp,\n          refName: centerRefName,\n          assemblyName,\n          tag,\n        }\n        self.ready = false\n      },\n      setFilterBy(filter: {\n        flagInclude: number\n        flagExclude: number\n        readName?: string\n        tagFilter?: { tag: string; value: string }\n      }) {\n        self.filterBy = cast(filter)\n      },\n    }))\n    .actions(self => {\n      // resets the sort object and refresh whole display on reload\n      const superReload = self.reload\n\n      return {\n        reload() {\n          self.clearSelected()\n          superReload()\n        },\n      }\n    })\n\n    .views(self => ({\n      get maxHeight() {\n        const conf = getConf(self, ['renderers', self.rendererTypeName]) || {}\n        return self.trackMaxHeight !== undefined\n          ? self.trackMaxHeight\n          : conf.maxHeight\n      },\n      get rendererConfig() {\n        const configBlob =\n          getConf(self, ['renderers', self.rendererTypeName]) || {}\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            height: self.featureHeight,\n            noSpacing: self.noSpacing,\n            maxHeight: this.maxHeight,\n            mismatchAlpha: self.mismatchAlpha,\n          },\n          getEnv(self),\n        )\n      },\n      get featureHeightSetting() {\n        return (\n          self.featureHeight || readConfObject(this.rendererConfig, 'height')\n        )\n      },\n      get mismatchAlphaSetting() {\n        return self.mismatchAlpha !== undefined\n          ? self.mismatchAlpha\n          : readConfObject(this.rendererConfig, 'mismatchAlpha')\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems } = self\n      return {\n        get rendererTypeName() {\n          const viewName = getConf(self, 'defaultRendering')\n          const rendererType = rendererTypes.get(viewName)\n          if (!rendererType) {\n            throw new Error(`unknown alignments view name ${viewName}`)\n          }\n          return rendererType\n        },\n\n        get contextMenuItems() {\n          const feat = self.contextMenuFeature\n          const contextMenuItems = feat\n            ? [\n                {\n                  label: 'Open feature details',\n                  icon: MenuOpenIcon,\n                  onClick: () => {\n                    self.clearFeatureSelection()\n                    if (feat) {\n                      self.selectFeature(feat)\n                    }\n                  },\n                },\n                {\n                  label: 'Copy info to clipboard',\n                  icon: ContentCopyIcon,\n                  onClick: () => {\n                    if (feat) {\n                      self.copyFeatureToClipboard(feat)\n                    }\n                  },\n                },\n              ]\n            : []\n          self.additionalContextMenuItemCallbacks.forEach(\n            (callback: Function) => {\n              const menuItems = callback(feat, self, pluginManager)\n              contextMenuItems.push(...menuItems)\n            },\n          )\n          return contextMenuItems\n        },\n\n        get DisplayBlurb() {\n          return LinearPileupDisplayBlurb\n        },\n\n        get filters() {\n          let filters: string[] = []\n          if (self.filterBy) {\n            const { flagInclude, flagExclude } = self.filterBy\n            filters = [\n              `jexl:((get(feature,'flags')&${flagInclude})==${flagInclude}) && !(get(feature,'flags')&${flagExclude})`,\n            ]\n            if (self.filterBy.tagFilter) {\n              const { tag, value } = self.filterBy.tagFilter\n              filters.push(\n                `jexl:\"${value}\" =='*' ? getTag(feature,\"${tag}\") != undefined : getTag(feature,\"${tag}\") == \"${value}\"`,\n              )\n            }\n            if (self.filterBy.readName) {\n              const { readName } = self.filterBy\n              filters.push(`jexl:get(feature,'name') == \"${readName}\"`)\n            }\n          }\n          return new SerializableFilterChain({ filters })\n        },\n\n        get renderProps() {\n          const view = getContainingView(self) as LGV\n          return {\n            ...self.composedRenderProps,\n            ...getParentRenderProps(self),\n            notReady:\n              !self.ready ||\n              (self.sortedBy && self.currBpPerPx !== view.bpPerPx),\n            rpcDriverName: self.rpcDriverName,\n            displayModel: self,\n            sortedBy: self.sortedBy,\n            colorBy: self.colorBy,\n            colorTagMap: JSON.parse(JSON.stringify(self.colorTagMap)),\n            modificationTagMap: JSON.parse(\n              JSON.stringify(self.modificationTagMap),\n            ),\n            filters: this.filters,\n            showSoftClip: self.showSoftClipping,\n            config: self.rendererConfig,\n          }\n        },\n\n        get composedTrackMenuItems() {\n          return [\n            {\n              label: 'Show soft clipping',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showSoftClipping,\n              onClick: () => {\n                self.toggleSoftClipping()\n                // if toggling from off to on, will break sort for this track\n                // so clear it\n                if (self.showSoftClipping) {\n                  self.clearSelected()\n                }\n              },\n            },\n            {\n              label: 'Sort by',\n              icon: SortIcon,\n              disabled: self.showSoftClipping,\n              subMenu: [\n                ...['Start location', 'Read strand', 'Base pair'].map(\n                  option => {\n                    return {\n                      label: option,\n                      onClick: () => self.setSortedBy(option),\n                    }\n                  },\n                ),\n                {\n                  label: 'Sort by tag...',\n                  onClick: () =>\n                    getSession(self).setDialogComponent(SortByTagDlg, {\n                      model: self,\n                    }),\n                },\n                {\n                  label: 'Clear sort',\n                  onClick: () => self.clearSelected(),\n                },\n              ],\n            },\n            {\n              label: 'Color scheme',\n              icon: PaletteIcon,\n              subMenu: [\n                {\n                  label: 'Normal',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'normal' })\n                  },\n                },\n                {\n                  label: 'Mapping quality',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'mappingQuality' })\n                  },\n                },\n                {\n                  label: 'Strand',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'strand' })\n                  },\n                },\n                {\n                  label: 'Pair orientation',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'pairOrientation' })\n                  },\n                },\n                {\n                  label: 'Per-base quality',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'perBaseQuality' })\n                  },\n                },\n                {\n                  label: 'Modifications or methylation',\n                  onClick: () => {\n                    getSession(self).setDialogComponent(ModificationsDlg, {\n                      model: self,\n                    })\n                  },\n                },\n                {\n                  label: 'Insert size',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'insertSize' })\n                  },\n                },\n                {\n                  label: 'Stranded paired-end',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'reverseTemplate' })\n                  },\n                },\n                {\n                  label: 'Color by tag...',\n                  onClick: () => {\n                    getSession(self).setDialogComponent(ColorByTagDlg, {\n                      model: self,\n                    })\n                  },\n                },\n              ],\n            },\n            {\n              label: 'Filter by',\n              icon: FilterListIcon,\n              onClick: () => {\n                getSession(self).setDialogComponent(FilterByTagDlg, {\n                  model: self,\n                })\n              },\n            },\n            {\n              label: 'Set feature height',\n              onClick: () => {\n                getSession(self).setDialogComponent(SetFeatureHeightDlg, {\n                  model: self,\n                })\n              },\n            },\n            {\n              label: 'Set max height',\n              onClick: () => {\n                getSession(self).setDialogComponent(SetMaxHeightDlg, {\n                  model: self,\n                })\n              },\n            },\n            {\n              label: 'Fade mismatches by quality',\n              type: 'checkbox',\n              checked: self.mismatchAlphaSetting,\n              onClick: () => {\n                self.toggleMismatchAlpha()\n              },\n            },\n          ]\n        },\n\n        get trackMenuItems() {\n          return [...trackMenuItems, ...this.composedTrackMenuItems]\n        },\n      }\n    })\n\nexport type LinearPileupDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearPileupDisplayModel = Instance<LinearPileupDisplayStateModel>\n\nexport default stateModelFactory\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function SNPCoverageConfigFactory(pluginManager: PluginManager) {\n  const SNPCoverageRendererConfigSchema = pluginManager.getRendererType(\n    'SNPCoverageRenderer',\n  ).configSchema\n\n  return ConfigurationSchema(\n    'LinearSNPCoverageDisplay',\n    {\n      autoscale: {\n        type: 'stringEnum',\n        defaultValue: 'local',\n        model: types.enumeration('Autoscale type', ['local']),\n        description:\n          'performs local autoscaling (no other options for SNP Coverage available)',\n      },\n      minScore: {\n        type: 'number',\n        defaultValue: Number.MIN_VALUE,\n        description: 'minimum value for the y-scale',\n      },\n      maxScore: {\n        type: 'number',\n        description: 'maximum value for the y-scale',\n        defaultValue: Number.MAX_VALUE,\n      },\n      scaleType: {\n        type: 'stringEnum',\n        model: types.enumeration('Scale type', ['linear', 'log']), // todo zscale\n        description: 'The type of scale to use',\n        defaultValue: 'linear',\n      },\n      inverted: {\n        type: 'boolean',\n        description: 'draw upside down',\n        defaultValue: false,\n      },\n      maxDisplayedBpPerPx: {\n        type: 'number',\n        description: 'maximum bpPerPx that is displayed in the view',\n        defaultValue: 100,\n      },\n      headroom: {\n        type: 'number',\n        description:\n          'round the upper value of the domain scale to the nearest N',\n        defaultValue: 0,\n      },\n\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        SNPCoverageRenderer: SNPCoverageRendererConfigSchema,\n      }),\n    },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport MUITooltip from '@material-ui/core/Tooltip'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\n\nconst useStyles = makeStyles(theme => ({\n  popper: {\n    fontSize: '0.8em',\n    zIndex: theme.zIndex.tooltip, // important to have a zIndex directly on the popper itself, material-ui Tooltip uses popper and has similar thing\n    pointerEvents: 'none', // needed to avoid rapid mouseLeave/mouseEnter on popper\n  },\n\n  hoverVertical: {\n    background: '#333',\n    border: 'none',\n    width: 1,\n    height: '100%',\n    top: 0,\n    cursor: 'default',\n    position: 'absolute',\n    pointerEvents: 'none',\n  },\n}))\n\ntype Count = {\n  [key: string]: {\n    total: number\n    strands: { [key: string]: number }\n  }\n}\n\nfunction TooltipContents({ feature }: { feature: Feature }) {\n  const refName = feature.get('refName')\n  const start = (feature.get('start') + 1).toLocaleString('en-US')\n  const end = feature.get('end').toLocaleString('en-US')\n  const loc = `${refName ? `${refName}:` : ''}${\n    start === end ? start : `${start}..${end}`\n  }`\n\n  const info = feature.get('snpinfo') as {\n    ref: Count\n    cov: Count\n    lowqual: Count\n    noncov: Count\n    delskips: Count\n    total: number\n  }\n\n  const { total, ref, cov, noncov, lowqual, delskips } = info\n  return (\n    <div>\n      <table>\n        <caption>{loc}</caption>\n        <thead>\n          <tr>\n            <th>Base</th>\n            <th>Count</th>\n            <th>% of Total</th>\n            <th>Strands</th>\n            <th>Source</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr>\n            <td>Total</td>\n            <td>{total}</td>\n            <td />\n          </tr>\n\n          {Object.entries({ ref, cov, noncov, delskips, lowqual }).map(\n            ([key, entry]) => {\n              return (\n                <React.Fragment key={key}>\n                  {Object.entries(entry).map(([base, score]) => {\n                    const { strands } = score\n                    return (\n                      <tr key={base}>\n                        <td>{base.toUpperCase()}</td>\n                        <td>{score.total}</td>\n                        <td>\n                          {base === 'total'\n                            ? '---'\n                            : `${Math.floor((score.total / total) * 100)}%`}\n                        </td>\n                        <td>\n                          {strands['-1'] ? `${strands['-1']}(-)` : ''}\n                          {strands['1'] ? `${strands['1']}(+)` : ''}\n                        </td>\n                        <td>{key}</td>\n                      </tr>\n                    )\n                  })}\n                </React.Fragment>\n              )\n            },\n          )}\n        </tbody>\n      </table>\n    </div>\n  )\n}\n\ntype Coord = [number, number]\nconst Tooltip = observer(\n  ({\n    model,\n    height,\n    mouseCoord,\n  }: {\n    model: any\n    height: number\n    mouseCoord: Coord\n  }) => {\n    const { featureUnderMouse } = model\n    const classes = useStyles()\n\n    return featureUnderMouse ? (\n      <>\n        <MUITooltip\n          placement=\"right-start\"\n          className={classes.popper}\n          open\n          title={<TooltipContents feature={featureUnderMouse} />}\n        >\n          <div\n            style={{\n              position: 'absolute',\n              left: mouseCoord[0],\n              top: 0,\n            }}\n          >\n            {' '}\n          </div>\n        </MUITooltip>\n        <div\n          className={classes.hoverVertical}\n          style={{ left: mouseCoord[0], height }}\n        />\n      </>\n    ) : null\n  },\n)\n\nexport default Tooltip\n","import { addDisposer, types, cast, getEnv, getSnapshot } from 'mobx-state-tree'\nimport { observable, autorun } from 'mobx'\nimport { getConf, readConfObject } from '@jbrowse/core/configuration'\nimport { linearWiggleDisplayModelFactory } from '@jbrowse/plugin-wiggle'\nimport {\n  AnyConfigurationSchemaType,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration/configurationSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { getContainingView } from '@jbrowse/core/util'\nimport Tooltip from '../components/Tooltip'\nimport { getUniqueModificationValues } from '../../shared'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\n// using a map because it preserves order\nconst rendererTypes = new Map([['snpcoverage', 'SNPCoverageRenderer']])\n\ntype LGV = LinearGenomeViewModel\n\nconst stateModelFactory = (\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) =>\n  types\n    .compose(\n      'LinearSNPCoverageDisplay',\n      linearWiggleDisplayModelFactory(pluginManager, configSchema),\n      types.model({\n        type: types.literal('LinearSNPCoverageDisplay'),\n        drawInterbaseCounts: types.maybe(types.boolean),\n        drawIndicators: types.maybe(types.boolean),\n        filterBy: types.optional(\n          types.model({\n            flagInclude: types.optional(types.number, 0),\n            flagExclude: types.optional(types.number, 1536),\n            readName: types.maybe(types.string),\n            tagFilter: types.maybe(\n              types.model({ tag: types.string, value: types.string }),\n            ),\n          }),\n          {},\n        ),\n        colorBy: types.maybe(\n          types.model({\n            type: types.string,\n            tag: types.maybe(types.string),\n          }),\n        ),\n      }),\n    )\n    .volatile(() => ({\n      modificationTagMap: observable.map({}),\n    }))\n    .actions(self => ({\n      setConfig(configuration: AnyConfigurationModel) {\n        self.configuration = configuration\n      },\n      setFilterBy(filter: {\n        flagInclude: number\n        flagExclude: number\n        readName?: string\n        tagFilter?: { tag: string; value: string }\n      }) {\n        self.filterBy = cast(filter)\n      },\n      setColorBy(colorBy?: { type: string; tag?: string }) {\n        self.colorBy = cast(colorBy)\n      },\n\n      updateModificationColorMap(uniqueModifications: string[]) {\n        const colorPalette = ['red', 'blue', 'green', 'orange', 'purple']\n        let i = 0\n\n        uniqueModifications.forEach(value => {\n          if (!self.modificationTagMap.has(value)) {\n            const newColor = colorPalette[i++]\n            self.modificationTagMap.set(value, newColor)\n          }\n        })\n      },\n    }))\n    .views(self => ({\n      get rendererConfig() {\n        const configBlob =\n          getConf(self, ['renderers', self.rendererTypeName]) || {}\n\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            drawInterbaseCounts:\n              self.drawInterbaseCounts === undefined\n                ? configBlob.drawInterbaseCounts\n                : self.drawInterbaseCounts,\n            drawIndicators:\n              self.drawIndicators === undefined\n                ? configBlob.drawIndicators\n                : self.drawIndicators,\n          },\n          getEnv(self),\n        )\n      },\n      get drawInterbaseCountsSetting() {\n        return self.drawInterbaseCounts !== undefined\n          ? self.drawInterbaseCounts\n          : readConfObject(this.rendererConfig, 'drawInterbaseCounts')\n      },\n      get drawIndicatorsSetting() {\n        return self.drawIndicators !== undefined\n          ? self.drawIndicators\n          : readConfObject(this.rendererConfig, 'drawIndicators')\n      },\n\n      get modificationsReady() {\n        return self.colorBy?.type === 'modifications'\n          ? Object.keys(JSON.parse(JSON.stringify(self.modificationTagMap)))\n              .length > 0\n          : true\n      },\n      get renderProps() {\n        return {\n          ...self.composedRenderProps,\n          ...getParentRenderProps(self),\n          notReady: !self.ready || !this.modificationsReady,\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          config: self.rendererConfig,\n          scaleOpts: self.scaleOpts,\n          resolution: self.resolution,\n          height: self.height,\n          ticks: self.ticks,\n          displayCrossHatches: self.displayCrossHatches,\n          filters: self.filters,\n          modificationTagMap: JSON.parse(\n            JSON.stringify(self.modificationTagMap),\n          ),\n\n          // must use getSnapshot because otherwise changes to e.g. just the\n          // colorBy.type are not read\n          colorBy: self.colorBy ? getSnapshot(self.colorBy) : undefined,\n        }\n      },\n    }))\n    .actions(self => ({\n      toggleDrawIndicators() {\n        self.drawIndicators = !self.drawIndicatorsSetting\n      },\n      toggleDrawInterbaseCounts() {\n        self.drawInterbaseCounts = !self.drawInterbaseCountsSetting\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            async () => {\n              try {\n                const { colorBy } = self\n                const { staticBlocks } = getContainingView(self) as LGV\n                if (colorBy?.type === 'modifications') {\n                  const vals = await getUniqueModificationValues(\n                    self,\n                    getConf(self.parentTrack, 'adapter'),\n                    colorBy,\n                    staticBlocks,\n                  )\n                  self.updateModificationColorMap(vals)\n                }\n              } catch (error) {\n                console.error(error)\n                self.setError(error)\n              }\n            },\n            { delay: 1000 },\n          ),\n        )\n      },\n    }))\n\n    .views(self => {\n      const { trackMenuItems } = self\n      return {\n        get TooltipComponent() {\n          return Tooltip\n        },\n\n        get adapterConfig() {\n          const subadapter = getConf(self.parentTrack, 'adapter')\n          return {\n            type: 'SNPCoverageAdapter',\n            subadapter,\n          }\n        },\n\n        get rendererTypeName() {\n          return rendererTypes.get('snpcoverage')\n        },\n\n        get needsScalebar() {\n          return true\n        },\n\n        get contextMenuItems() {\n          return []\n        },\n\n        get extraTrackMenuItems() {\n          return [\n            {\n              label: 'Draw insertion/clipping indicators',\n              type: 'checkbox',\n              checked: self.drawIndicatorsSetting,\n              onClick: () => {\n                self.toggleDrawIndicators()\n              },\n            },\n            {\n              label: 'Draw insertion/clipping counts',\n              type: 'checkbox',\n              checked: self.drawInterbaseCountsSetting,\n              onClick: () => {\n                self.toggleDrawInterbaseCounts()\n              },\n            },\n          ]\n        },\n        get trackMenuItems() {\n          return [\n            ...trackMenuItems,\n            ...self.composedTrackMenuItems,\n            ...this.extraTrackMenuItems,\n          ]\n        },\n        // The SNPCoverage filters are called twice because the BAM/CRAM features\n        // pass filters and then the SNPCoverage score features pass through\n        // here, and are already have 'snpinfo' are passed through\n        get filters() {\n          let filters: string[] = []\n          if (self.filterBy) {\n            const { flagInclude, flagExclude } = self.filterBy\n            filters = [\n              `jexl:get(feature,'snpinfo') != undefined ? true : ` +\n                `((get(feature,'flags')&${flagInclude})==${flagInclude}) && ` +\n                `!((get(feature,'flags')&${flagExclude}))`,\n            ]\n\n            if (self.filterBy.tagFilter) {\n              const { tag, value } = self.filterBy.tagFilter\n              filters.push(\n                `jexl:get(feature,'snpinfo') != undefined ? true : ` +\n                  `\"${value}\" =='*' ? getTag(feature,\"${tag}\") != undefined : ` +\n                  `getTag(feature,\"${tag}\") == \"${value}\"`,\n              )\n            }\n            if (self.filterBy.readName) {\n              const { readName } = self.filterBy\n              filters.push(\n                `jexl:get(feature,'snpinfo') != undefined ? true : ` +\n                  `get(feature,'name') == \"${readName}\"`,\n              )\n            }\n          }\n          return new SerializableFilterChain({ filters })\n        },\n      }\n    })\n\nexport type SNPCoverageDisplayModel = ReturnType<typeof stateModelFactory>\n\nexport default stateModelFactory\n","import { Region } from '@jbrowse/core/util/types'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { bpSpanPx } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport React, { MouseEvent, useRef, useState, useEffect } from 'react'\nimport type { BaseLinearDisplayModel } from '@jbrowse/plugin-linear-genome-view'\n\nfunction PileupRendering(props: {\n  blockKey: string\n  displayModel: BaseLinearDisplayModel\n  width: number\n  height: number\n  regions: Region[]\n  bpPerPx: number\n  sortedBy?: { type: string; pos: number; refName: string }\n  colorBy?: { type: string; tag?: string }\n  onMouseMove?: (event: React.MouseEvent, featureId: string | undefined) => void\n}) {\n  const {\n    onMouseMove,\n    blockKey,\n    displayModel,\n    width,\n    height,\n    regions,\n    bpPerPx,\n    sortedBy,\n    colorBy,\n  } = props\n  const {\n    selectedFeatureId,\n    featureIdUnderMouse,\n    contextMenuFeature,\n    blockLayoutFeatures,\n  } = displayModel || {}\n  const [region] = regions\n  const highlightOverlayCanvas = useRef<HTMLCanvasElement>(null)\n  const [mouseIsDown, setMouseIsDown] = useState(false)\n  const [movedDuringLastMouseDown, setMovedDuringLastMouseDown] = useState(\n    false,\n  )\n  useEffect(() => {\n    const canvas = highlightOverlayCanvas.current\n    if (!canvas) {\n      return\n    }\n    const ctx = canvas.getContext('2d')\n    if (!ctx) {\n      return\n    }\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n    let rect\n    let blockLayout\n\n    if (\n      selectedFeatureId &&\n      (blockLayout = blockLayoutFeatures.get(blockKey)) &&\n      (rect = blockLayout.get(selectedFeatureId))\n    ) {\n      const [leftBp, topPx, rightBp, bottomPx] = rect\n      const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n      const rectTop = Math.round(topPx)\n      const rectHeight = Math.round(bottomPx - topPx)\n      ctx.shadowColor = '#222266'\n      ctx.shadowBlur = 10\n      ctx.lineJoin = 'bevel'\n      ctx.lineWidth = 2\n      ctx.strokeStyle = '#00b8ff'\n      ctx.strokeRect(\n        leftPx - 2,\n        rectTop - 2,\n        rightPx - leftPx + 4,\n        rectHeight + 4,\n      )\n      ctx.clearRect(leftPx, rectTop, rightPx - leftPx, rectHeight)\n    }\n    const highlightedFeature = featureIdUnderMouse || contextMenuFeature?.id()\n    if (\n      highlightedFeature &&\n      (blockLayout = blockLayoutFeatures.get(blockKey)) &&\n      (rect = blockLayout.get(highlightedFeature))\n    ) {\n      const [leftBp, topPx, rightBp, bottomPx] = rect\n      const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n      const rectTop = Math.round(topPx)\n      const rectHeight = Math.round(bottomPx - topPx)\n      ctx.fillStyle = '#0003'\n      ctx.fillRect(leftPx, rectTop, rightPx - leftPx, rectHeight)\n    }\n  }, [\n    bpPerPx,\n    region,\n    selectedFeatureId,\n    featureIdUnderMouse,\n    contextMenuFeature,\n    blockKey,\n    blockLayoutFeatures,\n  ])\n\n  function onMouseDown(event: MouseEvent) {\n    setMouseIsDown(true)\n    setMovedDuringLastMouseDown(false)\n    callMouseHandler('MouseDown', event)\n  }\n\n  function onMouseEnter(event: MouseEvent) {\n    callMouseHandler('MouseEnter', event)\n  }\n\n  function onMouseOut(event: MouseEvent) {\n    callMouseHandler('MouseOut', event)\n    callMouseHandler('MouseLeave', event)\n  }\n\n  function onMouseOver(event: MouseEvent) {\n    callMouseHandler('MouseOver', event)\n  }\n\n  function onMouseUp(event: MouseEvent) {\n    setMouseIsDown(false)\n    callMouseHandler('MouseUp', event)\n  }\n\n  function onClick(event: MouseEvent) {\n    if (!movedDuringLastMouseDown) {\n      callMouseHandler('Click', event)\n    }\n  }\n\n  function onMouseLeave(event: MouseEvent) {\n    callMouseHandler('MouseOut', event)\n    callMouseHandler('MouseLeave', event)\n  }\n\n  function onContextMenu(event: MouseEvent) {\n    callMouseHandler('ContextMenu', event)\n  }\n\n  function mouseMove(event: MouseEvent) {\n    if (mouseIsDown) {\n      setMovedDuringLastMouseDown(true)\n    }\n    let offsetX = 0\n    let offsetY = 0\n    if (highlightOverlayCanvas.current) {\n      offsetX = highlightOverlayCanvas.current.getBoundingClientRect().left\n      offsetY = highlightOverlayCanvas.current.getBoundingClientRect().top\n    }\n    offsetX = event.clientX - offsetX\n    offsetY = event.clientY - offsetY\n    const px = region.reversed ? width - offsetX : offsetX\n    const clientBp = region.start + bpPerPx * px\n\n    const featIdUnderMouse = displayModel.getFeatureOverlapping(\n      blockKey,\n      clientBp,\n      offsetY,\n    )\n\n    if (onMouseMove) {\n      onMouseMove(event, featIdUnderMouse)\n    }\n  }\n\n  function callMouseHandler(handlerName: string, event: MouseEvent) {\n    // @ts-ignore\n    const featureHandler = props[`onFeature${handlerName}`]\n    // @ts-ignore\n    const canvasHandler = props[`on${handlerName}`]\n    if (featureHandler && featureIdUnderMouse) {\n      featureHandler(event, featureIdUnderMouse)\n    } else if (canvasHandler) {\n      canvasHandler(event, featureIdUnderMouse)\n    }\n  }\n\n  const canvasWidth = Math.ceil(width)\n  // need to call this in render so we get the right observer behavior\n  return (\n    <div\n      className=\"PileupRendering\"\n      data-testid={`pileup-${\n        sortedBy || colorBy\n          ? `${sortedBy?.type || ''}${colorBy?.type || ''}${colorBy?.tag || ''}`\n          : 'normal'\n      }`}\n      style={{ position: 'relative', width: canvasWidth, height }}\n    >\n      <PrerenderedCanvas\n        {...props}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n      />\n      <canvas\n        data-testid=\"pileup_overlay_canvas\"\n        width={canvasWidth}\n        height={height}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n        className=\"highlightOverlayCanvas\"\n        ref={highlightOverlayCanvas}\n        onMouseDown={event => onMouseDown(event)}\n        onMouseEnter={event => onMouseEnter(event)}\n        onMouseOut={event => onMouseOut(event)}\n        onMouseOver={event => onMouseOver(event)}\n        onMouseUp={event => onMouseUp(event)}\n        onMouseLeave={event => onMouseLeave(event)}\n        onMouseMove={event => mouseMove(event)}\n        onClick={event => onClick(event)}\n        onContextMenu={event => onContextMenu(event)}\n        onFocus={() => {}}\n        onBlur={() => {}}\n      />\n    </div>\n  )\n}\n\nexport default observer(PileupRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default ConfigurationSchema(\n  'PileupRenderer',\n  {\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a pileup alignment',\n      defaultValue: `#c8c8c8`,\n      contextVariable: ['feature'],\n    },\n\n    orientationType: {\n      type: 'stringEnum',\n      model: types.enumeration('orientationType', ['fr', 'rf', 'ff']),\n      defaultValue: 'fr',\n      description:\n        'read sequencer orienation. fr is normal \"reads pointing at each other ---> <--- while some other sequencers can use other options',\n    },\n    displayMode: {\n      type: 'stringEnum',\n      model: types.enumeration('displayMode', [\n        'normal',\n        'compact',\n        'collapse',\n      ]),\n      description: 'Alternative display modes',\n      defaultValue: 'normal',\n    },\n    minSubfeatureWidth: {\n      type: 'number',\n      description:\n        'the minimum width in px for a pileup mismatch feature. use for increasing mismatch marker widths when zoomed out to e.g. 1px or 0.5px',\n      defaultValue: 0,\n    },\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a pileup rendering',\n      defaultValue: 1200,\n    },\n    maxClippingSize: {\n      type: 'integer',\n      description: 'the max clip size to be used in a pileup rendering',\n      defaultValue: 10000,\n    },\n    height: {\n      type: 'number',\n      description: 'the height of each feature in a pileup alignment',\n      defaultValue: 7,\n      contextVariable: ['feature'],\n    },\n    noSpacing: {\n      type: 'boolean',\n      description: 'remove spacing between features',\n      defaultValue: false,\n    },\n    largeInsertionIndicatorScale: {\n      type: 'number',\n      description:\n        'scale at which to draw the large insertion indicators (bp/pixel)',\n      defaultValue: 10,\n    },\n    mismatchAlpha: {\n      type: 'boolean',\n      defaultValue: false,\n      description: 'Fade low quality mismatches',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { doesIntersect2 } from '@jbrowse/core/util/range'\nimport { Mismatch } from '../BamAdapter/MismatchParser'\n\ninterface SortObject {\n  pos: number\n  type: string\n  tag?: string\n}\nexport const sortFeature = (\n  features: Map<string, Feature>,\n  sortedBy: SortObject,\n) => {\n  const featureArray = Array.from(features.values())\n  const featuresInCenterLine: Feature[] = []\n  const featuresOutsideCenter: Feature[] = []\n  const { pos, type } = sortedBy\n\n  // only sort on features that intersect center line, append those outside post-sort\n  featureArray.forEach(innerArray => {\n    const feature = innerArray\n    const start = feature.get('start')\n    const end = feature.get('end')\n    if (doesIntersect2(pos - 1, pos, start, end)) {\n      featuresInCenterLine.push(innerArray)\n    } else {\n      featuresOutsideCenter.push(innerArray)\n    }\n  })\n\n  const isCram = featureArray.length ? featureArray[0].get('tags') : false\n  switch (type) {\n    case 'Start location': {\n      featuresInCenterLine.sort((a, b) => a.get('start') - b.get('start'))\n      break\n    }\n\n    case 'tag': {\n      const tag = sortedBy.tag as string\n      const getTag = (f: Feature, t: string) => {\n        return isCram ? f.get('tags')[t] : f.get(t)\n      }\n      const isString =\n        featuresInCenterLine[0] &&\n        typeof getTag(featuresInCenterLine[0], tag) === 'string'\n      if (isString) {\n        featuresInCenterLine.sort((a, b) =>\n          getTag(b, tag).localeCompare(getTag(a, tag)),\n        )\n      } else {\n        featuresInCenterLine.sort(\n          (a, b) => (getTag(b, tag) || 0) - (getTag(a, tag) || 0),\n        )\n      }\n      break\n    }\n\n    // first sort all mismatches, then all reference bases at the end\n    case 'Base pair': {\n      const baseSortArray: [string, Mismatch][] = []\n      featuresInCenterLine.forEach(feature => {\n        const mismatches: Mismatch[] = feature.get('mismatches')\n        mismatches.forEach(mismatch => {\n          const start = feature.get('start')\n          const offset = start + mismatch.start + 1\n          const consuming =\n            mismatch.type === 'insertion' || mismatch.type === 'softclip'\n          const len = consuming ? 0 : mismatch.length\n          if (pos >= offset && pos < offset + len) {\n            baseSortArray.push([feature.id(), mismatch])\n          }\n        })\n      })\n\n      const baseMap = new Map(baseSortArray)\n      featuresInCenterLine.sort((a, b) => {\n        const aMismatch = baseMap.get(a.id())\n        const bMismatch = baseMap.get(b.id())\n        const acode = bMismatch && bMismatch.base.toUpperCase()\n        const bcode = aMismatch && aMismatch.base.toUpperCase()\n        if (acode === bcode && acode === '*') {\n          // @ts-ignore\n          return aMismatch.length - bMismatch.length\n        }\n        return (\n          (acode ? acode.charCodeAt(0) : 0) - (bcode ? bcode.charCodeAt(0) : 0)\n        )\n      })\n\n      break\n    }\n\n    // sorts positive strands then negative strands\n    case 'Read strand': {\n      featuresInCenterLine.sort((a, b) =>\n        a.get('strand') <= b.get('strand') ? 1 : -1,\n      )\n      break\n    }\n  }\n\n  const sortedMap = new Map(\n    featuresInCenterLine\n      .concat(featuresOutsideCenter)\n      .map(feature => [feature.id(), feature]),\n  )\n\n  return sortedMap\n}\n","import { Feature } from '@jbrowse/core/util/simpleFeature'\n// get tag from BAM or CRAM feature, where CRAM uses feature.get('tags') and\n// BAM does not\nexport function getTag(feature: Feature, tag: string) {\n  const tags = feature.get('tags')\n  return tags ? tags[tag] : feature.get(tag)\n}\n\n// use fallback alt tag, used in situations where upper case/lower case tags\n// exist e.g. Mm/MM for base modifications\nexport function getTagAlt(feature: Feature, tag: string, alt: string) {\n  return getTag(feature, tag) || getTag(feature, alt)\n}\n\n// orientation definitions from igv.js, see also\n// https://software.broadinstitute.org/software/igv/interpreting_pair_orientations\nexport const orientationTypes = {\n  fr: {\n    F1R2: 'LR',\n    F2R1: 'LR',\n\n    F1F2: 'LL',\n    F2F1: 'LL',\n\n    R1R2: 'RR',\n    R2R1: 'RR',\n\n    R1F2: 'RL',\n    R2F1: 'RL',\n  } as { [key: string]: string },\n\n  rf: {\n    R1F2: 'LR',\n    R2F1: 'LR',\n\n    R1R2: 'LL',\n    R2R1: 'LL',\n\n    F1F2: 'RR',\n    F2F1: 'RR',\n\n    F1R2: 'RL',\n    F2R1: 'RL',\n  } as { [key: string]: string },\n\n  ff: {\n    F2F1: 'LR',\n    R1R2: 'LR',\n\n    F2R1: 'LL',\n    R1F2: 'LL',\n\n    R2F1: 'RR',\n    F1R2: 'RR',\n\n    R2R1: 'RL',\n    F1F2: 'RL',\n  } as { [key: string]: string },\n}\n\nexport function getColorWGBS(strand: number, base: string) {\n  if (strand === 1) {\n    if (base === 'C') {\n      return '#f00'\n    }\n    if (base === 'T') {\n      return '#00f'\n    }\n  } else if (strand === -1) {\n    if (base === 'G') {\n      return '#f00'\n    }\n    if (base === 'A') {\n      return '#00f'\n    }\n  }\n  return '#888'\n}\n","import deepEqual from 'fast-deep-equal'\nimport { LayoutSession } from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport GranularRectLayout from '@jbrowse/core/util/layouts/GranularRectLayout'\nimport MultiLayout from '@jbrowse/core/util/layouts/MultiLayout'\nimport { readConfObject } from '@jbrowse/core/configuration'\n\nexport interface PileupLayoutSessionProps {\n  config: AnyConfigurationModel\n  bpPerPx: number\n  filters: SerializableFilterChain\n  sortedBy: unknown\n  showSoftClip: unknown\n}\n\ntype MyMultiLayout = MultiLayout<GranularRectLayout<unknown>, unknown>\ninterface CachedPileupLayout {\n  layout: MyMultiLayout\n  config: AnyConfigurationModel\n  filters: SerializableFilterChain\n  sortedBy: unknown\n  showSoftClip: boolean\n}\n// Sorting and revealing soft clip changes the layout of Pileup renderer\n// Adds extra conditions to see if cached layout is valid\nexport class PileupLayoutSession extends LayoutSession {\n  sortedBy: unknown\n\n  showSoftClip = false\n\n  constructor(args: PileupLayoutSessionProps) {\n    super(args)\n    this.config = args.config\n  }\n\n  cachedLayoutIsValid(cachedLayout: CachedPileupLayout) {\n    return (\n      super.cachedLayoutIsValid(cachedLayout) &&\n      this.showSoftClip === cachedLayout.showSoftClip &&\n      deepEqual(this.sortedBy, cachedLayout.sortedBy)\n    )\n  }\n\n  cachedLayout: CachedPileupLayout | undefined\n\n  get layout(): MyMultiLayout {\n    if (!this.cachedLayout || !this.cachedLayoutIsValid(this.cachedLayout)) {\n      this.cachedLayout = {\n        layout: this.makeLayout(),\n        config: readConfObject(this.config),\n        filters: this.filters,\n        sortedBy: this.sortedBy,\n        showSoftClip: this.showSoftClip,\n      }\n    }\n    return this.cachedLayout.layout\n  }\n}\n","import { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { toArray } from 'rxjs/operators'\nimport BoxRendererType, {\n  RenderArgs,\n  RenderArgsSerialized,\n  RenderArgsDeserialized as BoxRenderArgsDeserialized,\n  RenderResults,\n  ResultsSerialized,\n  ResultsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport { Theme } from '@material-ui/core'\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { bpSpanPx, iterMap } from '@jbrowse/core/util'\nimport Color from 'color'\nimport { Region } from '@jbrowse/core/util/types'\nimport { renderToAbstractCanvas } from '@jbrowse/core/util/offscreenCanvasUtils'\nimport { BaseLayout } from '@jbrowse/core/util/layouts/BaseLayout'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport {\n  Mismatch,\n  parseCigar,\n  getModificationPositions,\n  getNextRefPos,\n} from '../BamAdapter/MismatchParser'\nimport { sortFeature } from './sortUtil'\nimport { getTagAlt, orientationTypes } from '../util'\n\nimport {\n  PileupLayoutSession,\n  PileupLayoutSessionProps,\n} from './PileupLayoutSession'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\n\nexport type {\n  RenderArgs,\n  RenderArgsSerialized,\n  RenderResults,\n  ResultsSerialized,\n  ResultsDeserialized,\n}\n\nfunction getColorBaseMap(theme: Theme) {\n  return {\n    A: theme.palette.bases.A.main,\n    C: theme.palette.bases.C.main,\n    G: theme.palette.bases.G.main,\n    T: theme.palette.bases.T.main,\n    deletion: '#808080', // gray\n  }\n}\n\nexport interface RenderArgsDeserialized extends BoxRenderArgsDeserialized {\n  colorBy?: { type: string; tag?: string }\n  colorTagMap?: Record<string, string>\n  modificationTagMap?: Record<string, string>\n  sortedBy?: {\n    type: string\n    pos: number\n    refName: string\n    assemblyName: string\n    tag?: string\n  }\n  showSoftClip: boolean\n  highResolutionScaling: number\n}\n\nexport interface RenderArgsDeserializedWithFeaturesAndLayout\n  extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n  layout: BaseLayout<Feature>\n  regionSequence?: string\n}\n\ninterface LayoutRecord {\n  feature: Feature\n  leftPx: number\n  rightPx: number\n  topPx: number\n  heightPx: number\n}\n\nconst alignmentColoring: { [key: string]: string } = {\n  color_fwd_strand_not_proper: '#ECC8C8',\n  color_rev_strand_not_proper: '#BEBED8',\n  color_fwd_strand: '#EC8B8B',\n  color_rev_strand: '#8F8FD8',\n  color_fwd_missing_mate: '#D11919',\n  color_rev_missing_mate: '#1919D1',\n  color_fwd_diff_chr: '#000',\n  color_rev_diff_chr: '#969696',\n  color_pair_lr: '#c8c8c8',\n  color_pair_rr: 'navy',\n  color_pair_rl: 'teal',\n  color_pair_ll: 'green',\n  color_nostrand: '#999',\n  color_interchrom: 'orange',\n  color_longinsert: 'red',\n  color_shortinsert: 'pink',\n}\n\ninterface LayoutFeature {\n  heightPx: number\n  topPx: number\n  feature: Feature\n}\n\nfunction shouldDrawMismatches(type?: string) {\n  return !['methylation', 'modifications'].includes(type || '')\n}\n\nexport default class PileupRenderer extends BoxRendererType {\n  supportsSVG = true\n\n  // get width and height of chars the height is an approximation: width\n  // letter M is approximately the height\n  getCharWidthHeight(ctx: CanvasRenderingContext2D) {\n    const charWidth = ctx.measureText('A').width\n    const charHeight = ctx.measureText('M').width\n    return { charWidth, charHeight }\n  }\n\n  layoutFeature(\n    feature: Feature,\n    layout: BaseLayout<Feature>,\n    config: AnyConfigurationModel,\n    bpPerPx: number,\n    region: Region,\n    showSoftClip?: boolean,\n  ): LayoutRecord | null {\n    let expansionBefore = 0\n    let expansionAfter = 0\n    const mismatches: Mismatch[] = feature.get('mismatches')\n    const seq: string = feature.get('seq')\n\n    // Expand the start and end of feature when softclipping enabled\n    if (showSoftClip && seq) {\n      for (let i = 0; i < mismatches.length; i += 1) {\n        const { type, start, cliplen = 0 } = mismatches[i]\n        if (type === 'softclip') {\n          start === 0 ? (expansionBefore = cliplen) : (expansionAfter = cliplen)\n        }\n      }\n    }\n\n    const [leftPx, rightPx] = bpSpanPx(\n      feature.get('start') - expansionBefore,\n      feature.get('end') + expansionAfter,\n      region,\n      bpPerPx,\n    )\n\n    let heightPx = readConfObject(config, 'height', { feature })\n    const displayMode = readConfObject(config, 'displayMode', { feature })\n    if (displayMode === 'compact') {\n      heightPx /= 3\n    }\n    if (feature.get('refName') !== region.refName) {\n      throw new Error(\n        `feature ${feature.id()} is not on the current region's reference sequence ${\n          region.refName\n        }`,\n      )\n    }\n    const topPx = layout.addRect(\n      feature.id(),\n      feature.get('start') - expansionBefore,\n      feature.get('end') + expansionAfter,\n      heightPx,\n    )\n    if (topPx === null) {\n      return null\n    }\n\n    return {\n      feature,\n      leftPx,\n      rightPx,\n      topPx: displayMode === 'collapse' ? 0 : topPx,\n      heightPx,\n    }\n  }\n\n  // expands region for clipping to use. possible improvement: use average read\n  // size to set the heuristic maxClippingSize expansion (e.g. short reads\n  // don't have to expand a softclipping size a lot, but long reads might)\n  getExpandedRegion(region: Region, renderArgs: RenderArgsDeserialized) {\n    const { config, showSoftClip } = renderArgs\n\n    const maxClippingSize = readConfObject(config, 'maxClippingSize')\n    const { start, end } = region\n    const len = end - start\n    const bpExpansion = Math.max(\n      len,\n      showSoftClip ? Math.round(maxClippingSize) : 0,\n    )\n\n    return {\n      ...region,\n      start: Math.floor(Math.max(start - bpExpansion, 0)),\n      end: Math.ceil(end + bpExpansion),\n    }\n  }\n\n  colorByOrientation(feature: Feature, config: AnyConfigurationModel) {\n    return alignmentColoring[\n      this.getOrientation(feature, config) || 'color_nostrand'\n    ]\n  }\n\n  getOrientation(feature: Feature, config: AnyConfigurationModel) {\n    const orientationType = readConfObject(config, 'orientationType') as\n      | 'fr'\n      | 'ff'\n      | 'rf'\n    const type = orientationTypes[orientationType]\n    const orientation = type[feature.get('pair_orientation') as string]\n    const map: { [key: string]: string } = {\n      LR: 'color_pair_lr',\n      RR: 'color_pair_rr',\n      RL: 'color_pair_rl',\n      LL: 'color_pair_ll',\n    }\n    return map[orientation]\n  }\n\n  colorByInsertSize(feature: Feature, _config: AnyConfigurationModel) {\n    return feature.get('is_paired') &&\n      feature.get('seq_id') !== feature.get('next_seq_id')\n      ? '#555'\n      : `hsl(${Math.abs(feature.get('template_length')) / 10},50%,50%)`\n  }\n\n  colorByStranded(feature: Feature, _config: AnyConfigurationModel) {\n    const flags = feature.get('flags')\n    const strand = feature.get('strand')\n    // is paired\n    if (flags & 1) {\n      const revflag = flags & 64\n      const flipper = revflag ? -1 : 1\n      // proper pairing\n      if (flags & 2) {\n        return strand * flipper === 1 ? 'color_rev_strand' : 'color_fwd_strand'\n      }\n      if (feature.get('multi_segment_next_segment_unmapped')) {\n        return strand * flipper === 1\n          ? 'color_rev_missing_mate'\n          : 'color_fwd_missing_mate'\n      }\n      if (feature.get('seq_id') === feature.get('next_seq_id')) {\n        return strand * flipper === 1\n          ? 'color_rev_strand_not_proper'\n          : 'color_fwd_strand_not_proper'\n      }\n      // should only leave aberrant chr\n      return strand === 1 ? 'color_fwd_diff_chr' : 'color_rev_diff_chr'\n    }\n    return strand === 1 ? 'color_fwd_strand' : 'color_rev_strand'\n  }\n\n  colorByPerBaseQuality(\n    ctx: CanvasRenderingContext2D,\n    feat: LayoutFeature,\n    _config: AnyConfigurationModel,\n    region: Region,\n    bpPerPx: number,\n  ) {\n    const { feature, topPx, heightPx } = feat\n    const qual: string = feature.get('qual') || ''\n    const scores = qual.split(' ').map(val => +val)\n    const cigarOps = parseCigar(feature.get('CIGAR'))\n    const width = 1 / bpPerPx\n    const start = feature.get('start')\n\n    for (let i = 0, j = 0, k = 0; k < scores.length; i += 2, k++) {\n      const len = +cigarOps[i]\n      const op = cigarOps[i + 1]\n      if (op === 'S' || op === 'I') {\n        k += len\n      } else if (op === 'D' || op === 'N') {\n        j += len\n      } else if (op === 'M' || op === 'X' || op === '=') {\n        for (let m = 0; m < len; m++) {\n          const score = scores[k + m]\n          ctx.fillStyle = `hsl(${score === 255 ? 150 : score * 1.5},55%,50%)`\n          const [leftPx] = bpSpanPx(\n            start + j + m,\n            start + j + m + 1,\n            region,\n            bpPerPx,\n          )\n          ctx.fillRect(leftPx, topPx, width + 0.5, heightPx)\n        }\n        j += len\n      }\n    }\n  }\n\n  // ML stores probabilities as array of numerics and MP is scaled phred scores\n  // https://github.com/samtools/hts-specs/pull/418/files#diff-e765c6479316309f56b636f88189cdde8c40b854c7bdcce9ee7fe87a4e76febcR596\n  //\n  // if we have ML or Ml, it is an 8bit probability, divide by 255\n  //\n  // if we have MP or Mp it is phred scaled ASCII, which can go up to 90 but\n  // has very high likelihood basecalls at that point, we really only care\n  // about low qual calls <20 approx\n  //\n  colorByModifications(\n    ctx: CanvasRenderingContext2D,\n    layoutFeature: LayoutFeature,\n    _config: AnyConfigurationModel,\n    region: Region,\n    bpPerPx: number,\n    props: RenderArgsDeserializedWithFeaturesAndLayout,\n  ) {\n    const { feature, topPx, heightPx } = layoutFeature\n    const { modificationTagMap = {} } = props\n\n    const mm = (getTagAlt(feature, 'MM', 'Mm') as string) || ''\n\n    const ml = (getTagAlt(feature, 'ML', 'Ml') as number[] | string) || []\n\n    const probabilities = ml\n      ? (typeof ml === 'string' ? ml.split(',').map(e => +e) : ml).map(\n          e => e / 255,\n        )\n      : (getTagAlt(feature, 'MP', 'Mp') as string)\n          .split('')\n          .map(s => s.charCodeAt(0) - 33)\n          .map(elt => Math.min(1, elt / 50))\n\n    const cigar = feature.get('CIGAR')\n    const start = feature.get('start')\n    const end = feature.get('end')\n    const seq = feature.get('seq')\n    const cigarOps = parseCigar(cigar)\n\n    const modifications = getModificationPositions(mm, seq)\n\n    // probIndex applies across multiple modifications e.g.\n    let probIndex = 0\n    modifications.forEach(({ type, positions }) => {\n      const col = modificationTagMap[type] || 'black'\n      const base = Color(col)\n      for (const readPos of getNextRefPos(cigarOps, positions)) {\n        if (readPos >= 0 && start + readPos < end) {\n          const [leftPx, rightPx] = bpSpanPx(\n            start + readPos,\n            start + readPos + 1,\n            region,\n            bpPerPx,\n          )\n\n          // give it a little boost of 0.1 to not make them fully\n          // invisible to avoid confusion\n          ctx.fillStyle = base\n            .alpha(probabilities[probIndex] + 0.1)\n            .hsl()\n            .string()\n          ctx.fillRect(leftPx, topPx, rightPx - leftPx + 0.5, heightPx)\n        }\n        probIndex++\n      }\n    })\n  }\n\n  // Color by methylation is slightly modified version of color by\n  // modifications\n  //\n  colorByMethylation(\n    ctx: CanvasRenderingContext2D,\n    layoutFeature: LayoutFeature,\n    _config: AnyConfigurationModel,\n    region: Region,\n    bpPerPx: number,\n    props: RenderArgsDeserializedWithFeaturesAndLayout,\n  ) {\n    const { regionSequence } = props\n    const { feature, topPx, heightPx } = layoutFeature\n\n    const mm: string = getTagAlt(feature, 'MM', 'Mm') || ''\n\n    if (!regionSequence) {\n      throw new Error('region sequence required for methylation')\n    }\n\n    const cigar = feature.get('CIGAR')\n    const fstart = feature.get('start')\n    const fend = feature.get('end')\n    const seq = feature.get('seq')\n    const cigarOps = parseCigar(cigar)\n    const { start: rstart, end: rend } = region\n\n    const methBins = new Array(rend - rstart).fill(0)\n    getModificationPositions(mm, seq).forEach(({ type, positions }) => {\n      if (type === 'm' && positions) {\n        for (const pos of getNextRefPos(cigarOps, positions)) {\n          const epos = pos + fstart - rstart\n          if (epos >= 0 && epos < methBins.length) {\n            methBins[epos] = 1\n          }\n        }\n      }\n    })\n\n    for (let j = fstart; j < fend; j++) {\n      const i = j - rstart\n      if (i >= 0 && i < methBins.length) {\n        const l2 = regionSequence[i + 1]\n        const l1 = regionSequence[i]\n        // color\n        if (l1.toUpperCase() === 'C' && l2.toUpperCase() === 'G') {\n          const [leftPx, rightPx] = bpSpanPx(\n            rstart + i,\n            rstart + i + 1,\n            region,\n            bpPerPx,\n          )\n          if (methBins[i]) {\n            ctx.fillStyle = 'red'\n          } else {\n            ctx.fillStyle = 'blue'\n          }\n          ctx.fillRect(leftPx, topPx, rightPx - leftPx + 0.5, heightPx)\n        }\n      }\n    }\n  }\n\n  drawRect(\n    ctx: CanvasRenderingContext2D,\n    feat: LayoutFeature,\n    props: RenderArgsDeserialized,\n  ) {\n    const { regions, bpPerPx } = props\n    const { heightPx, topPx, feature } = feat\n    const [region] = regions\n    const [leftPx, rightPx] = bpSpanPx(\n      feature.get('start'),\n      feature.get('end'),\n      region,\n      bpPerPx,\n    )\n    const flip = region.reversed ? -1 : 1\n    const strand = feature.get('strand') * flip\n    if (bpPerPx < 10) {\n      if (strand === -1) {\n        ctx.beginPath()\n        ctx.moveTo(leftPx - 5, topPx + heightPx / 2)\n        ctx.lineTo(leftPx, topPx + heightPx)\n        ctx.lineTo(rightPx, topPx + heightPx)\n        ctx.lineTo(rightPx, topPx)\n        ctx.lineTo(leftPx, topPx)\n        ctx.closePath()\n        ctx.fill()\n      } else {\n        ctx.beginPath()\n        ctx.moveTo(leftPx, topPx)\n        ctx.lineTo(leftPx, topPx + heightPx)\n        ctx.lineTo(rightPx, topPx + heightPx)\n        ctx.lineTo(rightPx + 5, topPx + heightPx / 2)\n        ctx.lineTo(rightPx, topPx)\n        ctx.closePath()\n        ctx.fill()\n      }\n    } else {\n      ctx.fillRect(leftPx, topPx, rightPx - leftPx, heightPx)\n    }\n  }\n\n  drawAlignmentRect(\n    ctx: CanvasRenderingContext2D,\n    feat: LayoutFeature,\n    props: RenderArgsDeserializedWithFeaturesAndLayout,\n  ) {\n    const { config, bpPerPx, regions, colorBy, colorTagMap = {} } = props\n    const { tag = '', type: colorType = '' } = colorBy || {}\n    const { feature } = feat\n    const region = regions[0]\n\n    // first pass for simple color changes that change the color of the\n    // alignment\n    switch (colorType) {\n      case 'insertSize':\n        ctx.fillStyle = this.colorByInsertSize(feature, config)\n        break\n      case 'strand':\n        ctx.fillStyle = feature.get('strand') === -1 ? '#8F8FD8' : '#EC8B8B'\n        break\n      case 'mappingQuality':\n        ctx.fillStyle = `hsl(${feature.get('mq')},50%,50%)`\n        break\n\n      case 'pairOrientation':\n        ctx.fillStyle = this.colorByOrientation(feature, config)\n        break\n      case 'stranded':\n        ctx.fillStyle = alignmentColoring[this.colorByStranded(feature, config)]\n        break\n      case 'xs':\n      case 'tag': {\n        const tags = feature.get('tags')\n        const val = tags ? tags[tag] : feature.get(tag)\n\n        // special for for XS/TS tag\n        if (tag === 'XS' || tag === 'TS') {\n          const map: { [key: string]: string | undefined } = {\n            '-': 'color_rev_strand',\n            '+': 'color_fwd_strand',\n          }\n          ctx.fillStyle = alignmentColoring[map[val] || 'color_nostrand']\n        }\n\n        // lower case 'ts' from minimap2 is flipped from xs\n        if (tag === 'ts') {\n          const map: { [key: string]: string } = {\n            '-':\n              feature.get('strand') === -1\n                ? 'color_fwd_strand'\n                : 'color_rev_strand',\n            '+':\n              feature.get('strand') === -1\n                ? 'color_rev_strand'\n                : 'color_fwd_strand',\n          }\n          ctx.fillStyle = alignmentColoring[map[val] || 'color_nostrand']\n        }\n\n        // tag is not one of the autofilled tags, has color-value pairs from\n        // fetchValues\n        else {\n          const foundValue = colorTagMap[val]\n          ctx.fillStyle = foundValue || 'color_nostrand'\n        }\n        break\n      }\n      case 'insertSizeAndPairOrientation':\n        break\n\n      case 'normal':\n      default:\n        ctx.fillStyle = readConfObject(config, 'color', { feature })\n        break\n    }\n\n    this.drawRect(ctx, feat, props)\n\n    // second pass for color types that render per-base things that go over the\n    // existing drawing\n    switch (colorType) {\n      case 'perBaseQuality':\n        this.colorByPerBaseQuality(ctx, feat, config, region, bpPerPx)\n        break\n\n      case 'modifications':\n        this.colorByModifications(ctx, feat, config, region, bpPerPx, props)\n        break\n\n      case 'methylation':\n        this.colorByMethylation(ctx, feat, config, region, bpPerPx, props)\n        break\n    }\n  }\n\n  drawMismatches(\n    ctx: CanvasRenderingContext2D,\n    feat: LayoutFeature,\n    props: RenderArgsDeserializedWithFeaturesAndLayout,\n    theme: Theme,\n    colorForBase: { [key: string]: string },\n    opts: {\n      mismatchAlpha?: boolean\n      drawSNPs?: boolean\n      drawIndels?: boolean\n    },\n  ) {\n    const { mismatchAlpha, drawSNPs = true, drawIndels = true } = opts\n    const { config, bpPerPx, regions } = props\n    const { heightPx, topPx, feature } = feat\n    const { charWidth, charHeight } = this.getCharWidthHeight(ctx)\n    const [region] = regions\n    const start = feature.get('start')\n    const minFeatWidth = readConfObject(config, 'minSubfeatureWidth')\n    const insertionScale = readConfObject(\n      config,\n      'largeInsertionIndicatorScale',\n    )\n    const pxPerBp = Math.min(1 / bpPerPx, 2)\n    const w = Math.max(minFeatWidth, pxPerBp)\n    const mismatches: Mismatch[] = feature.get('mismatches')\n    const heightLim = charHeight - 2\n\n    function getAlphaColor(baseColor: string, mismatch: { qual?: number }) {\n      let color = baseColor\n      if (mismatchAlpha && mismatch.qual !== undefined) {\n        color = Color(baseColor)\n          .alpha(Math.min(1, mismatch.qual / 50))\n          .hsl()\n          .string()\n      }\n      return color\n    }\n\n    // two pass rendering: first pass, draw all the mismatches except wide\n    // insertion markers\n    for (let i = 0; i < mismatches.length; i += 1) {\n      const mismatch = mismatches[i]\n      const [mismatchLeftPx, mismatchRightPx] = bpSpanPx(\n        start + mismatch.start,\n        start + mismatch.start + mismatch.length,\n        region,\n        bpPerPx,\n      )\n      const mismatchWidthPx = Math.max(\n        minFeatWidth,\n        Math.abs(mismatchLeftPx - mismatchRightPx),\n      )\n      if (mismatch.type === 'mismatch' && drawSNPs) {\n        const baseColor = colorForBase[mismatch.base] || '#888'\n\n        ctx.fillStyle = getAlphaColor(baseColor, mismatch)\n\n        ctx.fillRect(mismatchLeftPx, topPx, mismatchWidthPx, heightPx)\n\n        if (mismatchWidthPx >= charWidth && heightPx >= heightLim) {\n          // normal SNP coloring\n          ctx.fillStyle = getAlphaColor(\n            theme.palette.getContrastText(baseColor),\n            mismatch,\n          )\n          ctx.fillText(\n            mismatch.base,\n            mismatchLeftPx + (mismatchWidthPx - charWidth) / 2 + 1,\n            topPx + heightPx,\n          )\n        }\n      } else if (mismatch.type === 'deletion' && drawIndels) {\n        const baseColor = colorForBase.deletion\n        ctx.fillStyle = baseColor\n        ctx.fillRect(mismatchLeftPx, topPx, mismatchWidthPx, heightPx)\n        if (mismatchWidthPx >= charWidth && heightPx >= heightLim) {\n          ctx.fillStyle = theme.palette.getContrastText(baseColor)\n          ctx.fillText(\n            mismatch.base,\n            mismatchLeftPx + (mismatchWidthPx - charWidth) / 2 + 1,\n            topPx + heightPx,\n          )\n        }\n      } else if (mismatch.type === 'insertion' && drawIndels) {\n        ctx.fillStyle = 'purple'\n        const pos = mismatchLeftPx - 1\n        const len = +mismatch.base || mismatch.length\n        if (len < 10) {\n          ctx.fillRect(pos, topPx, w, heightPx)\n          if (1 / bpPerPx >= charWidth) {\n            ctx.fillRect(pos - w, topPx, w * 3, 1)\n            ctx.fillRect(pos - w, topPx + heightPx - 1, w * 3, 1)\n          }\n          if (1 / bpPerPx >= charWidth && heightPx >= heightLim) {\n            ctx.fillText(\n              `(${mismatch.base})`,\n              mismatchLeftPx + 2,\n              topPx + heightPx,\n            )\n          }\n        }\n      } else if (mismatch.type === 'hardclip' || mismatch.type === 'softclip') {\n        ctx.fillStyle = mismatch.type === 'hardclip' ? 'red' : 'blue'\n        const pos = mismatchLeftPx - 1\n        ctx.fillRect(pos, topPx + 1, w, heightPx - 2)\n        ctx.fillRect(pos - w, topPx, w * 3, 1)\n        ctx.fillRect(pos - w, topPx + heightPx - 1, w * 3, 1)\n        if (mismatchWidthPx >= charWidth && heightPx >= heightLim) {\n          ctx.fillText(\n            `(${mismatch.base})`,\n            mismatchLeftPx + 2,\n            topPx + heightPx,\n          )\n        }\n      } else if (mismatch.type === 'skip') {\n        // fix to avoid bad rendering\n        // note that this was also related to chrome bug https://bugs.chromium.org/p/chro>\n        // ref #1236\n        if (mismatchLeftPx + mismatchWidthPx > 0) {\n          ctx.clearRect(\n            mismatchLeftPx,\n            topPx,\n            // make small exons more visible when zoomed far out\n            mismatchWidthPx - (bpPerPx > 10 ? 1.5 : 0),\n            heightPx,\n          )\n        }\n        ctx.fillStyle = '#333'\n        ctx.fillRect(mismatchLeftPx, topPx + heightPx / 2, mismatchWidthPx, 2)\n      }\n    }\n\n    // second pass, draw wide insertion markers on top\n    if (drawIndels) {\n      for (let i = 0; i < mismatches.length; i += 1) {\n        const mismatch = mismatches[i]\n        const [mismatchLeftPx] = bpSpanPx(\n          feature.get('start') + mismatch.start,\n          feature.get('start') + mismatch.start + mismatch.length,\n          region,\n          bpPerPx,\n        )\n        const len = +mismatch.base || mismatch.length\n        const txt = `${len}`\n        if (mismatch.type === 'insertion' && len >= 10) {\n          if (bpPerPx > insertionScale) {\n            ctx.fillStyle = 'purple'\n            ctx.fillRect(mismatchLeftPx - 1, topPx, 2, heightPx)\n          } else if (heightPx > charHeight) {\n            const rect = ctx.measureText(txt)\n            const padding = 5\n            ctx.fillStyle = 'purple'\n            ctx.fillRect(\n              mismatchLeftPx - rect.width / 2 - padding,\n              topPx,\n              rect.width + 2 * padding,\n              heightPx,\n            )\n            ctx.fillStyle = 'white'\n            ctx.fillText(txt, mismatchLeftPx - rect.width / 2, topPx + heightPx)\n          } else {\n            const padding = 2\n            ctx.fillStyle = 'purple'\n            ctx.fillRect(mismatchLeftPx - padding, topPx, 2 * padding, heightPx)\n          }\n        }\n      }\n    }\n  }\n\n  drawSoftClipping(\n    ctx: CanvasRenderingContext2D,\n    feat: LayoutFeature,\n    props: RenderArgsDeserializedWithFeaturesAndLayout,\n    config: AnyConfigurationModel,\n    theme: Theme,\n  ) {\n    const { feature, topPx, heightPx } = feat\n    const { regions, bpPerPx } = props\n    const [region] = regions\n    const minFeatWidth = readConfObject(config, 'minSubfeatureWidth')\n    const mismatches: Mismatch[] = feature.get('mismatches')\n    const seq = feature.get('seq')\n    const { charWidth, charHeight } = this.getCharWidthHeight(ctx)\n    const colorForBase: { [key: string]: string } = {\n      A: theme.palette.bases.A.main,\n      C: theme.palette.bases.C.main,\n      G: theme.palette.bases.G.main,\n      T: theme.palette.bases.T.main,\n      deletion: '#808080', // gray\n    }\n\n    // Display all bases softclipped off in lightened colors\n    if (seq) {\n      mismatches\n        .filter(mismatch => mismatch.type === 'softclip')\n        .forEach(mismatch => {\n          const softClipLength = mismatch.cliplen || 0\n          const softClipStart =\n            mismatch.start === 0\n              ? feature.get('start') - softClipLength\n              : feature.get('start') + mismatch.start\n\n          for (let k = 0; k < softClipLength; k += 1) {\n            const base = seq.charAt(k + mismatch.start)\n\n            // If softclip length+start is longer than sequence, no need to\n            // continue showing base\n            if (!base) {\n              return\n            }\n\n            const [softClipLeftPx, softClipRightPx] = bpSpanPx(\n              softClipStart + k,\n              softClipStart + k + 1,\n              region,\n              bpPerPx,\n            )\n            const softClipWidthPx = Math.max(\n              minFeatWidth,\n              Math.abs(softClipLeftPx - softClipRightPx),\n            )\n\n            // Black accounts for IUPAC ambiguity code bases such as N that\n            // show in soft clipping\n            const baseColor = colorForBase[base] || '#000000'\n            ctx.fillStyle = baseColor\n            ctx.fillRect(softClipLeftPx, topPx, softClipWidthPx, heightPx)\n\n            if (softClipWidthPx >= charWidth && heightPx >= charHeight - 5) {\n              ctx.fillStyle = theme.palette.getContrastText(baseColor)\n              ctx.fillText(\n                base,\n                softClipLeftPx + (softClipWidthPx - charWidth) / 2 + 1,\n                topPx + heightPx,\n              )\n            }\n          }\n        })\n    }\n  }\n\n  async makeImageData(\n    ctx: CanvasRenderingContext2D,\n    layoutRecords: any, // eslint-disable-line @typescript-eslint/no-explicit-any\n    props: RenderArgsDeserializedWithFeaturesAndLayout,\n  ) {\n    const { layout, config, showSoftClip, colorBy, theme: configTheme } = props\n    const mismatchAlpha = readConfObject(config, 'mismatchAlpha')\n    const theme = createJBrowseTheme(configTheme)\n    const colorForBase = getColorBaseMap(theme)\n    if (!layout) {\n      throw new Error(`layout required`)\n    }\n    if (!layout.addRect) {\n      throw new Error('invalid layout object')\n    }\n    ctx.font = 'bold 10px Courier New,monospace'\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    layoutRecords.forEach((feat: any) => {\n      if (feat === null) {\n        return\n      }\n\n      const { feature, topPx, heightPx } = feat\n\n      ctx.fillStyle = readConfObject(config, 'color', { feature })\n      this.drawAlignmentRect(ctx, { feature, topPx, heightPx }, props)\n      this.drawMismatches(ctx, feat, props, theme, colorForBase, {\n        mismatchAlpha,\n\n        drawSNPs: shouldDrawMismatches(colorBy?.type),\n        drawIndels: shouldDrawMismatches(colorBy?.type),\n      })\n      if (showSoftClip) {\n        this.drawSoftClipping(ctx, feat, props, config, theme)\n      }\n    })\n  }\n\n  // we perform a full layout before render as a separate method because the\n  // layout determines the height of the canvas that we use to render\n  layoutFeats(props: RenderArgsDeserializedWithFeaturesAndLayout) {\n    const {\n      layout,\n      features,\n      sortedBy,\n      config,\n      bpPerPx,\n      showSoftClip,\n      regions,\n    } = props\n    const [region] = regions\n    if (!layout) {\n      throw new Error(`layout required`)\n    }\n    if (!layout.addRect) {\n      throw new Error('invalid layout object')\n    }\n\n    const sortedFeatures =\n      sortedBy && sortedBy.type && region.start === sortedBy.pos\n        ? sortFeature(features, sortedBy)\n        : null\n    const featureMap = sortedFeatures || features\n    const layoutRecords = iterMap(\n      featureMap.values(),\n      feature =>\n        this.layoutFeature(\n          feature,\n          layout,\n          config,\n          bpPerPx,\n          region,\n          showSoftClip,\n        ),\n      featureMap.size,\n    )\n    return layoutRecords\n  }\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const { bpPerPx, regions } = renderProps\n    const features = await this.getFeatures(renderProps)\n    const layout = this.createLayoutInWorker(renderProps)\n\n    const layoutRecords = this.layoutFeats({ ...renderProps, features, layout })\n\n    // @ts-ignore\n    const { dataAdapter: sequenceAdapter } = renderProps.adapterConfig\n      .sequenceAdapter\n      ? await getAdapter(\n          this.pluginManager,\n          renderProps.sessionId,\n          // @ts-ignore\n          renderProps.adapterConfig.sequenceAdapter,\n        )\n      : {}\n    const [region] = regions\n    const [feat] = sequenceAdapter\n      ? await (sequenceAdapter as BaseFeatureDataAdapter)\n          .getFeatures({\n            start: region.start,\n            end: region.end + 1,\n            refName: region.refName,\n            assemblyName: region.assemblyName,\n          })\n          .pipe(toArray())\n          .toPromise()\n      : []\n    const regionSequence = feat?.get('seq')\n\n    const width = (region.end - region.start) / bpPerPx\n    const height = Math.max(layout.getTotalHeight(), 1)\n\n    const res = await renderToAbstractCanvas(\n      width,\n      height,\n      renderProps,\n      (ctx: CanvasRenderingContext2D) =>\n        this.makeImageData(ctx, layoutRecords, {\n          ...renderProps,\n          layout,\n          features,\n          regionSequence,\n        }),\n    )\n\n    const results = await super.render({\n      ...renderProps,\n      ...res,\n      features,\n      layout,\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...res,\n      features,\n      layout,\n      height,\n      width,\n      maxHeightReached: layout.maxHeightReached,\n    }\n  }\n\n  createSession(args: PileupLayoutSessionProps) {\n    return new PileupLayoutSession(args)\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { types } from 'mobx-state-tree'\n\nexport default (pluginManager: PluginManager) =>\n  types.late(() =>\n    ConfigurationSchema(\n      'SNPCoverageAdapter',\n      {\n        subadapter: pluginManager.pluggableConfigSchemaType('adapter'),\n      },\n      { explicitlyTyped: true },\n    ),\n  )\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region } from '@jbrowse/core/util/types'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { reduce, filter, toArray } from 'rxjs/operators'\nimport { Observable } from 'rxjs'\nimport { getTagAlt } from '../util'\nimport {\n  parseCigar,\n  getNextRefPos,\n  getModificationPositions,\n  Mismatch,\n} from '../BamAdapter/MismatchParser'\n\ninterface SNPCoverageOptions extends BaseOptions {\n  filters?: SerializableFilterChain\n}\n\nfunction mismatchLen(mismatch: Mismatch) {\n  return !isInterbase(mismatch.type) ? mismatch.length : 1\n}\n\nfunction isInterbase(type: string) {\n  return type === 'softclip' || type === 'hardclip' || type === 'insertion'\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction inc(bin: any, strand: number, type: string, field: string) {\n  if (!bin[type][field]) {\n    bin[type][field] = { total: 0, strands: { '-1': 0, '0': 0, '1': 0 } }\n  }\n  bin[type][field].total++\n  bin[type][field].strands[strand]++\n}\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction dec(bin: any, strand: number, type: string, field: string) {\n  if (!bin[type][field]) {\n    bin[type][field] = { total: 0, strands: { '-1': 0, '0': 0, '1': 0 } }\n  }\n  bin[type][field].total--\n  bin[type][field].strands[strand]--\n}\n\nexport default class SNPCoverageAdapter extends BaseFeatureDataAdapter {\n  protected async configure() {\n    const subadapterConfig = readConfObject(this.config, 'subadapter')\n    const sequenceConf = readConfObject(this.config, [\n      'subadapter',\n      'sequenceAdapter',\n    ])\n    const dataAdapter = await this.getSubAdapter?.(subadapterConfig)\n\n    const sequenceAdapter = sequenceConf\n      ? await this.getSubAdapter?.(sequenceConf)\n      : undefined\n\n    if (!dataAdapter) {\n      throw new Error('Failed to get subadapter')\n    }\n\n    return {\n      subadapter: dataAdapter.dataAdapter as BaseFeatureDataAdapter,\n      sequenceAdapter: sequenceAdapter?.dataAdapter as\n        | BaseFeatureDataAdapter\n        | undefined,\n    }\n  }\n\n  getFeatures(region: Region, opts: SNPCoverageOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const { subadapter } = await this.configure()\n      let stream = subadapter.getFeatures(region, opts)\n\n      if (opts.filters) {\n        const { filters } = opts\n        stream = stream.pipe(filter(f => filters.passes(f, opts)))\n      }\n\n      const bins = await this.generateCoverageBins(stream, region, opts)\n\n      bins.forEach((bin, index) => {\n        if (bin.total) {\n          observer.next(\n            new SimpleFeature({\n              id: `${this.id}-${region.start}-${index}`,\n              data: {\n                score: bin.total,\n                snpinfo: bin,\n                start: region.start + index,\n                end: region.start + index + 1,\n                refName: region.refName,\n              },\n            }),\n          )\n        }\n      })\n\n      observer.complete()\n    }, opts.signal)\n  }\n\n  async getRefNames(opts: BaseOptions = {}) {\n    const { subadapter } = await this.configure()\n    return subadapter.getRefNames(opts)\n  }\n\n  freeResources(/* { region } */): void {}\n\n  /**\n   * Generates coverage bins from features which details\n   * the reference, mismatches, strands, and coverage info\n   * @param features - Features of region to be passed in\n   * @param region - Region\n   * @param bpPerPx - base pairs per pixel\n   * @returns Array of nested frequency tables\n   */\n  async generateCoverageBins(\n    features: Observable<Feature>,\n    region: Region,\n    opts: { bpPerPx?: number; colorBy?: { type: string; tag?: string } },\n  ) {\n    const { colorBy } = opts\n    const { sequenceAdapter } = await this.configure()\n    const { refName, start, end } = region\n    const binMax = Math.ceil(region.end - region.start)\n\n    // bins contain cov feature if they contribute to coverage, or noncov which\n    // are interbase or other features that don't contribute to coverage.\n    // delskips are elements that don't contribute to coverage, but should be\n    // reported also (and are not interbase)\n    type BinType = { total: number; strands: { [key: string]: number } }\n    const initBins = Array.from({ length: binMax }, () => ({\n      total: 0,\n      lowqual: {} as BinType,\n      cov: {} as BinType,\n      delskips: {} as BinType,\n      noncov: {} as BinType,\n      ref: {} as BinType,\n    }))\n\n    // request an extra +1 on the end to get CpG crossing region boundary\n    let regionSeq: string | undefined\n\n    if (sequenceAdapter) {\n      const [feat] = await sequenceAdapter\n        .getFeatures({ refName, start, end: end + 1, assemblyName: 'na' })\n        .pipe(toArray())\n        .toPromise()\n      regionSeq = feat?.get('seq')\n    }\n\n    return features\n      .pipe(\n        reduce((bins, feature) => {\n          const cigar = feature.get('CIGAR')\n          const fstart = feature.get('start')\n          const fend = feature.get('end')\n          const fstrand = feature.get('strand')\n          const cigarOps = parseCigar(cigar)\n\n          for (let j = fstart; j < fend; j++) {\n            const i = j - region.start\n            if (i >= 0 && i < bins.length) {\n              const bin = bins[i]\n              bin.total++\n              inc(bin, fstrand, 'ref', 'ref')\n            }\n          }\n\n          if (colorBy?.type === 'modifications') {\n            const seq = feature.get('seq')\n            const mm = getTagAlt(feature, 'MM', 'Mm') || ''\n\n            const ml =\n              (getTagAlt(feature, 'ML', 'Ml') as number[] | string) || []\n\n            const probabilities = ml\n              ? (typeof ml === 'string' ? ml.split(',').map(e => +e) : ml).map(\n                  e => e / 255,\n                )\n              : (getTagAlt(feature, 'MP', 'Mp') as string)\n                  .split('')\n                  .map(s => s.charCodeAt(0) - 33)\n                  .map(elt => Math.min(1, elt / 50))\n\n            let probIndex = 0\n            getModificationPositions(mm, seq).forEach(({ type, positions }) => {\n              const mod = `mod_${type}`\n              for (const pos of getNextRefPos(cigarOps, positions)) {\n                const epos = pos + fstart - region.start\n                if (epos >= 0 && epos < bins.length && pos + fstart < fend) {\n                  const bin = bins[epos]\n                  if (probabilities[probIndex] > 0.5) {\n                    inc(bin, fstrand, 'cov', mod)\n                  } else {\n                    inc(bin, fstrand, 'lowqual', mod)\n                  }\n                }\n                probIndex++\n              }\n            })\n          }\n\n          // methylation based coloring takes into account both reference\n          // sequence CpG detection and reads\n          else if (colorBy?.type === 'methylation') {\n            if (!regionSeq) {\n              throw new Error(\n                'no region sequence detected, need sequenceAdapter configuration',\n              )\n            }\n            const seq = feature.get('seq')\n            const mm = getTagAlt(feature, 'MM', 'Mm') || ''\n            const methBins = new Array(region.end - region.start).fill(0)\n\n            getModificationPositions(mm, seq).forEach(({ type, positions }) => {\n              // we are processing methylation\n              if (type === 'm') {\n                for (const pos of getNextRefPos(cigarOps, positions)) {\n                  const epos = pos + fstart - region.start\n                  if (epos >= 0 && epos < methBins.length) {\n                    methBins[epos] = 1\n                  }\n                }\n              }\n            })\n\n            for (let j = fstart; j < fend; j++) {\n              const i = j - region.start\n              if (i >= 0 && i < bins.length) {\n                const l2 = regionSeq[i + 1]\n                const l1 = regionSeq[i]\n                const bin = bins[i]\n                // color\n                if (l1.toUpperCase() === 'C' && l2.toUpperCase() === 'G') {\n                  if (methBins[i]) {\n                    inc(bin, fstrand, 'cov', 'meth')\n                    dec(bin, fstrand, 'ref', 'ref')\n                  } else {\n                    inc(bin, fstrand, 'cov', 'unmeth')\n                    dec(bin, fstrand, 'ref', 'ref')\n                  }\n                }\n              }\n            }\n          }\n\n          // normal SNP based coloring\n          else {\n            const mismatches = feature.get('mismatches')\n            for (let i = 0; i < mismatches?.length; i++) {\n              const mismatch = mismatches[i] as Mismatch\n              const mstart = fstart + mismatch.start\n              for (let j = mstart; j < mstart + mismatchLen(mismatch); j++) {\n                const epos = j - region.start\n                if (epos >= 0 && epos < bins.length) {\n                  const bin = bins[epos]\n                  const { base, type } = mismatch\n                  const interbase = isInterbase(type)\n                  if (!interbase) {\n                    dec(bin, fstrand, 'ref', 'ref')\n                  } else {\n                    inc(bin, fstrand, 'noncov', type)\n                  }\n\n                  if (type === 'deletion' || type === 'skip') {\n                    inc(bin, fstrand, 'delskips', type)\n                    bin.total--\n                  } else if (!interbase) {\n                    inc(bin, fstrand, 'cov', base)\n                  }\n                }\n              }\n            }\n          }\n\n          return bins\n        }, initBins),\n      )\n      .toPromise()\n  }\n}\n\nconst { capabilities } = SNPCoverageAdapter\nexport { capabilities }\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaFactory from './configSchema'\nimport { capabilities } from './SNPCoverageAdapter'\n\nexport default (pluginManager: PluginManager) => {\n  return {\n    getAdapterClass: () => import('./SNPCoverageAdapter').then(r => r.default),\n    configSchema: configSchemaFactory(pluginManager),\n    adapterCapabilities: capabilities,\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'SNPCoverageRenderer',\n  {\n    clipColor: {\n      type: 'color',\n      description: 'the color of the clipping marker',\n      defaultValue: 'red',\n    },\n    indicatorThreshold: {\n      type: 'number',\n      description:\n        'the proportion of reads containing a insertion/clip indicator',\n      defaultValue: 0.3,\n    },\n    drawInterbaseCounts: {\n      type: 'boolean',\n      description:\n        'draw count \"upsidedown histogram\" of the interbase events that don\\'t contribute to the coverage count so are not drawn in the normal histogram',\n      defaultValue: true,\n    },\n    drawIndicators: {\n      type: 'boolean',\n      description:\n        'draw a triangular indicator where an event has been detected',\n      defaultValue: true,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { featureSpanPx } from '@jbrowse/core/util'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { RenderArgsDeserialized as FeatureRenderArgsDeserialized } from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\nimport {\n  getOrigin,\n  getScale,\n  ScaleOpts,\n  WiggleBaseRenderer,\n  YSCALEBAR_LABEL_OFFSET,\n} from '@jbrowse/plugin-wiggle'\n\nexport interface RenderArgsDeserialized extends FeatureRenderArgsDeserialized {\n  bpPerPx: number\n  height: number\n  highResolutionScaling: number\n  scaleOpts: ScaleOpts\n}\n\nexport interface RenderArgsDeserializedWithFeatures\n  extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n  ticks: { values: number[] }\n  displayCrossHatches: boolean\n  modificationTagMap: Record<string, string>\n}\n\nexport default class SNPCoverageRenderer extends WiggleBaseRenderer {\n  // note: the snps are drawn on linear scale even if the data is drawn in log\n  // scape hence the two different scales being used\n  draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const {\n      features,\n      regions,\n      bpPerPx,\n      scaleOpts,\n      height: unadjustedHeight,\n      theme: configTheme,\n      config: cfg,\n      displayCrossHatches,\n      ticks: { values },\n      modificationTagMap,\n    } = props\n    const theme = createJBrowseTheme(configTheme)\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n\n    // the adjusted height takes into account YSCALEBAR_LABEL_OFFSET from the\n    // wiggle display, and makes the height of the actual drawn area add\n    // \"padding\" to the top and bottom of the display\n    const offset = YSCALEBAR_LABEL_OFFSET\n    const height = unadjustedHeight - offset * 2\n\n    const opts = { ...scaleOpts, range: [0, height] }\n    const viewScale = getScale(opts)\n    const snpViewScale = getScale({ ...opts, scaleType: 'linear' })\n    const originY = getOrigin(scaleOpts.scaleType)\n    const snpOriginY = getOrigin('linear')\n\n    const indicatorThreshold = readConfObject(cfg, 'indicatorThreshold')\n    const drawInterbaseCounts = readConfObject(cfg, 'drawInterbaseCounts')\n    const drawIndicators = readConfObject(cfg, 'drawIndicators')\n\n    // get the y coordinate that we are plotting at, this can be log scale\n    const toY = (n: number) => height - viewScale(n) + offset\n    const toHeight = (n: number) => toY(originY) - toY(n)\n\n    // this is always linear scale, even when plotted on top of log scale\n    const snpToY = (n: number) => height - snpViewScale(n) + offset\n    const snpToHeight = (n: number) => snpToY(snpOriginY) - snpToY(n)\n\n    const colorForBase: { [key: string]: string } = {\n      A: theme.palette.bases.A.main,\n      C: theme.palette.bases.C.main,\n      G: theme.palette.bases.G.main,\n      T: theme.palette.bases.T.main,\n      total: 'lightgrey',\n      insertion: 'purple',\n      softclip: 'blue',\n      hardclip: 'red',\n      meth: 'red',\n      unmeth: 'blue',\n      ref: 'lightgrey',\n    }\n\n    // Use two pass rendering, which helps in visualizing the SNPs at higher\n    // bpPerPx First pass: draw the gray background\n    ctx.fillStyle = colorForBase.total\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const w = rightPx - leftPx + 0.3\n      const score = feature.get('score') as number\n      ctx.fillRect(leftPx, toY(score), w, toHeight(score))\n    }\n    ctx.fillStyle = 'grey'\n    ctx.beginPath()\n    ctx.lineTo(0, 0)\n    ctx.moveTo(0, width)\n    ctx.stroke()\n\n    // Second pass: draw the SNP data, and add a minimum feature width of 1px\n    // which can be wider than the actual bpPerPx This reduces overdrawing of\n    // the grey background over the SNPs\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      type Counts = {\n        [key: string]: { total: number; strands: { [key: string]: number } }\n      }\n      const snpinfo = feature.get('snpinfo') as {\n        cov: Counts\n        noncov: Counts\n        total: number\n      }\n      const w = Math.max(rightPx - leftPx + 0.3, 1)\n      const totalScore = snpinfo.total\n\n      Object.entries(snpinfo.cov)\n        .sort(([a], [b]) => {\n          if (a < b) {\n            return -1\n          }\n          if (a > b) {\n            return 1\n          }\n          return 0\n        })\n        .reduce((curr, [base, { total }]) => {\n          ctx.fillStyle =\n            colorForBase[base] ||\n            modificationTagMap[base.replace('mod_', '')] ||\n            'red'\n          ctx.fillRect(leftPx, snpToY(total + curr), w, snpToHeight(total))\n          return curr + total\n        }, 0)\n\n      const interbaseEvents = Object.entries(snpinfo.noncov)\n      const indicatorHeight = 4.5\n      if (drawInterbaseCounts) {\n        interbaseEvents.reduce((curr, [base, { total }]) => {\n          ctx.fillStyle = colorForBase[base]\n          ctx.fillRect(\n            leftPx - 0.6,\n            indicatorHeight + snpToHeight(curr),\n            1.2,\n            snpToHeight(total),\n          )\n          return curr + total\n        }, 0)\n      }\n\n      if (drawIndicators) {\n        let accum = 0\n        let max = 0\n        let maxBase = ''\n        interbaseEvents.forEach(([base, { total }]) => {\n          accum += total\n          if (total > max) {\n            max = total\n            maxBase = base\n          }\n        })\n\n        // avoid drawing a bunch of indicators if coverage is very low e.g.\n        // less than 7\n        if (accum > totalScore * indicatorThreshold && totalScore > 7) {\n          ctx.fillStyle = colorForBase[maxBase]\n          ctx.beginPath()\n          ctx.moveTo(leftPx - 3, 0)\n          ctx.lineTo(leftPx + 3, 0)\n          ctx.lineTo(leftPx, indicatorHeight)\n          ctx.fill()\n        }\n      }\n    }\n\n    if (displayCrossHatches) {\n      ctx.lineWidth = 1\n      ctx.strokeStyle = 'rgba(140,140,140,0.8)'\n      values.forEach(tick => {\n        ctx.beginPath()\n        ctx.moveTo(0, Math.round(toY(tick)))\n        ctx.lineTo(width, Math.round(toY(tick)))\n        ctx.stroke()\n      })\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport ConfigSchema from './configSchema'\n\nexport { WiggleRendering as ReactComponent } from '@jbrowse/plugin-wiggle'\nexport { default } from './SNPCoverageRenderer'\n\nexport const configSchema = ConfigurationSchema(\n  'SNPCoverageRenderer',\n  {},\n  { baseConfiguration: ConfigSchema, explicitlyTyped: true },\n)\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport { RenderArgs } from '@jbrowse/core/rpc/coreRpcMethods'\nimport { renameRegionsIfNeeded } from '@jbrowse/core/util'\nimport { Region } from '@jbrowse/core/util/types'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\nimport { toArray } from 'rxjs/operators'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { getTagAlt } from '../util'\nimport { getModificationTypes } from '../BamAdapter/MismatchParser'\n\nexport class PileupGetGlobalValueForTag extends RpcMethodType {\n  name = 'PileupGetGlobalValueForTag'\n\n  async serializeArguments(\n    args: RenderArgs & { signal?: AbortSignal; statusCallback?: Function },\n  ) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      throw new Error('no assembly manager available')\n    }\n\n    return renameRegionsIfNeeded(assemblyManager, args)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      regions: Region[]\n      sessionId: string\n      tag: string\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { adapterConfig, sessionId, regions, tag } = deserializedArgs\n    const dataAdapter = (\n      await getAdapter(this.pluginManager, sessionId, adapterConfig)\n    ).dataAdapter as BaseFeatureDataAdapter\n\n    const features = dataAdapter.getFeaturesInMultipleRegions(regions)\n    const featuresArray = await features.pipe(toArray()).toPromise()\n    const uniqueValues = new Set<string>()\n    featuresArray.forEach(feature => {\n      const tags = feature.get('tags')\n      const val = tags ? tags[tag] : feature.get(tag)\n      if (val !== undefined) {\n        uniqueValues.add(`${val}`)\n      }\n    })\n    return [...uniqueValues]\n  }\n}\n\nexport class PileupGetVisibleModifications extends RpcMethodType {\n  name = 'PileupGetVisibleModifications'\n\n  async serializeArguments(\n    args: RenderArgs & { signal?: AbortSignal; statusCallback?: Function },\n  ) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      throw new Error('no assembly manager available')\n    }\n\n    return renameRegionsIfNeeded(assemblyManager, args)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      regions: Region[]\n      sessionId: string\n      tag: string\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { adapterConfig, sessionId, regions } = deserializedArgs\n    const dataAdapter = (\n      await getAdapter(this.pluginManager, sessionId, adapterConfig)\n    ).dataAdapter as BaseFeatureDataAdapter\n\n    const features = dataAdapter.getFeaturesInMultipleRegions(regions)\n    const featuresArray = await features.pipe(toArray()).toPromise()\n    const uniqueValues = new Set<string>()\n    featuresArray.forEach(feature => {\n      const val = (getTagAlt(feature, 'MM', 'Mm') as string) || ''\n      if (val !== undefined) {\n        getModificationTypes(val).forEach(t => uniqueValues.add(t))\n      }\n    })\n    return [...uniqueValues]\n  }\n}\n","import { lazy } from 'react'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport { LinearWiggleDisplayReactComponent } from '@jbrowse/plugin-wiggle'\nimport {\n  configSchema as alignmentsFeatureDetailConfigSchema,\n  stateModelFactory as alignmentsFeatureDetailStateModelFactory,\n} from './AlignmentsFeatureDetail'\nimport BamAdapterF from './BamAdapter'\nimport * as MismatchParser from './BamAdapter/MismatchParser'\nimport CramAdapterF from './CramAdapter'\nimport HtsgetBamAdapterF from './HtsgetBamAdapter'\nimport {\n  configSchemaFactory as linearAligmentsDisplayConfigSchemaFactory,\n  modelFactory as linearAlignmentsDisplayModelFactory,\n  ReactComponent as LinearAlignmentsDisplayReactComponent,\n} from './LinearAlignmentsDisplay'\nimport {\n  configSchemaFactory as linearPileupDisplayConfigSchemaFactory,\n  modelFactory as linearPileupDisplayModelFactory,\n} from './LinearPileupDisplay'\nimport {\n  configSchemaFactory as linearSNPCoverageDisplayConfigSchemaFactory,\n  modelFactory as linearSNPCoverageDisplayModelFactory,\n} from './LinearSNPCoverageDisplay'\nimport PileupRenderer, {\n  configSchema as pileupRendererConfigSchema,\n  ReactComponent as PileupRendererReactComponent,\n} from './PileupRenderer'\nimport SNPCoverageAdapterF from './SNPCoverageAdapter'\nimport SNPCoverageRenderer, {\n  configSchema as SNPCoverageRendererConfigSchema,\n  ReactComponent as SNPCoverageRendererReactComponent,\n} from './SNPCoverageRenderer'\nimport {\n  PileupGetGlobalValueForTag,\n  PileupGetVisibleModifications,\n} from './PileupRPC/rpcMethods'\n\nexport { MismatchParser }\n\nexport default class AlignmentsPlugin extends Plugin {\n  name = 'AlignmentsPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'AlignmentsTrack',\n        {},\n        { baseConfiguration: createBaseTrackConfig(pluginManager) },\n      )\n      const track = new TrackType({\n        name: 'AlignmentsTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'AlignmentsTrack',\n          configSchema,\n        ),\n      })\n      const linearAlignmentsDisplay = pluginManager.getDisplayType(\n        'LinearAlignmentsDisplay',\n      )\n      // Add LinearAlignmentsDisplay here so that it has priority over the other\n      // linear displays (defaults to order the displays are added, but we have\n      // to add the Pileup and SNPCoverage displays first).\n      track.addDisplayType(linearAlignmentsDisplay)\n      return track\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearPileupDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearPileupDisplay',\n        configSchema,\n        stateModel: linearPileupDisplayModelFactory(\n          pluginManager,\n          configSchema,\n        ),\n        trackType: 'AlignmentsTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearSNPCoverageDisplayConfigSchemaFactory(\n        pluginManager,\n      )\n      return new DisplayType({\n        name: 'LinearSNPCoverageDisplay',\n        configSchema,\n        stateModel: linearSNPCoverageDisplayModelFactory(\n          pluginManager,\n          configSchema,\n        ),\n        trackType: 'AlignmentsTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: LinearWiggleDisplayReactComponent,\n      })\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearAligmentsDisplayConfigSchemaFactory(\n        pluginManager,\n      )\n      return new DisplayType({\n        name: 'LinearAlignmentsDisplay',\n        configSchema,\n        stateModel: linearAlignmentsDisplayModelFactory(\n          pluginManager,\n          configSchema,\n        ),\n        trackType: 'AlignmentsTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: LinearAlignmentsDisplayReactComponent,\n      })\n    })\n    pluginManager.addWidgetType(\n      () =>\n        new WidgetType({\n          name: 'AlignmentsFeatureWidget',\n          heading: 'Feature details',\n          configSchema: alignmentsFeatureDetailConfigSchema,\n          stateModel: alignmentsFeatureDetailStateModelFactory(pluginManager),\n          ReactComponent: lazy(\n            () => import('./AlignmentsFeatureDetail/AlignmentsFeatureDetail'),\n          ),\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BamAdapter',\n          ...pluginManager.load(BamAdapterF),\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'SNPCoverageAdapter',\n          ...pluginManager.load(SNPCoverageAdapterF),\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'CramAdapter',\n          ...pluginManager.load(CramAdapterF),\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'HtsgetBamAdapter',\n          ...pluginManager.load(HtsgetBamAdapterF),\n        }),\n    )\n    pluginManager.addRendererType(\n      () =>\n        new PileupRenderer({\n          name: 'PileupRenderer',\n          ReactComponent: PileupRendererReactComponent,\n          configSchema: pileupRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n    pluginManager.addRendererType(\n      () =>\n        new SNPCoverageRenderer({\n          name: 'SNPCoverageRenderer',\n          ReactComponent: SNPCoverageRendererReactComponent,\n          configSchema: SNPCoverageRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n\n    pluginManager.addRpcMethod(\n      () => new PileupGetGlobalValueForTag(pluginManager),\n    )\n    pluginManager.addRpcMethod(\n      () => new PileupGetVisibleModifications(pluginManager),\n    )\n  }\n}\n","/* eslint-disable no-underscore-dangle */\nimport {\n  Feature,\n  SimpleFeatureSerialized,\n} from '@jbrowse/core/util/simpleFeature'\nimport { BamRecord } from '@gmod/bam'\nimport {\n  parseCigar,\n  generateMD,\n  cigarToMismatches,\n  mdToMismatches,\n  Mismatch,\n} from './MismatchParser'\n\nimport BamAdapter from './BamAdapter'\n\nexport default class BamSlightlyLazyFeature implements Feature {\n  private record: BamRecord\n\n  private adapter: BamAdapter\n\n  private ref?: string\n\n  constructor(record: BamRecord, adapter: BamAdapter, ref?: string) {\n    this.record = record\n    this.adapter = adapter\n    this.ref = ref\n  }\n\n  _get_name() {\n    return this.record.get('name')\n  }\n\n  _get_type(): string {\n    return 'match'\n  }\n\n  _get_score(): number {\n    return this.record.get('mq')\n  }\n\n  _get_flags(): string {\n    // @ts-ignore\n    return this.record.flags\n  }\n\n  _get_strand(): number {\n    return this.record.isReverseComplemented() ? -1 : 1\n  }\n\n  _get_read_group_id(): number {\n    // @ts-ignore\n    return this.record.readGroupId\n  }\n\n  _get_pair_orientation() {\n    return this.record.isPaired() ? this.record.getPairOrientation() : undefined\n  }\n\n  _get_next_seq_id() {\n    return this.record._next_refid()\n  }\n\n  _get_seq_id() {\n    // @ts-ignore\n    return this.record._refID\n  }\n\n  _get_next_refName(): string | undefined {\n    return this.adapter.refIdToName(this.record._next_refid())\n  }\n\n  _get_next_segment_position(): string | undefined {\n    return this.record.isPaired()\n      ? `${this.adapter.refIdToName(this.record._next_refid())}:${\n          this.record._next_pos() + 1\n        }`\n      : undefined\n  }\n\n  _get_seq(): string {\n    return this.record.getReadBases()\n  }\n\n  _get_MD(): string | undefined {\n    const md = this.record.get('MD')\n    const seq = this.get('seq')\n    if (!md && seq && this.ref) {\n      return generateMD(this.ref, this.record.getReadBases(), this.get('CIGAR'))\n    }\n    return md\n  }\n\n  qualRaw(): Buffer | undefined {\n    return this.record.qualRaw()\n  }\n\n  set(): void {}\n\n  tags() {\n    const properties = Object.getOwnPropertyNames(\n      BamSlightlyLazyFeature.prototype,\n    )\n\n    return [\n      ...new Set(\n        properties\n          .filter(\n            prop =>\n              prop.startsWith('_get_') &&\n              prop !== '_get_mismatches' &&\n              prop !== '_get_skips_and_dels' &&\n              prop !== '_get_cram_read_features' &&\n              prop !== '_get_tags' &&\n              prop !== '_get_next_seq_id' &&\n              prop !== '_get_seq_id',\n          )\n          .map(methodName => methodName.replace('_get_', ''))\n          .concat(this.record._tags()),\n      ),\n    ]\n  }\n\n  id(): string {\n    return `${this.adapter.id}-${this.record.id()}`\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  get(field: string): any {\n    const methodName = `_get_${field}`\n    // @ts-ignore\n    if (this[methodName]) {\n      // @ts-ignore\n      return this[methodName]()\n    }\n    return this.record.get(field)\n  }\n\n  _get_refName(): string | undefined {\n    return this.adapter.refIdToName(this.record.seq_id())\n  }\n\n  parent(): undefined {\n    return undefined\n  }\n\n  children(): undefined {\n    return undefined\n  }\n\n  pairedFeature(): boolean {\n    return false\n  }\n\n  toJSON(): SimpleFeatureSerialized {\n    const tags = Object.fromEntries(\n      this.tags()\n        .map(t => {\n          return [t, this.get(t)]\n        })\n        .filter(elt => elt[1] !== undefined),\n    )\n\n    return {\n      ...tags,\n      uniqueId: this.id(),\n    }\n  }\n\n  _get_skips_and_dels(\n    opts: {\n      cigarAttributeName: string\n    } = {\n      cigarAttributeName: 'CIGAR',\n    },\n  ): Mismatch[] {\n    const { cigarAttributeName } = opts\n    let mismatches: Mismatch[] = []\n    let cigarOps: string[] = []\n\n    // parse the CIGAR tag if it has one\n    const cigarString = this.get(cigarAttributeName)\n    if (cigarString) {\n      cigarOps = parseCigar(cigarString)\n      mismatches = mismatches.concat(\n        cigarToMismatches(cigarOps, this.get('seq'), this.qualRaw()),\n      )\n    }\n    return mismatches\n  }\n\n  _get_mismatches({\n    cigarAttributeName = 'CIGAR',\n    mdAttributeName = 'MD',\n  }: {\n    cigarAttributeName?: string\n    mdAttributeName?: string\n  } = {}): Mismatch[] {\n    let mismatches: Mismatch[] = []\n    let cigarOps: string[] = []\n\n    // parse the CIGAR tag if it has one\n    const cigarString = this.get(cigarAttributeName)\n    if (cigarString) {\n      cigarOps = parseCigar(cigarString)\n      mismatches = mismatches.concat(\n        cigarToMismatches(cigarOps, this.get('seq'), this.qualRaw()),\n      )\n    }\n\n    // now let's look for CRAM or MD mismatches\n    const mdString = this.get(mdAttributeName)\n    if (mdString) {\n      mismatches = mismatches.concat(\n        mdToMismatches(\n          mdString,\n          cigarOps,\n          mismatches,\n          this.get('seq'),\n          this.qualRaw(),\n        ),\n      )\n    }\n\n    // uniqify the mismatches\n    const seen: { [index: string]: boolean } = {}\n    return mismatches.filter(m => {\n      const key = `${m.type},${m.start},${m.length}`\n      const s = seen[key]\n      seen[key] = true\n      return !s\n    })\n  }\n\n  _get_clipPos() {\n    const cigar = this.get('CIGAR') || ''\n    return this.get('strand') === -1\n      ? +(cigar.match(/(\\d+)[SH]$/) || [])[1] || 0\n      : +(cigar.match(/^(\\d+)([SH])/) || [])[1] || 0\n  }\n}\n","import { BamFile } from '@gmod/bam'\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region } from '@jbrowse/core/util/types'\nimport { checkAbortSignal } from '@jbrowse/core/util'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { toArray } from 'rxjs/operators'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport BamSlightlyLazyFeature from './BamSlightlyLazyFeature'\n\ninterface Header {\n  idToName: string[]\n  nameToId: Record<string, number>\n}\n\nexport default class BamAdapter extends BaseFeatureDataAdapter {\n  private samHeader?: Header\n\n  private setupP?: Promise<Header>\n\n  protected configured?: Promise<{\n    bam: BamFile\n    sequenceAdapter?: BaseFeatureDataAdapter\n  }>\n\n  // derived classes may not use the same configuration so a custom\n  // configure method allows derived classes to override this behavior\n  protected async configure() {\n    if (!this.configured) {\n      const bamLocation = readConfObject(this.config, 'bamLocation')\n      const location = readConfObject(this.config, ['index', 'location'])\n      const indexType = readConfObject(this.config, ['index', 'indexType'])\n      const chunkSizeLimit = readConfObject(this.config, 'chunkSizeLimit')\n      const fetchSizeLimit = readConfObject(this.config, 'fetchSizeLimit')\n      const bam = new BamFile({\n        bamFilehandle: openLocation(bamLocation),\n        csiFilehandle: indexType === 'CSI' ? openLocation(location) : undefined,\n        baiFilehandle: indexType !== 'CSI' ? openLocation(location) : undefined,\n        chunkSizeLimit,\n        fetchSizeLimit,\n      })\n\n      const adapterConfig = readConfObject(this.config, 'sequenceAdapter')\n      if (adapterConfig && this.getSubAdapter) {\n        this.configured = this.getSubAdapter(adapterConfig).then(\n          ({ dataAdapter }) => ({\n            bam,\n            sequenceAdapter: dataAdapter as BaseFeatureDataAdapter,\n          }),\n        )\n      } else {\n        this.configured = Promise.resolve({ bam })\n      }\n    }\n    return this.configured\n  }\n\n  async getHeader(opts?: BaseOptions) {\n    const { bam } = await this.configure()\n    return bam.getHeaderText(opts)\n  }\n\n  private async setup(opts?: BaseOptions) {\n    // note that derived classes may not provide a BAM directly so this is\n    // conditional\n    const { statusCallback = () => {} } = opts || {}\n    if (!this.setupP) {\n      this.setupP = this.configure()\n        .then(async ({ bam }) => {\n          statusCallback('Downloading index')\n          const samHeader = await bam.getHeader(opts)\n\n          // use the @SQ lines in the header to figure out the\n          // mapping between ref ref ID numbers and names\n          const idToName: string[] = []\n          const nameToId: Record<string, number> = {}\n          samHeader\n            .filter(l => l.tag === 'SQ')\n            .forEach((sqLine, refId) => {\n              sqLine.data.forEach(item => {\n                if (item.tag === 'SN') {\n                  // this is the ref name\n                  const refName = item.value\n                  nameToId[refName] = refId\n                  idToName[refId] = refName\n                }\n              })\n            })\n          statusCallback('')\n          this.samHeader = { idToName, nameToId }\n          return this.samHeader\n        })\n        .catch(e => {\n          this.setupP = undefined\n          throw e\n        })\n    }\n    return this.setupP\n  }\n\n  async getRefNames(opts?: BaseOptions) {\n    const { idToName } = await this.setup(opts)\n    return idToName\n  }\n\n  private async seqFetch(refName: string, start: number, end: number) {\n    const { sequenceAdapter } = await this.configure()\n    const refSeqStore = sequenceAdapter\n    if (!refSeqStore) {\n      return undefined\n    }\n    if (!refName) {\n      return undefined\n    }\n\n    const features = refSeqStore.getFeatures({\n      refName,\n      start,\n      end,\n      assemblyName: '',\n    })\n\n    const seqChunks = await features.pipe(toArray()).toPromise()\n\n    const trimmed: string[] = []\n    seqChunks\n      .sort((a: Feature, b: Feature) => a.get('start') - b.get('start'))\n      .forEach((chunk: Feature) => {\n        const chunkStart = chunk.get('start')\n        const chunkEnd = chunk.get('end')\n        const trimStart = Math.max(start - chunkStart, 0)\n        const trimEnd = Math.min(end - chunkStart, chunkEnd - chunkStart)\n        const trimLength = trimEnd - trimStart\n        const chunkSeq = chunk.get('seq') || chunk.get('residues')\n        trimmed.push(chunkSeq.substr(trimStart, trimLength))\n      })\n\n    const sequence = trimmed.join('')\n    if (sequence.length !== end - start) {\n      throw new Error(\n        `sequence fetch failed: fetching ${refName}:${(\n          start - 1\n        ).toLocaleString()}-${end.toLocaleString()} returned ${sequence.length.toLocaleString()} bases, but should have returned ${(\n          end - start\n        ).toLocaleString()}`,\n      )\n    }\n    return sequence\n  }\n\n  getFeatures(\n    region: Region & { originalRefName?: string },\n    opts?: BaseOptions,\n  ) {\n    const { refName, start, end, originalRefName } = region\n    const { signal, statusCallback = () => {} } = opts || {}\n    return ObservableCreate<Feature>(async observer => {\n      const { bam } = await this.configure()\n      await this.setup(opts)\n      statusCallback('Downloading alignments')\n      const records = await bam.getRecordsForRange(refName, start, end, opts)\n\n      checkAbortSignal(signal)\n\n      for (const record of records) {\n        let ref: string | undefined\n        if (!record.get('md')) {\n          ref = await this.seqFetch(\n            originalRefName || refName,\n            record.get('start'),\n            record.get('end'),\n          )\n        }\n        observer.next(new BamSlightlyLazyFeature(record, this, ref))\n      }\n      statusCallback('')\n      observer.complete()\n    }, signal)\n  }\n\n  freeResources(/* { region } */): void {}\n\n  // depends on setup being called before the BAM constructor\n  refIdToName(refId: number): string | undefined {\n    return this.samHeader?.idToName[refId]\n  }\n}\n","/* eslint-disable no-underscore-dangle */\nimport {\n  Feature,\n  SimpleFeatureSerialized,\n} from '@jbrowse/core/util/simpleFeature'\n\nimport CramAdapter from './CramAdapter'\n\nexport interface Mismatch {\n  qual?: number\n  start: number\n  length: number\n  type: string\n  base: string\n  altbase?: string\n  seq?: string\n  cliplen?: number\n}\n\nexport default class CramSlightlyLazyFeature implements Feature {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private record: any\n\n  private _store: CramAdapter\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(record: any, store: CramAdapter) {\n    this.record = record\n    this._store = store\n  }\n\n  _get_name() {\n    return this.record.readName\n  }\n\n  _get_start() {\n    return this.record.alignmentStart - 1\n  }\n\n  _get_end() {\n    return this.record.alignmentStart + this.record.lengthOnRef - 1\n  }\n\n  _get_cram_read_features() {\n    return this.record.readFeatures\n  }\n\n  _get_type() {\n    return 'match'\n  }\n\n  _get_score() {\n    return this.record.mappingQuality\n  }\n\n  _get_flags() {\n    return this.record.flags\n  }\n\n  _get_strand() {\n    return this.record.isReverseComplemented() ? -1 : 1\n  }\n\n  _read_group_id() {\n    const rg = this._store.samHeader.readGroups\n    return rg ? rg[this.record.readGroupId] : undefined\n  }\n\n  _get_qual() {\n    return (this.record.qualityScores || []).join(' ')\n  }\n\n  qualRaw() {\n    return this.record.qualityScores\n  }\n\n  _get_seq_id() {\n    return this._store.refIdToName(this.record.sequenceId)\n  }\n\n  _get_refName() {\n    return this._get_seq_id()\n  }\n\n  _get_is_paired() {\n    return !!this.record.mate\n  }\n\n  _get_pair_orientation() {\n    return this.record.isPaired() ? this.record.getPairOrientation() : undefined\n  }\n\n  _get_template_length() {\n    return this.record.templateLength || this.record.templateSize\n  }\n\n  _get_next_seq_id() {\n    return this.record.mate\n      ? this._store.refIdToName(this.record.mate.sequenceId)\n      : undefined\n  }\n\n  _get_next_pos() {\n    return this.record.mate ? this.record.mate.alignmentStart : undefined\n  }\n\n  _get_next_segment_position() {\n    return this.record.mate\n      ? `${this._store.refIdToName(this.record.mate.sequenceId)}:${\n          this.record.mate.alignmentStart\n        }`\n      : undefined\n  }\n\n  _get_tags() {\n    const RG = this._read_group_id()\n    const { tags } = this.record\n    // avoids a tag copy if no RG, but just copy if there is one\n    return RG !== undefined ? { ...tags, RG } : tags\n  }\n\n  _get_seq() {\n    return this.record.getReadBases()\n  }\n\n  // generate a CIGAR, based on code from jkbonfield\n  _get_CIGAR() {\n    let seq = ''\n    let cigar = ''\n    let op = 'M'\n    let oplen = 0\n\n    // not sure I should access these, but...\n    const ref = this.record._refRegion.seq\n    const refStart = this.record._refRegion.start\n    let last_pos = this.record.alignmentStart\n    let sublen = 0\n    if (typeof this.record.readFeatures !== 'undefined') {\n      // @ts-ignore\n      this.record.readFeatures.forEach(({ code, refPos, sub, data }) => {\n        sublen = refPos - last_pos\n        seq += ref.substring(last_pos - refStart, refPos - refStart)\n        last_pos = refPos\n\n        if (oplen && op !== 'M') {\n          cigar += oplen + op\n          oplen = 0\n        }\n        if (sublen) {\n          op = 'M'\n          oplen += sublen\n        }\n\n        if (code === 'b') {\n          // An array of bases stored verbatim\n          const ret = data.split(',')\n          const added = String.fromCharCode(...ret)\n          seq += added\n          last_pos += added.length\n          oplen += added.length\n        } else if (code === 'B') {\n          // Single base (+ qual score)\n          seq += sub\n          last_pos++\n          oplen++\n        } else if (code === 'X') {\n          // Substitution\n          seq += sub\n          last_pos++\n          oplen++\n        } else if (code === 'D' || code === 'N') {\n          // Deletion or Ref Skip\n          last_pos += data\n          if (oplen) {\n            cigar += oplen + op\n          }\n          cigar += data + code\n          oplen = 0\n        } else if (code === 'I' || code === 'S') {\n          // Insertion or soft-clip\n          seq += data\n          if (oplen) {\n            cigar += oplen + op\n          }\n          cigar += data.length + code\n          oplen = 0\n        } else if (code === 'i') {\n          // Single base insertion\n          seq += data\n          if (oplen) {\n            cigar += oplen + op\n          }\n          cigar += `${1}I`\n          oplen = 0\n        } else if (code === 'P') {\n          // Padding\n          if (oplen) {\n            cigar += oplen + op\n          }\n          cigar += `${data}P`\n        } else if (code === 'H') {\n          // Hard clip\n          if (oplen) {\n            cigar += oplen + op\n          }\n          cigar += `${data}H`\n          oplen = 0\n        } // else q or Q\n      })\n    } else {\n      sublen = this.record.readLength - seq.length\n    }\n    if (seq.length !== this.record.readLength) {\n      sublen = this.record.readLength - seq.length\n      seq += ref.substring(last_pos - refStart, last_pos - refStart + sublen)\n\n      if (oplen && op !== 'M') {\n        cigar += oplen + op\n        oplen = 0\n      }\n      op = 'M'\n      oplen += sublen\n    }\n    if (oplen) {\n      cigar += oplen + op\n    }\n    return cigar\n  }\n\n  tags() {\n    const properties = Object.getOwnPropertyNames(\n      CramSlightlyLazyFeature.prototype,\n    )\n    return properties\n      .filter(\n        prop =>\n          prop.startsWith('_get_') &&\n          prop !== '_get_mismatches' &&\n          prop !== '_get_skips_and_dels' &&\n          prop !== '_get_cram_read_features',\n      )\n      .map(methodName => methodName.replace('_get_', ''))\n  }\n\n  id() {\n    return `${this._store.id}-${this.record.uniqueId}`\n  }\n\n  get(field: string) {\n    const methodName = `_get_${field}`\n    // @ts-ignore\n    if (this[methodName]) {\n      // @ts-ignore\n      return this[methodName]()\n    }\n    return undefined\n  }\n\n  parent(): undefined | Feature {\n    return undefined\n  }\n\n  children(): undefined | Feature[] {\n    return undefined\n  }\n\n  set(): void {}\n\n  pairedFeature() {\n    return false\n  }\n\n  _get_clipPos() {\n    const mismatches = this.get('mismatches')\n    if (mismatches.length) {\n      const record =\n        this.get('strand') === -1\n          ? mismatches[mismatches.length - 1]\n          : mismatches[0]\n      const { type, cliplen } = record\n      if (type === 'softclip' || type === 'hardclip') {\n        return cliplen\n      }\n    }\n    return 0\n  }\n\n  toJSON(): SimpleFeatureSerialized {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const tags: Record<string, any> = {}\n    this.tags().forEach((t: string) => {\n      const val = this.get(t)\n      if (val !== undefined) {\n        tags[t] = val\n      }\n    })\n\n    return {\n      ...tags,\n      name: this.get('name'),\n      type: this.get('type'),\n      uniqueId: this.id(),\n    }\n  }\n\n  _get_mismatches(): Mismatch[] {\n    const readFeatures = this.get('cram_read_features')\n    const qual = this.qualRaw()\n    if (!readFeatures) {\n      return []\n    }\n    const start = this.get('start')\n    const mismatches: Mismatch[] = []\n    readFeatures.forEach(\n      (args: {\n        code: string\n        refPos: number\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        data: any\n        pos: number\n        sub: string\n        ref: string\n      }) => {\n        const { code, pos, data, sub, ref } = args\n        const refPos = args.refPos - 1 - start\n        if (code === 'X') {\n          // substitution\n          mismatches.push({\n            start: refPos,\n            length: 1,\n            base: sub,\n            qual: qual?.[pos],\n            altbase: ref,\n            type: 'mismatch',\n          })\n        } else if (code === 'I') {\n          // insertion\n          mismatches.push({\n            start: refPos,\n            type: 'insertion',\n            base: `${data.length}`,\n            length: 0,\n          })\n        } else if (code === 'N') {\n          // reference skip\n          mismatches.push({\n            type: 'skip',\n            length: data,\n            start: refPos,\n            base: 'N',\n          })\n        } else if (code === 'S') {\n          // soft clip\n          const len = data.length\n          mismatches.push({\n            start: refPos,\n            type: 'softclip',\n            base: `S${len}`,\n            cliplen: len,\n            length: 1,\n          })\n        } else if (code === 'P') {\n          // padding\n        } else if (code === 'H') {\n          // hard clip\n          const len = data\n          mismatches.push({\n            start: refPos,\n            type: 'hardclip',\n            base: `H${len}`,\n            cliplen: len,\n            length: 1,\n          })\n        } else if (code === 'D') {\n          // deletion\n          mismatches.push({\n            type: 'deletion',\n            length: data,\n            start: refPos,\n            base: '*',\n          })\n        } else if (code === 'b') {\n          // stretch of bases\n        } else if (code === 'q') {\n          // stretch of qual scores\n        } else if (code === 'B') {\n          // a pair of [base, qual]\n        } else if (code === 'i') {\n          // single-base insertion\n          // insertion\n          mismatches.push({\n            start: refPos,\n            type: 'insertion',\n            base: data,\n            length: 1,\n          })\n        } else if (code === 'Q') {\n          // single quality value\n        }\n      },\n    )\n    return mismatches\n  }\n\n  _get_skips_and_dels(): Mismatch[] {\n    return this._get_mismatches()\n  }\n}\n","import { CraiIndex, IndexedCramFile } from '@gmod/cram'\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region } from '@jbrowse/core/util/types'\nimport { checkAbortSignal } from '@jbrowse/core/util'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { toArray } from 'rxjs/operators'\nimport CramSlightlyLazyFeature from './CramSlightlyLazyFeature'\n\ninterface HeaderLine {\n  tag: string\n  value: any // eslint-disable-line @typescript-eslint/no-explicit-any\n  data: HeaderLine[]\n}\ninterface Header {\n  idToName?: string[]\n  nameToId?: Record<string, number>\n  readGroups?: number[]\n}\n\nexport default class CramAdapter extends BaseFeatureDataAdapter {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private cram: any\n\n  private setupP?: Promise<Header>\n\n  private sequenceAdapter?: BaseFeatureDataAdapter\n\n  public samHeader: Header = {}\n\n  // maps a refname to an id\n  private seqIdToRefName: string[] | undefined\n\n  // maps a seqId to original refname, passed specially to render args, to a seqid\n  private seqIdToOriginalRefName: string[] = []\n\n  public async configure() {\n    const cramLocation = readConfObject(this.config, 'cramLocation')\n    const craiLocation = readConfObject(this.config, 'craiLocation')\n    if (!cramLocation) {\n      throw new Error('missing cramLocation argument')\n    }\n    if (!craiLocation) {\n      throw new Error('missing craiLocation argument')\n    }\n    this.cram = new IndexedCramFile({\n      cramFilehandle: openLocation(cramLocation),\n      index: new CraiIndex({ filehandle: openLocation(craiLocation) }),\n      seqFetch: this.seqFetch.bind(this),\n      checkSequenceMD5: false,\n      fetchSizeLimit: this.config.fetchSizeLimit || 600000000,\n    })\n    // instantiate the sequence adapter\n    const sequenceAdapterType = readConfObject(this.config, [\n      'sequenceAdapter',\n      'type',\n    ])\n\n    if (!this.getSubAdapter) {\n      throw new Error('Error getting subadapter')\n    }\n\n    const { dataAdapter } = await this.getSubAdapter(\n      readConfObject(this.config, 'sequenceAdapter'),\n    )\n    if (dataAdapter instanceof BaseFeatureDataAdapter) {\n      this.sequenceAdapter = dataAdapter\n    } else {\n      throw new Error(\n        `CRAM feature adapters cannot use sequence adapters of type '${sequenceAdapterType}'`,\n      )\n    }\n    return { sequenceAdapter: this.sequenceAdapter }\n  }\n\n  async getHeader(opts?: BaseOptions) {\n    await this.configure()\n    return this.cram.cram.getHeaderText(opts)\n  }\n\n  private async seqFetch(seqId: number, start: number, end: number) {\n    start -= 1 // convert from 1-based closed to interbase\n\n    const refSeqStore = this.sequenceAdapter\n    if (!refSeqStore) {\n      return undefined\n    }\n    const refName = this.refIdToOriginalName(seqId) || this.refIdToName(seqId)\n    if (!refName) {\n      return undefined\n    }\n\n    const features = refSeqStore.getFeatures(\n      {\n        refName,\n        start,\n        end,\n        assemblyName: '',\n      },\n      {},\n    )\n\n    const seqChunks = await features.pipe(toArray()).toPromise()\n\n    const trimmed: string[] = []\n    seqChunks\n      .sort((a, b) => a.get('start') - b.get('start'))\n      .forEach((chunk: Feature) => {\n        const chunkStart = chunk.get('start')\n        const chunkEnd = chunk.get('end')\n        const trimStart = Math.max(start - chunkStart, 0)\n        const trimEnd = Math.min(end - chunkStart, chunkEnd - chunkStart)\n        const trimLength = trimEnd - trimStart\n        const chunkSeq = chunk.get('seq') || chunk.get('residues')\n        trimmed.push(chunkSeq.substr(trimStart, trimLength))\n      })\n\n    const sequence = trimmed.join('')\n    if (sequence.length !== end - start) {\n      throw new Error(\n        `sequence fetch failed: fetching ${refName}:${(\n          start - 1\n        ).toLocaleString()}-${end.toLocaleString()} returned ${sequence.length.toLocaleString()} bases, but should have returned ${(\n          end - start\n        ).toLocaleString()}`,\n      )\n    }\n    return sequence\n  }\n\n  private async setup(opts?: BaseOptions) {\n    const { statusCallback = () => {} } = opts || {}\n    if (!this.setupP) {\n      this.setupP = this.configure()\n        .then(async () => {\n          statusCallback('Downloading index')\n          const samHeader: HeaderLine[] = await this.cram.cram.getSamHeader(\n            opts?.signal,\n          )\n\n          // use the @SQ lines in the header to figure out the\n          // mapping between ref ID numbers and names\n          const idToName: string[] = []\n          const nameToId: Record<string, number> = {}\n          samHeader\n            .filter(l => l.tag === 'SQ')\n            .forEach((sqLine, refId) => {\n              sqLine.data.forEach(item => {\n                if (item.tag === 'SN') {\n                  // this is the ref name\n                  const refName = item.value\n                  nameToId[refName] = refId\n                  idToName[refId] = refName\n                }\n              })\n            })\n\n          const readGroups = samHeader\n            .filter(l => l.tag === 'RG')\n            .map(rgLine => rgLine.data.find(item => item.tag === 'ID')?.value)\n\n          if (idToName.length) {\n            this.samHeader = { idToName, nameToId, readGroups }\n          }\n          statusCallback('')\n          return this.samHeader\n        })\n        .catch(e => {\n          this.setupP = undefined\n          throw e\n        })\n    }\n    return this.setupP\n  }\n\n  async getRefNames(opts?: BaseOptions) {\n    await this.setup(opts)\n    if (this.samHeader.idToName) {\n      return this.samHeader.idToName\n    }\n    if (this.sequenceAdapter) {\n      return this.sequenceAdapter.getRefNames()\n    }\n    throw new Error('unable to get refnames')\n  }\n\n  // use info from the SAM header if possible, but fall back to using\n  // the ref seq order from when the browser's refseqs were loaded\n  refNameToId(refName: string) {\n    if (this.samHeader.nameToId) {\n      return this.samHeader.nameToId[refName]\n    }\n    if (this.seqIdToRefName) {\n      return this.seqIdToRefName.indexOf(refName)\n    }\n    return undefined\n  }\n\n  // use info from the SAM header if possible, but fall back to using\n  // the ref seq order from when the browser's refseqs were loaded\n  refIdToName(refId: number) {\n    if (this.samHeader.idToName) {\n      return this.samHeader.idToName[refId]\n    }\n    if (this.seqIdToRefName) {\n      return this.seqIdToRefName[refId]\n    }\n    return undefined\n  }\n\n  refIdToOriginalName(refId: number) {\n    return this.seqIdToOriginalRefName[refId]\n  }\n\n  getFeatures(\n    region: Region & { originalRefName?: string },\n    opts?: BaseOptions,\n  ) {\n    const { signal, statusCallback = () => {} } = opts || {}\n    const { refName, start, end, originalRefName } = region\n\n    return ObservableCreate<Feature>(async observer => {\n      await this.setup(opts)\n      if (this.sequenceAdapter && !this.seqIdToRefName) {\n        this.seqIdToRefName = await this.sequenceAdapter.getRefNames(opts)\n      }\n      const refId = this.refNameToId(refName)\n      if (refId !== undefined) {\n        if (originalRefName) {\n          this.seqIdToOriginalRefName[refId] = originalRefName\n        }\n        statusCallback('Downloading alignments')\n        const records = await this.cram.getRecordsForRange(\n          refId,\n          start,\n          end,\n          opts,\n        )\n        checkAbortSignal(signal)\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        records.forEach((record: any) => {\n          observer.next(this.cramRecordToFeature(record))\n        })\n      }\n      statusCallback('')\n      observer.complete()\n    }, signal)\n  }\n\n  freeResources(/* { region } */): void {}\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  cramRecordToFeature(record: any): Feature {\n    return new CramSlightlyLazyFeature(record, this)\n  }\n}\n","import { HtsgetFile } from '@gmod/bam'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport BamAdapter from '../BamAdapter/BamAdapter'\n\nexport default class HtsgetBamAdapter extends BamAdapter {\n  protected async configure() {\n    if (!this.configured) {\n      const htsgetBase = readConfObject(this.config, 'htsgetBase')\n      const htsgetTrackId = readConfObject(this.config, 'htsgetTrackId')\n      const bam = new HtsgetFile({\n        baseUrl: htsgetBase,\n        trackId: htsgetTrackId,\n      })\n\n      const adapterConfig = readConfObject(this.config, 'sequenceAdapter')\n      if (adapterConfig && this.getSubAdapter) {\n        this.configured = this.getSubAdapter(adapterConfig).then(\n          ({ dataAdapter }) => {\n            return {\n              bam,\n              sequenceAdapter: dataAdapter as BaseFeatureDataAdapter,\n            }\n          },\n        )\n      }\n      this.configured = Promise.resolve({ bam })\n    }\n    return this.configured\n  }\n}\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  Button,\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n  TextField,\n  Typography,\n  makeStyles,\n} from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: 300,\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nfunction ColorByTagDlg(props: {\n  model: { setColorScheme: Function }\n  handleClose: () => void\n}) {\n  const classes = useStyles()\n  const { model, handleClose } = props\n  const [tag, setTag] = useState('')\n  const validTag = tag.match(/^[A-Za-z][A-Za-z0-9]$/)\n\n  return (\n    <Dialog open onClose={handleClose}>\n      <DialogTitle>\n        Color by tag\n        <IconButton\n          aria-label=\"close\"\n          className={classes.closeButton}\n          onClick={handleClose}\n        >\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent style={{ overflowX: 'hidden' }}>\n        <div className={classes.root}>\n          <Typography>Enter tag to color by: </Typography>\n          <Typography color=\"textSecondary\">\n            Examples: XS or TS for RNA-seq inferred read strand, ts (lower-case)\n            for minimap2 read strand, HP for haplotype, RG for read group, etc.\n          </Typography>\n\n          <TextField\n            value={tag}\n            onChange={event => {\n              setTag(event.target.value)\n            }}\n            placeholder=\"Enter tag name\"\n            inputProps={{\n              maxLength: 2,\n              'data-testid': 'color-tag-name-input',\n            }}\n            error={tag.length === 2 && !validTag}\n            helperText={tag.length === 2 && !validTag ? 'Not a valid tag' : ''}\n            autoComplete=\"off\"\n            data-testid=\"color-tag-name\"\n          />\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            style={{ marginLeft: 20 }}\n            onClick={() => {\n              model.setColorScheme({\n                type: 'tag',\n                tag,\n              })\n              handleClose()\n            }}\n            disabled={!validTag}\n          >\n            Submit\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nexport default observer(ColorByTagDlg)\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  Button,\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n  Link,\n  Paper,\n  TextField,\n  Typography,\n  makeStyles,\n} from '@material-ui/core'\n\nimport CloseIcon from '@material-ui/icons/Close'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: 500,\n  },\n  paper: {\n    padding: theme.spacing(2),\n    margin: theme.spacing(2),\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n  field: {\n    margin: theme.spacing(2),\n  },\n}))\n\nconst flagNames = [\n  'read paired',\n  'read mapped in proper pair',\n  'read unmapped',\n  'mate unmapped',\n  'read reverse strand',\n  'mate reverse strand',\n  'first in pair',\n  'second in pair',\n  'not primary alignment',\n  'read fails platform/vendor quality checks',\n  'read is PCR or optical duplicate',\n  'supplementary alignment',\n]\n\nfunction Bitmask(props: { flag?: number; setFlag: Function }) {\n  const { flag = 0, setFlag } = props\n  return (\n    <>\n      <TextField\n        type=\"number\"\n        value={flag}\n        onChange={event => setFlag(+event.target.value)}\n      />\n      {flagNames.map((name, index) => {\n        const val = flag & (1 << index)\n        const key = `${name}_${val}`\n        return (\n          <div key={key}>\n            <input\n              type=\"checkbox\"\n              checked={Boolean(val)}\n              onChange={event => {\n                if (event.target.checked) {\n                  setFlag(flag | (1 << index))\n                } else {\n                  setFlag(flag & ~(1 << index))\n                }\n              }}\n            />\n            <label htmlFor={key}>{name}</label>\n          </div>\n        )\n      })}\n    </>\n  )\n}\n\nfunction FilterByTagDlg(props: {\n  model: {\n    filterBy?: {\n      flagExclude: number\n      flagInclude: number\n      readName?: string\n      tagFilter?: { tag: string; value: string }\n    }\n    setFilterBy: Function\n  }\n  handleClose: () => void\n}) {\n  const { model, handleClose } = props\n  const classes = useStyles()\n  const { filterBy } = model\n  const [flagInclude, setFlagInclude] = useState(filterBy?.flagInclude)\n  const [flagExclude, setFlagExclude] = useState(filterBy?.flagExclude)\n  const [tag, setTag] = useState(filterBy?.tagFilter?.tag || '')\n  const [tagValue, setTagValue] = useState(filterBy?.tagFilter?.value || '')\n  const [readName, setReadName] = useState(filterBy?.readName || '')\n  const validTag = tag.match(/^[A-Za-z][A-Za-z0-9]$/)\n\n  const site = 'https://broadinstitute.github.io/picard/explain-flags.html'\n\n  return (\n    <Dialog open onClose={handleClose}>\n      <DialogTitle>\n        Filter options\n        <IconButton\n          aria-label=\"close\"\n          className={classes.closeButton}\n          onClick={handleClose}\n        >\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <Typography>\n          Set filter bitmask options. Refer to <Link href={site}>{site}</Link>{' '}\n          for details\n        </Typography>\n        <div className={classes.root}>\n          <Paper className={classes.paper} variant=\"outlined\">\n            <div style={{ display: 'flex' }}>\n              <div>\n                <Typography>Read must have ALL these flags</Typography>\n                <Bitmask flag={flagInclude} setFlag={setFlagInclude} />\n              </div>\n              <div>\n                <Typography>Read must have NONE of these flags</Typography>\n                <Bitmask flag={flagExclude} setFlag={setFlagExclude} />\n              </div>\n            </div>\n          </Paper>\n          <Paper className={classes.paper} variant=\"outlined\">\n            <Typography>\n              Filter by tag name and value. Use * in the value field to get all\n              reads containing any value for that tag. Example: filter tag name\n              SA with value * to get all split/supplementary reads. Other\n              examples include HP for haplotype, or RG for read group\n            </Typography>\n            <TextField\n              className={classes.field}\n              value={tag}\n              onChange={event => {\n                setTag(event.target.value)\n              }}\n              placeholder=\"Enter tag name\"\n              inputProps={{\n                maxLength: 2,\n                'data-testid': 'color-tag-name-input',\n              }}\n              error={tag.length === 2 && !validTag}\n              helperText={\n                tag.length === 2 && !validTag ? 'Not a valid tag' : ''\n              }\n              data-testid=\"color-tag-name\"\n            />\n            <TextField\n              className={classes.field}\n              value={tagValue}\n              onChange={event => {\n                setTagValue(event.target.value)\n              }}\n              placeholder=\"Enter tag value\"\n              inputProps={{\n                'data-testid': 'color-tag-name-input',\n              }}\n              data-testid=\"color-tag-value\"\n            />\n          </Paper>\n          <Paper className={classes.paper} variant=\"outlined\">\n            <Typography>Filter by read name</Typography>\n            <TextField\n              className={classes.field}\n              value={readName}\n              onChange={event => {\n                setReadName(event.target.value)\n              }}\n              placeholder=\"Enter read name\"\n              inputProps={{\n                'data-testid': 'color-tag-readname-input',\n              }}\n              data-testid=\"color-tag-readname\"\n            />\n          </Paper>\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            onClick={() => {\n              model.setFilterBy({\n                flagInclude,\n                flagExclude,\n                readName,\n                tagFilter:\n                  tag !== ''\n                    ? {\n                        tag,\n                        value: tagValue,\n                      }\n                    : undefined,\n              })\n              handleClose()\n            }}\n          >\n            Submit\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nexport default observer(FilterByTagDlg)\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  Button,\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n  TextField,\n  Typography,\n  makeStyles,\n} from '@material-ui/core'\n\nimport CloseIcon from '@material-ui/icons/Close'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    margin: 0,\n    padding: theme.spacing(2),\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nfunction SortByTagDlg(props: {\n  model: { setSortedBy: Function }\n  handleClose: () => void\n}) {\n  const classes = useStyles()\n  const { model, handleClose } = props\n  const [tag, setTag] = useState('')\n  const validTag = tag.match(/^[A-Za-z][A-Za-z0-9]$/)\n  return (\n    <Dialog open onClose={handleClose}>\n      <DialogTitle>\n        Sort by tag\n        <IconButton\n          aria-label=\"close\"\n          className={classes.closeButton}\n          onClick={handleClose}\n        >\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <div>\n          <Typography>Set the tag to sort by</Typography>\n          <Typography color=\"textSecondary\">\n            Examples: HP for haplotype, RG for read group, etc.\n          </Typography>\n          <TextField\n            value={tag}\n            onChange={event => {\n              setTag(event.target.value)\n            }}\n            placeholder=\"Enter tag name\"\n            inputProps={{\n              maxLength: 2,\n              'data-testid': 'sort-tag-name-input',\n            }}\n            error={tag.length === 2 && !validTag}\n            helperText={tag.length === 2 && !validTag ? 'Not a valid tag' : ''}\n            autoComplete=\"off\"\n            data-testid=\"sort-tag-name\"\n          />\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            onClick={() => {\n              model.setSortedBy('tag', tag)\n              handleClose()\n            }}\n          >\n            Submit\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\nexport default observer(SortByTagDlg)\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  Button,\n  TextField,\n  Typography,\n  IconButton,\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  Checkbox,\n  FormControlLabel,\n  makeStyles,\n} from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    margin: theme.spacing(4),\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nfunction SetFeatureHeightDlg(props: {\n  model: {\n    minScore: number\n    maxScore: number\n    setMinScore: Function\n    setMaxScore: Function\n    setFeatureHeight: Function\n    setNoSpacing: Function\n    featureHeightSetting: number\n    noSpacing: boolean\n  }\n  handleClose: () => void\n}) {\n  const classes = useStyles()\n  const { model, handleClose } = props\n  const { featureHeightSetting, noSpacing: noSpacingSetting } = model\n\n  const [height, setHeight] = useState(`${featureHeightSetting}`)\n  const [noSpacing, setNoSpacing] = useState(noSpacingSetting)\n\n  const ok = height !== '' && !Number.isNaN(+height)\n\n  return (\n    <Dialog open onClose={handleClose}>\n      <DialogTitle>\n        Set feature height\n        <IconButton className={classes.closeButton} onClick={handleClose}>\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <Typography>\n          Adjust the feature height and whether there is any spacing between\n          features. Setting feature height to 1 and removing spacing makes the\n          display very compact\n        </Typography>\n        <div className={classes.root}>\n          <Typography>Enter feature height: </Typography>\n          <TextField\n            value={height}\n            onChange={event => {\n              setHeight(event.target.value)\n            }}\n          />\n          <FormControlLabel\n            control={\n              <Checkbox\n                checked={!!noSpacing}\n                onChange={() => setNoSpacing(val => !val)}\n              />\n            }\n            label=\"Remove spacing between features in y-direction?\"\n          />\n\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            type=\"submit\"\n            style={{ marginLeft: 20 }}\n            disabled={!ok}\n            onClick={() => {\n              model.setFeatureHeight(\n                height !== '' && !Number.isNaN(+height) ? +height : undefined,\n              )\n              model.setNoSpacing(noSpacing)\n\n              handleClose()\n            }}\n          >\n            Submit\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nexport default observer(SetFeatureHeightDlg)\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  Button,\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n  TextField,\n  Typography,\n  makeStyles,\n} from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: 500,\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n  field: {\n    margin: theme.spacing(2),\n  },\n}))\n\nfunction SetMaxHeightDlg(props: {\n  model: {\n    maxHeight?: number\n    setMaxHeight: Function\n  }\n  handleClose: () => void\n}) {\n  const { model, handleClose } = props\n  const classes = useStyles()\n  const { maxHeight = '' } = model\n  const [max, setMax] = useState(`${maxHeight}`)\n\n  return (\n    <Dialog open onClose={handleClose}>\n      <DialogTitle id=\"alert-dialog-title\">\n        Filter options\n        <IconButton\n          aria-label=\"close\"\n          className={classes.closeButton}\n          onClick={handleClose}\n        >\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <div className={classes.root}>\n          <Typography>Set max height for the track</Typography>\n          <TextField\n            value={max}\n            onChange={event => {\n              setMax(event.target.value)\n            }}\n            placeholder=\"Enter max height for layout\"\n          />\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            type=\"submit\"\n            style={{ marginLeft: 20 }}\n            onClick={() => {\n              model.setMaxHeight(\n                max !== '' && !Number.isNaN(+max) ? +max : undefined,\n              )\n              handleClose()\n            }}\n          >\n            Submit\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nexport default observer(SetMaxHeightDlg)\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { ObservableMap } from 'mobx'\nimport {\n  Button,\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n  Typography,\n  CircularProgress,\n  makeStyles,\n} from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\n\nconst useStyles = makeStyles(theme => ({\n  root: {},\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n\n  table: {\n    border: '1px solid #888',\n    margin: theme.spacing(4),\n    '& td': {\n      padding: theme.spacing(1),\n    },\n  },\n}))\n\nfunction ModificationTable({\n  modifications,\n}: {\n  modifications: [string, string][]\n}) {\n  const classes = useStyles()\n  return (\n    <table className={classes.table}>\n      <tbody>\n        {modifications.map(([key, value]) => (\n          <tr key={key}>\n            <td>{key}</td>\n            <td>{value}</td>\n            <td\n              style={{\n                width: '1em',\n                background: value,\n              }}\n            />\n          </tr>\n        ))}\n      </tbody>\n    </table>\n  )\n}\n\nfunction ColorByTagDlg(props: {\n  model: {\n    setColorScheme: Function\n    modificationTagMap: ObservableMap<string, string>\n    colorBy?: { type: string }\n  }\n  handleClose: () => void\n}) {\n  const classes = useStyles()\n  const { model, handleClose } = props\n  const { colorBy, modificationTagMap } = model\n\n  const modifications = [...modificationTagMap.entries()]\n\n  return (\n    <Dialog open onClose={handleClose}>\n      <DialogTitle>\n        Color by modifications\n        <IconButton\n          aria-label=\"close\"\n          className={classes.closeButton}\n          onClick={handleClose}\n        >\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <div className={classes.root}>\n          <Typography>\n            You can choose to color the modifications in the BAM/CRAM MM/ML\n            specification using this dialog. Choosing modifications colors the\n            modified positions and can color multiple modification types.\n            Choosing the methylation setting colors methylated and unmethylated\n            CpG.\n          </Typography>\n          <Typography>\n            Note: you can revisit this dialog to see the current mapping of\n            colors to modification type for the modification coloring mode\n          </Typography>\n          <div style={{ margin: 20 }}>\n            {colorBy?.type === 'modifications' ? (\n              <div>\n                {modifications.length ? (\n                  <>\n                    Current modification-type-to-color mapping\n                    <ModificationTable\n                      modifications={[...modificationTagMap.entries()]}\n                    />\n                  </>\n                ) : (\n                  <div>\n                    <Typography>\n                      Note: color by modifications is already enabled. Loading\n                      current modifications...\n                    </Typography>\n                    <CircularProgress size={15} />\n                  </div>\n                )}\n              </div>\n            ) : null}\n            {colorBy?.type === 'methylation' ? (\n              <ModificationTable\n                modifications={[\n                  ['methylated', 'red'],\n                  ['unmethylated', 'blue'],\n                ]}\n              />\n            ) : null}\n          </div>\n          <div style={{ display: 'flex' }}>\n            <Button\n              variant=\"contained\"\n              color=\"primary\"\n              style={{ margin: 5 }}\n              onClick={() => {\n                model.setColorScheme({\n                  type: 'modifications',\n                })\n                handleClose()\n              }}\n            >\n              Modifications\n            </Button>\n            <Button\n              variant=\"contained\"\n              color=\"primary\"\n              style={{ margin: 5 }}\n              onClick={() => {\n                model.setColorScheme({\n                  type: 'methylation',\n                })\n                handleClose()\n              }}\n            >\n              Methylation\n            </Button>\n            <Button\n              variant=\"contained\"\n              color=\"secondary\"\n              style={{ margin: 5 }}\n              onClick={() => handleClose()}\n            >\n              Cancel\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nexport default observer(ColorByTagDlg)\n","import React, { useState } from 'react'\nimport {\n  Typography,\n  Link,\n  Paper,\n  Checkbox,\n  FormControlLabel,\n  FormGroup,\n  makeStyles,\n} from '@material-ui/core'\nimport { observer } from 'mobx-react'\nimport { getSession } from '@jbrowse/core/util'\nimport copy from 'copy-to-clipboard'\nimport {\n  FeatureDetails,\n  BaseCard,\n  SimpleValue,\n} from '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail'\nimport { parseCigar } from '../BamAdapter/MismatchParser'\n\nconst useStyles = makeStyles(() => ({\n  compact: {\n    paddingRight: 0,\n    paddingTop: 0,\n    paddingBottom: 0,\n  },\n}))\n\nconst omit = ['clipPos', 'flags']\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction AlignmentFlags(props: { feature: any }) {\n  const classes = useStyles()\n  const { feature } = props\n  const { flags } = feature\n  const flagNames = [\n    'read paired',\n    'read mapped in proper pair',\n    'read unmapped',\n    'mate unmapped',\n    'read reverse strand',\n    'mate reverse strand',\n    'first in pair',\n    'second in pair',\n    'not primary alignment',\n    'read fails platform/vendor quality checks',\n    'read is PCR or optical duplicate',\n    'supplementary alignment',\n  ]\n  return (\n    <BaseCard {...props} title=\"Flags\">\n      <SimpleValue name={'Flag'} value={flags} />\n\n      <FormGroup>\n        {flagNames.map((name, index) => {\n          const val = flags & (1 << index)\n          const key = `${name}_${val}`\n          return (\n            <FormControlLabel\n              key={key}\n              control={\n                <Checkbox\n                  className={classes.compact}\n                  checked={Boolean(val)}\n                  name={name}\n                  readOnly\n                />\n              }\n              label={name}\n            />\n          )\n        })}\n      </FormGroup>\n    </BaseCard>\n  )\n}\n\nfunction Formatter({ value }: { value: unknown }) {\n  const [show, setShow] = useState(false)\n  const display = String(value)\n  if (display.length > 100) {\n    return (\n      <>\n        <button type=\"button\" onClick={() => copy(display)}>\n          Copy\n        </button>\n        <button type=\"button\" onClick={() => setShow(val => !val)}>\n          {show ? 'Show less' : 'Show more'}\n        </button>\n        <div>{show ? display : `${display.slice(0, 100)}...`}</div>\n      </>\n    )\n  }\n  return <div>{display}</div>\n}\n\n// utility function to get length of alignment from cigar\nfunction getLengthOnRef(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let lengthOnRef = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'I') {\n      lengthOnRef += len\n    }\n  }\n  return lengthOnRef\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction SupplementaryAlignments(props: { tag: string; model: any }) {\n  const { tag, model } = props\n  const session = getSession(model)\n  return (\n    <BaseCard {...props} title=\"Supplementary alignments\">\n      <Typography>List of supplementary alignment locations</Typography>\n      <ul>\n        {tag\n          .split(';')\n          .filter(SA => !!SA)\n          .map((SA, index) => {\n            const [saRef, saStart, saStrand, saCigar] = SA.split(',')\n            const saLength = getLengthOnRef(saCigar)\n            const extra = Math.floor(saLength / 5)\n            const start = +saStart\n            const end = +saStart + saLength\n            const locString = `${saRef}:${Math.max(1, start - extra)}-${\n              end + extra\n            }`\n            const displayString = `${saRef}:${start}-${end} (${saStrand})`\n            return (\n              <li key={`${locString}-${index}`}>\n                <Link\n                  onClick={() => {\n                    const { view } = model\n                    if (view) {\n                      view.navToLocString(locString)\n                    } else {\n                      session.notify(\n                        'No view associated with this feature detail panel anymore',\n                        'warning',\n                      )\n                    }\n                  }}\n                  href=\"#\"\n                >\n                  {displayString}\n                </Link>\n              </li>\n            )\n          })}\n      </ul>\n    </BaseCard>\n  )\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction PairLink({ locString, model }: { locString: string; model: any }) {\n  const session = getSession(model)\n  return (\n    <Link\n      onClick={() => {\n        const { view } = model\n        if (view) {\n          view.navToLocString(locString)\n        } else {\n          session.notify(\n            'No view associated with this feature detail panel anymore',\n            'warning',\n          )\n        }\n      }}\n      href=\"#\"\n    >\n      {locString}\n    </Link>\n  )\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction AlignmentFeatureDetails(props: { model: any }) {\n  const { model } = props\n  const feat = JSON.parse(JSON.stringify(model.featureData))\n  const SA = (feat.tags && feat.tags.SA) || feat.SA\n  return (\n    <Paper data-testid=\"alignment-side-drawer\">\n      <FeatureDetails\n        {...props}\n        omit={omit}\n        feature={feat}\n        formatter={(value: unknown, key: string) => {\n          return key === 'next_segment_position' ? (\n            <PairLink model={model} locString={value as string} />\n          ) : (\n            <Formatter value={value} />\n          )\n        }}\n      />\n      {SA ? <SupplementaryAlignments model={model} tag={SA} /> : null}\n      <AlignmentFlags feature={feat} {...props} />\n    </Paper>\n  )\n}\n\nexport default observer(AlignmentFeatureDetails)\n"],"names":["configSchema","ConfigurationSchema","stateModelFactory","pluginManager","types","model","id","ElementId","type","literal","featureData","frozen","view","safeReference","pluggableMstType","actions","self","setFeatureData","data","clearFeatureData","undefined","late","bamLocation","defaultValue","uri","index","indexType","enumeration","location","chunkSizeLimit","fetchSizeLimit","sequenceAdapter","explicitlyTyped","getAdapterClass","then","r","runtime","exports","Op","Object","prototype","hasOwn","hasOwnProperty","$Symbol","Symbol","iteratorSymbol","iterator","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","obj","key","value","defineProperty","enumerable","configurable","writable","err","wrap","innerFn","outerFn","tryLocsList","protoGenerator","Generator","generator","create","context","Context","_invoke","makeInvokeMethod","tryCatch","fn","arg","call","GenStateSuspendedStart","GenStateSuspendedYield","GenStateExecuting","GenStateCompleted","ContinueSentinel","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","getProto","getPrototypeOf","NativeIteratorPrototype","values","Gp","constructor","displayName","defineIteratorMethods","forEach","method","isGeneratorFunction","genFun","ctor","name","mark","setPrototypeOf","__proto__","awrap","__await","AsyncIterator","PromiseImpl","invoke","resolve","reject","record","result","unwrapped","error","previousPromise","enqueue","callInvokeWithMethodAndArg","async","Promise","iter","next","done","state","Error","doneResult","delegate","delegateResult","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","TypeError","info","resultName","nextLoc","toString","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","push","resetTryEntry","completion","reset","keys","object","reverse","length","pop","iterable","iteratorMethod","isNaN","i","skipTempReset","prev","charAt","slice","stop","rootEntry","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","module","regeneratorRuntime","accidentalStrictMode","Function","getNextRefPos","parseCigar","cigar","split","cigarToMismatches","ops","seq","qual","currOffset","seqOffset","mismatches","len","op","start","base","q","j","cliplen","mdToMismatches","mdstring","cigarOps","cigarMismatches","mismatchRecords","curr","skips","filter","lastCigar","lastTemplateOffset","lastRefOffset","lastSkipPos","nextRecord","getTemplateCoordLocal","refCoord","templateOffset","refOffset","md","match","token","parseInt","substring","mismatch","s","substr","qualScore","altbase","getTemplateCoord","getMismatches","cigarString","mdString","concat","seen","m","generateMD","target","query","queryOffset","targetOffset","lengthMD","console","warn","str","toLowerCase","toUpperCase","tmp","positions","cigarIdx","readPos","refPos","pos","getModificationPositions","mm","mods","mod","map","basemod","rest","matches","strand","typestr","f","score","delta","flat","getModificationTypes","lib","cramLocation","craiLocation","pluggableConfigSchemaType","load","configSchemaF","htsgetBase","htsgetTrackId","configModelFactory","PileupDisplayConfigSchema","getDisplayType","SNPCoverageDisplayConfigSchema","pileupDisplay","snpCoverageDisplay","baseConfiguration","baseLinearDisplayConfigSchema","minDisplayHeight","compose","BaseDisplay","PileupDisplay","maybe","stateModel","SNPCoverageDisplay","snpCovHeight","configuration","ConfigurationReference","height","showCoverage","showPileup","scrollTop","toggleCoverage","togglePileup","setScrollTop","setSNPCoverageHeight","n","views","trackMenuItems","pileupDisplayConfig","conf","getConf","track","getContainingTrack","displayId","getFeatureByID","features","DisplayBlurb","sortedBy","sortedByPosition","sortedByRefName","snpCoverageDisplayConfig","label","subMenu","composedTrackMenuItems","extraTrackMenuItems","setSNPCoverageDisplay","displayConfig","setUserBpPerPxLimit","limit","setPileupDisplay","setHeight","displayHeight","resizeHeight","distance","oldHeight","newHeight","afterAttach","addDisposer","autorun","deepEqual","getSnapshot","setConfig","filterBy","setFilterBy","colorBy","setColorBy","renderSvg","opts","pileupHeight","when","ready","React","transform","overrideHeight","AlignmentsDisplay","style","position","RenderingComponent","ResizeHandle","onDrag","top","observer","PileupConfigFactory","PileupRendererConfigSchema","getRendererType","SvgFeatureRendererConfigSchema","defaultRendering","renderers","PileupRenderer","SvgFeatureRenderer","renderer","maxDisplayedBpPerPx","description","colorScheme","linearBasicDisplayConfigSchemaFactory","LinearPileupDisplayBlurb","props","backgroundColor","Typography","color","variant","refName","getUniqueTagValues","blocks","getSession","rpcManager","adapterConfig","sessionId","getRpcSessionId","tag","regions","contentBlocks","getUniqueModificationValues","ColorByTagDlg","lazy","FilterByTagDlg","SortByTagDlg","SetFeatureHeightDlg","SetMaxHeightDlg","ModificationsDlg","rendererTypes","Map","BaseLinearDisplay","showSoftClipping","featureHeight","number","noSpacing","fadeLikelihood","trackMaxHeight","mismatchAlpha","string","assemblyName","extra","optional","flagInclude","flagExclude","readName","tagFilter","colorTagMap","observable","modificationTagMap","currBpPerPx","setReady","flag","setCurrBpPerPx","setMaxHeight","setFeatureHeight","setNoSpacing","setColorScheme","cast","updateModificationColorMap","uniqueModifications","colorPalette","has","totalKeys","newColor","set","updateColorTagMap","uniqueTag","renderProps","getContainingView","staticBlocks","uniqueTagSet","parentTrack","uniqueModificationsSet","region","end","rendererType","renderInClient","timeout","bpPerPx","setError","delay","selectFeature","feature","session","isSessionModelWithWidgets","featureWidget","addWidget","toJSON","showWidget","setSelection","clearSelected","copyFeatureToClipboard","copiedFeature","uniqueId","copy","JSON","stringify","notify","toggleSoftClipping","toggleMismatchAlpha","setSortedBy","centerLineInfo","offset","centerBp","Math","round","centerRefName","superReload","reload","maxHeight","rendererTypeName","rendererConfig","configBlob","getEnv","featureHeightSetting","readConfObject","mismatchAlphaSetting","viewName","get","contextMenuItems","feat","contextMenuFeature","icon","MenuOpenIcon","onClick","clearFeatureSelection","ContentCopyIcon","additionalContextMenuItemCallbacks","callback","menuItems","filters","SerializableFilterChain","composedRenderProps","getParentRenderProps","notReady","rpcDriverName","displayModel","parse","showSoftClip","config","VisibilityIcon","checked","SortIcon","disabled","option","setDialogComponent","PaletteIcon","FilterListIcon","SNPCoverageConfigFactory","SNPCoverageRendererConfigSchema","autoscale","minScore","Number","MIN_VALUE","maxScore","MAX_VALUE","scaleType","inverted","headroom","SNPCoverageRenderer","useStyles","makeStyles","theme","popper","fontSize","zIndex","tooltip","pointerEvents","hoverVertical","background","border","width","cursor","TooltipContents","toLocaleString","total","ref","cov","noncov","lowqual","delskips","entries","Fragment","strands","floor","Tooltip","mouseCoord","featureUnderMouse","classes","MUITooltip","placement","className","open","title","left","linearWiggleDisplayModelFactory","drawInterbaseCounts","drawIndicators","drawInterbaseCountsSetting","drawIndicatorsSetting","modificationsReady","scaleOpts","resolution","ticks","displayCrossHatches","toggleDrawIndicators","toggleDrawInterbaseCounts","vals","TooltipComponent","subadapter","needsScalebar","PileupRendering","onMouseMove","blockKey","selectedFeatureId","featureIdUnderMouse","blockLayoutFeatures","highlightOverlayCanvas","useRef","useState","mouseIsDown","setMouseIsDown","movedDuringLastMouseDown","setMovedDuringLastMouseDown","useEffect","canvas","current","ctx","getContext","clearRect","rect","blockLayout","leftBp","topPx","rightBp","bottomPx","bpSpanPx","leftPx","rightPx","rectTop","rectHeight","shadowColor","shadowBlur","lineJoin","lineWidth","strokeStyle","strokeRect","highlightedFeature","fillStyle","fillRect","onMouseDown","event","callMouseHandler","onMouseEnter","onMouseOut","onMouseOver","onMouseUp","onMouseLeave","onContextMenu","mouseMove","offsetX","offsetY","getBoundingClientRect","clientX","clientY","px","reversed","clientBp","featIdUnderMouse","getFeatureOverlapping","handlerName","featureHandler","canvasHandler","canvasWidth","ceil","PrerenderedCanvas","onFocus","onBlur","contextVariable","orientationType","displayMode","minSubfeatureWidth","maxClippingSize","largeInsertionIndicatorScale","sortFeature","featureArray","Array","from","featuresInCenterLine","featuresOutsideCenter","innerArray","doesIntersect2","isCram","sort","a","b","getTag","t","isString","localeCompare","baseSortArray","consuming","baseMap","aMismatch","bMismatch","acode","bcode","charCodeAt","sortedMap","tags","getTagAlt","alt","orientationTypes","fr","F1R2","F2R1","F1F2","F2F1","R1R2","R2R1","R1F2","R2F1","rf","ff","PileupLayoutSession","args","cachedLayout","cachedLayoutIsValid","layout","makeLayout","LayoutSession","getColorBaseMap","A","palette","bases","main","C","G","T","deletion","alignmentColoring","color_fwd_strand_not_proper","color_rev_strand_not_proper","color_fwd_strand","color_rev_strand","color_fwd_missing_mate","color_rev_missing_mate","color_fwd_diff_chr","color_rev_diff_chr","color_pair_lr","color_pair_rr","color_pair_rl","color_pair_ll","color_nostrand","color_interchrom","color_longinsert","color_shortinsert","shouldDrawMismatches","includes","charWidth","measureText","charHeight","expansionBefore","expansionAfter","heightPx","addRect","renderArgs","bpExpansion","max","getOrientation","orientation","LR","RR","RL","LL","_config","abs","flags","revflag","flipper","scores","val","k","layoutFeature","ml","probabilities","e","elt","min","modifications","probIndex","col","Color","alpha","hsl","regionSequence","fstart","fend","rstart","rend","methBins","fill","epos","l2","l1","flip","beginPath","moveTo","lineTo","closePath","colorType","colorByInsertSize","colorByOrientation","colorByStranded","foundValue","drawRect","colorByPerBaseQuality","colorByModifications","colorByMethylation","colorForBase","drawSNPs","drawIndels","getCharWidthHeight","minFeatWidth","insertionScale","pxPerBp","w","heightLim","getAlphaColor","baseColor","mismatchLeftPx","mismatchRightPx","mismatchWidthPx","getContrastText","fillText","txt","padding","softClipLength","softClipStart","softClipLeftPx","softClipRightPx","softClipWidthPx","layoutRecords","configTheme","createJBrowseTheme","font","drawAlignmentRect","drawMismatches","drawSoftClipping","sortedFeatures","featureMap","iterMap","size","getFeatures","createLayoutInWorker","layoutFeats","getAdapter","dataAdapter","pipe","toArray","toPromise","getTotalHeight","renderToAbstractCanvas","makeImageData","res","results","maxHeightReached","BoxRendererType","mismatchLen","isInterbase","inc","bin","field","dec","SNPCoverageAdapter","subadapterConfig","sequenceConf","getSubAdapter","ObservableCreate","configure","stream","passes","generateCoverageBins","bins","SimpleFeature","snpinfo","signal","getRefNames","binMax","initBins","regionSeq","reduce","fstrand","mstart","interbase","BaseFeatureDataAdapter","capabilities","configSchemaFactory","adapterCapabilities","clipColor","indicatorThreshold","unadjustedHeight","cfg","YSCALEBAR_LABEL_OFFSET","range","viewScale","getScale","snpViewScale","originY","getOrigin","snpOriginY","toY","toHeight","snpToY","snpToHeight","insertion","softclip","hardclip","meth","unmeth","featureSpanPx","stroke","totalScore","replace","interbaseEvents","indicatorHeight","accum","maxBase","tick","WiggleBaseRenderer","ConfigSchema","PileupGetGlobalValueForTag","rootModel","assemblyManager","renameRegionsIfNeeded","rpcDriverClassName","deserializeArguments","deserializedArgs","getFeaturesInMultipleRegions","featuresArray","uniqueValues","Set","add","RpcMethodType","PileupGetVisibleModifications","AlignmentsPlugin","addTrackType","createBaseTrackConfig","TrackType","createBaseTrackModel","linearAlignmentsDisplay","addDisplayType","linearPileupDisplayConfigSchemaFactory","DisplayType","linearPileupDisplayModelFactory","trackType","viewType","ReactComponent","BaseLinearDisplayComponent","linearSNPCoverageDisplayConfigSchemaFactory","linearSNPCoverageDisplayModelFactory","LinearWiggleDisplayReactComponent","linearAligmentsDisplayConfigSchemaFactory","linearAlignmentsDisplayModelFactory","LinearAlignmentsDisplayReactComponent","addWidgetType","WidgetType","heading","alignmentsFeatureDetailConfigSchema","alignmentsFeatureDetailStateModelFactory","addAdapterType","AdapterType","BamAdapterF","SNPCoverageAdapterF","CramAdapterF","HtsgetBamAdapterF","addRendererType","PileupRendererReactComponent","pileupRendererConfigSchema","SNPCoverageRendererReactComponent","addRpcMethod","Plugin","BamSlightlyLazyFeature","adapter","isReverseComplemented","readGroupId","isPaired","getPairOrientation","_next_refid","_refID","refIdToName","_next_pos","getReadBases","qualRaw","properties","getOwnPropertyNames","prop","startsWith","methodName","_tags","seq_id","fromEntries","cigarAttributeName","mdAttributeName","BamAdapter","configured","bam","BamFile","bamFilehandle","openLocation","csiFilehandle","baiFilehandle","getHeaderText","statusCallback","setupP","getHeader","samHeader","idToName","nameToId","l","sqLine","refId","item","setup","refSeqStore","seqChunks","trimmed","chunk","chunkStart","chunkEnd","trimStart","trimEnd","trimLength","chunkSeq","sequence","join","originalRefName","getRecordsForRange","records","checkAbortSignal","seqFetch","CramSlightlyLazyFeature","store","_store","alignmentStart","lengthOnRef","readFeatures","mappingQuality","rg","readGroups","qualityScores","sequenceId","_get_seq_id","mate","templateLength","templateSize","RG","_read_group_id","oplen","_refRegion","refStart","last_pos","sublen","code","sub","ret","added","String","fromCharCode","readLength","_get_mismatches","CramAdapter","cram","IndexedCramFile","cramFilehandle","CraiIndex","filehandle","bind","checkSequenceMD5","sequenceAdapterType","seqId","refIdToOriginalName","getSamHeader","rgLine","find","seqIdToRefName","indexOf","seqIdToOriginalRefName","refNameToId","cramRecordToFeature","HtsgetBamAdapter","HtsgetFile","baseUrl","trackId","root","closeButton","right","spacing","grey","handleClose","setTag","validTag","Dialog","onClose","DialogTitle","IconButton","CloseIcon","DialogContent","overflowX","TextField","onChange","placeholder","inputProps","maxLength","helperText","autoComplete","Button","marginLeft","paper","margin","flagNames","Bitmask","setFlag","Boolean","htmlFor","setFlagInclude","setFlagExclude","tagValue","setTagValue","setReadName","site","Link","href","Paper","display","noSpacingSetting","ok","FormControlLabel","control","Checkbox","setMax","table","ModificationTable","CircularProgress","compact","paddingRight","paddingTop","paddingBottom","omit","AlignmentFlags","BaseCard","SimpleValue","FormGroup","readOnly","Formatter","show","setShow","getLengthOnRef","SupplementaryAlignments","SA","saRef","saStart","saStrand","saCigar","saLength","locString","displayString","navToLocString","PairLink","AlignmentFeatureDetails","FeatureDetails","formatter"],"mappings":"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"}