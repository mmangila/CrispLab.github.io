"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),n=e(t),r=require("@jbrowse/core/ui"),o=require("mobx-react"),i=require("mobx-state-tree"),a=require("@jbrowse/core/configuration"),s=require("@material-ui/core"),c=e(require("@material-ui/core/ScopedCssBaseline")),u=e(require("@material-ui/icons/Menu")),l=e(require("react-use-dimensions")),g=require("@jbrowse/core/util"),f=require("@jbrowse/core/assemblyManager"),p=e(f),d=e(require("@jbrowse/core/PluginManager")),h=e(require("@jbrowse/core/rpc/RpcManager")),m=e(require("@jbrowse/core/TextSearch/TextSearchManager")),v=e(require("@jbrowse/plugin-alignments")),y=e(require("@jbrowse/plugin-bed")),w=e(require("@jbrowse/plugin-config")),b=e(require("@jbrowse/plugin-data-management")),E=e(require("@jbrowse/plugin-gff3")),x=e(require("@jbrowse/plugin-linear-genome-view")),S=e(require("@jbrowse/plugin-sequence")),k=e(require("@jbrowse/plugin-svg")),j=e(require("@jbrowse/plugin-variants")),T=e(require("@jbrowse/plugin-wiggle")),P=require("mobx"),C=e(require("@material-ui/icons/Info")),M=e(require("@jbrowse/core/PluginLoader")),L=s.makeStyles({paper:{overflow:"auto"}}),O=o.observer((function(e){var r=e.session,o=r.visibleWidget;if(!o)return n.createElement(s.AppBar,{position:"relative"},n.createElement(s.Toolbar,null));var a=i.getEnv(r).pluginManager.getWidgetType(o.type),u=a.ReactComponent,l=a.HeadingComponent,g=a.heading;return n.createElement(n.Fragment,null,n.createElement(s.AppBar,{position:"static"},n.createElement(s.Toolbar,null,l?n.createElement(l,{model:o}):n.createElement(s.Typography,{variant:"h6"},g))),o&&u?n.createElement(t.Suspense,{fallback:n.createElement("div",null,"Loading...")},n.createElement(c,null,n.createElement(u,{model:o,session:r,overrideDimensions:{height:5*window.innerHeight/8,width:800}}))):null)})),q=o.observer((function(e){var t=e.session,r=L(),o=t.hideAllWidgets;return n.createElement(s.Dialog,{open:Boolean(t.visibleWidget),onClose:o,maxWidth:"xl"},n.createElement(s.Paper,{className:r.paper},n.createElement(O,{session:t})))})),N=s.makeStyles((function(e){return{viewContainer:{overflow:"hidden",background:e.palette.secondary.main,margin:e.spacing(1)},icon:{color:e.palette.secondary.contrastText},displayName:{marginTop:2,color:e.palette.secondary.contrastText},grow:{flexGrow:1},iconRoot:{"&:hover":{backgroundColor:s.fade(e.palette.secondary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}}})),I=o.observer((function(e){var o,i=e.model,a=e.IconButtonProps,c=e.IconProps,l=t.useState(),g=l[0],f=l[1];return null!=(o=i.menuItems)&&o.length?n.createElement(n.Fragment,null,n.createElement(s.IconButton,Object.assign({},a,{"aria-label":"more","aria-controls":"view-menu","aria-haspopup":"true",onClick:function(e){f(e.currentTarget)},"data-testid":"view_menu_icon"}),n.createElement(u,Object.assign({},c))),n.createElement(r.Menu,{anchorEl:g,open:Boolean(g),onMenuItemClick:function(e,t){t(),f(void 0)},onClose:function(){f(void 0)},menuItems:i.menuItems})):null})),W=o.observer((function(e){var o=e.view,a=e.children,c=N(),u=s.useTheme(),f=g.getSession(o),p=l(),d=p[0],h=p[1].width,m=u.spacing(1);return t.useEffect((function(){h&&i.isAlive(o)&&o.setWidth(h-2*m)}),[m,o,h]),n.createElement(s.Paper,{elevation:12,ref:d,className:c.viewContainer,style:{padding:"0px "+m+"px "+m+"px"}},f.DialogComponent?n.createElement(t.Suspense,{fallback:n.createElement("div",null)},n.createElement(f.DialogComponent,Object.assign({handleClose:function(){return f.setDialogComponent(void 0,void 0)}},f.DialogProps))):null,n.createElement("div",{style:{display:"flex"}},n.createElement(I,{model:o,IconButtonProps:{classes:{root:c.iconRoot},edge:"start"},IconProps:{className:c.icon}}),n.createElement("div",{className:c.grow}),o.displayName?n.createElement(s.Typography,{variant:"body2",className:c.displayName},o.displayName):null,n.createElement("div",{className:c.grow}),n.createElement("div",{style:{width:20,height:20}},n.createElement(r.Logomark,{variant:"white"}))),n.createElement(s.Paper,null,a))})),R=s.makeStyles((function(){return{avoidParentStyle:{all:"initial"}}})),_=o.observer((function(e){var o=e.viewState,u=R(),l=o.session,g=l.view,f=i.getEnv(l).pluginManager.getViewType(g.type);if(!f)throw new Error("unknown view type "+g.type);var p=f.ReactComponent,d=r.createJBrowseTheme(a.readConfObject(o.config.configuration,"theme"));return n.createElement(s.ThemeProvider,{theme:d},n.createElement("div",{className:u.avoidParentStyle},n.createElement(c,null,n.createElement(W,{key:"view-"+g.id,view:g},n.createElement(t.Suspense,{fallback:n.createElement("div",null,"Loading...")},n.createElement(p,{model:g,session:l}))),n.createElement(q,{session:l}))))})),A=[k,v,y,w,b,E,x,S,j,T];function D(e,t){return i.types.model("Configuration",{configuration:a.ConfigurationSchema("Root",{rpc:h.configSchema,highResolutionScaling:{type:"number",defaultValue:2},theme:{type:"frozen",defaultValue:{}}}),assembly:t,tracks:i.types.array(e.pluggableConfigSchemaType("track")),connections:i.types.array(e.pluggableConfigSchemaType("connection")),aggregateTextSearchAdapters:i.types.array(e.pluggableConfigSchemaType("text search adapter")),plugins:i.types.frozen()}).views((function(e){return{get assemblies(){return[e.assembly]},get assemblyName(){return a.readConfObject(e.assembly,"name")},get rpcManager(){return i.getParent(e).rpcManager}}}))}function G(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function V(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){G(i,r,o,a,s,"next",e)}function s(e){G(i,r,o,a,s,"throw",e)}a(void 0)}))}}function B(){return(B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var F=t.lazy((function(){return new Promise((function(e){e(function(e){if(e&&e.__esModule)return e;var t={};return e&&Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t.default=e,t}(require("@jbrowse/core/ui/AboutDialog")))}))}));function J(e){var t=new d([].concat(A,e).map((function(e){return new e})));t.createPluggableElements();var n=function(e){return i.types.model("ReactLinearGenomeViewSession",{name:i.types.identifier,margin:0,view:e.getViewType("LinearGenomeView").stateModel,widgets:i.types.map(e.pluggableMstType("widget","stateModel")),activeWidgets:i.types.map(i.types.safeReference(e.pluggableMstType("widget","stateModel"))),connectionInstances:i.types.array(e.pluggableMstType("connection","stateModel"))}).volatile((function(){return{selection:void 0,task:void 0,DialogComponent:void 0,DialogProps:void 0}})).views((function(e){return{get rpcManager(){return i.getParent(e).rpcManager},get configuration(){return i.getParent(e).config.configuration},get assemblies(){return[i.getParent(e).config.assembly]},get assemblyNames(){return[i.getParent(e).config.assemblyName]},get tracks(){return i.getParent(e).config.tracks},get aggregateTextSearchAdapters(){return i.getParent(e).config.aggregateTextSearchAdapters},get connections(){return i.getParent(e).config.connections},get adminMode(){return!1},get assemblyManager(){return i.getParent(e).assemblyManager},get version(){return""},get views(){return[e.view]},get renderProps(){return{theme:a.readConfObject(this.configuration,"theme")}},get visibleWidget(){if(i.isAlive(e))return Array.from(e.activeWidgets.values())[e.activeWidgets.size-1]},getReferring:function(t){var n=[];return i.walk(i.getParent(e),(function(e){if(i.isModelType(i.getType(e))){var r=i.getMembers(e);Object.entries(r.properties).forEach((function(r){var o=r[0];i.isReferenceType(r[1])&&e[o]===t&&n.push({node:e,key:o})}))}})),n}}})).actions((function(t){return{setDialogComponent:function(e,n){t.DialogComponent=e,t.DialogProps=n},makeConnection:function(n,r){void 0===r&&(r={});var o=n.type;if(!o)throw new Error("track configuration has no `type` listed");var i=a.readConfObject(n,"name");if(!e.getConnectionType(o))throw new Error("unknown connection type "+o);var s=B({},r,{name:i,type:o,configuration:n}),c=t.connectionInstances.push(s);return t.connectionInstances[c-1]},removeReferring:function(e,t,n,r){var o=this;e.forEach((function(e){var a=e.node,s=!1;try{var c="open track(s)",u=g.getContainingView(a);n.push((function(){return u.hideTrack(t.trackId)})),s=!0,r[c]||(r[c]=0),r[c]+=1}catch(e){}if(o.hasWidget(a)){var l="configuration editor widget(s)";n.push((function(){return o.hideWidget(a)})),s=!0,r[l]||(r[l]=0),r[l]+=1}if(!s)throw new Error("Error when closing this connection, the following node is still referring to a track configuration: "+JSON.stringify(i.getSnapshot(a)))}))},prepareToBreakConnection:function(e){var n=this,r=[],o={},i=a.readConfObject(e,"name");return t.connectionInstances.find((function(e){return e.name===i})).tracks.forEach((function(e){var i=t.getReferring(e);n.removeReferring(i,e,r,o)})),[function(){r.forEach((function(e){return e()})),n.breakConnection(e)},o]},breakConnection:function(e){var n=a.readConfObject(e,"name"),r=t.connectionInstances.find((function(e){return e.name===n}));t.connectionInstances.remove(r)},addView:function(n,r){if(void 0===r&&(r={}),!e.getElementType("view",n))throw new Error("unknown view type "+n);t.view=B({},r,{type:n})},removeView:function(){},addWidget:function(n,r,o,i){if(void 0===o&&(o={}),void 0===i&&(i={type:n}),!e.getElementType("widget",n))throw new Error("unknown widget type "+n);var a=B({},o,{id:r,type:n,configuration:i});return t.widgets.set(r,a),t.widgets.get(r)},showWidget:function(e){t.activeWidgets.has(e.id)&&t.activeWidgets.delete(e.id),t.activeWidgets.set(e.id,e)},hasWidget:function(e){return t.activeWidgets.has(e.id)},hideWidget:function(e){t.activeWidgets.delete(e.id)},hideAllWidgets:function(){t.activeWidgets.clear()},setSelection:function(e){t.selection=e},clearSelection:function(){t.selection=void 0},clearConnections:function(){t.connectionInstances.length=0},renameCurrentSession:function(e){return i.getParent(t).renameCurrentSession(e)}}})).views((function(e){return{getTrackActionMenuItems:function(t){return[{label:"About track",onClick:function(){e.setDialogComponent(F,{config:t})},icon:C}]}}})).extend((function(){var e=P.observable.array();return{views:{get snackbarMessages(){return e}},actions:{notify:function(e,t){return this.pushSnackbarMessage(e,t)},pushSnackbarMessage:function(t,n){return e.push([t,n])},popSnackbarMessage:function(){return e.pop()}}}}))}(t),r=f.assemblyConfigSchemas(t),o=i.types.union.apply(i.types,[{dispatcher:r.dispatcher}].concat(r.assemblyConfigSchemas)),s=p(o,t),c=t.load(m);return{model:i.types.model("ReactLinearGenomeView",{config:D(t,o),session:n,assemblyManager:s,error:i.types.maybe(i.types.string)}).actions((function(e){return{setSession:function(t){e.session=i.cast(t)},renameCurrentSession:function(t){if(e.session){var n=JSON.parse(JSON.stringify(i.getSnapshot(e.session)));n.name=t,this.setSession(n)}},setError:function(t){e.error=String(t)}}})).views((function(e){return{get jbrowse(){return e.config}}})).volatile((function(e){return{rpcManager:new h(t,e.config.configuration.rpc,{MainThreadRpcDriver:{}}),textSearchManager:new c}})),pluginManager:t}}function z(e,t){return e(t={exports:{}},t.exports),t.exports}var H=z((function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var o=Object.create((t&&t.prototype instanceof g?t:g).prototype),i=new S(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=u(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,i),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function g(){}function f(){}function p(){}var d={};d[o]=function(){return this};var h=Object.getPrototypeOf,m=h&&h(h(k([])));m&&m!==t&&n.call(m,o)&&(d=m);var v=p.prototype=g.prototype=Object.create(d);function y(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){var r;this._invoke=function(o,i){function a(){return new t((function(r,a){!function r(o,i,a,s){var c=u(e[o],e,i);if("throw"!==c.type){var l=c.arg,g=l.value;return g&&"object"==typeof g&&n.call(g,"__await")?t.resolve(g.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(g).then((function(e){l.value=e,a(l)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function k(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:j}}function j(){return{value:void 0,done:!0}}return f.prototype=v.constructor=p,p.constructor=f,f.displayName=s(p,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,s(e,a,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(w.prototype),w.prototype[i]=function(){return this},e.AsyncIterator=w,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new w(c(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(v),s(v,a,"Generator"),v[o]=function(){return this},v.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=k,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;x(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:k(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));function Y(){return(Y=V(H.mark((function e(t){var n;return H.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new M(t)).installGlobalReExports(window),e.next=4,n.load();case 4:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}exports.JBrowseLinearGenomeView=_,exports.ThemeProvider=function(e){var t=e.children;return console.warn('Deprecation warning: `ThemeProvider` is no longer supported as a way to theme @jbrowse/react-linear-genome-view. If using a custom theme, please pass the theme in to the "configuration" of `createViewState` instead.'),n.createElement(n.Fragment,null,t)},exports.createJBrowseTheme=function(e){return console.warn("Deprecation warning: `createJBrowseTheme` will be removed in a future release. It can be imported from @jbrowse/core/ui if needed."),r.createJBrowseTheme(e)},exports.createModel=J,exports.createViewState=function(e){var t=e.assembly,n=e.tracks,r=e.configuration,o=e.aggregateTextSearchAdapters,a=e.location,s=e.onChange,c=J(e.plugins||[]),u=c.pluginManager,l=e.defaultSession;l||(l={name:"this session",view:{id:"linearGenomeView",type:"LinearGenomeView"}});var g=c.model.create({config:{configuration:r,assembly:t,tracks:n,aggregateTextSearchAdapters:o,defaultSession:l},assemblyManager:{},session:l},{pluginManager:u});return u.setRootModel(g),u.configure(),a&&P.autorun((function(e){g.assemblyManager.allPossibleRefNames&&g.assemblyManager.allPossibleRefNames.length&&g.session.view.initialized&&("string"==typeof a?g.session.view.navToLocString(a,g.assemblyManager.assemblies[0].name):g.session.view.navTo(a),e.dispose())})),s&&i.onPatch(g,s),g},exports.loadPlugins=function(e){return Y.apply(this,arguments)};
//# sourceMappingURL=react-linear-genome-view.cjs.production.min.js.map
