"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("@jbrowse/core/pluggableElementTypes/AdapterType")),r=require("@jbrowse/core/pluggableElementTypes/models"),n=e(require("@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType")),o=e(require("@jbrowse/core/pluggableElementTypes/TrackType")),a=e(require("@jbrowse/core/Plugin")),i=require("@jbrowse/plugin-linear-genome-view"),c=require("@jbrowse/core/configuration"),u=require("@jbrowse/core/util/color"),s=require("@jbrowse/core/ui"),l=require("mobx-react"),f=e(require("react")),p=require("@jbrowse/core/util"),d=require("mobx-state-tree"),h=require("@jbrowse/core/util/tracks"),y=require("@jbrowse/core/data_adapters/BaseAdapter"),v=require("@jbrowse/core/util/rxjs"),g=e(require("@jbrowse/core/util/simpleFeature")),m=require("rxjs/operators"),w=require("@jbrowse/core/util/io"),b=require("@gmod/twobit"),x=require("@gmod/indexedfasta"),S=e(require("abortable-promise-cache")),k=e(require("@jbrowse/core/util/QuickLRU"));function L(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function j(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){L(a,n,o,i,c,"next",e)}function c(e){L(a,n,o,i,c,"throw",e)}i(void 0)}))}}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function q(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function E(e,t,r){return t&&q(e.prototype,t),r&&q(e,r),e}function O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){O(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function R(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=_(e);if(t){var o=_(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return A(this,r)}}function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=r){var n,o,a=[],i=!0,c=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){c=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(c)throw o}}return a}}(e,t)||z(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){if(e){if("string"==typeof e)return I(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?I(e,t):void 0}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var D=c.ConfigurationSchema("BgzipFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.fai"}},gziLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.gzi"}}},{explicitlyTyped:!0}),B=c.ConfigurationSchema("ChromSizesAdapter",{chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/species.chrom.sizes"}}},{explicitlyTyped:!0});function M(e){for(var t=e.codonTable,r=e.frame,n=e.bpPerPx,o=e.region,a=e.height,i=e.y,c=e.reverse,u=void 0!==c&&c,s=e.theme,l=n,d=(r+(3-o.start%3)+3)%3,h=e.seq.slice(d),y=[],v=0;v<h.length;v+=3){var g=h.slice(v,v+3),m=u?p.revcom(g):g;y.push({letter:t[m]||"",codon:m.toUpperCase()})}var w=1/l*3,b=0===o.start?0:w,x=1/n>=12,S=(o.end-o.start)/n,k=["#d8d8d8","#adadad","#8f8f8f"].reverse();return f.createElement(f.Fragment,null,y.map((function(e,t){var n=o.reversed?S-(w*(t+1)+d/l-b):w*t+d/l-b,c=e.letter,u=e.codon;return f.createElement(f.Fragment,{key:"".concat(t,"-").concat(c)},f.createElement("rect",{x:n,y:i,width:x?w:w+.7,height:a,stroke:x?"#555":"none",fill:p.defaultStarts.includes(u)?s.palette.startCodon:p.defaultStops.includes(u)?s.palette.stopCodon:k[Math.abs(r)]}),x?f.createElement("text",{x:n+w/2,y:i+a/2,dominantBaseline:"middle",textAnchor:"middle"},c):null)})))}function G(e){var t=e.bpPerPx,r=e.region,n=e.feature,o=e.theme,a=e.height,i=e.seq,c=e.y,s=1/t>=12,l=N(p.bpSpanPx(n.get("start"),n.get("end"),r,t),2),d=l[0],h=l[1],y=r.reversed,v=n.get("end")-n.get("start"),g=Math.max((h-d)/v,.8);return f.createElement(f.Fragment,null,i.split("").map((function(e,t){var r=o.palette.bases[e.toUpperCase()],n=y?h-(t+1)*g:d+t*g;return f.createElement(f.Fragment,{key:t},f.createElement("rect",{x:n,y:c,width:g,height:a,fill:r?r.main:"#aaa",stroke:s?"#555":"none"}),s?f.createElement("text",{x:n+g/2,y:c+a/2,dominantBaseline:"middle",textAnchor:"middle",fill:r?u.contrastingTextColor(r.main):"black"},e):null)})))}var V=function(e){var t,r=e.regions,n=e.theme,o=e.features,a=void 0===o?new Map:o,i=e.showReverse,c=e.showForward,u=e.showTranslation,l=e.bpPerPx,d=N(r,1)[0],h=s.createJBrowseTheme(n),y=p.generateCodonTable(p.defaultCodonTable),v=(t=a.values(),function(e){if(Array.isArray(e))return I(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||z(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0];if(!v)return null;var g=v.get("seq");if(!g)return null;var m=-20;return f.createElement(f.Fragment,null,u&&(d.reversed?i:c)?[2,1,0].map((function(e){return f.createElement(M,{key:"translation-".concat(e),seq:g,y:m+=20,codonTable:y,frame:e,bpPerPx:l,region:d,theme:h,height:20,reverse:d.reversed})})):null,c?f.createElement(G,{height:20,y:m+=20,feature:v,region:d,seq:d.reversed?p.complement(g):g,bpPerPx:l,theme:h}):null,i?f.createElement(G,{height:20,y:m+=20,feature:v,region:d,seq:d.reversed?g:p.complement(g),bpPerPx:l,theme:h}):null,u&&(d.reversed?c:i)?[0,-1,-2].map((function(e){return f.createElement(M,{key:"rev-translation-".concat(e),seq:g,y:m+=20,codonTable:y,frame:e,bpPerPx:l,region:d,theme:h,height:20,reverse:!d.reversed})})):null)},J=function(e){var t=e.width,r=e.totalHeight,n=e.children;return e.exportSVG?f.createElement(f.Fragment,null,n):f.createElement("svg",{width:t,height:r,style:{width:t,height:r}},n)};function U(e){var t=e.bpPerPx,r=N(e.regions,1)[0];return f.createElement(J,Object.assign({},e,{totalHeight:200,width:(r.end-r.start)/t}),f.createElement(V,Object.assign({},e)))}var H=l.observer(U),Y=c.ConfigurationSchema("DivSequenceRenderer",{height:{type:"number",description:"height in pixels of each line of sequence",defaultValue:16}},{explicitlyTyped:!0}),Q=c.ConfigurationSchema("IndexedFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.fai"}}},{explicitlyTyped:!0}),Z=c.ConfigurationSchema("LinearReferenceSequenceDisplay",{renderer:Y},{explicitIdentifier:"displayId",explicitlyTyped:!0}),$=c.ConfigurationSchema("TwoBitAdapter",{twoBitLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.2bit"}}},{explicitlyTyped:!0}),K=function(e){return c.ConfigurationSchema("GCContentAdapter",{sequenceAdapter:e.pluggableConfigSchemaType("adapter")},{explicitlyTyped:!0})},W=function(e){return{configSchema:e.load(K),getAdapterClass:function(){return Promise.resolve().then((function(){return oe})).then((function(e){return e.default}))}}},X=function(e){R(r,n);var t=F(r);function r(){var e;return T(this,r),(e=t.apply(this,arguments)).supportsSVG=!0,e}return E(r,[{key:"getExpandedRegion",value:function(e){return C(C({},e),{},{start:Math.max(e.start-3,0),end:e.end+3})}}]),r}(),ee=function(e){R(u,a);var n=F(u);function u(){var e;return T(this,u),(e=n.apply(this,arguments)).name="SequencePlugin",e}return E(u,[{key:"install",value:function(e){e.addAdapterType((function(){return new t({name:"TwoBitAdapter",configSchema:$,getAdapterClass:function(){return Promise.resolve().then((function(){return ae})).then((function(e){return e.default}))}})})),e.addAdapterType((function(){return new t({name:"ChromSizesAdapter",configSchema:B,getAdapterClass:function(){return Promise.resolve().then((function(){return ie})).then((function(e){return e.default}))}})})),e.addAdapterType((function(){return new t({name:"IndexedFastaAdapter",configSchema:Q,getAdapterClass:function(){return Promise.resolve().then((function(){return ue})).then((function(e){return e.default}))}})})),e.addAdapterType((function(){return new t({name:"BgzipFastaAdapter",configSchema:D,getAdapterClass:function(){return Promise.resolve().then((function(){return se})).then((function(e){return e.default}))}})})),e.addAdapterType((function(){return new t(C({name:"GCContentAdapter"},e.load(W)))})),e.addTrackType((function(){var t=function(e){return c.ConfigurationSchema("ReferenceSequenceTrack",{adapter:e.pluggableConfigSchemaType("adapter"),displays:d.types.array(e.pluggableConfigSchemaType("display")),metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}}},{preProcessSnapshot:function(t){var r=JSON.parse(JSON.stringify(t)),n=new Set,o=r.displays,a=void 0===o?[]:o;return"placeholderId"!==r.trackId&&(a.forEach((function(e){return e&&n.add(e.type)})),e.getTrackType(r.type).displayTypes.forEach((function(e){n.has(e.name)||a.push({displayId:"".concat(r.trackId,"-").concat(e.name),type:e.name})}))),C(C({},r),{},{displays:a})},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:function(e){return{addDisplayConf:function(t){var r=t.type;if(!r)throw new Error("unknown display type ".concat(r));var n=e.displays.find((function(e){return e&&e.displayId===t.displayId}));if(n)return n;var o=e.displays.push(t);return e.displays[o-1]}}}})}(e);return new o({name:"ReferenceSequenceTrack",configSchema:t,stateModel:r.createBaseTrackModel(e,"ReferenceSequenceTrack",t)})})),e.addDisplayType((function(){var e=function(e){return d.types.compose("LinearReferenceSequenceDisplay",i.BaseLinearDisplay,d.types.model({type:d.types.literal("LinearReferenceSequenceDisplay"),configuration:c.ConfigurationReference(e),showForward:d.types.optional(d.types.boolean,!0),showReverse:d.types.optional(d.types.boolean,!0),showTranslation:d.types.optional(d.types.boolean,!0),height:180})).views((function(e){return{get renderProps(){var t=e.showForward,r=e.showReverse,n=e.showTranslation;return C(C(C({},e.composedRenderProps),h.getParentRenderProps(e)),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer,showForward:t,showReverse:r,showTranslation:n})},regionCannotBeRendered:function(){var t=p.getContainingView(e);if(t&&t.bpPerPx>=1)return"Zoom in to see sequence"},get rendererTypeName(){return e.configuration.renderer.type}}})).actions((function(e){return{toggleShowForward:function(){e.showForward=!e.showForward},toggleShowReverse:function(){e.showReverse=!e.showReverse},toggleShowTranslation:function(){e.showTranslation=!e.showTranslation}}})).views((function(e){return{get trackMenuItems(){return[{label:"Show forward",type:"checkbox",checked:e.showForward,onClick:function(){e.toggleShowForward()}},{label:"Show reverse",type:"checkbox",checked:e.showReverse,onClick:function(){e.toggleShowReverse()}},{label:"Show translation",type:"checkbox",checked:e.showTranslation,onClick:function(){e.toggleShowTranslation()}}]}}}))}(Z);return{name:"LinearReferenceSequenceDisplay",configSchema:Z,stateModel:e,trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:i.BaseLinearDisplayComponent}})),e.addRendererType((function(){return new X({name:"DivSequenceRenderer",ReactComponent:H,configSchema:Y,pluginManager:e})}))}}]),u}();function te(e,t){return e(t={exports:{}},t.exports),t.exports}var re=te((function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=Object.create((t&&t.prototype instanceof f?t:f).prototype),a=new k(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return{value:void 0,done:!0}}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var c=b(i,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,a),o}function s(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l={};function f(){}function p(){}function d(){}var h={};h[o]=function(){return this};var y=Object.getPrototypeOf,v=y&&y(y(L([])));v&&v!==t&&r.call(v,o)&&(h=v);var g=d.prototype=f.prototype=Object.create(h);function m(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){var n;this._invoke=function(o,a){function i(){return new t((function(n,i){!function n(o,a,i,c){var u=s(e[o],e,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==typeof f&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):t.resolve(f).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,c)}))}c(u.arg)}(o,a,n,i)}))}return n=n?n.then(i,i):i()}}function b(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function L(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:j}}function j(){return{value:void 0,done:!0}}return p.prototype=g.constructor=d,d.constructor=p,p.displayName=c(d,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,i,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},m(w.prototype),w.prototype[a]=function(){return this},e.AsyncIterator=w,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new w(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},m(g),c(g,i,"Generator"),g[o]=function(){return this},g.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=L,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:L(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}})),ne=function(e){R(o,y.BaseFeatureDataAdapter);var t,r,n=F(o);function o(){var e;return T(this,o),(e=n.apply(this,arguments)).windowSize=1e3,e.windowDelta=1e3,e.gcMode="content",e}return E(o,[{key:"configure",value:(r=j(re.mark((function e(){var t,r,n;return re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.readConfObject(this.config,"sequenceAdapter"),e.next=3,null===(t=this.getSubAdapter)||void 0===t?void 0:t.call(this,r);case 3:if(n=e.sent){e.next=6;break}throw new Error("Error getting subadapter");case 6:return e.abrupt("return",n.dataAdapter);case 7:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getRefNames",value:(t=j(re.mark((function e(){return re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.configure();case 2:return e.abrupt("return",e.sent.getRefNames());case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getFeatures",value:function(e,t){var r=this;return this.windowSize=1e3,this.windowDelta=1e3,this.gcMode="content",v.ObservableCreate(function(){var n=j(re.mark((function n(o){var a,i,c,u,s,l,f,p,d,h,y,v,w,b,x,S;return re.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.configure();case 2:if(a=n.sent,i=1===r.windowSize?1:r.windowSize/2,c=1===r.windowSize,u=e.start,s=e.end,u=Math.max(0,u-i),!((s+=i)<0||u>s)){n.next=11;break}return o.complete(),n.abrupt("return");case 11:return l=a.getFeatures(C(C({},e),{},{start:u,end:s}),t),n.next=14,l.pipe(m.toArray()).toPromise();case 14:for(f=N(n.sent,1),p=f[0].get("seq"),d=i;d<p.length-i;d+=r.windowDelta){for(h=c?p[d]:p.slice(d-i,d+i),y=0,v=0,w=0,b=0;b<h.length;b++)"c"===h[b]||"C"===h[b]?y++:"g"!==h[b]&&"G"!==h[b]||v++,"N"!==h[b]&&w++;x=u,S=void 0,"content"===r.gcMode?S=(v+y)/(w||1):"skew"===r.gcMode&&(S=(v-y)/(v+y||1)),o.next(new g({uniqueId:"".concat(r.id,"_").concat(x+d),start:x+d,end:x+d+r.windowDelta,score:S}))}o.complete();case 20:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),o}();ne.capabilities=["hasLocalStats"];var oe={__proto__:null,default:ne},ae={__proto__:null,default:function(e){R(n,y.BaseFeatureDataAdapter);var t,r=F(n);function n(e){var t;T(this,n),t=r.call(this,e);var o={filehandle:w.openLocation(c.readConfObject(e,"twoBitLocation"))};return t.twobit=new b.TwoBitFile(o),t}return E(n,[{key:"getRefNames",value:function(){return this.twobit.getSequenceNames()}},{key:"getRegions",value:(t=j(re.mark((function e(){var t;return re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.twobit.getSequenceSizes();case 2:return t=e.sent,e.abrupt("return",Object.keys(t).map((function(e){return{refName:e,start:0,end:t[e]}})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getFeatures",value:function(e){var t=this,r=e.refName,n=e.start,o=e.end;return v.ObservableCreate(function(){var e=j(re.mark((function e(a){var i,c,u;return re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.twobit.getSequenceSize(r);case 2:return c=void 0!==(i=e.sent)?Math.min(i,o):o,e.next=6,t.twobit.getSequence(r,n,c);case 6:(u=e.sent)&&a.next(new g({id:"".concat(r," ").concat(n,"-").concat(c),data:{refName:r,start:n,end:c,seq:u}})),a.complete();case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}()},ie={__proto__:null,default:function(e){R(o,y.BaseAdapter);var t,r,n=F(o);function o(e){var t;T(this,o),t=n.call(this,e);var r=c.readConfObject(e,"chromSizesLocation");if(!r)throw new Error("must provide chromSizesLocation");var a=w.openLocation(r);return t.source=a.toString(),t.refSeqs=t.init(a),t}return E(o,[{key:"init",value:(r=j(re.mark((function e(t){var r,n;return re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readFile("utf8");case 2:if(n={},(r=e.sent).length){e.next=6;break}throw new Error("Could not read file ".concat(t.toString()));case 6:return r.split("\n").forEach((function(e){if(e.length){var t=N(e.split("\t"),2);n[t[0]]=+t[1]}})),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"getRegions",value:(t=j(re.mark((function e(){var t;return re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.refSeqs;case 2:return t=e.sent,e.abrupt("return",Object.keys(t).map((function(e){return{refName:e,start:0,end:t[e]}})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"freeResources",value:function(){}}]),o}()},ce=function(e){R(n,y.BaseFeatureDataAdapter);var t,r=F(n);function n(e){var t,o;T(this,n),(t=r.call(this,e)).seqCache=new S({cache:new k({maxSize:200}),fill:(o=j(re.mark((function e(r){return re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.fasta.getSequence(r.refName,r.start,r.end));case 2:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})});var a=c.readConfObject(e,"fastaLocation"),i=c.readConfObject(e,"faiLocation");if(!a)throw new Error("must provide fastaLocation");if(!i)throw new Error("must provide faiLocation");var u={fasta:w.openLocation(a),fai:w.openLocation(i)};return t.fasta=new x.IndexedFasta(u),t}return E(n,[{key:"getRefNames",value:function(){return this.fasta.getSequenceNames()}},{key:"getRegions",value:(t=j(re.mark((function e(){var t;return re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fasta.getSequenceSizes();case 2:return t=e.sent,e.abrupt("return",Object.keys(t).map((function(e){return{refName:e,start:0,end:t[e]}})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getFeatures",value:function(e){var t=this,r=e.refName,n=e.start,o=e.end;return v.ObservableCreate(function(){var e=j(re.mark((function e(a){var i,c,u,s,l,f,p,d;return re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fasta.getSequenceSize(r);case 2:for(c=void 0!==(i=e.sent)?Math.min(i,o):o,u=[],l=o+(128e3-o%128e3),f=s=n-n%128e3;f<l;f+=128e3)p={refName:r,start:f,end:f+128e3},u.push(t.seqCache.get(JSON.stringify(p),p));return e.next=11,Promise.all(u);case 11:(d=e.sent.join("").slice(n-s).slice(0,o-n))&&a.next(new g({id:"".concat(r," ").concat(n,"-").concat(c),data:{refName:r,start:n,end:c,seq:d}})),a.complete();case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}(),ue={__proto__:null,default:ce},se={__proto__:null,default:function(e){R(r,ce);var t=F(r);function r(e){var n;T(this,r),n=t.call(this,e);var o=c.readConfObject(e,"fastaLocation"),a=c.readConfObject(e,"faiLocation"),i=c.readConfObject(e,"gziLocation");if(!o)throw new Error("must provide fastaLocation");if(!a)throw new Error("must provide faiLocation");if(!i)throw new Error("must provide gziLocation");var u={fasta:w.openLocation(o),fai:w.openLocation(a),gzi:w.openLocation(i)};return n.fasta=new x.BgzipIndexedFasta(u),n}return r}()};exports.default=ee;
//# sourceMappingURL=plugin-sequence.cjs.production.min.js.map
