"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

/* eslint prefer-rest-params:0, no-nested-ternary:0 */

/**
 * Adapted from a combination of Range and _Compound in the
 * Dalliance Genome Explorer, (c) Thomas Down 2006-2010.
 */
var Range = /*#__PURE__*/function () {
  function Range(arg1, arg2) {
    (0, _classCallCheck2.default)(this, Range);
    (0, _defineProperty2.default)(this, "ranges", void 0);
    this.ranges = arguments.length === 2 ? [{
      min: arg1,
      max: arg2
    }] : 0 in arg1 ? Object.assign({}, arg1) : [arg1];
  }

  (0, _createClass2.default)(Range, [{
    key: "min",
    value: function min() {
      return this.ranges[0].min;
    }
  }, {
    key: "max",
    value: function max() {
      return this.ranges[this.ranges.length - 1].max;
    }
  }, {
    key: "contains",
    value: function contains(pos) {
      for (var s = 0; s < this.ranges.length; s += 1) {
        var r = this.ranges[s];

        if (r.min <= pos && r.max >= pos) {
          return true;
        }
      }

      return false;
    }
  }, {
    key: "isContiguous",
    value: function isContiguous() {
      return this.ranges.length > 1;
    }
  }, {
    key: "getRanges",
    value: function getRanges() {
      return this.ranges.map(function (r) {
        return new Range(r.min, r.max);
      });
    }
  }, {
    key: "toString",
    value: function toString() {
      return this.ranges.map(function (r) {
        return "[".concat(r.min, "-").concat(r.max, "]");
      }).join(',');
    }
  }, {
    key: "union",
    value: function union(s1) {
      var ranges = this.getRanges().concat(s1.getRanges()).sort(this.rangeOrder);
      var oranges = [];
      var current = ranges[0];

      for (var i = 1; i < ranges.length; i += 1) {
        var nxt = ranges[i];

        if (nxt.min() > current.max() + 1) {
          oranges.push(current);
          current = nxt;
        } else if (nxt.max() > current.max()) {
          current = new Range(current.min(), nxt.max());
        }
      }

      oranges.push(current);

      if (oranges.length === 1) {
        return oranges[0];
      }

      return new Range(oranges);
    }
  }, {
    key: "intersection",
    value: function intersection(arg) {
      // eslint-disable-next-line @typescript-eslint/no-this-alias
      var s0 = this;
      var s1 = arg;
      var r0 = this.ranges();
      var r1 = s1.ranges();
      var l0 = r0.length;
      var l1 = r1.length;
      var i0 = 0;
      var i1 = 0;
      var or = [];

      while (i0 < l0 && i1 < l1) {
        s0 = r0[i0];
        s1 = r1[i1];
        var lapMin = Math.max(s0.min(), s1.min());
        var lapMax = Math.min(s0.max(), s1.max());

        if (lapMax >= lapMin) {
          or.push(new Range(lapMin, lapMax));
        }

        if (s0.max() > s1.max()) {
          i1 += 1;
        } else {
          i0 += 1;
        }
      }

      if (or.length === 0) {
        throw new Error('found range of length 0');
      }

      if (or.length === 1) {
        return or[0];
      }

      return new Range(or);
    }
  }, {
    key: "coverage",
    value: function coverage() {
      var tot = 0;
      var rl = this.ranges();

      for (var ri = 0; ri < rl.length; ri += 1) {
        var r = rl[ri];
        tot += r.max() - r.min() + 1;
      }

      return tot;
    }
  }, {
    key: "rangeOrder",
    value: function rangeOrder(tmpa, tmpb) {
      var a = tmpa;
      var b = tmpb;

      if (arguments.length < 2) {
        b = a;
        a = this;
      }

      if (a.min() < b.min()) {
        return -1;
      }

      if (a.min() > b.min()) {
        return 1;
      }

      if (a.max() < b.max()) {
        return -1;
      }

      if (b.max() > a.max()) {
        return 1;
      }

      return 0;
    }
  }]);
  return Range;
}();

exports.default = Range;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yYW5nZS50cyJdLCJuYW1lcyI6WyJSYW5nZSIsImFyZzEiLCJhcmcyIiwicmFuZ2VzIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwibWluIiwibWF4IiwiT2JqZWN0IiwiYXNzaWduIiwicG9zIiwicyIsInIiLCJtYXAiLCJqb2luIiwiczEiLCJnZXRSYW5nZXMiLCJjb25jYXQiLCJzb3J0IiwicmFuZ2VPcmRlciIsIm9yYW5nZXMiLCJjdXJyZW50IiwiaSIsIm54dCIsInB1c2giLCJhcmciLCJzMCIsInIwIiwicjEiLCJsMCIsImwxIiwiaTAiLCJpMSIsIm9yIiwibGFwTWluIiwiTWF0aCIsImxhcE1heCIsIkVycm9yIiwidG90IiwicmwiLCJyaSIsInRtcGEiLCJ0bXBiIiwiYSIsImIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVBOzs7O0lBSXFCQSxLO0FBR25CLGlCQUFtQkMsSUFBbkIsRUFBOEJDLElBQTlCLEVBQTBDO0FBQUE7QUFBQTtBQUN4QyxTQUFLQyxNQUFMLEdBQ0VDLFNBQVMsQ0FBQ0MsTUFBVixLQUFxQixDQUFyQixHQUNJLENBQUM7QUFBRUMsTUFBQUEsR0FBRyxFQUFFTCxJQUFQO0FBQWFNLE1BQUFBLEdBQUcsRUFBRUw7QUFBbEIsS0FBRCxDQURKLEdBRUksS0FBS0QsSUFBTCxHQUNBTyxNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCUixJQUFsQixDQURBLEdBRUEsQ0FBQ0EsSUFBRCxDQUxOO0FBTUQ7Ozs7MEJBRW9CO0FBQ25CLGFBQU8sS0FBS0UsTUFBTCxDQUFZLENBQVosRUFBZUcsR0FBdEI7QUFDRDs7OzBCQUVvQjtBQUNuQixhQUFPLEtBQUtILE1BQUwsQ0FBWSxLQUFLQSxNQUFMLENBQVlFLE1BQVosR0FBcUIsQ0FBakMsRUFBb0NFLEdBQTNDO0FBQ0Q7Ozs2QkFFZUcsRyxFQUFzQjtBQUNwQyxXQUFLLElBQUlDLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUcsS0FBS1Is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LE1BQXpCLEVBQWlDbUMsRUFBRSxJQUFJLENBQXZDLEVBQTBDO0FBQ3hDLFlBQU01QixDQUFDLEdBQUcyQixFQUFFLENBQUNDLEVBQUQsQ0FBWjtBQUNBRixRQUFBQSxHQUFHLElBQUkxQixDQUFDLENBQUNMLEdBQUYsS0FBVUssQ0FBQyxDQUFDTixHQUFGLEVBQVYsR0FBb0IsQ0FBM0I7QUFDRDs7QUFDRCxhQUFPZ0MsR0FBUDtBQUNEOzs7K0JBRWlCRyxJLEVBQWFDLEksRUFBcUI7QUFDbEQsVUFBSUMsQ0FBQyxHQUFHRixJQUFSO0FBQ0EsVUFBSUcsQ0FBQyxHQUFHRixJQUFSOztBQUNBLFVBQUl0QyxTQUFTLENBQUNDLE1BQVYsR0FBbUIsQ0FBdkIsRUFBMEI7QUFDeEJ1QyxRQUFBQSxDQUFDLEdBQUdELENBQUo7QUFDQUEsUUFBQUEsQ0FBQyxHQUFHLElBQUo7QUFDRDs7QUFFRCxVQUFJQSxDQUFDLENBQUNyQyxHQUFGLEtBQVVzQyxDQUFDLENBQUN0QyxHQUFGLEVBQWQsRUFBdUI7QUFDckIsZUFBTyxDQUFDLENBQVI7QUFDRDs7QUFDRCxVQUFJcUMsQ0FBQyxDQUFDckMsR0FBRixLQUFVc0MsQ0FBQyxDQUFDdEMsR0FBRixFQUFkLEVBQXVCO0FBQ3JCLGVBQU8sQ0FBUDtBQUNEOztBQUNELFVBQUlxQyxDQUFDLENBQUNwQyxHQUFGLEtBQVVxQyxDQUFDLENBQUNyQyxHQUFGLEVBQWQsRUFBdUI7QUFDckIsZUFBTyxDQUFDLENBQVI7QUFDRDs7QUFDRCxVQUFJcUMsQ0FBQyxDQUFDckMsR0FBRixLQUFVb0MsQ0FBQyxDQUFDcEMsR0FBRixFQUFkLEVBQXVCO0FBQ3JCLGVBQU8sQ0FBUDtBQUNEOztBQUNELGFBQU8sQ0FBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50IHByZWZlci1yZXN0LXBhcmFtczowLCBuby1uZXN0ZWQtdGVybmFyeTowICovXG5cbi8qKlxuICogQWRhcHRlZCBmcm9tIGEgY29tYmluYXRpb24gb2YgUmFuZ2UgYW5kIF9Db21wb3VuZCBpbiB0aGVcbiAqIERhbGxpYW5jZSBHZW5vbWUgRXhwbG9yZXIsIChjKSBUaG9tYXMgRG93biAyMDA2LTIwMTAuXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJhbmdlIHtcbiAgcHVibGljIHJhbmdlczogYW55XG5cbiAgcHVibGljIGNvbnN0cnVjdG9yKGFyZzE6IGFueSwgYXJnMj86IGFueSkge1xuICAgIHRoaXMucmFuZ2VzID1cbiAgICAgIGFyZ3VtZW50cy5sZW5ndGggPT09IDJcbiAgICAgICAgPyBbeyBtaW46IGFyZzEsIG1heDogYXJnMiB9XVxuICAgICAgICA6IDAgaW4gYXJnMVxuICAgICAgICA/IE9iamVjdC5hc3NpZ24oe30sIGFyZzEpXG4gICAgICAgIDogW2FyZzFdXG4gIH1cblxuICBwdWJsaWMgbWluKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMucmFuZ2VzWzBdLm1pblxuICB9XG5cbiAgcHVibGljIG1heCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLnJhbmdlc1t0aGlzLnJhbmdlcy5sZW5ndGggLSAxXS5tYXhcbiAgfVxuXG4gIHB1YmxpYyBjb250YWlucyhwb3M6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGZvciAobGV0IHMgPSAwOyBzIDwgdGhpcy5yYW5nZXMubGVuZ3RoOyBzICs9IDEpIHtcbiAgICAgIGNvbnN0IHIgPSB0aGlzLnJhbmdlc1tzXVxuICAgICAgaWYgKHIubWluIDw9IHBvcyAmJiByLm1heCA+PSBwb3MpIHtcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICBwdWJsaWMgaXNDb250aWd1b3VzKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnJhbmdlcy5sZW5ndGggPiAxXG4gIH1cblxuICBwdWJsaWMgZ2V0UmFuZ2VzKCk6IFJhbmdlW10ge1xuICAgIHJldHVybiB0aGlzLnJhbmdlcy5tYXAoKHI6IFJhbmdlKSA9PiBuZXcgUmFuZ2Uoci5taW4sIHIubWF4KSlcbiAgfVxuXG4gIHB1YmxpYyB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnJhbmdlcy5tYXAoKHI6IFJhbmdlKSA9PiBgWyR7ci5taW59LSR7ci5tYXh9XWApLmpvaW4oJywnKVxuICB9XG5cbiAgcHVibGljIHVuaW9uKHMxOiBSYW5nZSk6IFJhbmdlIHtcbiAgICBjb25zdCByYW5nZXMgPSB0aGlzLmdldFJhbmdlcygpXG4gICAgICAuY29uY2F0KHMxLmdldFJhbmdlcygpKVxuICAgICAgLnNvcnQodGhpcy5yYW5nZU9yZGVyKVxuICAgIGNvbnN0IG9yYW5nZXMgPSBbXVxuICAgIGxldCBjdXJyZW50ID0gcmFuZ2VzWzBdXG5cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHJhbmdlcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgY29uc3Qgbnh0ID0gcmFuZ2VzW2ldXG4gICAgICBpZiAobnh0Lm1pbigpID4gY3VycmVudC5tYXgoKSArIDEpIHtcbiAgICAgICAgb3Jhbmdlcy5wdXNoKGN1cnJlbnQpXG4gICAgICAgIGN1cnJlbnQgPSBueHRcbiAgICAgIH0gZWxzZSBpZiAobnh0Lm1heCgpID4gY3VycmVudC5tYXgoKSkge1xuICAgICAgICBjdXJyZW50ID0gbmV3IFJhbmdlKGN1cnJlbnQubWluKCksIG54dC5tYXgoKSlcbiAgICAgIH1cbiAgICB9XG4gICAgb3Jhbmdlcy5wdXNoKGN1cnJlbnQpXG5cbiAgICBpZiAob3Jhbmdlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgIHJldHVybiBvcmFuZ2VzWzBdXG4gICAgfVxuICAgIHJldHVybiBuZXcgUmFuZ2Uob3JhbmdlcylcbiAgfVxuXG4gIHB1YmxpYyBpbnRlcnNlY3Rpb24oYXJnOiBSYW5nZSk6IFJhbmdlIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXRoaXMtYWxpYXNcbiAgICBsZXQgczAgPSB0aGlzXG4gICAgbGV0IHMxID0gYXJnXG4gICAgY29uc3QgcjAgPSB0aGlzLnJhbmdlcygpXG4gICAgY29uc3QgcjEgPSBzMS5yYW5nZXMoKVxuICAgIGNvbnN0IGwwID0gcjAubGVuZ3RoXG5cbiAgICBjb25zdCBsMSA9IHIxLmxlbmd0aFxuICAgIGxldCBpMCA9IDBcblxuICAgIGxldCBpMSA9IDBcbiAgICBjb25zdCBvciA9IFtdXG5cbiAgICB3aGlsZSAoaTAgPCBsMCAmJiBpMSA8IGwxKSB7XG4gICAgICBzMCA9IHIwW2kwXVxuICAgICAgczEgPSByMVtpMV1cbiAgICAgIGNvbnN0IGxhcE1pbiA9IE1hdGgubWF4KHMwLm1pbigpLCBzMS5taW4oKSlcbiAgICAgIGNvbnN0IGxhcE1heCA9IE1hdGgubWluKHMwLm1heCgpLCBzMS5tYXgoKSlcbiAgICAgIGlmIChsYXBNYXggPj0gbGFwTWluKSB7XG4gICAgICAgIG9yLnB1c2gobmV3IFJhbmdlKGxhcE1pbiwgbGFwTWF4KSlcbiAgICAgIH1cbiAgICAgIGlmIChzMC5tYXgoKSA+IHMxLm1heCgpKSB7XG4gICAgICAgIGkxICs9IDFcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGkwICs9IDFcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAob3IubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ZvdW5kIHJhbmdlIG9mIGxlbmd0aCAwJylcbiAgICB9XG4gICAgaWYgKG9yLmxlbmd0aCA9PT0gMSkge1xuICAgICAgcmV0dXJuIG9yWzBdXG4gICAgfVxuICAgIHJldHVybiBuZXcgUmFuZ2Uob3IpXG4gIH1cblxuICBwdWJsaWMgY292ZXJhZ2UoKTogbnVtYmVyIHtcbiAgICBsZXQgdG90ID0gMFxuICAgIGNvbnN0IHJsID0gdGhpcy5yYW5nZXMoKVxuICAgIGZvciAobGV0IHJpID0gMDsgcmkgPCBybC5sZW5ndGg7IHJpICs9IDEpIHtcbiAgICAgIGNvbnN0IHIgPSBybFtyaV1cbiAgICAgIHRvdCArPSByLm1heCgpIC0gci5taW4oKSArIDFcbiAgICB9XG4gICAgcmV0dXJuIHRvdFxuICB9XG5cbiAgcHVibGljIHJhbmdlT3JkZXIodG1wYTogUmFuZ2UsIHRtcGI6IFJhbmdlKTogbnVtYmVyIHtcbiAgICBsZXQgYSA9IHRtcGFcbiAgICBsZXQgYiA9IHRtcGJcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHtcbiAgICAgIGIgPSBhXG4gICAgICBhID0gdGhpc1xuICAgIH1cblxuICAgIGlmIChhLm1pbigpIDwgYi5taW4oKSkge1xuICAgICAgcmV0dXJuIC0xXG4gICAgfVxuICAgIGlmIChhLm1pbigpID4gYi5taW4oKSkge1xuICAgICAgcmV0dXJuIDFcbiAgICB9XG4gICAgaWYgKGEubWF4KCkgPCBiLm1heCgpKSB7XG4gICAgICByZXR1cm4gLTFcbiAgICB9XG4gICAgaWYgKGIubWF4KCkgPiBhLm1heCgpKSB7XG4gICAgICByZXR1cm4gMVxuICAgIH1cbiAgICByZXR1cm4gMFxuICB9XG59XG4iXX0=